(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))m(w);new MutationObserver(w=>{for(const S of w)if(S.type==="childList")for(const P of S.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&m(P)}).observe(document,{childList:!0,subtree:!0});function u(w){const S={};return w.integrity&&(S.integrity=w.integrity),w.referrerpolicy&&(S.referrerPolicy=w.referrerpolicy),w.crossorigin==="use-credentials"?S.credentials="include":w.crossorigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function m(w){if(w.ep)return;w.ep=!0;const S=u(w);fetch(w.href,S)}})();var fS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},gr={exports:{}},Wt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var od=Symbol.for("react.element"),mS=Symbol.for("react.portal"),_S=Symbol.for("react.fragment"),gS=Symbol.for("react.strict_mode"),yS=Symbol.for("react.profiler"),xS=Symbol.for("react.provider"),vS=Symbol.for("react.context"),wS=Symbol.for("react.forward_ref"),bS=Symbol.for("react.suspense"),TS=Symbol.for("react.memo"),ES=Symbol.for("react.lazy"),Gv=Symbol.iterator;function SS(n){return n===null||typeof n!="object"?null:(n=Gv&&n[Gv]||n["@@iterator"],typeof n=="function"?n:null)}var dw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pw=Object.assign,fw={};function Qc(n,o,u){this.props=n,this.context=o,this.refs=fw,this.updater=u||dw}Qc.prototype.isReactComponent={};Qc.prototype.setState=function(n,o){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,o,"setState")};Qc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function mw(){}mw.prototype=Qc.prototype;function Ty(n,o,u){this.props=n,this.context=o,this.refs=fw,this.updater=u||dw}var Ey=Ty.prototype=new mw;Ey.constructor=Ty;pw(Ey,Qc.prototype);Ey.isPureReactComponent=!0;var $v=Array.isArray,_w=Object.prototype.hasOwnProperty,Sy={current:null},gw={key:!0,ref:!0,__self:!0,__source:!0};function yw(n,o,u){var m,w={},S=null,P=null;if(o!=null)for(m in o.ref!==void 0&&(P=o.ref),o.key!==void 0&&(S=""+o.key),o)_w.call(o,m)&&!gw.hasOwnProperty(m)&&(w[m]=o[m]);var a=arguments.length-2;if(a===1)w.children=u;else if(1<a){for(var U=Array(a),de=0;de<a;de++)U[de]=arguments[de+2];w.children=U}if(n&&n.defaultProps)for(m in a=n.defaultProps,a)w[m]===void 0&&(w[m]=a[m]);return{$$typeof:od,type:n,key:S,ref:P,props:w,_owner:Sy.current}}function CS(n,o){return{$$typeof:od,type:n.type,key:o,ref:n.ref,props:n.props,_owner:n._owner}}function Cy(n){return typeof n=="object"&&n!==null&&n.$$typeof===od}function IS(n){var o={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(u){return o[u]})}var Zv=/\/+/g;function G_(n,o){return typeof n=="object"&&n!==null&&n.key!=null?IS(""+n.key):o.toString(36)}function df(n,o,u,m,w){var S=typeof n;(S==="undefined"||S==="boolean")&&(n=null);var P=!1;if(n===null)P=!0;else switch(S){case"string":case"number":P=!0;break;case"object":switch(n.$$typeof){case od:case mS:P=!0}}if(P)return P=n,w=w(P),n=m===""?"."+G_(P,0):m,$v(w)?(u="",n!=null&&(u=n.replace(Zv,"$&/")+"/"),df(w,o,u,"",function(de){return de})):w!=null&&(Cy(w)&&(w=CS(w,u+(!w.key||P&&P.key===w.key?"":(""+w.key).replace(Zv,"$&/")+"/")+n)),o.push(w)),1;if(P=0,m=m===""?".":m+":",$v(n))for(var a=0;a<n.length;a++){S=n[a];var U=m+G_(S,a);P+=df(S,o,u,U,w)}else if(U=SS(n),typeof U=="function")for(n=U.call(n),a=0;!(S=n.next()).done;)S=S.value,U=m+G_(S,a++),P+=df(S,o,u,U,w);else if(S==="object")throw o=String(n),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return P}function Gp(n,o,u){if(n==null)return n;var m=[],w=0;return df(n,m,"","",function(S){return o.call(u,S,w++)}),m}function AS(n){if(n._status===-1){var o=n._result;o=o(),o.then(function(u){(n._status===0||n._status===-1)&&(n._status=1,n._result=u)},function(u){(n._status===0||n._status===-1)&&(n._status=2,n._result=u)}),n._status===-1&&(n._status=0,n._result=o)}if(n._status===1)return n._result.default;throw n._result}var Ri={current:null},pf={transition:null},MS={ReactCurrentDispatcher:Ri,ReactCurrentBatchConfig:pf,ReactCurrentOwner:Sy};Wt.Children={map:Gp,forEach:function(n,o,u){Gp(n,function(){o.apply(this,arguments)},u)},count:function(n){var o=0;return Gp(n,function(){o++}),o},toArray:function(n){return Gp(n,function(o){return o})||[]},only:function(n){if(!Cy(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Wt.Component=Qc;Wt.Fragment=_S;Wt.Profiler=yS;Wt.PureComponent=Ty;Wt.StrictMode=gS;Wt.Suspense=bS;Wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=MS;Wt.cloneElement=function(n,o,u){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var m=pw({},n.props),w=n.key,S=n.ref,P=n._owner;if(o!=null){if(o.ref!==void 0&&(S=o.ref,P=Sy.current),o.key!==void 0&&(w=""+o.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(U in o)_w.call(o,U)&&!gw.hasOwnProperty(U)&&(m[U]=o[U]===void 0&&a!==void 0?a[U]:o[U])}var U=arguments.length-2;if(U===1)m.children=u;else if(1<U){a=Array(U);for(var de=0;de<U;de++)a[de]=arguments[de+2];m.children=a}return{$$typeof:od,type:n.type,key:w,ref:S,props:m,_owner:P}};Wt.createContext=function(n){return n={$$typeof:vS,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:xS,_context:n},n.Consumer=n};Wt.createElement=yw;Wt.createFactory=function(n){var o=yw.bind(null,n);return o.type=n,o};Wt.createRef=function(){return{current:null}};Wt.forwardRef=function(n){return{$$typeof:wS,render:n}};Wt.isValidElement=Cy;Wt.lazy=function(n){return{$$typeof:ES,_payload:{_status:-1,_result:n},_init:AS}};Wt.memo=function(n,o){return{$$typeof:TS,type:n,compare:o===void 0?null:o}};Wt.startTransition=function(n){var o=pf.transition;pf.transition={};try{n()}finally{pf.transition=o}};Wt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Wt.useCallback=function(n,o){return Ri.current.useCallback(n,o)};Wt.useContext=function(n){return Ri.current.useContext(n)};Wt.useDebugValue=function(){};Wt.useDeferredValue=function(n){return Ri.current.useDeferredValue(n)};Wt.useEffect=function(n,o){return Ri.current.useEffect(n,o)};Wt.useId=function(){return Ri.current.useId()};Wt.useImperativeHandle=function(n,o,u){return Ri.current.useImperativeHandle(n,o,u)};Wt.useInsertionEffect=function(n,o){return Ri.current.useInsertionEffect(n,o)};Wt.useLayoutEffect=function(n,o){return Ri.current.useLayoutEffect(n,o)};Wt.useMemo=function(n,o){return Ri.current.useMemo(n,o)};Wt.useReducer=function(n,o,u){return Ri.current.useReducer(n,o,u)};Wt.useRef=function(n){return Ri.current.useRef(n)};Wt.useState=function(n){return Ri.current.useState(n)};Wt.useSyncExternalStore=function(n,o,u){return Ri.current.useSyncExternalStore(n,o,u)};Wt.useTransition=function(){return Ri.current.useTransition()};Wt.version="18.2.0";(function(n){n.exports=Wt})(gr);var yg={},xw={exports:{}},_n={},vw={exports:{}},ww={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function o(it,wt){var vt=it.length;it.push(wt);e:for(;0<vt;){var sr=vt-1>>>1,zt=it[sr];if(0<w(zt,wt))it[sr]=wt,it[vt]=zt,vt=sr;else break e}}function u(it){return it.length===0?null:it[0]}function m(it){if(it.length===0)return null;var wt=it[0],vt=it.pop();if(vt!==wt){it[0]=vt;e:for(var sr=0,zt=it.length,Mr=zt>>>1;sr<Mr;){var Zr=2*(sr+1)-1,qr=it[Zr],Wr=Zr+1,fi=it[Wr];if(0>w(qr,vt))Wr<zt&&0>w(fi,qr)?(it[sr]=fi,it[Wr]=vt,sr=Wr):(it[sr]=qr,it[Zr]=vt,sr=Zr);else if(Wr<zt&&0>w(fi,vt))it[sr]=fi,it[Wr]=vt,sr=Wr;else break e}}return wt}function w(it,wt){var vt=it.sortIndex-wt.sortIndex;return vt!==0?vt:it.id-wt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var S=performance;n.unstable_now=function(){return S.now()}}else{var P=Date,a=P.now();n.unstable_now=function(){return P.now()-a}}var U=[],de=[],Me=1,ne=null,me=3,Ge=!1,Ye=!1,ze=!1,kt=typeof setTimeout=="function"?setTimeout:null,ge=typeof clearTimeout=="function"?clearTimeout:null,he=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function we(it){for(var wt=u(de);wt!==null;){if(wt.callback===null)m(de);else if(wt.startTime<=it)m(de),wt.sortIndex=wt.expirationTime,o(U,wt);else break;wt=u(de)}}function je(it){if(ze=!1,we(it),!Ye)if(u(U)!==null)Ye=!0,Ui(Fe);else{var wt=u(de);wt!==null&&yn(je,wt.startTime-it)}}function Fe(it,wt){Ye=!1,ze&&(ze=!1,ge(ft),ft=-1),Ge=!0;var vt=me;try{for(we(wt),ne=u(U);ne!==null&&(!(ne.expirationTime>wt)||it&&!ai());){var sr=ne.callback;if(typeof sr=="function"){ne.callback=null,me=ne.priorityLevel;var zt=sr(ne.expirationTime<=wt);wt=n.unstable_now(),typeof zt=="function"?ne.callback=zt:ne===u(U)&&m(U),we(wt)}else m(U);ne=u(U)}if(ne!==null)var Mr=!0;else{var Zr=u(de);Zr!==null&&yn(je,Zr.startTime-wt),Mr=!1}return Mr}finally{ne=null,me=vt,Ge=!1}}var st=!1,lt=null,ft=-1,nr=5,xt=-1;function ai(){return!(n.unstable_now()-xt<nr)}function Oi(){if(lt!==null){var it=n.unstable_now();xt=it;var wt=!0;try{wt=lt(!0,it)}finally{wt?Fi():(st=!1,lt=null)}}else st=!1}var Fi;if(typeof he=="function")Fi=function(){he(Oi)};else if(typeof MessageChannel<"u"){var Co=new MessageChannel,as=Co.port2;Co.port1.onmessage=Oi,Fi=function(){as.postMessage(null)}}else Fi=function(){kt(Oi,0)};function Ui(it){lt=it,st||(st=!0,Fi())}function yn(it,wt){ft=kt(function(){it(n.unstable_now())},wt)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(it){it.callback=null},n.unstable_continueExecution=function(){Ye||Ge||(Ye=!0,Ui(Fe))},n.unstable_forceFrameRate=function(it){0>it||125<it?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):nr=0<it?Math.floor(1e3/it):5},n.unstable_getCurrentPriorityLevel=function(){return me},n.unstable_getFirstCallbackNode=function(){return u(U)},n.unstable_next=function(it){switch(me){case 1:case 2:case 3:var wt=3;break;default:wt=me}var vt=me;me=wt;try{return it()}finally{me=vt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(it,wt){switch(it){case 1:case 2:case 3:case 4:case 5:break;default:it=3}var vt=me;me=it;try{return wt()}finally{me=vt}},n.unstable_scheduleCallback=function(it,wt,vt){var sr=n.unstable_now();switch(typeof vt=="object"&&vt!==null?(vt=vt.delay,vt=typeof vt=="number"&&0<vt?sr+vt:sr):vt=sr,it){case 1:var zt=-1;break;case 2:zt=250;break;case 5:zt=1073741823;break;case 4:zt=1e4;break;default:zt=5e3}return zt=vt+zt,it={id:Me++,callback:wt,priorityLevel:it,startTime:vt,expirationTime:zt,sortIndex:-1},vt>sr?(it.sortIndex=vt,o(de,it),u(U)===null&&it===u(de)&&(ze?(ge(ft),ft=-1):ze=!0,yn(je,vt-sr))):(it.sortIndex=zt,o(U,it),Ye||Ge||(Ye=!0,Ui(Fe))),it},n.unstable_shouldYield=ai,n.unstable_wrapCallback=function(it){var wt=me;return function(){var vt=me;me=wt;try{return it.apply(this,arguments)}finally{me=vt}}}})(ww);(function(n){n.exports=ww})(vw);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bw=gr.exports,mn=vw.exports;function Xe(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,u=1;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Tw=new Set,Vh={};function _l(n,o){qc(n,o),qc(n+"Capture",o)}function qc(n,o){for(Vh[n]=o,n=0;n<o.length;n++)Tw.add(o[n])}var rs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xg=Object.prototype.hasOwnProperty,kS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qv={},Wv={};function zS(n){return xg.call(Wv,n)?!0:xg.call(qv,n)?!1:kS.test(n)?Wv[n]=!0:(qv[n]=!0,!1)}function PS(n,o,u,m){if(u!==null&&u.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return m?!1:u!==null?!u.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function DS(n,o,u,m){if(o===null||typeof o>"u"||PS(n,o,u,m))return!0;if(m)return!1;if(u!==null)switch(u.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Bi(n,o,u,m,w,S,P){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=m,this.attributeNamespace=w,this.mustUseProperty=u,this.propertyName=n,this.type=o,this.sanitizeURL=S,this.removeEmptyString=P}var pi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){pi[n]=new Bi(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];pi[o]=new Bi(o,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){pi[n]=new Bi(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){pi[n]=new Bi(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){pi[n]=new Bi(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){pi[n]=new Bi(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){pi[n]=new Bi(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){pi[n]=new Bi(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){pi[n]=new Bi(n,5,!1,n.toLowerCase(),null,!1,!1)});var Iy=/[\-:]([a-z])/g;function Ay(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(Iy,Ay);pi[o]=new Bi(o,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(Iy,Ay);pi[o]=new Bi(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(Iy,Ay);pi[o]=new Bi(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){pi[n]=new Bi(n,1,!1,n.toLowerCase(),null,!1,!1)});pi.xlinkHref=new Bi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){pi[n]=new Bi(n,1,!1,n.toLowerCase(),null,!0,!0)});function My(n,o,u,m){var w=pi.hasOwnProperty(o)?pi[o]:null;(w!==null?w.type!==0:m||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(DS(o,u,w,m)&&(u=null),m||w===null?zS(o)&&(u===null?n.removeAttribute(o):n.setAttribute(o,""+u)):w.mustUseProperty?n[w.propertyName]=u===null?w.type===3?!1:"":u:(o=w.attributeName,m=w.attributeNamespace,u===null?n.removeAttribute(o):(w=w.type,u=w===3||w===4&&u===!0?"":""+u,m?n.setAttributeNS(m,o,u):n.setAttribute(o,u))))}var ss=bw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$p=Symbol.for("react.element"),Ac=Symbol.for("react.portal"),Mc=Symbol.for("react.fragment"),ky=Symbol.for("react.strict_mode"),vg=Symbol.for("react.profiler"),Ew=Symbol.for("react.provider"),Sw=Symbol.for("react.context"),zy=Symbol.for("react.forward_ref"),wg=Symbol.for("react.suspense"),bg=Symbol.for("react.suspense_list"),Py=Symbol.for("react.memo"),Zs=Symbol.for("react.lazy"),Cw=Symbol.for("react.offscreen"),Xv=Symbol.iterator;function yh(n){return n===null||typeof n!="object"?null:(n=Xv&&n[Xv]||n["@@iterator"],typeof n=="function"?n:null)}var Rr=Object.assign,$_;function Ih(n){if($_===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);$_=o&&o[1]||""}return`
`+$_+n}var Z_=!1;function q_(n,o){if(!n||Z_)return"";Z_=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(de){var m=de}Reflect.construct(n,[],o)}else{try{o.call()}catch(de){m=de}n.call(o.prototype)}else{try{throw Error()}catch(de){m=de}n()}}catch(de){if(de&&m&&typeof de.stack=="string"){for(var w=de.stack.split(`
`),S=m.stack.split(`
`),P=w.length-1,a=S.length-1;1<=P&&0<=a&&w[P]!==S[a];)a--;for(;1<=P&&0<=a;P--,a--)if(w[P]!==S[a]){if(P!==1||a!==1)do if(P--,a--,0>a||w[P]!==S[a]){var U=`
`+w[P].replace(" at new "," at ");return n.displayName&&U.includes("<anonymous>")&&(U=U.replace("<anonymous>",n.displayName)),U}while(1<=P&&0<=a);break}}}finally{Z_=!1,Error.prepareStackTrace=u}return(n=n?n.displayName||n.name:"")?Ih(n):""}function LS(n){switch(n.tag){case 5:return Ih(n.type);case 16:return Ih("Lazy");case 13:return Ih("Suspense");case 19:return Ih("SuspenseList");case 0:case 2:case 15:return n=q_(n.type,!1),n;case 11:return n=q_(n.type.render,!1),n;case 1:return n=q_(n.type,!0),n;default:return""}}function Tg(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Mc:return"Fragment";case Ac:return"Portal";case vg:return"Profiler";case ky:return"StrictMode";case wg:return"Suspense";case bg:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Sw:return(n.displayName||"Context")+".Consumer";case Ew:return(n._context.displayName||"Context")+".Provider";case zy:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Py:return o=n.displayName||null,o!==null?o:Tg(n.type)||"Memo";case Zs:o=n._payload,n=n._init;try{return Tg(n(o))}catch{}}return null}function RS(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Tg(o);case 8:return o===ky?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function aa(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Iw(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function BS(n){var o=Iw(n)?"checked":"value",u=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),m=""+n[o];if(!n.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var w=u.get,S=u.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return w.call(this)},set:function(P){m=""+P,S.call(this,P)}}),Object.defineProperty(n,o,{enumerable:u.enumerable}),{getValue:function(){return m},setValue:function(P){m=""+P},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function Zp(n){n._valueTracker||(n._valueTracker=BS(n))}function Aw(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var u=o.getValue(),m="";return n&&(m=Iw(n)?n.checked?"true":"false":n.value),n=m,n!==u?(o.setValue(n),!0):!1}function Af(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Eg(n,o){var u=o.checked;return Rr({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u!=null?u:n._wrapperState.initialChecked})}function Hv(n,o){var u=o.defaultValue==null?"":o.defaultValue,m=o.checked!=null?o.checked:o.defaultChecked;u=aa(o.value!=null?o.value:u),n._wrapperState={initialChecked:m,initialValue:u,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Mw(n,o){o=o.checked,o!=null&&My(n,"checked",o,!1)}function Sg(n,o){Mw(n,o);var u=aa(o.value),m=o.type;if(u!=null)m==="number"?(u===0&&n.value===""||n.value!=u)&&(n.value=""+u):n.value!==""+u&&(n.value=""+u);else if(m==="submit"||m==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?Cg(n,o.type,u):o.hasOwnProperty("defaultValue")&&Cg(n,o.type,aa(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function Yv(n,o,u){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var m=o.type;if(!(m!=="submit"&&m!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,u||o===n.value||(n.value=o),n.defaultValue=o}u=n.name,u!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,u!==""&&(n.name=u)}function Cg(n,o,u){(o!=="number"||Af(n.ownerDocument)!==n)&&(u==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+u&&(n.defaultValue=""+u))}var Ah=Array.isArray;function Nc(n,o,u,m){if(n=n.options,o){o={};for(var w=0;w<u.length;w++)o["$"+u[w]]=!0;for(u=0;u<n.length;u++)w=o.hasOwnProperty("$"+n[u].value),n[u].selected!==w&&(n[u].selected=w),w&&m&&(n[u].defaultSelected=!0)}else{for(u=""+aa(u),o=null,w=0;w<n.length;w++){if(n[w].value===u){n[w].selected=!0,m&&(n[w].defaultSelected=!0);return}o!==null||n[w].disabled||(o=n[w])}o!==null&&(o.selected=!0)}}function Ig(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Xe(91));return Rr({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Kv(n,o){var u=o.value;if(u==null){if(u=o.children,o=o.defaultValue,u!=null){if(o!=null)throw Error(Xe(92));if(Ah(u)){if(1<u.length)throw Error(Xe(93));u=u[0]}o=u}o==null&&(o=""),u=o}n._wrapperState={initialValue:aa(u)}}function kw(n,o){var u=aa(o.value),m=aa(o.defaultValue);u!=null&&(u=""+u,u!==n.value&&(n.value=u),o.defaultValue==null&&n.defaultValue!==u&&(n.defaultValue=u)),m!=null&&(n.defaultValue=""+m)}function Jv(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function zw(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ag(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?zw(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var qp,Pw=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,u,m,w){MSApp.execUnsafeLocalFunction(function(){return n(o,u,m,w)})}:n}(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for(qp=qp||document.createElement("div"),qp.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=qp.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function jh(n,o){if(o){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=o;return}}n.textContent=o}var Ph={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},OS=["Webkit","ms","Moz","O"];Object.keys(Ph).forEach(function(n){OS.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),Ph[o]=Ph[n]})});function Dw(n,o,u){return o==null||typeof o=="boolean"||o===""?"":u||typeof o!="number"||o===0||Ph.hasOwnProperty(n)&&Ph[n]?(""+o).trim():o+"px"}function Lw(n,o){n=n.style;for(var u in o)if(o.hasOwnProperty(u)){var m=u.indexOf("--")===0,w=Dw(u,o[u],m);u==="float"&&(u="cssFloat"),m?n.setProperty(u,w):n[u]=w}}var FS=Rr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Mg(n,o){if(o){if(FS[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Xe(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Xe(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Xe(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Xe(62))}}function kg(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zg=null;function Dy(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Pg=null,Vc=null,jc=null;function Qv(n){if(n=ld(n)){if(typeof Pg!="function")throw Error(Xe(280));var o=n.stateNode;o&&(o=nm(o),Pg(n.stateNode,n.type,o))}}function Rw(n){Vc?jc?jc.push(n):jc=[n]:Vc=n}function Bw(){if(Vc){var n=Vc,o=jc;if(jc=Vc=null,Qv(n),o)for(n=0;n<o.length;n++)Qv(o[n])}}function Ow(n,o){return n(o)}function Fw(){}var W_=!1;function Uw(n,o,u){if(W_)return n(o,u);W_=!0;try{return Ow(n,o,u)}finally{W_=!1,(Vc!==null||jc!==null)&&(Fw(),Bw())}}function Gh(n,o){var u=n.stateNode;if(u===null)return null;var m=nm(u);if(m===null)return null;u=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(n=n.type,m=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!m;break e;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(Xe(231,o,typeof u));return u}var Dg=!1;if(rs)try{var xh={};Object.defineProperty(xh,"passive",{get:function(){Dg=!0}}),window.addEventListener("test",xh,xh),window.removeEventListener("test",xh,xh)}catch{Dg=!1}function US(n,o,u,m,w,S,P,a,U){var de=Array.prototype.slice.call(arguments,3);try{o.apply(u,de)}catch(Me){this.onError(Me)}}var Dh=!1,Mf=null,kf=!1,Lg=null,NS={onError:function(n){Dh=!0,Mf=n}};function VS(n,o,u,m,w,S,P,a,U){Dh=!1,Mf=null,US.apply(NS,arguments)}function jS(n,o,u,m,w,S,P,a,U){if(VS.apply(this,arguments),Dh){if(Dh){var de=Mf;Dh=!1,Mf=null}else throw Error(Xe(198));kf||(kf=!0,Lg=de)}}function gl(n){var o=n,u=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,(o.flags&4098)!==0&&(u=o.return),n=o.return;while(n)}return o.tag===3?u:null}function Nw(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function e1(n){if(gl(n)!==n)throw Error(Xe(188))}function GS(n){var o=n.alternate;if(!o){if(o=gl(n),o===null)throw Error(Xe(188));return o!==n?null:n}for(var u=n,m=o;;){var w=u.return;if(w===null)break;var S=w.alternate;if(S===null){if(m=w.return,m!==null){u=m;continue}break}if(w.child===S.child){for(S=w.child;S;){if(S===u)return e1(w),n;if(S===m)return e1(w),o;S=S.sibling}throw Error(Xe(188))}if(u.return!==m.return)u=w,m=S;else{for(var P=!1,a=w.child;a;){if(a===u){P=!0,u=w,m=S;break}if(a===m){P=!0,m=w,u=S;break}a=a.sibling}if(!P){for(a=S.child;a;){if(a===u){P=!0,u=S,m=w;break}if(a===m){P=!0,m=S,u=w;break}a=a.sibling}if(!P)throw Error(Xe(189))}}if(u.alternate!==m)throw Error(Xe(190))}if(u.tag!==3)throw Error(Xe(188));return u.stateNode.current===u?n:o}function Vw(n){return n=GS(n),n!==null?jw(n):null}function jw(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=jw(n);if(o!==null)return o;n=n.sibling}return null}var Gw=mn.unstable_scheduleCallback,t1=mn.unstable_cancelCallback,$S=mn.unstable_shouldYield,ZS=mn.unstable_requestPaint,Vr=mn.unstable_now,qS=mn.unstable_getCurrentPriorityLevel,Ly=mn.unstable_ImmediatePriority,$w=mn.unstable_UserBlockingPriority,zf=mn.unstable_NormalPriority,WS=mn.unstable_LowPriority,Zw=mn.unstable_IdlePriority,em=null,bo=null;function XS(n){if(bo&&typeof bo.onCommitFiberRoot=="function")try{bo.onCommitFiberRoot(em,n,void 0,(n.current.flags&128)===128)}catch{}}var to=Math.clz32?Math.clz32:KS,HS=Math.log,YS=Math.LN2;function KS(n){return n>>>=0,n===0?32:31-(HS(n)/YS|0)|0}var Wp=64,Xp=4194304;function Mh(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Pf(n,o){var u=n.pendingLanes;if(u===0)return 0;var m=0,w=n.suspendedLanes,S=n.pingedLanes,P=u&268435455;if(P!==0){var a=P&~w;a!==0?m=Mh(a):(S&=P,S!==0&&(m=Mh(S)))}else P=u&~w,P!==0?m=Mh(P):S!==0&&(m=Mh(S));if(m===0)return 0;if(o!==0&&o!==m&&(o&w)===0&&(w=m&-m,S=o&-o,w>=S||w===16&&(S&4194240)!==0))return o;if((m&4)!==0&&(m|=u&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=m;0<o;)u=31-to(o),w=1<<u,m|=n[u],o&=~w;return m}function JS(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function QS(n,o){for(var u=n.suspendedLanes,m=n.pingedLanes,w=n.expirationTimes,S=n.pendingLanes;0<S;){var P=31-to(S),a=1<<P,U=w[P];U===-1?((a&u)===0||(a&m)!==0)&&(w[P]=JS(a,o)):U<=o&&(n.expiredLanes|=a),S&=~a}}function Rg(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function qw(){var n=Wp;return Wp<<=1,(Wp&4194240)===0&&(Wp=64),n}function X_(n){for(var o=[],u=0;31>u;u++)o.push(n);return o}function sd(n,o,u){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-to(o),n[o]=u}function eC(n,o){var u=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var m=n.eventTimes;for(n=n.expirationTimes;0<u;){var w=31-to(u),S=1<<w;o[w]=0,m[w]=-1,n[w]=-1,u&=~S}}function Ry(n,o){var u=n.entangledLanes|=o;for(n=n.entanglements;u;){var m=31-to(u),w=1<<m;w&o|n[m]&o&&(n[m]|=o),u&=~w}}var cr=0;function Ww(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var Xw,By,Hw,Yw,Kw,Bg=!1,Hp=[],Qs=null,ea=null,ta=null,$h=new Map,Zh=new Map,Ws=[],tC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function r1(n,o){switch(n){case"focusin":case"focusout":Qs=null;break;case"dragenter":case"dragleave":ea=null;break;case"mouseover":case"mouseout":ta=null;break;case"pointerover":case"pointerout":$h.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zh.delete(o.pointerId)}}function vh(n,o,u,m,w,S){return n===null||n.nativeEvent!==S?(n={blockedOn:o,domEventName:u,eventSystemFlags:m,nativeEvent:S,targetContainers:[w]},o!==null&&(o=ld(o),o!==null&&By(o)),n):(n.eventSystemFlags|=m,o=n.targetContainers,w!==null&&o.indexOf(w)===-1&&o.push(w),n)}function rC(n,o,u,m,w){switch(o){case"focusin":return Qs=vh(Qs,n,o,u,m,w),!0;case"dragenter":return ea=vh(ea,n,o,u,m,w),!0;case"mouseover":return ta=vh(ta,n,o,u,m,w),!0;case"pointerover":var S=w.pointerId;return $h.set(S,vh($h.get(S)||null,n,o,u,m,w)),!0;case"gotpointercapture":return S=w.pointerId,Zh.set(S,vh(Zh.get(S)||null,n,o,u,m,w)),!0}return!1}function Jw(n){var o=sl(n.target);if(o!==null){var u=gl(o);if(u!==null){if(o=u.tag,o===13){if(o=Nw(u),o!==null){n.blockedOn=o,Kw(n.priority,function(){Hw(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function ff(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var u=Og(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(u===null){u=n.nativeEvent;var m=new u.constructor(u.type,u);zg=m,u.target.dispatchEvent(m),zg=null}else return o=ld(u),o!==null&&By(o),n.blockedOn=u,!1;o.shift()}return!0}function i1(n,o,u){ff(n)&&u.delete(o)}function iC(){Bg=!1,Qs!==null&&ff(Qs)&&(Qs=null),ea!==null&&ff(ea)&&(ea=null),ta!==null&&ff(ta)&&(ta=null),$h.forEach(i1),Zh.forEach(i1)}function wh(n,o){n.blockedOn===o&&(n.blockedOn=null,Bg||(Bg=!0,mn.unstable_scheduleCallback(mn.unstable_NormalPriority,iC)))}function qh(n){function o(w){return wh(w,n)}if(0<Hp.length){wh(Hp[0],n);for(var u=1;u<Hp.length;u++){var m=Hp[u];m.blockedOn===n&&(m.blockedOn=null)}}for(Qs!==null&&wh(Qs,n),ea!==null&&wh(ea,n),ta!==null&&wh(ta,n),$h.forEach(o),Zh.forEach(o),u=0;u<Ws.length;u++)m=Ws[u],m.blockedOn===n&&(m.blockedOn=null);for(;0<Ws.length&&(u=Ws[0],u.blockedOn===null);)Jw(u),u.blockedOn===null&&Ws.shift()}var Gc=ss.ReactCurrentBatchConfig,Df=!0;function nC(n,o,u,m){var w=cr,S=Gc.transition;Gc.transition=null;try{cr=1,Oy(n,o,u,m)}finally{cr=w,Gc.transition=S}}function oC(n,o,u,m){var w=cr,S=Gc.transition;Gc.transition=null;try{cr=4,Oy(n,o,u,m)}finally{cr=w,Gc.transition=S}}function Oy(n,o,u,m){if(Df){var w=Og(n,o,u,m);if(w===null)ng(n,o,m,Lf,u),r1(n,m);else if(rC(w,n,o,u,m))m.stopPropagation();else if(r1(n,m),o&4&&-1<tC.indexOf(n)){for(;w!==null;){var S=ld(w);if(S!==null&&Xw(S),S=Og(n,o,u,m),S===null&&ng(n,o,m,Lf,u),S===w)break;w=S}w!==null&&m.stopPropagation()}else ng(n,o,m,null,u)}}var Lf=null;function Og(n,o,u,m){if(Lf=null,n=Dy(m),n=sl(n),n!==null)if(o=gl(n),o===null)n=null;else if(u=o.tag,u===13){if(n=Nw(o),n!==null)return n;n=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return Lf=n,null}function Qw(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qS()){case Ly:return 1;case $w:return 4;case zf:case WS:return 16;case Zw:return 536870912;default:return 16}default:return 16}}var Ys=null,Fy=null,mf=null;function eb(){if(mf)return mf;var n,o=Fy,u=o.length,m,w="value"in Ys?Ys.value:Ys.textContent,S=w.length;for(n=0;n<u&&o[n]===w[n];n++);var P=u-n;for(m=1;m<=P&&o[u-m]===w[S-m];m++);return mf=w.slice(n,1<m?1-m:void 0)}function _f(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function Yp(){return!0}function n1(){return!1}function gn(n){function o(u,m,w,S,P){this._reactName=u,this._targetInst=w,this.type=m,this.nativeEvent=S,this.target=P,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(u=n[a],this[a]=u?u(S):S[a]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?Yp:n1,this.isPropagationStopped=n1,this}return Rr(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Yp)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Yp)},persist:function(){},isPersistent:Yp}),o}var eu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Uy=gn(eu),ad=Rr({},eu,{view:0,detail:0}),sC=gn(ad),H_,Y_,bh,tm=Rr({},ad,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ny,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==bh&&(bh&&n.type==="mousemove"?(H_=n.screenX-bh.screenX,Y_=n.screenY-bh.screenY):Y_=H_=0,bh=n),H_)},movementY:function(n){return"movementY"in n?n.movementY:Y_}}),o1=gn(tm),aC=Rr({},tm,{dataTransfer:0}),lC=gn(aC),cC=Rr({},ad,{relatedTarget:0}),K_=gn(cC),uC=Rr({},eu,{animationName:0,elapsedTime:0,pseudoElement:0}),hC=gn(uC),dC=Rr({},eu,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),pC=gn(dC),fC=Rr({},eu,{data:0}),s1=gn(fC),mC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_C={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yC(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=gC[n])?!!o[n]:!1}function Ny(){return yC}var xC=Rr({},ad,{key:function(n){if(n.key){var o=mC[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=_f(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?_C[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ny,charCode:function(n){return n.type==="keypress"?_f(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?_f(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),vC=gn(xC),wC=Rr({},tm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),a1=gn(wC),bC=Rr({},ad,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ny}),TC=gn(bC),EC=Rr({},eu,{propertyName:0,elapsedTime:0,pseudoElement:0}),SC=gn(EC),CC=Rr({},tm,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),IC=gn(CC),AC=[9,13,27,32],Vy=rs&&"CompositionEvent"in window,Lh=null;rs&&"documentMode"in document&&(Lh=document.documentMode);var MC=rs&&"TextEvent"in window&&!Lh,tb=rs&&(!Vy||Lh&&8<Lh&&11>=Lh),l1=String.fromCharCode(32),c1=!1;function rb(n,o){switch(n){case"keyup":return AC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ib(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var kc=!1;function kC(n,o){switch(n){case"compositionend":return ib(o);case"keypress":return o.which!==32?null:(c1=!0,l1);case"textInput":return n=o.data,n===l1&&c1?null:n;default:return null}}function zC(n,o){if(kc)return n==="compositionend"||!Vy&&rb(n,o)?(n=eb(),mf=Fy=Ys=null,kc=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return tb&&o.locale!=="ko"?null:o.data;default:return null}}var PC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function u1(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!PC[n.type]:o==="textarea"}function nb(n,o,u,m){Rw(m),o=Rf(o,"onChange"),0<o.length&&(u=new Uy("onChange","change",null,u,m),n.push({event:u,listeners:o}))}var Rh=null,Wh=null;function DC(n){mb(n,0)}function rm(n){var o=Dc(n);if(Aw(o))return n}function LC(n,o){if(n==="change")return o}var ob=!1;if(rs){var J_;if(rs){var Q_="oninput"in document;if(!Q_){var h1=document.createElement("div");h1.setAttribute("oninput","return;"),Q_=typeof h1.oninput=="function"}J_=Q_}else J_=!1;ob=J_&&(!document.documentMode||9<document.documentMode)}function d1(){Rh&&(Rh.detachEvent("onpropertychange",sb),Wh=Rh=null)}function sb(n){if(n.propertyName==="value"&&rm(Wh)){var o=[];nb(o,Wh,n,Dy(n)),Uw(DC,o)}}function RC(n,o,u){n==="focusin"?(d1(),Rh=o,Wh=u,Rh.attachEvent("onpropertychange",sb)):n==="focusout"&&d1()}function BC(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return rm(Wh)}function OC(n,o){if(n==="click")return rm(o)}function FC(n,o){if(n==="input"||n==="change")return rm(o)}function UC(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var io=typeof Object.is=="function"?Object.is:UC;function Xh(n,o){if(io(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var u=Object.keys(n),m=Object.keys(o);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var w=u[m];if(!xg.call(o,w)||!io(n[w],o[w]))return!1}return!0}function p1(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function f1(n,o){var u=p1(n);n=0;for(var m;u;){if(u.nodeType===3){if(m=n+u.textContent.length,n<=o&&m>=o)return{node:u,offset:o-n};n=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=p1(u)}}function ab(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?ab(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function lb(){for(var n=window,o=Af();o instanceof n.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)n=o.contentWindow;else break;o=Af(n.document)}return o}function jy(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function NC(n){var o=lb(),u=n.focusedElem,m=n.selectionRange;if(o!==u&&u&&u.ownerDocument&&ab(u.ownerDocument.documentElement,u)){if(m!==null&&jy(u)){if(o=m.start,n=m.end,n===void 0&&(n=o),"selectionStart"in u)u.selectionStart=o,u.selectionEnd=Math.min(n,u.value.length);else if(n=(o=u.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var w=u.textContent.length,S=Math.min(m.start,w);m=m.end===void 0?S:Math.min(m.end,w),!n.extend&&S>m&&(w=m,m=S,S=w),w=f1(u,S);var P=f1(u,m);w&&P&&(n.rangeCount!==1||n.anchorNode!==w.node||n.anchorOffset!==w.offset||n.focusNode!==P.node||n.focusOffset!==P.offset)&&(o=o.createRange(),o.setStart(w.node,w.offset),n.removeAllRanges(),S>m?(n.addRange(o),n.extend(P.node,P.offset)):(o.setEnd(P.node,P.offset),n.addRange(o)))}}for(o=[],n=u;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<o.length;u++)n=o[u],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var VC=rs&&"documentMode"in document&&11>=document.documentMode,zc=null,Fg=null,Bh=null,Ug=!1;function m1(n,o,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Ug||zc==null||zc!==Af(m)||(m=zc,"selectionStart"in m&&jy(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Bh&&Xh(Bh,m)||(Bh=m,m=Rf(Fg,"onSelect"),0<m.length&&(o=new Uy("onSelect","select",null,o,u),n.push({event:o,listeners:m}),o.target=zc)))}function Kp(n,o){var u={};return u[n.toLowerCase()]=o.toLowerCase(),u["Webkit"+n]="webkit"+o,u["Moz"+n]="moz"+o,u}var Pc={animationend:Kp("Animation","AnimationEnd"),animationiteration:Kp("Animation","AnimationIteration"),animationstart:Kp("Animation","AnimationStart"),transitionend:Kp("Transition","TransitionEnd")},eg={},cb={};rs&&(cb=document.createElement("div").style,"AnimationEvent"in window||(delete Pc.animationend.animation,delete Pc.animationiteration.animation,delete Pc.animationstart.animation),"TransitionEvent"in window||delete Pc.transitionend.transition);function im(n){if(eg[n])return eg[n];if(!Pc[n])return n;var o=Pc[n],u;for(u in o)if(o.hasOwnProperty(u)&&u in cb)return eg[n]=o[u];return n}var ub=im("animationend"),hb=im("animationiteration"),db=im("animationstart"),pb=im("transitionend"),fb=new Map,_1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ca(n,o){fb.set(n,o),_l(o,[n])}for(var tg=0;tg<_1.length;tg++){var rg=_1[tg],jC=rg.toLowerCase(),GC=rg[0].toUpperCase()+rg.slice(1);ca(jC,"on"+GC)}ca(ub,"onAnimationEnd");ca(hb,"onAnimationIteration");ca(db,"onAnimationStart");ca("dblclick","onDoubleClick");ca("focusin","onFocus");ca("focusout","onBlur");ca(pb,"onTransitionEnd");qc("onMouseEnter",["mouseout","mouseover"]);qc("onMouseLeave",["mouseout","mouseover"]);qc("onPointerEnter",["pointerout","pointerover"]);qc("onPointerLeave",["pointerout","pointerover"]);_l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_l("onBeforeInput",["compositionend","keypress","textInput","paste"]);_l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$C=new Set("cancel close invalid load scroll toggle".split(" ").concat(kh));function g1(n,o,u){var m=n.type||"unknown-event";n.currentTarget=u,jS(m,o,void 0,n),n.currentTarget=null}function mb(n,o){o=(o&4)!==0;for(var u=0;u<n.length;u++){var m=n[u],w=m.event;m=m.listeners;e:{var S=void 0;if(o)for(var P=m.length-1;0<=P;P--){var a=m[P],U=a.instance,de=a.currentTarget;if(a=a.listener,U!==S&&w.isPropagationStopped())break e;g1(w,a,de),S=U}else for(P=0;P<m.length;P++){if(a=m[P],U=a.instance,de=a.currentTarget,a=a.listener,U!==S&&w.isPropagationStopped())break e;g1(w,a,de),S=U}}}if(kf)throw n=Lg,kf=!1,Lg=null,n}function br(n,o){var u=o[$g];u===void 0&&(u=o[$g]=new Set);var m=n+"__bubble";u.has(m)||(_b(o,n,2,!1),u.add(m))}function ig(n,o,u){var m=0;o&&(m|=4),_b(u,n,m,o)}var Jp="_reactListening"+Math.random().toString(36).slice(2);function Hh(n){if(!n[Jp]){n[Jp]=!0,Tw.forEach(function(u){u!=="selectionchange"&&($C.has(u)||ig(u,!1,n),ig(u,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Jp]||(o[Jp]=!0,ig("selectionchange",!1,o))}}function _b(n,o,u,m){switch(Qw(o)){case 1:var w=nC;break;case 4:w=oC;break;default:w=Oy}u=w.bind(null,o,u,n),w=void 0,!Dg||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(w=!0),m?w!==void 0?n.addEventListener(o,u,{capture:!0,passive:w}):n.addEventListener(o,u,!0):w!==void 0?n.addEventListener(o,u,{passive:w}):n.addEventListener(o,u,!1)}function ng(n,o,u,m,w){var S=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var P=m.tag;if(P===3||P===4){var a=m.stateNode.containerInfo;if(a===w||a.nodeType===8&&a.parentNode===w)break;if(P===4)for(P=m.return;P!==null;){var U=P.tag;if((U===3||U===4)&&(U=P.stateNode.containerInfo,U===w||U.nodeType===8&&U.parentNode===w))return;P=P.return}for(;a!==null;){if(P=sl(a),P===null)return;if(U=P.tag,U===5||U===6){m=S=P;continue e}a=a.parentNode}}m=m.return}Uw(function(){var de=S,Me=Dy(u),ne=[];e:{var me=fb.get(n);if(me!==void 0){var Ge=Uy,Ye=n;switch(n){case"keypress":if(_f(u)===0)break e;case"keydown":case"keyup":Ge=vC;break;case"focusin":Ye="focus",Ge=K_;break;case"focusout":Ye="blur",Ge=K_;break;case"beforeblur":case"afterblur":Ge=K_;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ge=o1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ge=lC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ge=TC;break;case ub:case hb:case db:Ge=hC;break;case pb:Ge=SC;break;case"scroll":Ge=sC;break;case"wheel":Ge=IC;break;case"copy":case"cut":case"paste":Ge=pC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ge=a1}var ze=(o&4)!==0,kt=!ze&&n==="scroll",ge=ze?me!==null?me+"Capture":null:me;ze=[];for(var he=de,we;he!==null;){we=he;var je=we.stateNode;if(we.tag===5&&je!==null&&(we=je,ge!==null&&(je=Gh(he,ge),je!=null&&ze.push(Yh(he,je,we)))),kt)break;he=he.return}0<ze.length&&(me=new Ge(me,Ye,null,u,Me),ne.push({event:me,listeners:ze}))}}if((o&7)===0){e:{if(me=n==="mouseover"||n==="pointerover",Ge=n==="mouseout"||n==="pointerout",me&&u!==zg&&(Ye=u.relatedTarget||u.fromElement)&&(sl(Ye)||Ye[is]))break e;if((Ge||me)&&(me=Me.window===Me?Me:(me=Me.ownerDocument)?me.defaultView||me.parentWindow:window,Ge?(Ye=u.relatedTarget||u.toElement,Ge=de,Ye=Ye?sl(Ye):null,Ye!==null&&(kt=gl(Ye),Ye!==kt||Ye.tag!==5&&Ye.tag!==6)&&(Ye=null)):(Ge=null,Ye=de),Ge!==Ye)){if(ze=o1,je="onMouseLeave",ge="onMouseEnter",he="mouse",(n==="pointerout"||n==="pointerover")&&(ze=a1,je="onPointerLeave",ge="onPointerEnter",he="pointer"),kt=Ge==null?me:Dc(Ge),we=Ye==null?me:Dc(Ye),me=new ze(je,he+"leave",Ge,u,Me),me.target=kt,me.relatedTarget=we,je=null,sl(Me)===de&&(ze=new ze(ge,he+"enter",Ye,u,Me),ze.target=we,ze.relatedTarget=kt,je=ze),kt=je,Ge&&Ye)t:{for(ze=Ge,ge=Ye,he=0,we=ze;we;we=Ic(we))he++;for(we=0,je=ge;je;je=Ic(je))we++;for(;0<he-we;)ze=Ic(ze),he--;for(;0<we-he;)ge=Ic(ge),we--;for(;he--;){if(ze===ge||ge!==null&&ze===ge.alternate)break t;ze=Ic(ze),ge=Ic(ge)}ze=null}else ze=null;Ge!==null&&y1(ne,me,Ge,ze,!1),Ye!==null&&kt!==null&&y1(ne,kt,Ye,ze,!0)}}e:{if(me=de?Dc(de):window,Ge=me.nodeName&&me.nodeName.toLowerCase(),Ge==="select"||Ge==="input"&&me.type==="file")var Fe=LC;else if(u1(me))if(ob)Fe=FC;else{Fe=BC;var st=RC}else(Ge=me.nodeName)&&Ge.toLowerCase()==="input"&&(me.type==="checkbox"||me.type==="radio")&&(Fe=OC);if(Fe&&(Fe=Fe(n,de))){nb(ne,Fe,u,Me);break e}st&&st(n,me,de),n==="focusout"&&(st=me._wrapperState)&&st.controlled&&me.type==="number"&&Cg(me,"number",me.value)}switch(st=de?Dc(de):window,n){case"focusin":(u1(st)||st.contentEditable==="true")&&(zc=st,Fg=de,Bh=null);break;case"focusout":Bh=Fg=zc=null;break;case"mousedown":Ug=!0;break;case"contextmenu":case"mouseup":case"dragend":Ug=!1,m1(ne,u,Me);break;case"selectionchange":if(VC)break;case"keydown":case"keyup":m1(ne,u,Me)}var lt;if(Vy)e:{switch(n){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else kc?rb(n,u)&&(ft="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(ft="onCompositionStart");ft&&(tb&&u.locale!=="ko"&&(kc||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&kc&&(lt=eb()):(Ys=Me,Fy="value"in Ys?Ys.value:Ys.textContent,kc=!0)),st=Rf(de,ft),0<st.length&&(ft=new s1(ft,n,null,u,Me),ne.push({event:ft,listeners:st}),lt?ft.data=lt:(lt=ib(u),lt!==null&&(ft.data=lt)))),(lt=MC?kC(n,u):zC(n,u))&&(de=Rf(de,"onBeforeInput"),0<de.length&&(Me=new s1("onBeforeInput","beforeinput",null,u,Me),ne.push({event:Me,listeners:de}),Me.data=lt))}mb(ne,o)})}function Yh(n,o,u){return{instance:n,listener:o,currentTarget:u}}function Rf(n,o){for(var u=o+"Capture",m=[];n!==null;){var w=n,S=w.stateNode;w.tag===5&&S!==null&&(w=S,S=Gh(n,u),S!=null&&m.unshift(Yh(n,S,w)),S=Gh(n,o),S!=null&&m.push(Yh(n,S,w))),n=n.return}return m}function Ic(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function y1(n,o,u,m,w){for(var S=o._reactName,P=[];u!==null&&u!==m;){var a=u,U=a.alternate,de=a.stateNode;if(U!==null&&U===m)break;a.tag===5&&de!==null&&(a=de,w?(U=Gh(u,S),U!=null&&P.unshift(Yh(u,U,a))):w||(U=Gh(u,S),U!=null&&P.push(Yh(u,U,a)))),u=u.return}P.length!==0&&n.push({event:o,listeners:P})}var ZC=/\r\n?/g,qC=/\u0000|\uFFFD/g;function x1(n){return(typeof n=="string"?n:""+n).replace(ZC,`
`).replace(qC,"")}function Qp(n,o,u){if(o=x1(o),x1(n)!==o&&u)throw Error(Xe(425))}function Bf(){}var Ng=null,Vg=null;function jg(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Gg=typeof setTimeout=="function"?setTimeout:void 0,WC=typeof clearTimeout=="function"?clearTimeout:void 0,v1=typeof Promise=="function"?Promise:void 0,XC=typeof queueMicrotask=="function"?queueMicrotask:typeof v1<"u"?function(n){return v1.resolve(null).then(n).catch(HC)}:Gg;function HC(n){setTimeout(function(){throw n})}function og(n,o){var u=o,m=0;do{var w=u.nextSibling;if(n.removeChild(u),w&&w.nodeType===8)if(u=w.data,u==="/$"){if(m===0){n.removeChild(w),qh(o);return}m--}else u!=="$"&&u!=="$?"&&u!=="$!"||m++;u=w}while(u);qh(o)}function ra(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function w1(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return n;o--}else u==="/$"&&o++}n=n.previousSibling}return null}var tu=Math.random().toString(36).slice(2),wo="__reactFiber$"+tu,Kh="__reactProps$"+tu,is="__reactContainer$"+tu,$g="__reactEvents$"+tu,YC="__reactListeners$"+tu,KC="__reactHandles$"+tu;function sl(n){var o=n[wo];if(o)return o;for(var u=n.parentNode;u;){if(o=u[is]||u[wo]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(n=w1(n);n!==null;){if(u=n[wo])return u;n=w1(n)}return o}n=u,u=n.parentNode}return null}function ld(n){return n=n[wo]||n[is],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Dc(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Xe(33))}function nm(n){return n[Kh]||null}var Zg=[],Lc=-1;function ua(n){return{current:n}}function Tr(n){0>Lc||(n.current=Zg[Lc],Zg[Lc]=null,Lc--)}function yr(n,o){Lc++,Zg[Lc]=n.current,n.current=o}var la={},Ci=ua(la),rn=ua(!1),hl=la;function Wc(n,o){var u=n.type.contextTypes;if(!u)return la;var m=n.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===o)return m.__reactInternalMemoizedMaskedChildContext;var w={},S;for(S in u)w[S]=o[S];return m&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=w),w}function nn(n){return n=n.childContextTypes,n!=null}function Of(){Tr(rn),Tr(Ci)}function b1(n,o,u){if(Ci.current!==la)throw Error(Xe(168));yr(Ci,o),yr(rn,u)}function gb(n,o,u){var m=n.stateNode;if(o=o.childContextTypes,typeof m.getChildContext!="function")return u;m=m.getChildContext();for(var w in m)if(!(w in o))throw Error(Xe(108,RS(n)||"Unknown",w));return Rr({},u,m)}function Ff(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||la,hl=Ci.current,yr(Ci,n),yr(rn,rn.current),!0}function T1(n,o,u){var m=n.stateNode;if(!m)throw Error(Xe(169));u?(n=gb(n,o,hl),m.__reactInternalMemoizedMergedChildContext=n,Tr(rn),Tr(Ci),yr(Ci,n)):Tr(rn),yr(rn,u)}var Ko=null,om=!1,sg=!1;function yb(n){Ko===null?Ko=[n]:Ko.push(n)}function JC(n){om=!0,yb(n)}function ha(){if(!sg&&Ko!==null){sg=!0;var n=0,o=cr;try{var u=Ko;for(cr=1;n<u.length;n++){var m=u[n];do m=m(!0);while(m!==null)}Ko=null,om=!1}catch(w){throw Ko!==null&&(Ko=Ko.slice(n+1)),Gw(Ly,ha),w}finally{cr=o,sg=!1}}return null}var Rc=[],Bc=0,Uf=null,Nf=0,Mn=[],kn=0,dl=null,Jo=1,Qo="";function nl(n,o){Rc[Bc++]=Nf,Rc[Bc++]=Uf,Uf=n,Nf=o}function xb(n,o,u){Mn[kn++]=Jo,Mn[kn++]=Qo,Mn[kn++]=dl,dl=n;var m=Jo;n=Qo;var w=32-to(m)-1;m&=~(1<<w),u+=1;var S=32-to(o)+w;if(30<S){var P=w-w%5;S=(m&(1<<P)-1).toString(32),m>>=P,w-=P,Jo=1<<32-to(o)+w|u<<w|m,Qo=S+n}else Jo=1<<S|u<<w|m,Qo=n}function Gy(n){n.return!==null&&(nl(n,1),xb(n,1,0))}function $y(n){for(;n===Uf;)Uf=Rc[--Bc],Rc[Bc]=null,Nf=Rc[--Bc],Rc[Bc]=null;for(;n===dl;)dl=Mn[--kn],Mn[kn]=null,Qo=Mn[--kn],Mn[kn]=null,Jo=Mn[--kn],Mn[kn]=null}var fn=null,pn=null,Ar=!1,eo=null;function vb(n,o){var u=zn(5,null,null,0);u.elementType="DELETED",u.stateNode=o,u.return=n,o=n.deletions,o===null?(n.deletions=[u],n.flags|=16):o.push(u)}function E1(n,o){switch(n.tag){case 5:var u=n.type;return o=o.nodeType!==1||u.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,fn=n,pn=ra(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,fn=n,pn=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(u=dl!==null?{id:Jo,overflow:Qo}:null,n.memoizedState={dehydrated:o,treeContext:u,retryLane:1073741824},u=zn(18,null,null,0),u.stateNode=o,u.return=n,n.child=u,fn=n,pn=null,!0):!1;default:return!1}}function qg(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Wg(n){if(Ar){var o=pn;if(o){var u=o;if(!E1(n,o)){if(qg(n))throw Error(Xe(418));o=ra(u.nextSibling);var m=fn;o&&E1(n,o)?vb(m,u):(n.flags=n.flags&-4097|2,Ar=!1,fn=n)}}else{if(qg(n))throw Error(Xe(418));n.flags=n.flags&-4097|2,Ar=!1,fn=n}}}function S1(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;fn=n}function ef(n){if(n!==fn)return!1;if(!Ar)return S1(n),Ar=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!jg(n.type,n.memoizedProps)),o&&(o=pn)){if(qg(n))throw wb(),Error(Xe(418));for(;o;)vb(n,o),o=ra(o.nextSibling)}if(S1(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Xe(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var u=n.data;if(u==="/$"){if(o===0){pn=ra(n.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++}n=n.nextSibling}pn=null}}else pn=fn?ra(n.stateNode.nextSibling):null;return!0}function wb(){for(var n=pn;n;)n=ra(n.nextSibling)}function Xc(){pn=fn=null,Ar=!1}function Zy(n){eo===null?eo=[n]:eo.push(n)}var QC=ss.ReactCurrentBatchConfig;function Kn(n,o){if(n&&n.defaultProps){o=Rr({},o),n=n.defaultProps;for(var u in n)o[u]===void 0&&(o[u]=n[u]);return o}return o}var Vf=ua(null),jf=null,Oc=null,qy=null;function Wy(){qy=Oc=jf=null}function Xy(n){var o=Vf.current;Tr(Vf),n._currentValue=o}function Xg(n,o,u){for(;n!==null;){var m=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),n===u)break;n=n.return}}function $c(n,o){jf=n,qy=Oc=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&o)!==0&&(tn=!0),n.firstContext=null)}function Dn(n){var o=n._currentValue;if(qy!==n)if(n={context:n,memoizedValue:o,next:null},Oc===null){if(jf===null)throw Error(Xe(308));Oc=n,jf.dependencies={lanes:0,firstContext:n}}else Oc=Oc.next=n;return o}var al=null;function Hy(n){al===null?al=[n]:al.push(n)}function bb(n,o,u,m){var w=o.interleaved;return w===null?(u.next=u,Hy(o)):(u.next=w.next,w.next=u),o.interleaved=u,ns(n,m)}function ns(n,o){n.lanes|=o;var u=n.alternate;for(u!==null&&(u.lanes|=o),u=n,n=n.return;n!==null;)n.childLanes|=o,u=n.alternate,u!==null&&(u.childLanes|=o),u=n,n=n.return;return u.tag===3?u.stateNode:null}var qs=!1;function Yy(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Tb(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function es(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function ia(n,o,u){var m=n.updateQueue;if(m===null)return null;if(m=m.shared,(Qt&2)!==0){var w=m.pending;return w===null?o.next=o:(o.next=w.next,w.next=o),m.pending=o,ns(n,u)}return w=m.interleaved,w===null?(o.next=o,Hy(m)):(o.next=w.next,w.next=o),m.interleaved=o,ns(n,u)}function gf(n,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194240)!==0)){var m=o.lanes;m&=n.pendingLanes,u|=m,o.lanes=u,Ry(n,u)}}function C1(n,o){var u=n.updateQueue,m=n.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var w=null,S=null;if(u=u.firstBaseUpdate,u!==null){do{var P={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};S===null?w=S=P:S=S.next=P,u=u.next}while(u!==null);S===null?w=S=o:S=S.next=o}else w=S=o;u={baseState:m.baseState,firstBaseUpdate:w,lastBaseUpdate:S,shared:m.shared,effects:m.effects},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=o:n.next=o,u.lastBaseUpdate=o}function Gf(n,o,u,m){var w=n.updateQueue;qs=!1;var S=w.firstBaseUpdate,P=w.lastBaseUpdate,a=w.shared.pending;if(a!==null){w.shared.pending=null;var U=a,de=U.next;U.next=null,P===null?S=de:P.next=de,P=U;var Me=n.alternate;Me!==null&&(Me=Me.updateQueue,a=Me.lastBaseUpdate,a!==P&&(a===null?Me.firstBaseUpdate=de:a.next=de,Me.lastBaseUpdate=U))}if(S!==null){var ne=w.baseState;P=0,Me=de=U=null,a=S;do{var me=a.lane,Ge=a.eventTime;if((m&me)===me){Me!==null&&(Me=Me.next={eventTime:Ge,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var Ye=n,ze=a;switch(me=o,Ge=u,ze.tag){case 1:if(Ye=ze.payload,typeof Ye=="function"){ne=Ye.call(Ge,ne,me);break e}ne=Ye;break e;case 3:Ye.flags=Ye.flags&-65537|128;case 0:if(Ye=ze.payload,me=typeof Ye=="function"?Ye.call(Ge,ne,me):Ye,me==null)break e;ne=Rr({},ne,me);break e;case 2:qs=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,me=w.effects,me===null?w.effects=[a]:me.push(a))}else Ge={eventTime:Ge,lane:me,tag:a.tag,payload:a.payload,callback:a.callback,next:null},Me===null?(de=Me=Ge,U=ne):Me=Me.next=Ge,P|=me;if(a=a.next,a===null){if(a=w.shared.pending,a===null)break;me=a,a=me.next,me.next=null,w.lastBaseUpdate=me,w.shared.pending=null}}while(1);if(Me===null&&(U=ne),w.baseState=U,w.firstBaseUpdate=de,w.lastBaseUpdate=Me,o=w.shared.interleaved,o!==null){w=o;do P|=w.lane,w=w.next;while(w!==o)}else S===null&&(w.shared.lanes=0);fl|=P,n.lanes=P,n.memoizedState=ne}}function I1(n,o,u){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var m=n[o],w=m.callback;if(w!==null){if(m.callback=null,m=u,typeof w!="function")throw Error(Xe(191,w));w.call(m)}}}var Eb=new bw.Component().refs;function Hg(n,o,u,m){o=n.memoizedState,u=u(m,o),u=u==null?o:Rr({},o,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var sm={isMounted:function(n){return(n=n._reactInternals)?gl(n)===n:!1},enqueueSetState:function(n,o,u){n=n._reactInternals;var m=Li(),w=oa(n),S=es(m,w);S.payload=o,u!=null&&(S.callback=u),o=ia(n,S,w),o!==null&&(ro(o,n,w,m),gf(o,n,w))},enqueueReplaceState:function(n,o,u){n=n._reactInternals;var m=Li(),w=oa(n),S=es(m,w);S.tag=1,S.payload=o,u!=null&&(S.callback=u),o=ia(n,S,w),o!==null&&(ro(o,n,w,m),gf(o,n,w))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var u=Li(),m=oa(n),w=es(u,m);w.tag=2,o!=null&&(w.callback=o),o=ia(n,w,m),o!==null&&(ro(o,n,m,u),gf(o,n,m))}};function A1(n,o,u,m,w,S,P){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(m,S,P):o.prototype&&o.prototype.isPureReactComponent?!Xh(u,m)||!Xh(w,S):!0}function Sb(n,o,u){var m=!1,w=la,S=o.contextType;return typeof S=="object"&&S!==null?S=Dn(S):(w=nn(o)?hl:Ci.current,m=o.contextTypes,S=(m=m!=null)?Wc(n,w):la),o=new o(u,S),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=sm,n.stateNode=o,o._reactInternals=n,m&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=w,n.__reactInternalMemoizedMaskedChildContext=S),o}function M1(n,o,u,m){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,m),o.state!==n&&sm.enqueueReplaceState(o,o.state,null)}function Yg(n,o,u,m){var w=n.stateNode;w.props=u,w.state=n.memoizedState,w.refs=Eb,Yy(n);var S=o.contextType;typeof S=="object"&&S!==null?w.context=Dn(S):(S=nn(o)?hl:Ci.current,w.context=Wc(n,S)),w.state=n.memoizedState,S=o.getDerivedStateFromProps,typeof S=="function"&&(Hg(n,o,S,u),w.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(o=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),o!==w.state&&sm.enqueueReplaceState(w,w.state,null),Gf(n,u,w,m),w.state=n.memoizedState),typeof w.componentDidMount=="function"&&(n.flags|=4194308)}function Th(n,o,u){if(n=u.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(Xe(309));var m=u.stateNode}if(!m)throw Error(Xe(147,n));var w=m,S=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===S?o.ref:(o=function(P){var a=w.refs;a===Eb&&(a=w.refs={}),P===null?delete a[S]:a[S]=P},o._stringRef=S,o)}if(typeof n!="string")throw Error(Xe(284));if(!u._owner)throw Error(Xe(290,n))}return n}function tf(n,o){throw n=Object.prototype.toString.call(o),Error(Xe(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function k1(n){var o=n._init;return o(n._payload)}function Cb(n){function o(ge,he){if(n){var we=ge.deletions;we===null?(ge.deletions=[he],ge.flags|=16):we.push(he)}}function u(ge,he){if(!n)return null;for(;he!==null;)o(ge,he),he=he.sibling;return null}function m(ge,he){for(ge=new Map;he!==null;)he.key!==null?ge.set(he.key,he):ge.set(he.index,he),he=he.sibling;return ge}function w(ge,he){return ge=sa(ge,he),ge.index=0,ge.sibling=null,ge}function S(ge,he,we){return ge.index=we,n?(we=ge.alternate,we!==null?(we=we.index,we<he?(ge.flags|=2,he):we):(ge.flags|=2,he)):(ge.flags|=1048576,he)}function P(ge){return n&&ge.alternate===null&&(ge.flags|=2),ge}function a(ge,he,we,je){return he===null||he.tag!==6?(he=pg(we,ge.mode,je),he.return=ge,he):(he=w(he,we),he.return=ge,he)}function U(ge,he,we,je){var Fe=we.type;return Fe===Mc?Me(ge,he,we.props.children,je,we.key):he!==null&&(he.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===Zs&&k1(Fe)===he.type)?(je=w(he,we.props),je.ref=Th(ge,he,we),je.return=ge,je):(je=Tf(we.type,we.key,we.props,null,ge.mode,je),je.ref=Th(ge,he,we),je.return=ge,je)}function de(ge,he,we,je){return he===null||he.tag!==4||he.stateNode.containerInfo!==we.containerInfo||he.stateNode.implementation!==we.implementation?(he=fg(we,ge.mode,je),he.return=ge,he):(he=w(he,we.children||[]),he.return=ge,he)}function Me(ge,he,we,je,Fe){return he===null||he.tag!==7?(he=ul(we,ge.mode,je,Fe),he.return=ge,he):(he=w(he,we),he.return=ge,he)}function ne(ge,he,we){if(typeof he=="string"&&he!==""||typeof he=="number")return he=pg(""+he,ge.mode,we),he.return=ge,he;if(typeof he=="object"&&he!==null){switch(he.$$typeof){case $p:return we=Tf(he.type,he.key,he.props,null,ge.mode,we),we.ref=Th(ge,null,he),we.return=ge,we;case Ac:return he=fg(he,ge.mode,we),he.return=ge,he;case Zs:var je=he._init;return ne(ge,je(he._payload),we)}if(Ah(he)||yh(he))return he=ul(he,ge.mode,we,null),he.return=ge,he;tf(ge,he)}return null}function me(ge,he,we,je){var Fe=he!==null?he.key:null;if(typeof we=="string"&&we!==""||typeof we=="number")return Fe!==null?null:a(ge,he,""+we,je);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case $p:return we.key===Fe?U(ge,he,we,je):null;case Ac:return we.key===Fe?de(ge,he,we,je):null;case Zs:return Fe=we._init,me(ge,he,Fe(we._payload),je)}if(Ah(we)||yh(we))return Fe!==null?null:Me(ge,he,we,je,null);tf(ge,we)}return null}function Ge(ge,he,we,je,Fe){if(typeof je=="string"&&je!==""||typeof je=="number")return ge=ge.get(we)||null,a(he,ge,""+je,Fe);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case $p:return ge=ge.get(je.key===null?we:je.key)||null,U(he,ge,je,Fe);case Ac:return ge=ge.get(je.key===null?we:je.key)||null,de(he,ge,je,Fe);case Zs:var st=je._init;return Ge(ge,he,we,st(je._payload),Fe)}if(Ah(je)||yh(je))return ge=ge.get(we)||null,Me(he,ge,je,Fe,null);tf(he,je)}return null}function Ye(ge,he,we,je){for(var Fe=null,st=null,lt=he,ft=he=0,nr=null;lt!==null&&ft<we.length;ft++){lt.index>ft?(nr=lt,lt=null):nr=lt.sibling;var xt=me(ge,lt,we[ft],je);if(xt===null){lt===null&&(lt=nr);break}n&&lt&&xt.alternate===null&&o(ge,lt),he=S(xt,he,ft),st===null?Fe=xt:st.sibling=xt,st=xt,lt=nr}if(ft===we.length)return u(ge,lt),Ar&&nl(ge,ft),Fe;if(lt===null){for(;ft<we.length;ft++)lt=ne(ge,we[ft],je),lt!==null&&(he=S(lt,he,ft),st===null?Fe=lt:st.sibling=lt,st=lt);return Ar&&nl(ge,ft),Fe}for(lt=m(ge,lt);ft<we.length;ft++)nr=Ge(lt,ge,ft,we[ft],je),nr!==null&&(n&&nr.alternate!==null&&lt.delete(nr.key===null?ft:nr.key),he=S(nr,he,ft),st===null?Fe=nr:st.sibling=nr,st=nr);return n&&lt.forEach(function(ai){return o(ge,ai)}),Ar&&nl(ge,ft),Fe}function ze(ge,he,we,je){var Fe=yh(we);if(typeof Fe!="function")throw Error(Xe(150));if(we=Fe.call(we),we==null)throw Error(Xe(151));for(var st=Fe=null,lt=he,ft=he=0,nr=null,xt=we.next();lt!==null&&!xt.done;ft++,xt=we.next()){lt.index>ft?(nr=lt,lt=null):nr=lt.sibling;var ai=me(ge,lt,xt.value,je);if(ai===null){lt===null&&(lt=nr);break}n&&lt&&ai.alternate===null&&o(ge,lt),he=S(ai,he,ft),st===null?Fe=ai:st.sibling=ai,st=ai,lt=nr}if(xt.done)return u(ge,lt),Ar&&nl(ge,ft),Fe;if(lt===null){for(;!xt.done;ft++,xt=we.next())xt=ne(ge,xt.value,je),xt!==null&&(he=S(xt,he,ft),st===null?Fe=xt:st.sibling=xt,st=xt);return Ar&&nl(ge,ft),Fe}for(lt=m(ge,lt);!xt.done;ft++,xt=we.next())xt=Ge(lt,ge,ft,xt.value,je),xt!==null&&(n&&xt.alternate!==null&&lt.delete(xt.key===null?ft:xt.key),he=S(xt,he,ft),st===null?Fe=xt:st.sibling=xt,st=xt);return n&&lt.forEach(function(Oi){return o(ge,Oi)}),Ar&&nl(ge,ft),Fe}function kt(ge,he,we,je){if(typeof we=="object"&&we!==null&&we.type===Mc&&we.key===null&&(we=we.props.children),typeof we=="object"&&we!==null){switch(we.$$typeof){case $p:e:{for(var Fe=we.key,st=he;st!==null;){if(st.key===Fe){if(Fe=we.type,Fe===Mc){if(st.tag===7){u(ge,st.sibling),he=w(st,we.props.children),he.return=ge,ge=he;break e}}else if(st.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===Zs&&k1(Fe)===st.type){u(ge,st.sibling),he=w(st,we.props),he.ref=Th(ge,st,we),he.return=ge,ge=he;break e}u(ge,st);break}else o(ge,st);st=st.sibling}we.type===Mc?(he=ul(we.props.children,ge.mode,je,we.key),he.return=ge,ge=he):(je=Tf(we.type,we.key,we.props,null,ge.mode,je),je.ref=Th(ge,he,we),je.return=ge,ge=je)}return P(ge);case Ac:e:{for(st=we.key;he!==null;){if(he.key===st)if(he.tag===4&&he.stateNode.containerInfo===we.containerInfo&&he.stateNode.implementation===we.implementation){u(ge,he.sibling),he=w(he,we.children||[]),he.return=ge,ge=he;break e}else{u(ge,he);break}else o(ge,he);he=he.sibling}he=fg(we,ge.mode,je),he.return=ge,ge=he}return P(ge);case Zs:return st=we._init,kt(ge,he,st(we._payload),je)}if(Ah(we))return Ye(ge,he,we,je);if(yh(we))return ze(ge,he,we,je);tf(ge,we)}return typeof we=="string"&&we!==""||typeof we=="number"?(we=""+we,he!==null&&he.tag===6?(u(ge,he.sibling),he=w(he,we),he.return=ge,ge=he):(u(ge,he),he=pg(we,ge.mode,je),he.return=ge,ge=he),P(ge)):u(ge,he)}return kt}var Hc=Cb(!0),Ib=Cb(!1),cd={},To=ua(cd),Jh=ua(cd),Qh=ua(cd);function ll(n){if(n===cd)throw Error(Xe(174));return n}function Ky(n,o){switch(yr(Qh,o),yr(Jh,n),yr(To,cd),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Ag(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=Ag(o,n)}Tr(To),yr(To,o)}function Yc(){Tr(To),Tr(Jh),Tr(Qh)}function Ab(n){ll(Qh.current);var o=ll(To.current),u=Ag(o,n.type);o!==u&&(yr(Jh,n),yr(To,u))}function Jy(n){Jh.current===n&&(Tr(To),Tr(Jh))}var Dr=ua(0);function $f(n){for(var o=n;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var ag=[];function Qy(){for(var n=0;n<ag.length;n++)ag[n]._workInProgressVersionPrimary=null;ag.length=0}var yf=ss.ReactCurrentDispatcher,lg=ss.ReactCurrentBatchConfig,pl=0,Lr=null,Qr=null,oi=null,Zf=!1,Oh=!1,ed=0,eI=0;function Ti(){throw Error(Xe(321))}function e0(n,o){if(o===null)return!1;for(var u=0;u<o.length&&u<n.length;u++)if(!io(n[u],o[u]))return!1;return!0}function t0(n,o,u,m,w,S){if(pl=S,Lr=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,yf.current=n===null||n.memoizedState===null?nI:oI,n=u(m,w),Oh){S=0;do{if(Oh=!1,ed=0,25<=S)throw Error(Xe(301));S+=1,oi=Qr=null,o.updateQueue=null,yf.current=sI,n=u(m,w)}while(Oh)}if(yf.current=qf,o=Qr!==null&&Qr.next!==null,pl=0,oi=Qr=Lr=null,Zf=!1,o)throw Error(Xe(300));return n}function r0(){var n=ed!==0;return ed=0,n}function vo(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?Lr.memoizedState=oi=n:oi=oi.next=n,oi}function Ln(){if(Qr===null){var n=Lr.alternate;n=n!==null?n.memoizedState:null}else n=Qr.next;var o=oi===null?Lr.memoizedState:oi.next;if(o!==null)oi=o,Qr=n;else{if(n===null)throw Error(Xe(310));Qr=n,n={memoizedState:Qr.memoizedState,baseState:Qr.baseState,baseQueue:Qr.baseQueue,queue:Qr.queue,next:null},oi===null?Lr.memoizedState=oi=n:oi=oi.next=n}return oi}function td(n,o){return typeof o=="function"?o(n):o}function cg(n){var o=Ln(),u=o.queue;if(u===null)throw Error(Xe(311));u.lastRenderedReducer=n;var m=Qr,w=m.baseQueue,S=u.pending;if(S!==null){if(w!==null){var P=w.next;w.next=S.next,S.next=P}m.baseQueue=w=S,u.pending=null}if(w!==null){S=w.next,m=m.baseState;var a=P=null,U=null,de=S;do{var Me=de.lane;if((pl&Me)===Me)U!==null&&(U=U.next={lane:0,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null}),m=de.hasEagerState?de.eagerState:n(m,de.action);else{var ne={lane:Me,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null};U===null?(a=U=ne,P=m):U=U.next=ne,Lr.lanes|=Me,fl|=Me}de=de.next}while(de!==null&&de!==S);U===null?P=m:U.next=a,io(m,o.memoizedState)||(tn=!0),o.memoizedState=m,o.baseState=P,o.baseQueue=U,u.lastRenderedState=m}if(n=u.interleaved,n!==null){w=n;do S=w.lane,Lr.lanes|=S,fl|=S,w=w.next;while(w!==n)}else w===null&&(u.lanes=0);return[o.memoizedState,u.dispatch]}function ug(n){var o=Ln(),u=o.queue;if(u===null)throw Error(Xe(311));u.lastRenderedReducer=n;var m=u.dispatch,w=u.pending,S=o.memoizedState;if(w!==null){u.pending=null;var P=w=w.next;do S=n(S,P.action),P=P.next;while(P!==w);io(S,o.memoizedState)||(tn=!0),o.memoizedState=S,o.baseQueue===null&&(o.baseState=S),u.lastRenderedState=S}return[S,m]}function Mb(){}function kb(n,o){var u=Lr,m=Ln(),w=o(),S=!io(m.memoizedState,w);if(S&&(m.memoizedState=w,tn=!0),m=m.queue,i0(Db.bind(null,u,m,n),[n]),m.getSnapshot!==o||S||oi!==null&&oi.memoizedState.tag&1){if(u.flags|=2048,rd(9,Pb.bind(null,u,m,w,o),void 0,null),si===null)throw Error(Xe(349));(pl&30)!==0||zb(u,o,w)}return w}function zb(n,o,u){n.flags|=16384,n={getSnapshot:o,value:u},o=Lr.updateQueue,o===null?(o={lastEffect:null,stores:null},Lr.updateQueue=o,o.stores=[n]):(u=o.stores,u===null?o.stores=[n]:u.push(n))}function Pb(n,o,u,m){o.value=u,o.getSnapshot=m,Lb(o)&&Rb(n)}function Db(n,o,u){return u(function(){Lb(o)&&Rb(n)})}function Lb(n){var o=n.getSnapshot;n=n.value;try{var u=o();return!io(n,u)}catch{return!0}}function Rb(n){var o=ns(n,1);o!==null&&ro(o,n,1,-1)}function z1(n){var o=vo();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:td,lastRenderedState:n},o.queue=n,n=n.dispatch=iI.bind(null,Lr,n),[o.memoizedState,n]}function rd(n,o,u,m){return n={tag:n,create:o,destroy:u,deps:m,next:null},o=Lr.updateQueue,o===null?(o={lastEffect:null,stores:null},Lr.updateQueue=o,o.lastEffect=n.next=n):(u=o.lastEffect,u===null?o.lastEffect=n.next=n:(m=u.next,u.next=n,n.next=m,o.lastEffect=n)),n}function Bb(){return Ln().memoizedState}function xf(n,o,u,m){var w=vo();Lr.flags|=n,w.memoizedState=rd(1|o,u,void 0,m===void 0?null:m)}function am(n,o,u,m){var w=Ln();m=m===void 0?null:m;var S=void 0;if(Qr!==null){var P=Qr.memoizedState;if(S=P.destroy,m!==null&&e0(m,P.deps)){w.memoizedState=rd(o,u,S,m);return}}Lr.flags|=n,w.memoizedState=rd(1|o,u,S,m)}function P1(n,o){return xf(8390656,8,n,o)}function i0(n,o){return am(2048,8,n,o)}function Ob(n,o){return am(4,2,n,o)}function Fb(n,o){return am(4,4,n,o)}function Ub(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function Nb(n,o,u){return u=u!=null?u.concat([n]):null,am(4,4,Ub.bind(null,o,n),u)}function n0(){}function Vb(n,o){var u=Ln();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&e0(o,m[1])?m[0]:(u.memoizedState=[n,o],n)}function jb(n,o){var u=Ln();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&e0(o,m[1])?m[0]:(n=n(),u.memoizedState=[n,o],n)}function Gb(n,o,u){return(pl&21)===0?(n.baseState&&(n.baseState=!1,tn=!0),n.memoizedState=u):(io(u,o)||(u=qw(),Lr.lanes|=u,fl|=u,n.baseState=!0),o)}function tI(n,o){var u=cr;cr=u!==0&&4>u?u:4,n(!0);var m=lg.transition;lg.transition={};try{n(!1),o()}finally{cr=u,lg.transition=m}}function $b(){return Ln().memoizedState}function rI(n,o,u){var m=oa(n);if(u={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null},Zb(n))qb(o,u);else if(u=bb(n,o,u,m),u!==null){var w=Li();ro(u,n,m,w),Wb(u,o,m)}}function iI(n,o,u){var m=oa(n),w={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null};if(Zb(n))qb(o,w);else{var S=n.alternate;if(n.lanes===0&&(S===null||S.lanes===0)&&(S=o.lastRenderedReducer,S!==null))try{var P=o.lastRenderedState,a=S(P,u);if(w.hasEagerState=!0,w.eagerState=a,io(a,P)){var U=o.interleaved;U===null?(w.next=w,Hy(o)):(w.next=U.next,U.next=w),o.interleaved=w;return}}catch{}finally{}u=bb(n,o,w,m),u!==null&&(w=Li(),ro(u,n,m,w),Wb(u,o,m))}}function Zb(n){var o=n.alternate;return n===Lr||o!==null&&o===Lr}function qb(n,o){Oh=Zf=!0;var u=n.pending;u===null?o.next=o:(o.next=u.next,u.next=o),n.pending=o}function Wb(n,o,u){if((u&4194240)!==0){var m=o.lanes;m&=n.pendingLanes,u|=m,o.lanes=u,Ry(n,u)}}var qf={readContext:Dn,useCallback:Ti,useContext:Ti,useEffect:Ti,useImperativeHandle:Ti,useInsertionEffect:Ti,useLayoutEffect:Ti,useMemo:Ti,useReducer:Ti,useRef:Ti,useState:Ti,useDebugValue:Ti,useDeferredValue:Ti,useTransition:Ti,useMutableSource:Ti,useSyncExternalStore:Ti,useId:Ti,unstable_isNewReconciler:!1},nI={readContext:Dn,useCallback:function(n,o){return vo().memoizedState=[n,o===void 0?null:o],n},useContext:Dn,useEffect:P1,useImperativeHandle:function(n,o,u){return u=u!=null?u.concat([n]):null,xf(4194308,4,Ub.bind(null,o,n),u)},useLayoutEffect:function(n,o){return xf(4194308,4,n,o)},useInsertionEffect:function(n,o){return xf(4,2,n,o)},useMemo:function(n,o){var u=vo();return o=o===void 0?null:o,n=n(),u.memoizedState=[n,o],n},useReducer:function(n,o,u){var m=vo();return o=u!==void 0?u(o):o,m.memoizedState=m.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},m.queue=n,n=n.dispatch=rI.bind(null,Lr,n),[m.memoizedState,n]},useRef:function(n){var o=vo();return n={current:n},o.memoizedState=n},useState:z1,useDebugValue:n0,useDeferredValue:function(n){return vo().memoizedState=n},useTransition:function(){var n=z1(!1),o=n[0];return n=tI.bind(null,n[1]),vo().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,u){var m=Lr,w=vo();if(Ar){if(u===void 0)throw Error(Xe(407));u=u()}else{if(u=o(),si===null)throw Error(Xe(349));(pl&30)!==0||zb(m,o,u)}w.memoizedState=u;var S={value:u,getSnapshot:o};return w.queue=S,P1(Db.bind(null,m,S,n),[n]),m.flags|=2048,rd(9,Pb.bind(null,m,S,u,o),void 0,null),u},useId:function(){var n=vo(),o=si.identifierPrefix;if(Ar){var u=Qo,m=Jo;u=(m&~(1<<32-to(m)-1)).toString(32)+u,o=":"+o+"R"+u,u=ed++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=eI++,o=":"+o+"r"+u.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},oI={readContext:Dn,useCallback:Vb,useContext:Dn,useEffect:i0,useImperativeHandle:Nb,useInsertionEffect:Ob,useLayoutEffect:Fb,useMemo:jb,useReducer:cg,useRef:Bb,useState:function(){return cg(td)},useDebugValue:n0,useDeferredValue:function(n){var o=Ln();return Gb(o,Qr.memoizedState,n)},useTransition:function(){var n=cg(td)[0],o=Ln().memoizedState;return[n,o]},useMutableSource:Mb,useSyncExternalStore:kb,useId:$b,unstable_isNewReconciler:!1},sI={readContext:Dn,useCallback:Vb,useContext:Dn,useEffect:i0,useImperativeHandle:Nb,useInsertionEffect:Ob,useLayoutEffect:Fb,useMemo:jb,useReducer:ug,useRef:Bb,useState:function(){return ug(td)},useDebugValue:n0,useDeferredValue:function(n){var o=Ln();return Qr===null?o.memoizedState=n:Gb(o,Qr.memoizedState,n)},useTransition:function(){var n=ug(td)[0],o=Ln().memoizedState;return[n,o]},useMutableSource:Mb,useSyncExternalStore:kb,useId:$b,unstable_isNewReconciler:!1};function Kc(n,o){try{var u="",m=o;do u+=LS(m),m=m.return;while(m);var w=u}catch(S){w=`
Error generating stack: `+S.message+`
`+S.stack}return{value:n,source:o,stack:w,digest:null}}function hg(n,o,u){return{value:n,source:null,stack:u!=null?u:null,digest:o!=null?o:null}}function Kg(n,o){try{console.error(o.value)}catch(u){setTimeout(function(){throw u})}}var aI=typeof WeakMap=="function"?WeakMap:Map;function Xb(n,o,u){u=es(-1,u),u.tag=3,u.payload={element:null};var m=o.value;return u.callback=function(){Xf||(Xf=!0,ay=m),Kg(n,o)},u}function Hb(n,o,u){u=es(-1,u),u.tag=3;var m=n.type.getDerivedStateFromError;if(typeof m=="function"){var w=o.value;u.payload=function(){return m(w)},u.callback=function(){Kg(n,o)}}var S=n.stateNode;return S!==null&&typeof S.componentDidCatch=="function"&&(u.callback=function(){Kg(n,o),typeof m!="function"&&(na===null?na=new Set([this]):na.add(this));var P=o.stack;this.componentDidCatch(o.value,{componentStack:P!==null?P:""})}),u}function D1(n,o,u){var m=n.pingCache;if(m===null){m=n.pingCache=new aI;var w=new Set;m.set(o,w)}else w=m.get(o),w===void 0&&(w=new Set,m.set(o,w));w.has(u)||(w.add(u),n=wI.bind(null,n,o,u),o.then(n,n))}function L1(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function R1(n,o,u,m,w){return(n.mode&1)===0?(n===o?n.flags|=65536:(n.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(o=es(-1,1),o.tag=2,ia(u,o,1))),u.lanes|=1),n):(n.flags|=65536,n.lanes=w,n)}var lI=ss.ReactCurrentOwner,tn=!1;function Di(n,o,u,m){o.child=n===null?Ib(o,null,u,m):Hc(o,n.child,u,m)}function B1(n,o,u,m,w){u=u.render;var S=o.ref;return $c(o,w),m=t0(n,o,u,m,S,w),u=r0(),n!==null&&!tn?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~w,os(n,o,w)):(Ar&&u&&Gy(o),o.flags|=1,Di(n,o,m,w),o.child)}function O1(n,o,u,m,w){if(n===null){var S=u.type;return typeof S=="function"&&!d0(S)&&S.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(o.tag=15,o.type=S,Yb(n,o,S,m,w)):(n=Tf(u.type,null,m,o,o.mode,w),n.ref=o.ref,n.return=o,o.child=n)}if(S=n.child,(n.lanes&w)===0){var P=S.memoizedProps;if(u=u.compare,u=u!==null?u:Xh,u(P,m)&&n.ref===o.ref)return os(n,o,w)}return o.flags|=1,n=sa(S,m),n.ref=o.ref,n.return=o,o.child=n}function Yb(n,o,u,m,w){if(n!==null){var S=n.memoizedProps;if(Xh(S,m)&&n.ref===o.ref)if(tn=!1,o.pendingProps=m=S,(n.lanes&w)!==0)(n.flags&131072)!==0&&(tn=!0);else return o.lanes=n.lanes,os(n,o,w)}return Jg(n,o,u,m,w)}function Kb(n,o,u){var m=o.pendingProps,w=m.children,S=n!==null?n.memoizedState:null;if(m.mode==="hidden")if((o.mode&1)===0)o.memoizedState={baseLanes:0,cachePool:null,transitions:null},yr(Uc,dn),dn|=u;else{if((u&1073741824)===0)return n=S!==null?S.baseLanes|u:u,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,yr(Uc,dn),dn|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=S!==null?S.baseLanes:u,yr(Uc,dn),dn|=m}else S!==null?(m=S.baseLanes|u,o.memoizedState=null):m=u,yr(Uc,dn),dn|=m;return Di(n,o,w,u),o.child}function Jb(n,o){var u=o.ref;(n===null&&u!==null||n!==null&&n.ref!==u)&&(o.flags|=512,o.flags|=2097152)}function Jg(n,o,u,m,w){var S=nn(u)?hl:Ci.current;return S=Wc(o,S),$c(o,w),u=t0(n,o,u,m,S,w),m=r0(),n!==null&&!tn?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~w,os(n,o,w)):(Ar&&m&&Gy(o),o.flags|=1,Di(n,o,u,w),o.child)}function F1(n,o,u,m,w){if(nn(u)){var S=!0;Ff(o)}else S=!1;if($c(o,w),o.stateNode===null)vf(n,o),Sb(o,u,m),Yg(o,u,m,w),m=!0;else if(n===null){var P=o.stateNode,a=o.memoizedProps;P.props=a;var U=P.context,de=u.contextType;typeof de=="object"&&de!==null?de=Dn(de):(de=nn(u)?hl:Ci.current,de=Wc(o,de));var Me=u.getDerivedStateFromProps,ne=typeof Me=="function"||typeof P.getSnapshotBeforeUpdate=="function";ne||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(a!==m||U!==de)&&M1(o,P,m,de),qs=!1;var me=o.memoizedState;P.state=me,Gf(o,m,P,w),U=o.memoizedState,a!==m||me!==U||rn.current||qs?(typeof Me=="function"&&(Hg(o,u,Me,m),U=o.memoizedState),(a=qs||A1(o,u,a,m,me,U,de))?(ne||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(o.flags|=4194308)):(typeof P.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=U),P.props=m,P.state=U,P.context=de,m=a):(typeof P.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{P=o.stateNode,Tb(n,o),a=o.memoizedProps,de=o.type===o.elementType?a:Kn(o.type,a),P.props=de,ne=o.pendingProps,me=P.context,U=u.contextType,typeof U=="object"&&U!==null?U=Dn(U):(U=nn(u)?hl:Ci.current,U=Wc(o,U));var Ge=u.getDerivedStateFromProps;(Me=typeof Ge=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(a!==ne||me!==U)&&M1(o,P,m,U),qs=!1,me=o.memoizedState,P.state=me,Gf(o,m,P,w);var Ye=o.memoizedState;a!==ne||me!==Ye||rn.current||qs?(typeof Ge=="function"&&(Hg(o,u,Ge,m),Ye=o.memoizedState),(de=qs||A1(o,u,de,m,me,Ye,U)||!1)?(Me||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(m,Ye,U),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(m,Ye,U)),typeof P.componentDidUpdate=="function"&&(o.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof P.componentDidUpdate!="function"||a===n.memoizedProps&&me===n.memoizedState||(o.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&me===n.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=Ye),P.props=m,P.state=Ye,P.context=U,m=de):(typeof P.componentDidUpdate!="function"||a===n.memoizedProps&&me===n.memoizedState||(o.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&me===n.memoizedState||(o.flags|=1024),m=!1)}return Qg(n,o,u,m,S,w)}function Qg(n,o,u,m,w,S){Jb(n,o);var P=(o.flags&128)!==0;if(!m&&!P)return w&&T1(o,u,!1),os(n,o,S);m=o.stateNode,lI.current=o;var a=P&&typeof u.getDerivedStateFromError!="function"?null:m.render();return o.flags|=1,n!==null&&P?(o.child=Hc(o,n.child,null,S),o.child=Hc(o,null,a,S)):Di(n,o,a,S),o.memoizedState=m.state,w&&T1(o,u,!0),o.child}function Qb(n){var o=n.stateNode;o.pendingContext?b1(n,o.pendingContext,o.pendingContext!==o.context):o.context&&b1(n,o.context,!1),Ky(n,o.containerInfo)}function U1(n,o,u,m,w){return Xc(),Zy(w),o.flags|=256,Di(n,o,u,m),o.child}var ey={dehydrated:null,treeContext:null,retryLane:0};function ty(n){return{baseLanes:n,cachePool:null,transitions:null}}function e2(n,o,u){var m=o.pendingProps,w=Dr.current,S=!1,P=(o.flags&128)!==0,a;if((a=P)||(a=n!==null&&n.memoizedState===null?!1:(w&2)!==0),a?(S=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(w|=1),yr(Dr,w&1),n===null)return Wg(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((o.mode&1)===0?o.lanes=1:n.data==="$!"?o.lanes=8:o.lanes=1073741824,null):(P=m.children,n=m.fallback,S?(m=o.mode,S=o.child,P={mode:"hidden",children:P},(m&1)===0&&S!==null?(S.childLanes=0,S.pendingProps=P):S=um(P,m,0,null),n=ul(n,m,u,null),S.return=o,n.return=o,S.sibling=n,o.child=S,o.child.memoizedState=ty(u),o.memoizedState=ey,n):o0(o,P));if(w=n.memoizedState,w!==null&&(a=w.dehydrated,a!==null))return cI(n,o,P,m,a,w,u);if(S){S=m.fallback,P=o.mode,w=n.child,a=w.sibling;var U={mode:"hidden",children:m.children};return(P&1)===0&&o.child!==w?(m=o.child,m.childLanes=0,m.pendingProps=U,o.deletions=null):(m=sa(w,U),m.subtreeFlags=w.subtreeFlags&14680064),a!==null?S=sa(a,S):(S=ul(S,P,u,null),S.flags|=2),S.return=o,m.return=o,m.sibling=S,o.child=m,m=S,S=o.child,P=n.child.memoizedState,P=P===null?ty(u):{baseLanes:P.baseLanes|u,cachePool:null,transitions:P.transitions},S.memoizedState=P,S.childLanes=n.childLanes&~u,o.memoizedState=ey,m}return S=n.child,n=S.sibling,m=sa(S,{mode:"visible",children:m.children}),(o.mode&1)===0&&(m.lanes=u),m.return=o,m.sibling=null,n!==null&&(u=o.deletions,u===null?(o.deletions=[n],o.flags|=16):u.push(n)),o.child=m,o.memoizedState=null,m}function o0(n,o){return o=um({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function rf(n,o,u,m){return m!==null&&Zy(m),Hc(o,n.child,null,u),n=o0(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function cI(n,o,u,m,w,S,P){if(u)return o.flags&256?(o.flags&=-257,m=hg(Error(Xe(422))),rf(n,o,P,m)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(S=m.fallback,w=o.mode,m=um({mode:"visible",children:m.children},w,0,null),S=ul(S,w,P,null),S.flags|=2,m.return=o,S.return=o,m.sibling=S,o.child=m,(o.mode&1)!==0&&Hc(o,n.child,null,P),o.child.memoizedState=ty(P),o.memoizedState=ey,S);if((o.mode&1)===0)return rf(n,o,P,null);if(w.data==="$!"){if(m=w.nextSibling&&w.nextSibling.dataset,m)var a=m.dgst;return m=a,S=Error(Xe(419)),m=hg(S,m,void 0),rf(n,o,P,m)}if(a=(P&n.childLanes)!==0,tn||a){if(m=si,m!==null){switch(P&-P){case 4:w=2;break;case 16:w=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:w=32;break;case 536870912:w=268435456;break;default:w=0}w=(w&(m.suspendedLanes|P))!==0?0:w,w!==0&&w!==S.retryLane&&(S.retryLane=w,ns(n,w),ro(m,n,w,-1))}return h0(),m=hg(Error(Xe(421))),rf(n,o,P,m)}return w.data==="$?"?(o.flags|=128,o.child=n.child,o=bI.bind(null,n),w._reactRetry=o,null):(n=S.treeContext,pn=ra(w.nextSibling),fn=o,Ar=!0,eo=null,n!==null&&(Mn[kn++]=Jo,Mn[kn++]=Qo,Mn[kn++]=dl,Jo=n.id,Qo=n.overflow,dl=o),o=o0(o,m.children),o.flags|=4096,o)}function N1(n,o,u){n.lanes|=o;var m=n.alternate;m!==null&&(m.lanes|=o),Xg(n.return,o,u)}function dg(n,o,u,m,w){var S=n.memoizedState;S===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:w}:(S.isBackwards=o,S.rendering=null,S.renderingStartTime=0,S.last=m,S.tail=u,S.tailMode=w)}function t2(n,o,u){var m=o.pendingProps,w=m.revealOrder,S=m.tail;if(Di(n,o,m.children,u),m=Dr.current,(m&2)!==0)m=m&1|2,o.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&N1(n,u,o);else if(n.tag===19)N1(n,u,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}m&=1}if(yr(Dr,m),(o.mode&1)===0)o.memoizedState=null;else switch(w){case"forwards":for(u=o.child,w=null;u!==null;)n=u.alternate,n!==null&&$f(n)===null&&(w=u),u=u.sibling;u=w,u===null?(w=o.child,o.child=null):(w=u.sibling,u.sibling=null),dg(o,!1,w,u,S);break;case"backwards":for(u=null,w=o.child,o.child=null;w!==null;){if(n=w.alternate,n!==null&&$f(n)===null){o.child=w;break}n=w.sibling,w.sibling=u,u=w,w=n}dg(o,!0,u,null,S);break;case"together":dg(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function vf(n,o){(o.mode&1)===0&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function os(n,o,u){if(n!==null&&(o.dependencies=n.dependencies),fl|=o.lanes,(u&o.childLanes)===0)return null;if(n!==null&&o.child!==n.child)throw Error(Xe(153));if(o.child!==null){for(n=o.child,u=sa(n,n.pendingProps),o.child=u,u.return=o;n.sibling!==null;)n=n.sibling,u=u.sibling=sa(n,n.pendingProps),u.return=o;u.sibling=null}return o.child}function uI(n,o,u){switch(o.tag){case 3:Qb(o),Xc();break;case 5:Ab(o);break;case 1:nn(o.type)&&Ff(o);break;case 4:Ky(o,o.stateNode.containerInfo);break;case 10:var m=o.type._context,w=o.memoizedProps.value;yr(Vf,m._currentValue),m._currentValue=w;break;case 13:if(m=o.memoizedState,m!==null)return m.dehydrated!==null?(yr(Dr,Dr.current&1),o.flags|=128,null):(u&o.child.childLanes)!==0?e2(n,o,u):(yr(Dr,Dr.current&1),n=os(n,o,u),n!==null?n.sibling:null);yr(Dr,Dr.current&1);break;case 19:if(m=(u&o.childLanes)!==0,(n.flags&128)!==0){if(m)return t2(n,o,u);o.flags|=128}if(w=o.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),yr(Dr,Dr.current),m)break;return null;case 22:case 23:return o.lanes=0,Kb(n,o,u)}return os(n,o,u)}var r2,ry,i2,n2;r2=function(n,o){for(var u=o.child;u!==null;){if(u.tag===5||u.tag===6)n.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};ry=function(){};i2=function(n,o,u,m){var w=n.memoizedProps;if(w!==m){n=o.stateNode,ll(To.current);var S=null;switch(u){case"input":w=Eg(n,w),m=Eg(n,m),S=[];break;case"select":w=Rr({},w,{value:void 0}),m=Rr({},m,{value:void 0}),S=[];break;case"textarea":w=Ig(n,w),m=Ig(n,m),S=[];break;default:typeof w.onClick!="function"&&typeof m.onClick=="function"&&(n.onclick=Bf)}Mg(u,m);var P;u=null;for(de in w)if(!m.hasOwnProperty(de)&&w.hasOwnProperty(de)&&w[de]!=null)if(de==="style"){var a=w[de];for(P in a)a.hasOwnProperty(P)&&(u||(u={}),u[P]="")}else de!=="dangerouslySetInnerHTML"&&de!=="children"&&de!=="suppressContentEditableWarning"&&de!=="suppressHydrationWarning"&&de!=="autoFocus"&&(Vh.hasOwnProperty(de)?S||(S=[]):(S=S||[]).push(de,null));for(de in m){var U=m[de];if(a=w!=null?w[de]:void 0,m.hasOwnProperty(de)&&U!==a&&(U!=null||a!=null))if(de==="style")if(a){for(P in a)!a.hasOwnProperty(P)||U&&U.hasOwnProperty(P)||(u||(u={}),u[P]="");for(P in U)U.hasOwnProperty(P)&&a[P]!==U[P]&&(u||(u={}),u[P]=U[P])}else u||(S||(S=[]),S.push(de,u)),u=U;else de==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,a=a?a.__html:void 0,U!=null&&a!==U&&(S=S||[]).push(de,U)):de==="children"?typeof U!="string"&&typeof U!="number"||(S=S||[]).push(de,""+U):de!=="suppressContentEditableWarning"&&de!=="suppressHydrationWarning"&&(Vh.hasOwnProperty(de)?(U!=null&&de==="onScroll"&&br("scroll",n),S||a===U||(S=[])):(S=S||[]).push(de,U))}u&&(S=S||[]).push("style",u);var de=S;(o.updateQueue=de)&&(o.flags|=4)}};n2=function(n,o,u,m){u!==m&&(o.flags|=4)};function Eh(n,o){if(!Ar)switch(n.tailMode){case"hidden":o=n.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:m.sibling=null}}function Ei(n){var o=n.alternate!==null&&n.alternate.child===n.child,u=0,m=0;if(o)for(var w=n.child;w!==null;)u|=w.lanes|w.childLanes,m|=w.subtreeFlags&14680064,m|=w.flags&14680064,w.return=n,w=w.sibling;else for(w=n.child;w!==null;)u|=w.lanes|w.childLanes,m|=w.subtreeFlags,m|=w.flags,w.return=n,w=w.sibling;return n.subtreeFlags|=m,n.childLanes=u,o}function hI(n,o,u){var m=o.pendingProps;switch($y(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ei(o),null;case 1:return nn(o.type)&&Of(),Ei(o),null;case 3:return m=o.stateNode,Yc(),Tr(rn),Tr(Ci),Qy(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(n===null||n.child===null)&&(ef(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,eo!==null&&(uy(eo),eo=null))),ry(n,o),Ei(o),null;case 5:Jy(o);var w=ll(Qh.current);if(u=o.type,n!==null&&o.stateNode!=null)i2(n,o,u,m,w),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!m){if(o.stateNode===null)throw Error(Xe(166));return Ei(o),null}if(n=ll(To.current),ef(o)){m=o.stateNode,u=o.type;var S=o.memoizedProps;switch(m[wo]=o,m[Kh]=S,n=(o.mode&1)!==0,u){case"dialog":br("cancel",m),br("close",m);break;case"iframe":case"object":case"embed":br("load",m);break;case"video":case"audio":for(w=0;w<kh.length;w++)br(kh[w],m);break;case"source":br("error",m);break;case"img":case"image":case"link":br("error",m),br("load",m);break;case"details":br("toggle",m);break;case"input":Hv(m,S),br("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!S.multiple},br("invalid",m);break;case"textarea":Kv(m,S),br("invalid",m)}Mg(u,S),w=null;for(var P in S)if(S.hasOwnProperty(P)){var a=S[P];P==="children"?typeof a=="string"?m.textContent!==a&&(S.suppressHydrationWarning!==!0&&Qp(m.textContent,a,n),w=["children",a]):typeof a=="number"&&m.textContent!==""+a&&(S.suppressHydrationWarning!==!0&&Qp(m.textContent,a,n),w=["children",""+a]):Vh.hasOwnProperty(P)&&a!=null&&P==="onScroll"&&br("scroll",m)}switch(u){case"input":Zp(m),Yv(m,S,!0);break;case"textarea":Zp(m),Jv(m);break;case"select":case"option":break;default:typeof S.onClick=="function"&&(m.onclick=Bf)}m=w,o.updateQueue=m,m!==null&&(o.flags|=4)}else{P=w.nodeType===9?w:w.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=zw(u)),n==="http://www.w3.org/1999/xhtml"?u==="script"?(n=P.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof m.is=="string"?n=P.createElement(u,{is:m.is}):(n=P.createElement(u),u==="select"&&(P=n,m.multiple?P.multiple=!0:m.size&&(P.size=m.size))):n=P.createElementNS(n,u),n[wo]=o,n[Kh]=m,r2(n,o,!1,!1),o.stateNode=n;e:{switch(P=kg(u,m),u){case"dialog":br("cancel",n),br("close",n),w=m;break;case"iframe":case"object":case"embed":br("load",n),w=m;break;case"video":case"audio":for(w=0;w<kh.length;w++)br(kh[w],n);w=m;break;case"source":br("error",n),w=m;break;case"img":case"image":case"link":br("error",n),br("load",n),w=m;break;case"details":br("toggle",n),w=m;break;case"input":Hv(n,m),w=Eg(n,m),br("invalid",n);break;case"option":w=m;break;case"select":n._wrapperState={wasMultiple:!!m.multiple},w=Rr({},m,{value:void 0}),br("invalid",n);break;case"textarea":Kv(n,m),w=Ig(n,m),br("invalid",n);break;default:w=m}Mg(u,w),a=w;for(S in a)if(a.hasOwnProperty(S)){var U=a[S];S==="style"?Lw(n,U):S==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,U!=null&&Pw(n,U)):S==="children"?typeof U=="string"?(u!=="textarea"||U!=="")&&jh(n,U):typeof U=="number"&&jh(n,""+U):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(Vh.hasOwnProperty(S)?U!=null&&S==="onScroll"&&br("scroll",n):U!=null&&My(n,S,U,P))}switch(u){case"input":Zp(n),Yv(n,m,!1);break;case"textarea":Zp(n),Jv(n);break;case"option":m.value!=null&&n.setAttribute("value",""+aa(m.value));break;case"select":n.multiple=!!m.multiple,S=m.value,S!=null?Nc(n,!!m.multiple,S,!1):m.defaultValue!=null&&Nc(n,!!m.multiple,m.defaultValue,!0);break;default:typeof w.onClick=="function"&&(n.onclick=Bf)}switch(u){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Ei(o),null;case 6:if(n&&o.stateNode!=null)n2(n,o,n.memoizedProps,m);else{if(typeof m!="string"&&o.stateNode===null)throw Error(Xe(166));if(u=ll(Qh.current),ll(To.current),ef(o)){if(m=o.stateNode,u=o.memoizedProps,m[wo]=o,(S=m.nodeValue!==u)&&(n=fn,n!==null))switch(n.tag){case 3:Qp(m.nodeValue,u,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Qp(m.nodeValue,u,(n.mode&1)!==0)}S&&(o.flags|=4)}else m=(u.nodeType===9?u:u.ownerDocument).createTextNode(m),m[wo]=o,o.stateNode=m}return Ei(o),null;case 13:if(Tr(Dr),m=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ar&&pn!==null&&(o.mode&1)!==0&&(o.flags&128)===0)wb(),Xc(),o.flags|=98560,S=!1;else if(S=ef(o),m!==null&&m.dehydrated!==null){if(n===null){if(!S)throw Error(Xe(318));if(S=o.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(Xe(317));S[wo]=o}else Xc(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ei(o),S=!1}else eo!==null&&(uy(eo),eo=null),S=!0;if(!S)return o.flags&65536?o:null}return(o.flags&128)!==0?(o.lanes=u,o):(m=m!==null,m!==(n!==null&&n.memoizedState!==null)&&m&&(o.child.flags|=8192,(o.mode&1)!==0&&(n===null||(Dr.current&1)!==0?ei===0&&(ei=3):h0())),o.updateQueue!==null&&(o.flags|=4),Ei(o),null);case 4:return Yc(),ry(n,o),n===null&&Hh(o.stateNode.containerInfo),Ei(o),null;case 10:return Xy(o.type._context),Ei(o),null;case 17:return nn(o.type)&&Of(),Ei(o),null;case 19:if(Tr(Dr),S=o.memoizedState,S===null)return Ei(o),null;if(m=(o.flags&128)!==0,P=S.rendering,P===null)if(m)Eh(S,!1);else{if(ei!==0||n!==null&&(n.flags&128)!==0)for(n=o.child;n!==null;){if(P=$f(n),P!==null){for(o.flags|=128,Eh(S,!1),m=P.updateQueue,m!==null&&(o.updateQueue=m,o.flags|=4),o.subtreeFlags=0,m=u,u=o.child;u!==null;)S=u,n=m,S.flags&=14680066,P=S.alternate,P===null?(S.childLanes=0,S.lanes=n,S.child=null,S.subtreeFlags=0,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=P.childLanes,S.lanes=P.lanes,S.child=P.child,S.subtreeFlags=0,S.deletions=null,S.memoizedProps=P.memoizedProps,S.memoizedState=P.memoizedState,S.updateQueue=P.updateQueue,S.type=P.type,n=P.dependencies,S.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),u=u.sibling;return yr(Dr,Dr.current&1|2),o.child}n=n.sibling}S.tail!==null&&Vr()>Jc&&(o.flags|=128,m=!0,Eh(S,!1),o.lanes=4194304)}else{if(!m)if(n=$f(P),n!==null){if(o.flags|=128,m=!0,u=n.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),Eh(S,!0),S.tail===null&&S.tailMode==="hidden"&&!P.alternate&&!Ar)return Ei(o),null}else 2*Vr()-S.renderingStartTime>Jc&&u!==1073741824&&(o.flags|=128,m=!0,Eh(S,!1),o.lanes=4194304);S.isBackwards?(P.sibling=o.child,o.child=P):(u=S.last,u!==null?u.sibling=P:o.child=P,S.last=P)}return S.tail!==null?(o=S.tail,S.rendering=o,S.tail=o.sibling,S.renderingStartTime=Vr(),o.sibling=null,u=Dr.current,yr(Dr,m?u&1|2:u&1),o):(Ei(o),null);case 22:case 23:return u0(),m=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==m&&(o.flags|=8192),m&&(o.mode&1)!==0?(dn&1073741824)!==0&&(Ei(o),o.subtreeFlags&6&&(o.flags|=8192)):Ei(o),null;case 24:return null;case 25:return null}throw Error(Xe(156,o.tag))}function dI(n,o){switch($y(o),o.tag){case 1:return nn(o.type)&&Of(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return Yc(),Tr(rn),Tr(Ci),Qy(),n=o.flags,(n&65536)!==0&&(n&128)===0?(o.flags=n&-65537|128,o):null;case 5:return Jy(o),null;case 13:if(Tr(Dr),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(Xe(340));Xc()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return Tr(Dr),null;case 4:return Yc(),null;case 10:return Xy(o.type._context),null;case 22:case 23:return u0(),null;case 24:return null;default:return null}}var nf=!1,Si=!1,pI=typeof WeakSet=="function"?WeakSet:Set,ht=null;function Fc(n,o){var u=n.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(m){Ur(n,o,m)}else u.current=null}function iy(n,o,u){try{u()}catch(m){Ur(n,o,m)}}var V1=!1;function fI(n,o){if(Ng=Df,n=lb(),jy(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else e:{u=(u=n.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var w=m.anchorOffset,S=m.focusNode;m=m.focusOffset;try{u.nodeType,S.nodeType}catch{u=null;break e}var P=0,a=-1,U=-1,de=0,Me=0,ne=n,me=null;t:for(;;){for(var Ge;ne!==u||w!==0&&ne.nodeType!==3||(a=P+w),ne!==S||m!==0&&ne.nodeType!==3||(U=P+m),ne.nodeType===3&&(P+=ne.nodeValue.length),(Ge=ne.firstChild)!==null;)me=ne,ne=Ge;for(;;){if(ne===n)break t;if(me===u&&++de===w&&(a=P),me===S&&++Me===m&&(U=P),(Ge=ne.nextSibling)!==null)break;ne=me,me=ne.parentNode}ne=Ge}u=a===-1||U===-1?null:{start:a,end:U}}else u=null}u=u||{start:0,end:0}}else u=null;for(Vg={focusedElem:n,selectionRange:u},Df=!1,ht=o;ht!==null;)if(o=ht,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,ht=n;else for(;ht!==null;){o=ht;try{var Ye=o.alternate;if((o.flags&1024)!==0)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Ye!==null){var ze=Ye.memoizedProps,kt=Ye.memoizedState,ge=o.stateNode,he=ge.getSnapshotBeforeUpdate(o.elementType===o.type?ze:Kn(o.type,ze),kt);ge.__reactInternalSnapshotBeforeUpdate=he}break;case 3:var we=o.stateNode.containerInfo;we.nodeType===1?we.textContent="":we.nodeType===9&&we.documentElement&&we.removeChild(we.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Xe(163))}}catch(je){Ur(o,o.return,je)}if(n=o.sibling,n!==null){n.return=o.return,ht=n;break}ht=o.return}return Ye=V1,V1=!1,Ye}function Fh(n,o,u){var m=o.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var w=m=m.next;do{if((w.tag&n)===n){var S=w.destroy;w.destroy=void 0,S!==void 0&&iy(o,u,S)}w=w.next}while(w!==m)}}function lm(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&n)===n){var m=u.create;u.destroy=m()}u=u.next}while(u!==o)}}function ny(n){var o=n.ref;if(o!==null){var u=n.stateNode;switch(n.tag){case 5:n=u;break;default:n=u}typeof o=="function"?o(n):o.current=n}}function o2(n){var o=n.alternate;o!==null&&(n.alternate=null,o2(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[wo],delete o[Kh],delete o[$g],delete o[YC],delete o[KC])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function s2(n){return n.tag===5||n.tag===3||n.tag===4}function j1(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||s2(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function oy(n,o,u){var m=n.tag;if(m===5||m===6)n=n.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(n,o):u.insertBefore(n,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(n,u)):(o=u,o.appendChild(n)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=Bf));else if(m!==4&&(n=n.child,n!==null))for(oy(n,o,u),n=n.sibling;n!==null;)oy(n,o,u),n=n.sibling}function sy(n,o,u){var m=n.tag;if(m===5||m===6)n=n.stateNode,o?u.insertBefore(n,o):u.appendChild(n);else if(m!==4&&(n=n.child,n!==null))for(sy(n,o,u),n=n.sibling;n!==null;)sy(n,o,u),n=n.sibling}var hi=null,Jn=!1;function $s(n,o,u){for(u=u.child;u!==null;)a2(n,o,u),u=u.sibling}function a2(n,o,u){if(bo&&typeof bo.onCommitFiberUnmount=="function")try{bo.onCommitFiberUnmount(em,u)}catch{}switch(u.tag){case 5:Si||Fc(u,o);case 6:var m=hi,w=Jn;hi=null,$s(n,o,u),hi=m,Jn=w,hi!==null&&(Jn?(n=hi,u=u.stateNode,n.nodeType===8?n.parentNode.removeChild(u):n.removeChild(u)):hi.removeChild(u.stateNode));break;case 18:hi!==null&&(Jn?(n=hi,u=u.stateNode,n.nodeType===8?og(n.parentNode,u):n.nodeType===1&&og(n,u),qh(n)):og(hi,u.stateNode));break;case 4:m=hi,w=Jn,hi=u.stateNode.containerInfo,Jn=!0,$s(n,o,u),hi=m,Jn=w;break;case 0:case 11:case 14:case 15:if(!Si&&(m=u.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){w=m=m.next;do{var S=w,P=S.destroy;S=S.tag,P!==void 0&&((S&2)!==0||(S&4)!==0)&&iy(u,o,P),w=w.next}while(w!==m)}$s(n,o,u);break;case 1:if(!Si&&(Fc(u,o),m=u.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=u.memoizedProps,m.state=u.memoizedState,m.componentWillUnmount()}catch(a){Ur(u,o,a)}$s(n,o,u);break;case 21:$s(n,o,u);break;case 22:u.mode&1?(Si=(m=Si)||u.memoizedState!==null,$s(n,o,u),Si=m):$s(n,o,u);break;default:$s(n,o,u)}}function G1(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var u=n.stateNode;u===null&&(u=n.stateNode=new pI),o.forEach(function(m){var w=TI.bind(null,n,m);u.has(m)||(u.add(m),m.then(w,w))})}}function Yn(n,o){var u=o.deletions;if(u!==null)for(var m=0;m<u.length;m++){var w=u[m];try{var S=n,P=o,a=P;e:for(;a!==null;){switch(a.tag){case 5:hi=a.stateNode,Jn=!1;break e;case 3:hi=a.stateNode.containerInfo,Jn=!0;break e;case 4:hi=a.stateNode.containerInfo,Jn=!0;break e}a=a.return}if(hi===null)throw Error(Xe(160));a2(S,P,w),hi=null,Jn=!1;var U=w.alternate;U!==null&&(U.return=null),w.return=null}catch(de){Ur(w,o,de)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)l2(o,n),o=o.sibling}function l2(n,o){var u=n.alternate,m=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Yn(o,n),xo(n),m&4){try{Fh(3,n,n.return),lm(3,n)}catch(ze){Ur(n,n.return,ze)}try{Fh(5,n,n.return)}catch(ze){Ur(n,n.return,ze)}}break;case 1:Yn(o,n),xo(n),m&512&&u!==null&&Fc(u,u.return);break;case 5:if(Yn(o,n),xo(n),m&512&&u!==null&&Fc(u,u.return),n.flags&32){var w=n.stateNode;try{jh(w,"")}catch(ze){Ur(n,n.return,ze)}}if(m&4&&(w=n.stateNode,w!=null)){var S=n.memoizedProps,P=u!==null?u.memoizedProps:S,a=n.type,U=n.updateQueue;if(n.updateQueue=null,U!==null)try{a==="input"&&S.type==="radio"&&S.name!=null&&Mw(w,S),kg(a,P);var de=kg(a,S);for(P=0;P<U.length;P+=2){var Me=U[P],ne=U[P+1];Me==="style"?Lw(w,ne):Me==="dangerouslySetInnerHTML"?Pw(w,ne):Me==="children"?jh(w,ne):My(w,Me,ne,de)}switch(a){case"input":Sg(w,S);break;case"textarea":kw(w,S);break;case"select":var me=w._wrapperState.wasMultiple;w._wrapperState.wasMultiple=!!S.multiple;var Ge=S.value;Ge!=null?Nc(w,!!S.multiple,Ge,!1):me!==!!S.multiple&&(S.defaultValue!=null?Nc(w,!!S.multiple,S.defaultValue,!0):Nc(w,!!S.multiple,S.multiple?[]:"",!1))}w[Kh]=S}catch(ze){Ur(n,n.return,ze)}}break;case 6:if(Yn(o,n),xo(n),m&4){if(n.stateNode===null)throw Error(Xe(162));w=n.stateNode,S=n.memoizedProps;try{w.nodeValue=S}catch(ze){Ur(n,n.return,ze)}}break;case 3:if(Yn(o,n),xo(n),m&4&&u!==null&&u.memoizedState.isDehydrated)try{qh(o.containerInfo)}catch(ze){Ur(n,n.return,ze)}break;case 4:Yn(o,n),xo(n);break;case 13:Yn(o,n),xo(n),w=n.child,w.flags&8192&&(S=w.memoizedState!==null,w.stateNode.isHidden=S,!S||w.alternate!==null&&w.alternate.memoizedState!==null||(l0=Vr())),m&4&&G1(n);break;case 22:if(Me=u!==null&&u.memoizedState!==null,n.mode&1?(Si=(de=Si)||Me,Yn(o,n),Si=de):Yn(o,n),xo(n),m&8192){if(de=n.memoizedState!==null,(n.stateNode.isHidden=de)&&!Me&&(n.mode&1)!==0)for(ht=n,Me=n.child;Me!==null;){for(ne=ht=Me;ht!==null;){switch(me=ht,Ge=me.child,me.tag){case 0:case 11:case 14:case 15:Fh(4,me,me.return);break;case 1:Fc(me,me.return);var Ye=me.stateNode;if(typeof Ye.componentWillUnmount=="function"){m=me,u=me.return;try{o=m,Ye.props=o.memoizedProps,Ye.state=o.memoizedState,Ye.componentWillUnmount()}catch(ze){Ur(m,u,ze)}}break;case 5:Fc(me,me.return);break;case 22:if(me.memoizedState!==null){Z1(ne);continue}}Ge!==null?(Ge.return=me,ht=Ge):Z1(ne)}Me=Me.sibling}e:for(Me=null,ne=n;;){if(ne.tag===5){if(Me===null){Me=ne;try{w=ne.stateNode,de?(S=w.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none"):(a=ne.stateNode,U=ne.memoizedProps.style,P=U!=null&&U.hasOwnProperty("display")?U.display:null,a.style.display=Dw("display",P))}catch(ze){Ur(n,n.return,ze)}}}else if(ne.tag===6){if(Me===null)try{ne.stateNode.nodeValue=de?"":ne.memoizedProps}catch(ze){Ur(n,n.return,ze)}}else if((ne.tag!==22&&ne.tag!==23||ne.memoizedState===null||ne===n)&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===n)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===n)break e;Me===ne&&(Me=null),ne=ne.return}Me===ne&&(Me=null),ne.sibling.return=ne.return,ne=ne.sibling}}break;case 19:Yn(o,n),xo(n),m&4&&G1(n);break;case 21:break;default:Yn(o,n),xo(n)}}function xo(n){var o=n.flags;if(o&2){try{e:{for(var u=n.return;u!==null;){if(s2(u)){var m=u;break e}u=u.return}throw Error(Xe(160))}switch(m.tag){case 5:var w=m.stateNode;m.flags&32&&(jh(w,""),m.flags&=-33);var S=j1(n);sy(n,S,w);break;case 3:case 4:var P=m.stateNode.containerInfo,a=j1(n);oy(n,a,P);break;default:throw Error(Xe(161))}}catch(U){Ur(n,n.return,U)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function mI(n,o,u){ht=n,c2(n)}function c2(n,o,u){for(var m=(n.mode&1)!==0;ht!==null;){var w=ht,S=w.child;if(w.tag===22&&m){var P=w.memoizedState!==null||nf;if(!P){var a=w.alternate,U=a!==null&&a.memoizedState!==null||Si;a=nf;var de=Si;if(nf=P,(Si=U)&&!de)for(ht=w;ht!==null;)P=ht,U=P.child,P.tag===22&&P.memoizedState!==null?q1(w):U!==null?(U.return=P,ht=U):q1(w);for(;S!==null;)ht=S,c2(S),S=S.sibling;ht=w,nf=a,Si=de}$1(n)}else(w.subtreeFlags&8772)!==0&&S!==null?(S.return=w,ht=S):$1(n)}}function $1(n){for(;ht!==null;){var o=ht;if((o.flags&8772)!==0){var u=o.alternate;try{if((o.flags&8772)!==0)switch(o.tag){case 0:case 11:case 15:Si||lm(5,o);break;case 1:var m=o.stateNode;if(o.flags&4&&!Si)if(u===null)m.componentDidMount();else{var w=o.elementType===o.type?u.memoizedProps:Kn(o.type,u.memoizedProps);m.componentDidUpdate(w,u.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var S=o.updateQueue;S!==null&&I1(o,S,m);break;case 3:var P=o.updateQueue;if(P!==null){if(u=null,o.child!==null)switch(o.child.tag){case 5:u=o.child.stateNode;break;case 1:u=o.child.stateNode}I1(o,P,u)}break;case 5:var a=o.stateNode;if(u===null&&o.flags&4){u=a;var U=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":U.autoFocus&&u.focus();break;case"img":U.src&&(u.src=U.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var de=o.alternate;if(de!==null){var Me=de.memoizedState;if(Me!==null){var ne=Me.dehydrated;ne!==null&&qh(ne)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Xe(163))}Si||o.flags&512&&ny(o)}catch(me){Ur(o,o.return,me)}}if(o===n){ht=null;break}if(u=o.sibling,u!==null){u.return=o.return,ht=u;break}ht=o.return}}function Z1(n){for(;ht!==null;){var o=ht;if(o===n){ht=null;break}var u=o.sibling;if(u!==null){u.return=o.return,ht=u;break}ht=o.return}}function q1(n){for(;ht!==null;){var o=ht;try{switch(o.tag){case 0:case 11:case 15:var u=o.return;try{lm(4,o)}catch(U){Ur(o,u,U)}break;case 1:var m=o.stateNode;if(typeof m.componentDidMount=="function"){var w=o.return;try{m.componentDidMount()}catch(U){Ur(o,w,U)}}var S=o.return;try{ny(o)}catch(U){Ur(o,S,U)}break;case 5:var P=o.return;try{ny(o)}catch(U){Ur(o,P,U)}}}catch(U){Ur(o,o.return,U)}if(o===n){ht=null;break}var a=o.sibling;if(a!==null){a.return=o.return,ht=a;break}ht=o.return}}var _I=Math.ceil,Wf=ss.ReactCurrentDispatcher,s0=ss.ReactCurrentOwner,Pn=ss.ReactCurrentBatchConfig,Qt=0,si=null,Gr=null,di=0,dn=0,Uc=ua(0),ei=0,id=null,fl=0,cm=0,a0=0,Uh=null,en=null,l0=0,Jc=1/0,Yo=null,Xf=!1,ay=null,na=null,of=!1,Ks=null,Hf=0,Nh=0,ly=null,wf=-1,bf=0;function Li(){return(Qt&6)!==0?Vr():wf!==-1?wf:wf=Vr()}function oa(n){return(n.mode&1)===0?1:(Qt&2)!==0&&di!==0?di&-di:QC.transition!==null?(bf===0&&(bf=qw()),bf):(n=cr,n!==0||(n=window.event,n=n===void 0?16:Qw(n.type)),n)}function ro(n,o,u,m){if(50<Nh)throw Nh=0,ly=null,Error(Xe(185));sd(n,u,m),((Qt&2)===0||n!==si)&&(n===si&&((Qt&2)===0&&(cm|=u),ei===4&&Xs(n,di)),on(n,m),u===1&&Qt===0&&(o.mode&1)===0&&(Jc=Vr()+500,om&&ha()))}function on(n,o){var u=n.callbackNode;QS(n,o);var m=Pf(n,n===si?di:0);if(m===0)u!==null&&t1(u),n.callbackNode=null,n.callbackPriority=0;else if(o=m&-m,n.callbackPriority!==o){if(u!=null&&t1(u),o===1)n.tag===0?JC(W1.bind(null,n)):yb(W1.bind(null,n)),XC(function(){(Qt&6)===0&&ha()}),u=null;else{switch(Ww(m)){case 1:u=Ly;break;case 4:u=$w;break;case 16:u=zf;break;case 536870912:u=Zw;break;default:u=zf}u=g2(u,u2.bind(null,n))}n.callbackPriority=o,n.callbackNode=u}}function u2(n,o){if(wf=-1,bf=0,(Qt&6)!==0)throw Error(Xe(327));var u=n.callbackNode;if(Zc()&&n.callbackNode!==u)return null;var m=Pf(n,n===si?di:0);if(m===0)return null;if((m&30)!==0||(m&n.expiredLanes)!==0||o)o=Yf(n,m);else{o=m;var w=Qt;Qt|=2;var S=d2();(si!==n||di!==o)&&(Yo=null,Jc=Vr()+500,cl(n,o));do try{xI();break}catch(a){h2(n,a)}while(1);Wy(),Wf.current=S,Qt=w,Gr!==null?o=0:(si=null,di=0,o=ei)}if(o!==0){if(o===2&&(w=Rg(n),w!==0&&(m=w,o=cy(n,w))),o===1)throw u=id,cl(n,0),Xs(n,m),on(n,Vr()),u;if(o===6)Xs(n,m);else{if(w=n.current.alternate,(m&30)===0&&!gI(w)&&(o=Yf(n,m),o===2&&(S=Rg(n),S!==0&&(m=S,o=cy(n,S))),o===1))throw u=id,cl(n,0),Xs(n,m),on(n,Vr()),u;switch(n.finishedWork=w,n.finishedLanes=m,o){case 0:case 1:throw Error(Xe(345));case 2:ol(n,en,Yo);break;case 3:if(Xs(n,m),(m&130023424)===m&&(o=l0+500-Vr(),10<o)){if(Pf(n,0)!==0)break;if(w=n.suspendedLanes,(w&m)!==m){Li(),n.pingedLanes|=n.suspendedLanes&w;break}n.timeoutHandle=Gg(ol.bind(null,n,en,Yo),o);break}ol(n,en,Yo);break;case 4:if(Xs(n,m),(m&4194240)===m)break;for(o=n.eventTimes,w=-1;0<m;){var P=31-to(m);S=1<<P,P=o[P],P>w&&(w=P),m&=~S}if(m=w,m=Vr()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*_I(m/1960))-m,10<m){n.timeoutHandle=Gg(ol.bind(null,n,en,Yo),m);break}ol(n,en,Yo);break;case 5:ol(n,en,Yo);break;default:throw Error(Xe(329))}}}return on(n,Vr()),n.callbackNode===u?u2.bind(null,n):null}function cy(n,o){var u=Uh;return n.current.memoizedState.isDehydrated&&(cl(n,o).flags|=256),n=Yf(n,o),n!==2&&(o=en,en=u,o!==null&&uy(o)),n}function uy(n){en===null?en=n:en.push.apply(en,n)}function gI(n){for(var o=n;;){if(o.flags&16384){var u=o.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var m=0;m<u.length;m++){var w=u[m],S=w.getSnapshot;w=w.value;try{if(!io(S(),w))return!1}catch{return!1}}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Xs(n,o){for(o&=~a0,o&=~cm,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var u=31-to(o),m=1<<u;n[u]=-1,o&=~m}}function W1(n){if((Qt&6)!==0)throw Error(Xe(327));Zc();var o=Pf(n,0);if((o&1)===0)return on(n,Vr()),null;var u=Yf(n,o);if(n.tag!==0&&u===2){var m=Rg(n);m!==0&&(o=m,u=cy(n,m))}if(u===1)throw u=id,cl(n,0),Xs(n,o),on(n,Vr()),u;if(u===6)throw Error(Xe(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,ol(n,en,Yo),on(n,Vr()),null}function c0(n,o){var u=Qt;Qt|=1;try{return n(o)}finally{Qt=u,Qt===0&&(Jc=Vr()+500,om&&ha())}}function ml(n){Ks!==null&&Ks.tag===0&&(Qt&6)===0&&Zc();var o=Qt;Qt|=1;var u=Pn.transition,m=cr;try{if(Pn.transition=null,cr=1,n)return n()}finally{cr=m,Pn.transition=u,Qt=o,(Qt&6)===0&&ha()}}function u0(){dn=Uc.current,Tr(Uc)}function cl(n,o){n.finishedWork=null,n.finishedLanes=0;var u=n.timeoutHandle;if(u!==-1&&(n.timeoutHandle=-1,WC(u)),Gr!==null)for(u=Gr.return;u!==null;){var m=u;switch($y(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&Of();break;case 3:Yc(),Tr(rn),Tr(Ci),Qy();break;case 5:Jy(m);break;case 4:Yc();break;case 13:Tr(Dr);break;case 19:Tr(Dr);break;case 10:Xy(m.type._context);break;case 22:case 23:u0()}u=u.return}if(si=n,Gr=n=sa(n.current,null),di=dn=o,ei=0,id=null,a0=cm=fl=0,en=Uh=null,al!==null){for(o=0;o<al.length;o++)if(u=al[o],m=u.interleaved,m!==null){u.interleaved=null;var w=m.next,S=u.pending;if(S!==null){var P=S.next;S.next=w,m.next=P}u.pending=m}al=null}return n}function h2(n,o){do{var u=Gr;try{if(Wy(),yf.current=qf,Zf){for(var m=Lr.memoizedState;m!==null;){var w=m.queue;w!==null&&(w.pending=null),m=m.next}Zf=!1}if(pl=0,oi=Qr=Lr=null,Oh=!1,ed=0,s0.current=null,u===null||u.return===null){ei=1,id=o,Gr=null;break}e:{var S=n,P=u.return,a=u,U=o;if(o=di,a.flags|=32768,U!==null&&typeof U=="object"&&typeof U.then=="function"){var de=U,Me=a,ne=Me.tag;if((Me.mode&1)===0&&(ne===0||ne===11||ne===15)){var me=Me.alternate;me?(Me.updateQueue=me.updateQueue,Me.memoizedState=me.memoizedState,Me.lanes=me.lanes):(Me.updateQueue=null,Me.memoizedState=null)}var Ge=L1(P);if(Ge!==null){Ge.flags&=-257,R1(Ge,P,a,S,o),Ge.mode&1&&D1(S,de,o),o=Ge,U=de;var Ye=o.updateQueue;if(Ye===null){var ze=new Set;ze.add(U),o.updateQueue=ze}else Ye.add(U);break e}else{if((o&1)===0){D1(S,de,o),h0();break e}U=Error(Xe(426))}}else if(Ar&&a.mode&1){var kt=L1(P);if(kt!==null){(kt.flags&65536)===0&&(kt.flags|=256),R1(kt,P,a,S,o),Zy(Kc(U,a));break e}}S=U=Kc(U,a),ei!==4&&(ei=2),Uh===null?Uh=[S]:Uh.push(S),S=P;do{switch(S.tag){case 3:S.flags|=65536,o&=-o,S.lanes|=o;var ge=Xb(S,U,o);C1(S,ge);break e;case 1:a=U;var he=S.type,we=S.stateNode;if((S.flags&128)===0&&(typeof he.getDerivedStateFromError=="function"||we!==null&&typeof we.componentDidCatch=="function"&&(na===null||!na.has(we)))){S.flags|=65536,o&=-o,S.lanes|=o;var je=Hb(S,a,o);C1(S,je);break e}}S=S.return}while(S!==null)}f2(u)}catch(Fe){o=Fe,Gr===u&&u!==null&&(Gr=u=u.return);continue}break}while(1)}function d2(){var n=Wf.current;return Wf.current=qf,n===null?qf:n}function h0(){(ei===0||ei===3||ei===2)&&(ei=4),si===null||(fl&268435455)===0&&(cm&268435455)===0||Xs(si,di)}function Yf(n,o){var u=Qt;Qt|=2;var m=d2();(si!==n||di!==o)&&(Yo=null,cl(n,o));do try{yI();break}catch(w){h2(n,w)}while(1);if(Wy(),Qt=u,Wf.current=m,Gr!==null)throw Error(Xe(261));return si=null,di=0,ei}function yI(){for(;Gr!==null;)p2(Gr)}function xI(){for(;Gr!==null&&!$S();)p2(Gr)}function p2(n){var o=_2(n.alternate,n,dn);n.memoizedProps=n.pendingProps,o===null?f2(n):Gr=o,s0.current=null}function f2(n){var o=n;do{var u=o.alternate;if(n=o.return,(o.flags&32768)===0){if(u=hI(u,o,dn),u!==null){Gr=u;return}}else{if(u=dI(u,o),u!==null){u.flags&=32767,Gr=u;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ei=6,Gr=null;return}}if(o=o.sibling,o!==null){Gr=o;return}Gr=o=n}while(o!==null);ei===0&&(ei=5)}function ol(n,o,u){var m=cr,w=Pn.transition;try{Pn.transition=null,cr=1,vI(n,o,u,m)}finally{Pn.transition=w,cr=m}return null}function vI(n,o,u,m){do Zc();while(Ks!==null);if((Qt&6)!==0)throw Error(Xe(327));u=n.finishedWork;var w=n.finishedLanes;if(u===null)return null;if(n.finishedWork=null,n.finishedLanes=0,u===n.current)throw Error(Xe(177));n.callbackNode=null,n.callbackPriority=0;var S=u.lanes|u.childLanes;if(eC(n,S),n===si&&(Gr=si=null,di=0),(u.subtreeFlags&2064)===0&&(u.flags&2064)===0||of||(of=!0,g2(zf,function(){return Zc(),null})),S=(u.flags&15990)!==0,(u.subtreeFlags&15990)!==0||S){S=Pn.transition,Pn.transition=null;var P=cr;cr=1;var a=Qt;Qt|=4,s0.current=null,fI(n,u),l2(u,n),NC(Vg),Df=!!Ng,Vg=Ng=null,n.current=u,mI(u),ZS(),Qt=a,cr=P,Pn.transition=S}else n.current=u;if(of&&(of=!1,Ks=n,Hf=w),S=n.pendingLanes,S===0&&(na=null),XS(u.stateNode),on(n,Vr()),o!==null)for(m=n.onRecoverableError,u=0;u<o.length;u++)w=o[u],m(w.value,{componentStack:w.stack,digest:w.digest});if(Xf)throw Xf=!1,n=ay,ay=null,n;return(Hf&1)!==0&&n.tag!==0&&Zc(),S=n.pendingLanes,(S&1)!==0?n===ly?Nh++:(Nh=0,ly=n):Nh=0,ha(),null}function Zc(){if(Ks!==null){var n=Ww(Hf),o=Pn.transition,u=cr;try{if(Pn.transition=null,cr=16>n?16:n,Ks===null)var m=!1;else{if(n=Ks,Ks=null,Hf=0,(Qt&6)!==0)throw Error(Xe(331));var w=Qt;for(Qt|=4,ht=n.current;ht!==null;){var S=ht,P=S.child;if((ht.flags&16)!==0){var a=S.deletions;if(a!==null){for(var U=0;U<a.length;U++){var de=a[U];for(ht=de;ht!==null;){var Me=ht;switch(Me.tag){case 0:case 11:case 15:Fh(8,Me,S)}var ne=Me.child;if(ne!==null)ne.return=Me,ht=ne;else for(;ht!==null;){Me=ht;var me=Me.sibling,Ge=Me.return;if(o2(Me),Me===de){ht=null;break}if(me!==null){me.return=Ge,ht=me;break}ht=Ge}}}var Ye=S.alternate;if(Ye!==null){var ze=Ye.child;if(ze!==null){Ye.child=null;do{var kt=ze.sibling;ze.sibling=null,ze=kt}while(ze!==null)}}ht=S}}if((S.subtreeFlags&2064)!==0&&P!==null)P.return=S,ht=P;else e:for(;ht!==null;){if(S=ht,(S.flags&2048)!==0)switch(S.tag){case 0:case 11:case 15:Fh(9,S,S.return)}var ge=S.sibling;if(ge!==null){ge.return=S.return,ht=ge;break e}ht=S.return}}var he=n.current;for(ht=he;ht!==null;){P=ht;var we=P.child;if((P.subtreeFlags&2064)!==0&&we!==null)we.return=P,ht=we;else e:for(P=he;ht!==null;){if(a=ht,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:lm(9,a)}}catch(Fe){Ur(a,a.return,Fe)}if(a===P){ht=null;break e}var je=a.sibling;if(je!==null){je.return=a.return,ht=je;break e}ht=a.return}}if(Qt=w,ha(),bo&&typeof bo.onPostCommitFiberRoot=="function")try{bo.onPostCommitFiberRoot(em,n)}catch{}m=!0}return m}finally{cr=u,Pn.transition=o}}return!1}function X1(n,o,u){o=Kc(u,o),o=Xb(n,o,1),n=ia(n,o,1),o=Li(),n!==null&&(sd(n,1,o),on(n,o))}function Ur(n,o,u){if(n.tag===3)X1(n,n,u);else for(;o!==null;){if(o.tag===3){X1(o,n,u);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(na===null||!na.has(m))){n=Kc(u,n),n=Hb(o,n,1),o=ia(o,n,1),n=Li(),o!==null&&(sd(o,1,n),on(o,n));break}}o=o.return}}function wI(n,o,u){var m=n.pingCache;m!==null&&m.delete(o),o=Li(),n.pingedLanes|=n.suspendedLanes&u,si===n&&(di&u)===u&&(ei===4||ei===3&&(di&130023424)===di&&500>Vr()-l0?cl(n,0):a0|=u),on(n,o)}function m2(n,o){o===0&&((n.mode&1)===0?o=1:(o=Xp,Xp<<=1,(Xp&130023424)===0&&(Xp=4194304)));var u=Li();n=ns(n,o),n!==null&&(sd(n,o,u),on(n,u))}function bI(n){var o=n.memoizedState,u=0;o!==null&&(u=o.retryLane),m2(n,u)}function TI(n,o){var u=0;switch(n.tag){case 13:var m=n.stateNode,w=n.memoizedState;w!==null&&(u=w.retryLane);break;case 19:m=n.stateNode;break;default:throw Error(Xe(314))}m!==null&&m.delete(o),m2(n,u)}var _2;_2=function(n,o,u){if(n!==null)if(n.memoizedProps!==o.pendingProps||rn.current)tn=!0;else{if((n.lanes&u)===0&&(o.flags&128)===0)return tn=!1,uI(n,o,u);tn=(n.flags&131072)!==0}else tn=!1,Ar&&(o.flags&1048576)!==0&&xb(o,Nf,o.index);switch(o.lanes=0,o.tag){case 2:var m=o.type;vf(n,o),n=o.pendingProps;var w=Wc(o,Ci.current);$c(o,u),w=t0(null,o,m,n,w,u);var S=r0();return o.flags|=1,typeof w=="object"&&w!==null&&typeof w.render=="function"&&w.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,nn(m)?(S=!0,Ff(o)):S=!1,o.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,Yy(o),w.updater=sm,o.stateNode=w,w._reactInternals=o,Yg(o,m,n,u),o=Qg(null,o,m,!0,S,u)):(o.tag=0,Ar&&S&&Gy(o),Di(null,o,w,u),o=o.child),o;case 16:m=o.elementType;e:{switch(vf(n,o),n=o.pendingProps,w=m._init,m=w(m._payload),o.type=m,w=o.tag=SI(m),n=Kn(m,n),w){case 0:o=Jg(null,o,m,n,u);break e;case 1:o=F1(null,o,m,n,u);break e;case 11:o=B1(null,o,m,n,u);break e;case 14:o=O1(null,o,m,Kn(m.type,n),u);break e}throw Error(Xe(306,m,""))}return o;case 0:return m=o.type,w=o.pendingProps,w=o.elementType===m?w:Kn(m,w),Jg(n,o,m,w,u);case 1:return m=o.type,w=o.pendingProps,w=o.elementType===m?w:Kn(m,w),F1(n,o,m,w,u);case 3:e:{if(Qb(o),n===null)throw Error(Xe(387));m=o.pendingProps,S=o.memoizedState,w=S.element,Tb(n,o),Gf(o,m,null,u);var P=o.memoizedState;if(m=P.element,S.isDehydrated)if(S={element:m,isDehydrated:!1,cache:P.cache,pendingSuspenseBoundaries:P.pendingSuspenseBoundaries,transitions:P.transitions},o.updateQueue.baseState=S,o.memoizedState=S,o.flags&256){w=Kc(Error(Xe(423)),o),o=U1(n,o,m,u,w);break e}else if(m!==w){w=Kc(Error(Xe(424)),o),o=U1(n,o,m,u,w);break e}else for(pn=ra(o.stateNode.containerInfo.firstChild),fn=o,Ar=!0,eo=null,u=Ib(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Xc(),m===w){o=os(n,o,u);break e}Di(n,o,m,u)}o=o.child}return o;case 5:return Ab(o),n===null&&Wg(o),m=o.type,w=o.pendingProps,S=n!==null?n.memoizedProps:null,P=w.children,jg(m,w)?P=null:S!==null&&jg(m,S)&&(o.flags|=32),Jb(n,o),Di(n,o,P,u),o.child;case 6:return n===null&&Wg(o),null;case 13:return e2(n,o,u);case 4:return Ky(o,o.stateNode.containerInfo),m=o.pendingProps,n===null?o.child=Hc(o,null,m,u):Di(n,o,m,u),o.child;case 11:return m=o.type,w=o.pendingProps,w=o.elementType===m?w:Kn(m,w),B1(n,o,m,w,u);case 7:return Di(n,o,o.pendingProps,u),o.child;case 8:return Di(n,o,o.pendingProps.children,u),o.child;case 12:return Di(n,o,o.pendingProps.children,u),o.child;case 10:e:{if(m=o.type._context,w=o.pendingProps,S=o.memoizedProps,P=w.value,yr(Vf,m._currentValue),m._currentValue=P,S!==null)if(io(S.value,P)){if(S.children===w.children&&!rn.current){o=os(n,o,u);break e}}else for(S=o.child,S!==null&&(S.return=o);S!==null;){var a=S.dependencies;if(a!==null){P=S.child;for(var U=a.firstContext;U!==null;){if(U.context===m){if(S.tag===1){U=es(-1,u&-u),U.tag=2;var de=S.updateQueue;if(de!==null){de=de.shared;var Me=de.pending;Me===null?U.next=U:(U.next=Me.next,Me.next=U),de.pending=U}}S.lanes|=u,U=S.alternate,U!==null&&(U.lanes|=u),Xg(S.return,u,o),a.lanes|=u;break}U=U.next}}else if(S.tag===10)P=S.type===o.type?null:S.child;else if(S.tag===18){if(P=S.return,P===null)throw Error(Xe(341));P.lanes|=u,a=P.alternate,a!==null&&(a.lanes|=u),Xg(P,u,o),P=S.sibling}else P=S.child;if(P!==null)P.return=S;else for(P=S;P!==null;){if(P===o){P=null;break}if(S=P.sibling,S!==null){S.return=P.return,P=S;break}P=P.return}S=P}Di(n,o,w.children,u),o=o.child}return o;case 9:return w=o.type,m=o.pendingProps.children,$c(o,u),w=Dn(w),m=m(w),o.flags|=1,Di(n,o,m,u),o.child;case 14:return m=o.type,w=Kn(m,o.pendingProps),w=Kn(m.type,w),O1(n,o,m,w,u);case 15:return Yb(n,o,o.type,o.pendingProps,u);case 17:return m=o.type,w=o.pendingProps,w=o.elementType===m?w:Kn(m,w),vf(n,o),o.tag=1,nn(m)?(n=!0,Ff(o)):n=!1,$c(o,u),Sb(o,m,w),Yg(o,m,w,u),Qg(null,o,m,!0,n,u);case 19:return t2(n,o,u);case 22:return Kb(n,o,u)}throw Error(Xe(156,o.tag))};function g2(n,o){return Gw(n,o)}function EI(n,o,u,m){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(n,o,u,m){return new EI(n,o,u,m)}function d0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function SI(n){if(typeof n=="function")return d0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===zy)return 11;if(n===Py)return 14}return 2}function sa(n,o){var u=n.alternate;return u===null?(u=zn(n.tag,o,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=o,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&14680064,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,o=n.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u}function Tf(n,o,u,m,w,S){var P=2;if(m=n,typeof n=="function")d0(n)&&(P=1);else if(typeof n=="string")P=5;else e:switch(n){case Mc:return ul(u.children,w,S,o);case ky:P=8,w|=8;break;case vg:return n=zn(12,u,o,w|2),n.elementType=vg,n.lanes=S,n;case wg:return n=zn(13,u,o,w),n.elementType=wg,n.lanes=S,n;case bg:return n=zn(19,u,o,w),n.elementType=bg,n.lanes=S,n;case Cw:return um(u,w,S,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Ew:P=10;break e;case Sw:P=9;break e;case zy:P=11;break e;case Py:P=14;break e;case Zs:P=16,m=null;break e}throw Error(Xe(130,n==null?n:typeof n,""))}return o=zn(P,u,o,w),o.elementType=n,o.type=m,o.lanes=S,o}function ul(n,o,u,m){return n=zn(7,n,m,o),n.lanes=u,n}function um(n,o,u,m){return n=zn(22,n,m,o),n.elementType=Cw,n.lanes=u,n.stateNode={isHidden:!1},n}function pg(n,o,u){return n=zn(6,n,null,o),n.lanes=u,n}function fg(n,o,u){return o=zn(4,n.children!==null?n.children:[],n.key,o),o.lanes=u,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function CI(n,o,u,m,w){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=X_(0),this.expirationTimes=X_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=X_(0),this.identifierPrefix=m,this.onRecoverableError=w,this.mutableSourceEagerHydrationData=null}function p0(n,o,u,m,w,S,P,a,U){return n=new CI(n,o,u,a,U),o===1?(o=1,S===!0&&(o|=8)):o=0,S=zn(3,null,null,o),n.current=S,S.stateNode=n,S.memoizedState={element:m,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yy(S),n}function II(n,o,u){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ac,key:m==null?null:""+m,children:n,containerInfo:o,implementation:u}}function y2(n){if(!n)return la;n=n._reactInternals;e:{if(gl(n)!==n||n.tag!==1)throw Error(Xe(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(nn(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Xe(171))}if(n.tag===1){var u=n.type;if(nn(u))return gb(n,u,o)}return o}function x2(n,o,u,m,w,S,P,a,U){return n=p0(u,m,!0,n,w,S,P,a,U),n.context=y2(null),u=n.current,m=Li(),w=oa(u),S=es(m,w),S.callback=o!=null?o:null,ia(u,S,w),n.current.lanes=w,sd(n,w,m),on(n,m),n}function hm(n,o,u,m){var w=o.current,S=Li(),P=oa(w);return u=y2(u),o.context===null?o.context=u:o.pendingContext=u,o=es(S,P),o.payload={element:n},m=m===void 0?null:m,m!==null&&(o.callback=m),n=ia(w,o,P),n!==null&&(ro(n,w,P,S),gf(n,w,P)),P}function Kf(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function H1(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<o?u:o}}function f0(n,o){H1(n,o),(n=n.alternate)&&H1(n,o)}function AI(){return null}var v2=typeof reportError=="function"?reportError:function(n){console.error(n)};function m0(n){this._internalRoot=n}dm.prototype.render=m0.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(Xe(409));hm(n,o,null,null)};dm.prototype.unmount=m0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;ml(function(){hm(null,n,null,null)}),o[is]=null}};function dm(n){this._internalRoot=n}dm.prototype.unstable_scheduleHydration=function(n){if(n){var o=Yw();n={blockedOn:null,target:n,priority:o};for(var u=0;u<Ws.length&&o!==0&&o<Ws[u].priority;u++);Ws.splice(u,0,n),u===0&&Jw(n)}};function _0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function pm(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Y1(){}function MI(n,o,u,m,w){if(w){if(typeof m=="function"){var S=m;m=function(){var de=Kf(P);S.call(de)}}var P=x2(o,m,n,0,null,!1,!1,"",Y1);return n._reactRootContainer=P,n[is]=P.current,Hh(n.nodeType===8?n.parentNode:n),ml(),P}for(;w=n.lastChild;)n.removeChild(w);if(typeof m=="function"){var a=m;m=function(){var de=Kf(U);a.call(de)}}var U=p0(n,0,!1,null,null,!1,!1,"",Y1);return n._reactRootContainer=U,n[is]=U.current,Hh(n.nodeType===8?n.parentNode:n),ml(function(){hm(o,U,u,m)}),U}function fm(n,o,u,m,w){var S=u._reactRootContainer;if(S){var P=S;if(typeof w=="function"){var a=w;w=function(){var U=Kf(P);a.call(U)}}hm(o,P,n,w)}else P=MI(u,o,n,w,m);return Kf(P)}Xw=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var u=Mh(o.pendingLanes);u!==0&&(Ry(o,u|1),on(o,Vr()),(Qt&6)===0&&(Jc=Vr()+500,ha()))}break;case 13:ml(function(){var m=ns(n,1);if(m!==null){var w=Li();ro(m,n,1,w)}}),f0(n,1)}};By=function(n){if(n.tag===13){var o=ns(n,134217728);if(o!==null){var u=Li();ro(o,n,134217728,u)}f0(n,134217728)}};Hw=function(n){if(n.tag===13){var o=oa(n),u=ns(n,o);if(u!==null){var m=Li();ro(u,n,o,m)}f0(n,o)}};Yw=function(){return cr};Kw=function(n,o){var u=cr;try{return cr=n,o()}finally{cr=u}};Pg=function(n,o,u){switch(o){case"input":if(Sg(n,u),o=u.name,u.type==="radio"&&o!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<u.length;o++){var m=u[o];if(m!==n&&m.form===n.form){var w=nm(m);if(!w)throw Error(Xe(90));Aw(m),Sg(m,w)}}}break;case"textarea":kw(n,u);break;case"select":o=u.value,o!=null&&Nc(n,!!u.multiple,o,!1)}};Ow=c0;Fw=ml;var kI={usingClientEntryPoint:!1,Events:[ld,Dc,nm,Rw,Bw,c0]},Sh={findFiberByHostInstance:sl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},zI={bundleType:Sh.bundleType,version:Sh.version,rendererPackageName:Sh.rendererPackageName,rendererConfig:Sh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ss.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Vw(n),n===null?null:n.stateNode},findFiberByHostInstance:Sh.findFiberByHostInstance||AI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var sf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sf.isDisabled&&sf.supportsFiber)try{em=sf.inject(zI),bo=sf}catch{}}_n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kI;_n.createPortal=function(n,o){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_0(o))throw Error(Xe(200));return II(n,o,null,u)};_n.createRoot=function(n,o){if(!_0(n))throw Error(Xe(299));var u=!1,m="",w=v2;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(w=o.onRecoverableError)),o=p0(n,1,!1,null,null,u,!1,m,w),n[is]=o.current,Hh(n.nodeType===8?n.parentNode:n),new m0(o)};_n.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(Xe(188)):(n=Object.keys(n).join(","),Error(Xe(268,n)));return n=Vw(o),n=n===null?null:n.stateNode,n};_n.flushSync=function(n){return ml(n)};_n.hydrate=function(n,o,u){if(!pm(o))throw Error(Xe(200));return fm(null,n,o,!0,u)};_n.hydrateRoot=function(n,o,u){if(!_0(n))throw Error(Xe(405));var m=u!=null&&u.hydratedSources||null,w=!1,S="",P=v2;if(u!=null&&(u.unstable_strictMode===!0&&(w=!0),u.identifierPrefix!==void 0&&(S=u.identifierPrefix),u.onRecoverableError!==void 0&&(P=u.onRecoverableError)),o=x2(o,null,n,1,u!=null?u:null,w,!1,S,P),n[is]=o.current,Hh(n),m)for(n=0;n<m.length;n++)u=m[n],w=u._getVersion,w=w(u._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[u,w]:o.mutableSourceEagerHydrationData.push(u,w);return new dm(o)};_n.render=function(n,o,u){if(!pm(o))throw Error(Xe(200));return fm(null,n,o,!1,u)};_n.unmountComponentAtNode=function(n){if(!pm(n))throw Error(Xe(40));return n._reactRootContainer?(ml(function(){fm(null,null,n,!1,function(){n._reactRootContainer=null,n[is]=null})}),!0):!1};_n.unstable_batchedUpdates=c0;_n.unstable_renderSubtreeIntoContainer=function(n,o,u,m){if(!pm(u))throw Error(Xe(200));if(n==null||n._reactInternals===void 0)throw Error(Xe(38));return fm(n,o,u,!1,m)};_n.version="18.2.0-next-9e3b772b8-20220608";(function(n){function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(u){console.error(u)}}o(),n.exports=_n})(xw);var K1=xw.exports;yg.createRoot=K1.createRoot,yg.hydrateRoot=K1.hydrateRoot;const w2=()=>({VITE_API_URL:"https://maps-sockets-react.up.railway.app",VITE_MAPS_TOKEN:"pk.eyJ1IjoibXlrM3MiLCJhIjoiY2w3MHZpaWh2MGc4NTN1bnRpcnJldnQ5bSJ9.d5SEpjCBwm5WLmyttaCDGg"}),So=Object.create(null);So.open="0";So.close="1";So.ping="2";So.pong="3";So.message="4";So.upgrade="5";So.noop="6";const Ef=Object.create(null);Object.keys(So).forEach(n=>{Ef[So[n]]=n});const PI={type:"error",data:"parser error"},DI=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",LI=typeof ArrayBuffer=="function",RI=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,b2=({type:n,data:o},u,m)=>DI&&o instanceof Blob?u?m(o):J1(o,m):LI&&(o instanceof ArrayBuffer||RI(o))?u?m(o):J1(new Blob([o]),m):m(So[n]+(o||"")),J1=(n,o)=>{const u=new FileReader;return u.onload=function(){const m=u.result.split(",")[1];o("b"+m)},u.readAsDataURL(n)},Q1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zh=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<Q1.length;n++)zh[Q1.charCodeAt(n)]=n;const BI=n=>{let o=n.length*.75,u=n.length,m,w=0,S,P,a,U;n[n.length-1]==="="&&(o--,n[n.length-2]==="="&&o--);const de=new ArrayBuffer(o),Me=new Uint8Array(de);for(m=0;m<u;m+=4)S=zh[n.charCodeAt(m)],P=zh[n.charCodeAt(m+1)],a=zh[n.charCodeAt(m+2)],U=zh[n.charCodeAt(m+3)],Me[w++]=S<<2|P>>4,Me[w++]=(P&15)<<4|a>>2,Me[w++]=(a&3)<<6|U&63;return de},OI=typeof ArrayBuffer=="function",T2=(n,o)=>{if(typeof n!="string")return{type:"message",data:E2(n,o)};const u=n.charAt(0);return u==="b"?{type:"message",data:FI(n.substring(1),o)}:Ef[u]?n.length>1?{type:Ef[u],data:n.substring(1)}:{type:Ef[u]}:PI},FI=(n,o)=>{if(OI){const u=BI(n);return E2(u,o)}else return{base64:!0,data:n}},E2=(n,o)=>{switch(o){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},S2=String.fromCharCode(30),UI=(n,o)=>{const u=n.length,m=new Array(u);let w=0;n.forEach((S,P)=>{b2(S,!1,a=>{m[P]=a,++w===u&&o(m.join(S2))})})},NI=(n,o)=>{const u=n.split(S2),m=[];for(let w=0;w<u.length;w++){const S=T2(u[w],o);if(m.push(S),S.type==="error")break}return m},C2=4;function $r(n){if(n)return VI(n)}function VI(n){for(var o in $r.prototype)n[o]=$r.prototype[o];return n}$r.prototype.on=$r.prototype.addEventListener=function(n,o){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(o),this};$r.prototype.once=function(n,o){function u(){this.off(n,u),o.apply(this,arguments)}return u.fn=o,this.on(n,u),this};$r.prototype.off=$r.prototype.removeListener=$r.prototype.removeAllListeners=$r.prototype.removeEventListener=function(n,o){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var u=this._callbacks["$"+n];if(!u)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var m,w=0;w<u.length;w++)if(m=u[w],m===o||m.fn===o){u.splice(w,1);break}return u.length===0&&delete this._callbacks["$"+n],this};$r.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var o=new Array(arguments.length-1),u=this._callbacks["$"+n],m=1;m<arguments.length;m++)o[m-1]=arguments[m];if(u){u=u.slice(0);for(var m=0,w=u.length;m<w;++m)u[m].apply(this,o)}return this};$r.prototype.emitReserved=$r.prototype.emit;$r.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};$r.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Js=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function I2(n,...o){return o.reduce((u,m)=>(n.hasOwnProperty(m)&&(u[m]=n[m]),u),{})}const jI=setTimeout,GI=clearTimeout;function mm(n,o){o.useNativeTimers?(n.setTimeoutFn=jI.bind(Js),n.clearTimeoutFn=GI.bind(Js)):(n.setTimeoutFn=setTimeout.bind(Js),n.clearTimeoutFn=clearTimeout.bind(Js))}const $I=1.33;function ZI(n){return typeof n=="string"?qI(n):Math.ceil((n.byteLength||n.size)*$I)}function qI(n){let o=0,u=0;for(let m=0,w=n.length;m<w;m++)o=n.charCodeAt(m),o<128?u+=1:o<2048?u+=2:o<55296||o>=57344?u+=3:(m++,u+=4);return u}class WI extends Error{constructor(o,u,m){super(o),this.description=u,this.context=m,this.type="TransportError"}}class A2 extends $r{constructor(o){super(),this.writable=!1,mm(this,o),this.opts=o,this.query=o.query,this.readyState="",this.socket=o.socket}onError(o,u,m){return super.emitReserved("error",new WI(o,u,m)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(o){this.readyState==="open"&&this.write(o)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(o){const u=T2(o,this.socket.binaryType);this.onPacket(u)}onPacket(o){super.emitReserved("packet",o)}onClose(o){this.readyState="closed",super.emitReserved("close",o)}}const M2="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),hy=64,XI={};let ew=0,af=0,tw;function rw(n){let o="";do o=M2[n%hy]+o,n=Math.floor(n/hy);while(n>0);return o}function k2(){const n=rw(+new Date);return n!==tw?(ew=0,tw=n):n+"."+rw(ew++)}for(;af<hy;af++)XI[M2[af]]=af;function z2(n){let o="";for(let u in n)n.hasOwnProperty(u)&&(o.length&&(o+="&"),o+=encodeURIComponent(u)+"="+encodeURIComponent(n[u]));return o}function HI(n){let o={},u=n.split("&");for(let m=0,w=u.length;m<w;m++){let S=u[m].split("=");o[decodeURIComponent(S[0])]=decodeURIComponent(S[1])}return o}let P2=!1;try{P2=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const YI=P2;function D2(n){const o=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!o||YI))return new XMLHttpRequest}catch{}if(!o)try{return new Js[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function KI(){}const JI=function(){return new D2({xdomain:!1}).responseType!=null}();class QI extends A2{constructor(o){if(super(o),this.polling=!1,typeof location<"u"){const m=location.protocol==="https:";let w=location.port;w||(w=m?"443":"80"),this.xd=typeof location<"u"&&o.hostname!==location.hostname||w!==o.port,this.xs=o.secure!==m}const u=o&&o.forceBase64;this.supportsBinary=JI&&!u}get name(){return"polling"}doOpen(){this.poll()}pause(o){this.readyState="pausing";const u=()=>{this.readyState="paused",o()};if(this.polling||!this.writable){let m=0;this.polling&&(m++,this.once("pollComplete",function(){--m||u()})),this.writable||(m++,this.once("drain",function(){--m||u()}))}else u()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(o){const u=m=>{if(this.readyState==="opening"&&m.type==="open"&&this.onOpen(),m.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(m)};NI(o,this.socket.binaryType).forEach(u),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const o=()=>{this.write([{type:"close"}])};this.readyState==="open"?o():this.once("open",o)}write(o){this.writable=!1,UI(o,u=>{this.doWrite(u,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let o=this.query||{};const u=this.opts.secure?"https":"http";let m="";this.opts.timestampRequests!==!1&&(o[this.opts.timestampParam]=k2()),!this.supportsBinary&&!o.sid&&(o.b64=1),this.opts.port&&(u==="https"&&Number(this.opts.port)!==443||u==="http"&&Number(this.opts.port)!==80)&&(m=":"+this.opts.port);const w=z2(o),S=this.opts.hostname.indexOf(":")!==-1;return u+"://"+(S?"["+this.opts.hostname+"]":this.opts.hostname)+m+this.opts.path+(w.length?"?"+w:"")}request(o={}){return Object.assign(o,{xd:this.xd,xs:this.xs},this.opts),new Eo(this.uri(),o)}doWrite(o,u){const m=this.request({method:"POST",data:o});m.on("success",u),m.on("error",(w,S)=>{this.onError("xhr post error",w,S)})}doPoll(){const o=this.request();o.on("data",this.onData.bind(this)),o.on("error",(u,m)=>{this.onError("xhr poll error",u,m)}),this.pollXhr=o}}class Eo extends $r{constructor(o,u){super(),mm(this,u),this.opts=u,this.method=u.method||"GET",this.uri=o,this.async=u.async!==!1,this.data=u.data!==void 0?u.data:null,this.create()}create(){const o=I2(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");o.xdomain=!!this.opts.xd,o.xscheme=!!this.opts.xs;const u=this.xhr=new D2(o);try{u.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){u.setDisableHeaderCheck&&u.setDisableHeaderCheck(!0);for(let m in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(m)&&u.setRequestHeader(m,this.opts.extraHeaders[m])}}catch{}if(this.method==="POST")try{u.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{u.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in u&&(u.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(u.timeout=this.opts.requestTimeout),u.onreadystatechange=()=>{u.readyState===4&&(u.status===200||u.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof u.status=="number"?u.status:0)},0))},u.send(this.data)}catch(m){this.setTimeoutFn(()=>{this.onError(m)},0);return}typeof document<"u"&&(this.index=Eo.requestsCount++,Eo.requests[this.index]=this)}onError(o){this.emitReserved("error",o,this.xhr),this.cleanup(!0)}cleanup(o){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=KI,o)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Eo.requests[this.index],this.xhr=null}}onLoad(){const o=this.xhr.responseText;o!==null&&(this.emitReserved("data",o),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Eo.requestsCount=0;Eo.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",iw);else if(typeof addEventListener=="function"){const n="onpagehide"in Js?"pagehide":"unload";addEventListener(n,iw,!1)}}function iw(){for(let n in Eo.requests)Eo.requests.hasOwnProperty(n)&&Eo.requests[n].abort()}const eA=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?o=>Promise.resolve().then(o):(o,u)=>u(o,0))(),lf=Js.WebSocket||Js.MozWebSocket,nw=!0,tA="arraybuffer",ow=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class rA extends A2{constructor(o){super(o),this.supportsBinary=!o.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const o=this.uri(),u=this.opts.protocols,m=ow?{}:I2(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(m.headers=this.opts.extraHeaders);try{this.ws=nw&&!ow?u?new lf(o,u):new lf(o):new lf(o,u,m)}catch(w){return this.emitReserved("error",w)}this.ws.binaryType=this.socket.binaryType||tA,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=o=>this.onClose({description:"websocket connection closed",context:o}),this.ws.onmessage=o=>this.onData(o.data),this.ws.onerror=o=>this.onError("websocket error",o)}write(o){this.writable=!1;for(let u=0;u<o.length;u++){const m=o[u],w=u===o.length-1;b2(m,this.supportsBinary,S=>{const P={};try{nw&&this.ws.send(S)}catch{}w&&eA(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let o=this.query||{};const u=this.opts.secure?"wss":"ws";let m="";this.opts.port&&(u==="wss"&&Number(this.opts.port)!==443||u==="ws"&&Number(this.opts.port)!==80)&&(m=":"+this.opts.port),this.opts.timestampRequests&&(o[this.opts.timestampParam]=k2()),this.supportsBinary||(o.b64=1);const w=z2(o),S=this.opts.hostname.indexOf(":")!==-1;return u+"://"+(S?"["+this.opts.hostname+"]":this.opts.hostname)+m+this.opts.path+(w.length?"?"+w:"")}check(){return!!lf}}const iA={websocket:rA,polling:QI},nA=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,oA=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function dy(n){const o=n,u=n.indexOf("["),m=n.indexOf("]");u!=-1&&m!=-1&&(n=n.substring(0,u)+n.substring(u,m).replace(/:/g,";")+n.substring(m,n.length));let w=nA.exec(n||""),S={},P=14;for(;P--;)S[oA[P]]=w[P]||"";return u!=-1&&m!=-1&&(S.source=o,S.host=S.host.substring(1,S.host.length-1).replace(/;/g,":"),S.authority=S.authority.replace("[","").replace("]","").replace(/;/g,":"),S.ipv6uri=!0),S.pathNames=sA(S,S.path),S.queryKey=aA(S,S.query),S}function sA(n,o){const u=/\/{2,9}/g,m=o.replace(u,"/").split("/");return(o.substr(0,1)=="/"||o.length===0)&&m.splice(0,1),o.substr(o.length-1,1)=="/"&&m.splice(m.length-1,1),m}function aA(n,o){const u={};return o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(m,w,S){w&&(u[w]=S)}),u}class Hs extends $r{constructor(o,u={}){super(),o&&typeof o=="object"&&(u=o,o=null),o?(o=dy(o),u.hostname=o.host,u.secure=o.protocol==="https"||o.protocol==="wss",u.port=o.port,o.query&&(u.query=o.query)):u.host&&(u.hostname=dy(u.host).host),mm(this,u),this.secure=u.secure!=null?u.secure:typeof location<"u"&&location.protocol==="https:",u.hostname&&!u.port&&(u.port=this.secure?"443":"80"),this.hostname=u.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=u.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=u.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},u),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=HI(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(o){const u=Object.assign({},this.opts.query);u.EIO=C2,u.transport=o,this.id&&(u.sid=this.id);const m=Object.assign({},this.opts.transportOptions[o],this.opts,{query:u,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new iA[o](m)}open(){let o;if(this.opts.rememberUpgrade&&Hs.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)o="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else o=this.transports[0];this.readyState="opening";try{o=this.createTransport(o)}catch{this.transports.shift(),this.open();return}o.open(),this.setTransport(o)}setTransport(o){this.transport&&this.transport.removeAllListeners(),this.transport=o,o.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",u=>this.onClose("transport close",u))}probe(o){let u=this.createTransport(o),m=!1;Hs.priorWebsocketSuccess=!1;const w=()=>{m||(u.send([{type:"ping",data:"probe"}]),u.once("packet",ne=>{if(!m)if(ne.type==="pong"&&ne.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",u),!u)return;Hs.priorWebsocketSuccess=u.name==="websocket",this.transport.pause(()=>{m||this.readyState!=="closed"&&(Me(),this.setTransport(u),u.send([{type:"upgrade"}]),this.emitReserved("upgrade",u),u=null,this.upgrading=!1,this.flush())})}else{const me=new Error("probe error");me.transport=u.name,this.emitReserved("upgradeError",me)}}))};function S(){m||(m=!0,Me(),u.close(),u=null)}const P=ne=>{const me=new Error("probe error: "+ne);me.transport=u.name,S(),this.emitReserved("upgradeError",me)};function a(){P("transport closed")}function U(){P("socket closed")}function de(ne){u&&ne.name!==u.name&&S()}const Me=()=>{u.removeListener("open",w),u.removeListener("error",P),u.removeListener("close",a),this.off("close",U),this.off("upgrading",de)};u.once("open",w),u.once("error",P),u.once("close",a),this.once("close",U),this.once("upgrading",de),u.open()}onOpen(){if(this.readyState="open",Hs.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let o=0;const u=this.upgrades.length;for(;o<u;o++)this.probe(this.upgrades[o])}}onPacket(o){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",o),this.emitReserved("heartbeat"),o.type){case"open":this.onHandshake(JSON.parse(o.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const u=new Error("server error");u.code=o.data,this.onError(u);break;case"message":this.emitReserved("data",o.data),this.emitReserved("message",o.data);break}}onHandshake(o){this.emitReserved("handshake",o),this.id=o.sid,this.transport.query.sid=o.sid,this.upgrades=this.filterUpgrades(o.upgrades),this.pingInterval=o.pingInterval,this.pingTimeout=o.pingTimeout,this.maxPayload=o.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const o=this.getWritablePackets();this.transport.send(o),this.prevBufferLen=o.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let u=1;for(let m=0;m<this.writeBuffer.length;m++){const w=this.writeBuffer[m].data;if(w&&(u+=ZI(w)),m>0&&u>this.maxPayload)return this.writeBuffer.slice(0,m);u+=2}return this.writeBuffer}write(o,u,m){return this.sendPacket("message",o,u,m),this}send(o,u,m){return this.sendPacket("message",o,u,m),this}sendPacket(o,u,m,w){if(typeof u=="function"&&(w=u,u=void 0),typeof m=="function"&&(w=m,m=null),this.readyState==="closing"||this.readyState==="closed")return;m=m||{},m.compress=m.compress!==!1;const S={type:o,data:u,options:m};this.emitReserved("packetCreate",S),this.writeBuffer.push(S),w&&this.once("flush",w),this.flush()}close(){const o=()=>{this.onClose("forced close"),this.transport.close()},u=()=>{this.off("upgrade",u),this.off("upgradeError",u),o()},m=()=>{this.once("upgrade",u),this.once("upgradeError",u)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?m():o()}):this.upgrading?m():o()),this}onError(o){Hs.priorWebsocketSuccess=!1,this.emitReserved("error",o),this.onClose("transport error",o)}onClose(o,u){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",o,u),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(o){const u=[];let m=0;const w=o.length;for(;m<w;m++)~this.transports.indexOf(o[m])&&u.push(o[m]);return u}}Hs.protocol=C2;function lA(n,o="",u){let m=n;u=u||typeof location<"u"&&location,n==null&&(n=u.protocol+"//"+u.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=u.protocol+n:n=u.host+n),/^(https?|wss?):\/\//.test(n)||(typeof u<"u"?n=u.protocol+"//"+n:n="https://"+n),m=dy(n)),m.port||(/^(http|ws)$/.test(m.protocol)?m.port="80":/^(http|ws)s$/.test(m.protocol)&&(m.port="443")),m.path=m.path||"/";const S=m.host.indexOf(":")!==-1?"["+m.host+"]":m.host;return m.id=m.protocol+"://"+S+":"+m.port+o,m.href=m.protocol+"://"+S+(u&&u.port===m.port?"":":"+m.port),m}const cA=typeof ArrayBuffer=="function",uA=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,L2=Object.prototype.toString,hA=typeof Blob=="function"||typeof Blob<"u"&&L2.call(Blob)==="[object BlobConstructor]",dA=typeof File=="function"||typeof File<"u"&&L2.call(File)==="[object FileConstructor]";function g0(n){return cA&&(n instanceof ArrayBuffer||uA(n))||hA&&n instanceof Blob||dA&&n instanceof File}function Sf(n,o){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let u=0,m=n.length;u<m;u++)if(Sf(n[u]))return!0;return!1}if(g0(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Sf(n.toJSON(),!0);for(const u in n)if(Object.prototype.hasOwnProperty.call(n,u)&&Sf(n[u]))return!0;return!1}function pA(n){const o=[],u=n.data,m=n;return m.data=py(u,o),m.attachments=o.length,{packet:m,buffers:o}}function py(n,o){if(!n)return n;if(g0(n)){const u={_placeholder:!0,num:o.length};return o.push(n),u}else if(Array.isArray(n)){const u=new Array(n.length);for(let m=0;m<n.length;m++)u[m]=py(n[m],o);return u}else if(typeof n=="object"&&!(n instanceof Date)){const u={};for(const m in n)Object.prototype.hasOwnProperty.call(n,m)&&(u[m]=py(n[m],o));return u}return n}function fA(n,o){return n.data=fy(n.data,o),n.attachments=void 0,n}function fy(n,o){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<o.length)return o[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let u=0;u<n.length;u++)n[u]=fy(n[u],o);else if(typeof n=="object")for(const u in n)Object.prototype.hasOwnProperty.call(n,u)&&(n[u]=fy(n[u],o));return n}const mA=5;var Yt;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Yt||(Yt={}));class _A{constructor(o){this.replacer=o}encode(o){return(o.type===Yt.EVENT||o.type===Yt.ACK)&&Sf(o)?(o.type=o.type===Yt.EVENT?Yt.BINARY_EVENT:Yt.BINARY_ACK,this.encodeAsBinary(o)):[this.encodeAsString(o)]}encodeAsString(o){let u=""+o.type;return(o.type===Yt.BINARY_EVENT||o.type===Yt.BINARY_ACK)&&(u+=o.attachments+"-"),o.nsp&&o.nsp!=="/"&&(u+=o.nsp+","),o.id!=null&&(u+=o.id),o.data!=null&&(u+=JSON.stringify(o.data,this.replacer)),u}encodeAsBinary(o){const u=pA(o),m=this.encodeAsString(u.packet),w=u.buffers;return w.unshift(m),w}}class y0 extends $r{constructor(o){super(),this.reviver=o}add(o){let u;if(typeof o=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");u=this.decodeString(o),u.type===Yt.BINARY_EVENT||u.type===Yt.BINARY_ACK?(this.reconstructor=new gA(u),u.attachments===0&&super.emitReserved("decoded",u)):super.emitReserved("decoded",u)}else if(g0(o)||o.base64)if(this.reconstructor)u=this.reconstructor.takeBinaryData(o),u&&(this.reconstructor=null,super.emitReserved("decoded",u));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+o)}decodeString(o){let u=0;const m={type:Number(o.charAt(0))};if(Yt[m.type]===void 0)throw new Error("unknown packet type "+m.type);if(m.type===Yt.BINARY_EVENT||m.type===Yt.BINARY_ACK){const S=u+1;for(;o.charAt(++u)!=="-"&&u!=o.length;);const P=o.substring(S,u);if(P!=Number(P)||o.charAt(u)!=="-")throw new Error("Illegal attachments");m.attachments=Number(P)}if(o.charAt(u+1)==="/"){const S=u+1;for(;++u&&!(o.charAt(u)===","||u===o.length););m.nsp=o.substring(S,u)}else m.nsp="/";const w=o.charAt(u+1);if(w!==""&&Number(w)==w){const S=u+1;for(;++u;){const P=o.charAt(u);if(P==null||Number(P)!=P){--u;break}if(u===o.length)break}m.id=Number(o.substring(S,u+1))}if(o.charAt(++u)){const S=this.tryParse(o.substr(u));if(y0.isPayloadValid(m.type,S))m.data=S;else throw new Error("invalid payload")}return m}tryParse(o){try{return JSON.parse(o,this.reviver)}catch{return!1}}static isPayloadValid(o,u){switch(o){case Yt.CONNECT:return typeof u=="object";case Yt.DISCONNECT:return u===void 0;case Yt.CONNECT_ERROR:return typeof u=="string"||typeof u=="object";case Yt.EVENT:case Yt.BINARY_EVENT:return Array.isArray(u)&&u.length>0;case Yt.ACK:case Yt.BINARY_ACK:return Array.isArray(u)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class gA{constructor(o){this.packet=o,this.buffers=[],this.reconPack=o}takeBinaryData(o){if(this.buffers.push(o),this.buffers.length===this.reconPack.attachments){const u=fA(this.reconPack,this.buffers);return this.finishedReconstruction(),u}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const yA=Object.freeze(Object.defineProperty({__proto__:null,protocol:mA,get PacketType(){return Yt},Encoder:_A,Decoder:y0},Symbol.toStringTag,{value:"Module"}));function Qn(n,o,u){return n.on(o,u),function(){n.off(o,u)}}const xA=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class R2 extends $r{constructor(o,u,m){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=o,this.nsp=u,m&&m.auth&&(this.auth=m.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const o=this.io;this.subs=[Qn(o,"open",this.onopen.bind(this)),Qn(o,"packet",this.onpacket.bind(this)),Qn(o,"error",this.onerror.bind(this)),Qn(o,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...o){return o.unshift("message"),this.emit.apply(this,o),this}emit(o,...u){if(xA.hasOwnProperty(o))throw new Error('"'+o+'" is a reserved event name');u.unshift(o);const m={type:Yt.EVENT,data:u};if(m.options={},m.options.compress=this.flags.compress!==!1,typeof u[u.length-1]=="function"){const P=this.ids++,a=u.pop();this._registerAckCallback(P,a),m.id=P}const w=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!w||!this.connected)||(this.connected?(this.notifyOutgoingListeners(m),this.packet(m)):this.sendBuffer.push(m)),this.flags={},this}_registerAckCallback(o,u){const m=this.flags.timeout;if(m===void 0){this.acks[o]=u;return}const w=this.io.setTimeoutFn(()=>{delete this.acks[o];for(let S=0;S<this.sendBuffer.length;S++)this.sendBuffer[S].id===o&&this.sendBuffer.splice(S,1);u.call(this,new Error("operation has timed out"))},m);this.acks[o]=(...S)=>{this.io.clearTimeoutFn(w),u.apply(this,[null,...S])}}packet(o){o.nsp=this.nsp,this.io._packet(o)}onopen(){typeof this.auth=="function"?this.auth(o=>{this.packet({type:Yt.CONNECT,data:o})}):this.packet({type:Yt.CONNECT,data:this.auth})}onerror(o){this.connected||this.emitReserved("connect_error",o)}onclose(o,u){this.connected=!1,delete this.id,this.emitReserved("disconnect",o,u)}onpacket(o){if(o.nsp===this.nsp)switch(o.type){case Yt.CONNECT:if(o.data&&o.data.sid){const w=o.data.sid;this.onconnect(w)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Yt.EVENT:case Yt.BINARY_EVENT:this.onevent(o);break;case Yt.ACK:case Yt.BINARY_ACK:this.onack(o);break;case Yt.DISCONNECT:this.ondisconnect();break;case Yt.CONNECT_ERROR:this.destroy();const m=new Error(o.data.message);m.data=o.data.data,this.emitReserved("connect_error",m);break}}onevent(o){const u=o.data||[];o.id!=null&&u.push(this.ack(o.id)),this.connected?this.emitEvent(u):this.receiveBuffer.push(Object.freeze(u))}emitEvent(o){if(this._anyListeners&&this._anyListeners.length){const u=this._anyListeners.slice();for(const m of u)m.apply(this,o)}super.emit.apply(this,o)}ack(o){const u=this;let m=!1;return function(...w){m||(m=!0,u.packet({type:Yt.ACK,id:o,data:w}))}}onack(o){const u=this.acks[o.id];typeof u=="function"&&(u.apply(this,o.data),delete this.acks[o.id])}onconnect(o){this.id=o,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(o=>this.emitEvent(o)),this.receiveBuffer=[],this.sendBuffer.forEach(o=>{this.notifyOutgoingListeners(o),this.packet(o)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(o=>o()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Yt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(o){return this.flags.compress=o,this}get volatile(){return this.flags.volatile=!0,this}timeout(o){return this.flags.timeout=o,this}onAny(o){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(o),this}prependAny(o){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(o),this}offAny(o){if(!this._anyListeners)return this;if(o){const u=this._anyListeners;for(let m=0;m<u.length;m++)if(o===u[m])return u.splice(m,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(o){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(o),this}prependAnyOutgoing(o){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(o),this}offAnyOutgoing(o){if(!this._anyOutgoingListeners)return this;if(o){const u=this._anyOutgoingListeners;for(let m=0;m<u.length;m++)if(o===u[m])return u.splice(m,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(o){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const u=this._anyOutgoingListeners.slice();for(const m of u)m.apply(this,o.data)}}}function ru(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}ru.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var o=Math.random(),u=Math.floor(o*this.jitter*n);n=(Math.floor(o*10)&1)==0?n-u:n+u}return Math.min(n,this.max)|0};ru.prototype.reset=function(){this.attempts=0};ru.prototype.setMin=function(n){this.ms=n};ru.prototype.setMax=function(n){this.max=n};ru.prototype.setJitter=function(n){this.jitter=n};class my extends $r{constructor(o,u){var m;super(),this.nsps={},this.subs=[],o&&typeof o=="object"&&(u=o,o=void 0),u=u||{},u.path=u.path||"/socket.io",this.opts=u,mm(this,u),this.reconnection(u.reconnection!==!1),this.reconnectionAttempts(u.reconnectionAttempts||1/0),this.reconnectionDelay(u.reconnectionDelay||1e3),this.reconnectionDelayMax(u.reconnectionDelayMax||5e3),this.randomizationFactor((m=u.randomizationFactor)!==null&&m!==void 0?m:.5),this.backoff=new ru({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(u.timeout==null?2e4:u.timeout),this._readyState="closed",this.uri=o;const w=u.parser||yA;this.encoder=new w.Encoder,this.decoder=new w.Decoder,this._autoConnect=u.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(o){return arguments.length?(this._reconnection=!!o,this):this._reconnection}reconnectionAttempts(o){return o===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=o,this)}reconnectionDelay(o){var u;return o===void 0?this._reconnectionDelay:(this._reconnectionDelay=o,(u=this.backoff)===null||u===void 0||u.setMin(o),this)}randomizationFactor(o){var u;return o===void 0?this._randomizationFactor:(this._randomizationFactor=o,(u=this.backoff)===null||u===void 0||u.setJitter(o),this)}reconnectionDelayMax(o){var u;return o===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=o,(u=this.backoff)===null||u===void 0||u.setMax(o),this)}timeout(o){return arguments.length?(this._timeout=o,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(o){if(~this._readyState.indexOf("open"))return this;this.engine=new Hs(this.uri,this.opts);const u=this.engine,m=this;this._readyState="opening",this.skipReconnect=!1;const w=Qn(u,"open",function(){m.onopen(),o&&o()}),S=Qn(u,"error",P=>{m.cleanup(),m._readyState="closed",this.emitReserved("error",P),o?o(P):m.maybeReconnectOnOpen()});if(this._timeout!==!1){const P=this._timeout;P===0&&w();const a=this.setTimeoutFn(()=>{w(),u.close(),u.emit("error",new Error("timeout"))},P);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(w),this.subs.push(S),this}connect(o){return this.open(o)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const o=this.engine;this.subs.push(Qn(o,"ping",this.onping.bind(this)),Qn(o,"data",this.ondata.bind(this)),Qn(o,"error",this.onerror.bind(this)),Qn(o,"close",this.onclose.bind(this)),Qn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(o){this.decoder.add(o)}ondecoded(o){this.emitReserved("packet",o)}onerror(o){this.emitReserved("error",o)}socket(o,u){let m=this.nsps[o];return m||(m=new R2(this,o,u),this.nsps[o]=m),m}_destroy(o){const u=Object.keys(this.nsps);for(const m of u)if(this.nsps[m].active)return;this._close()}_packet(o){const u=this.encoder.encode(o);for(let m=0;m<u.length;m++)this.engine.write(u[m],o.options)}cleanup(){this.subs.forEach(o=>o()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(o,u){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",o,u),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const o=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const u=this.backoff.duration();this._reconnecting=!0;const m=this.setTimeoutFn(()=>{o.skipReconnect||(this.emitReserved("reconnect_attempt",o.backoff.attempts),!o.skipReconnect&&o.open(w=>{w?(o._reconnecting=!1,o.reconnect(),this.emitReserved("reconnect_error",w)):o.onreconnect()}))},u);this.opts.autoUnref&&m.unref(),this.subs.push(function(){clearTimeout(m)})}}onreconnect(){const o=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",o)}}const Ch={};function Cf(n,o){typeof n=="object"&&(o=n,n=void 0),o=o||{};const u=lA(n,o.path||"/socket.io"),m=u.source,w=u.id,S=u.path,P=Ch[w]&&S in Ch[w].nsps,a=o.forceNew||o["force new connection"]||o.multiplex===!1||P;let U;return a?U=new my(m,o):(Ch[w]||(Ch[w]=new my(m,o)),U=Ch[w]),u.query&&!o.query&&(o.query=u.queryKey),U.socket(u.path,o)}Object.assign(Cf,{Manager:my,Socket:R2,io:Cf,connect:Cf});const vA=n=>{const o=gr.exports.useMemo(()=>Cf.connect(n,{transports:["websocket"]}),[n]),[u,m]=gr.exports.useState(!1);return gr.exports.useEffect(()=>()=>{o.disconnect()},[]),gr.exports.useEffect(()=>{m(o.connected)},[o]),gr.exports.useEffect(()=>{o.on("connect",()=>{m(!0)})},[o]),gr.exports.useEffect(()=>{o.on("disconnect",()=>{m(!1)})},[o]),{socket:o,online:u}},B2=gr.exports.createContext();var _m={exports:{}},gm={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wA=gr.exports,bA=Symbol.for("react.element"),TA=Symbol.for("react.fragment"),EA=Object.prototype.hasOwnProperty,SA=wA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,CA={key:!0,ref:!0,__self:!0,__source:!0};function O2(n,o,u){var m,w={},S=null,P=null;u!==void 0&&(S=""+u),o.key!==void 0&&(S=""+o.key),o.ref!==void 0&&(P=o.ref);for(m in o)EA.call(o,m)&&!CA.hasOwnProperty(m)&&(w[m]=o[m]);if(n&&n.defaultProps)for(m in o=n.defaultProps,o)w[m]===void 0&&(w[m]=o[m]);return{$$typeof:bA,type:n,key:S,ref:P,props:w,_owner:SA.current}}gm.Fragment=TA;gm.jsx=O2;gm.jsxs=O2;(function(n){n.exports=gm})(_m);const IA=_m.exports.Fragment,nd=_m.exports.jsx,sw=_m.exports.jsxs,{VITE_API_URL:AA}=w2(),MA=({children:n})=>{const{socket:o,online:u}=vA(AA),m=S=>{o.emit("marcador-nuevo",S)},w=S=>{o.emit("marcador-actualizado",S)};return nd(B2.Provider,{value:{socket:o,online:u,newMarker:m,updateMarker:w},children:n})};var F2={exports:{}};(function(n,o){(function(u,m){n.exports=m()})(fS,function(){var u,m,w;function S(a,U){if(!u)u=U;else if(!m)m=U;else{var de="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",Me={};u(Me),w=U(Me),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([de],{type:"text/javascript"})))}}S(["exports"],function(a){var U=typeof self<"u"?self:{},de=Me;function Me(r,e,i,s){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=i,this.p2y=s}Me.prototype.sampleCurveX=function(r){return((this.ax*r+this.bx)*r+this.cx)*r},Me.prototype.sampleCurveY=function(r){return((this.ay*r+this.by)*r+this.cy)*r},Me.prototype.sampleCurveDerivativeX=function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},Me.prototype.solveCurveX=function(r,e){var i,s,c,d,f;for(e===void 0&&(e=1e-6),c=r,f=0;f<8;f++){if(d=this.sampleCurveX(c)-r,Math.abs(d)<e)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=d/g}if((c=r)<(i=0))return i;if(c>(s=1))return s;for(;i<s;){if(d=this.sampleCurveX(c),Math.abs(d-r)<e)return c;r>d?i=c:s=c,c=.5*(s-i)+i}return c},Me.prototype.solve=function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))};var ne=me;function me(r,e){this.x=r,this.y=e}me.prototype={clone:function(){return new me(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),i=Math.sin(r),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(r,e){var i=Math.cos(r),s=Math.sin(r),c=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},me.convert=function(r){return r instanceof me?r:Array.isArray(r)?new me(r[0],r[1]):r};const Ge=Math.PI/180,Ye=180/Math.PI;function ze(r){return r*Ge}function kt(r){return r*Ye}const ge=[[0,0],[1,0],[1,1],[0,1]];function he(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function we(r,e,i,s){const c=new de(r,e,i,s);return function(d){return c.solve(d)}}const je=we(.25,.1,.25,1);function Fe(r,e,i){return Math.min(i,Math.max(e,r))}function st(r,e,i){return(i=Fe((i-r)/(e-r),0,1))*i*(3-2*i)}function lt(r,e,i){const s=i-e,c=((r-e)%s+s)%s+e;return c===e?i:c}function ft(r,e,i){if(!r.length)return i(null,[]);let s=r.length;const c=new Array(r.length);let d=null;r.forEach((f,g)=>{e(f,(x,v)=>{x&&(d=x),c[g]=v,--s==0&&i(d,c)})})}function nr(r){const e=[];for(const i in r)e.push(r[i]);return e}function xt(r,...e){for(const i of e)for(const s in i)r[s]=i[s];return r}let ai=1;function Oi(){return ai++}function Fi(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Co(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function as(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Ui(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function yn(r,e){return r.indexOf(e,r.length-e.length)!==-1}function it(r,e,i){const s={};for(const c in r)s[c]=e.call(i||this,r[c],c,r);return s}function wt(r,e,i){const s={};for(const c in r)e.call(i||this,r[c],c,r)&&(s[c]=r[c]);return s}function vt(r){return Array.isArray(r)?r.map(vt):typeof r=="object"&&r?it(r,vt):r}const sr={};function zt(r){sr[r]||(typeof console<"u"&&console.warn(r),sr[r]=!0)}function Mr(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function Zr(r){let e=0;for(let i,s,c=0,d=r.length,f=d-1;c<d;f=c++)i=r[c],s=r[f],e+=(s.x-i.x)*(i.y+s.y);return e}function qr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Wr(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,c,d)=>{const f=c||d;return e[s]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let fi=null;function ls(r){if(fi==null){const e=r.navigator?r.navigator.userAgent:null;fi=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return fi}function da(r){try{const e=U[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Rn(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}const yl=U.performance;function Io(r){const e=r?r.url.toString():void 0;return yl.getEntriesByName(e)}var Ao="2.9.2";let Ft,Bn,Mo,xn;const Ni={now:()=>Mo!==void 0?Mo:U.performance.now(),setNow(r){Mo=r},restoreNow(){Mo=void 0},frame(r){const e=U.requestAnimationFrame(r);return{cancel:()=>U.cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:s}=r;xn||(xn=U.document.createElement("canvas"));const c=xn.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return(i>xn.width||s>xn.height)&&(xn.width=i,xn.height=s),c.clearRect(-e,-e,i+2*e,s+2*e),c.drawImage(r,0,0,i,s),c.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:r=>(Ft||(Ft=U.document.createElement("a")),Ft.href=r,Ft.href),get devicePixelRatio(){return U.devicePixelRatio},get prefersReducedMotion(){return!!U.matchMedia&&(Bn==null&&(Bn=U.matchMedia("(prefers-reduced-motion: reduce)")),Bn.matches)}};let cs;const Bt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(cs==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{cs=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):r}catch{cs=r}}return cs},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},no={supported:!1,testSupport:function(r){!ko&&Fn&&(us?pa(r):On=r)}};let On,Fn,ko=!1,us=!1;function pa(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Fn),r.isContextLost())return;no.supported=!0}catch{}r.deleteTexture(e),ko=!0}U.document&&(Fn=U.document.createElement("img"),Fn.onload=function(){On&&pa(On),On=null,us=!0},Fn.onerror=function(){ko=!0,On=null},Fn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const fa="01",Ii="NO_ACCESS_TOKEN";function vn(r){return r.indexOf("mapbox:")===0}function zo(r){return Bt.API_URL_REGEX.test(r)}const xl=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ai(r){const e=r.match(xl);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Un(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}function vl(r){if(!r)return null;const e=r.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(U.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ma{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=vl(Bt.ACCESS_TOKEN);let s="";return s=i&&i.u?U.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(Number("0x"+d)))):Bt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=da("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=U.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const d=U.localStorage.getItem(s);d&&(this.anonId=d)}catch{zt("Unable to read from LocalStorage")}}saveEventData(){const e=da("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{U.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&U.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{zt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,c){if(!Bt.EVENTS_URL)return;const d=Ai(Bt.EVENTS_URL);d.params.push(`access_token=${c||Bt.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Ao,skuId:fa,userId:this.anonId},g=i?xt(f,i):f,x={url:Un(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=ye(x,v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(c)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const _a=new class extends ma{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){Bt.EVENTS_URL&&Bt.ACCESS_TOKEN&&Array.isArray(r)&&r.some(i=>vn(i)||zo(i))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=vl(Bt.ACCESS_TOKEN),i=e?e.u:Bt.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;as(this.anonId)||(this.anonId=Fi(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),f=new Date(c),g=(c-this.eventData.lastSuccess)/864e5;s=s||g>=1||g<-1||d.getDate()!==f.getDate()}else s=!0;s?this.postEvent(c,{"enabled.telemetry":!1},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},r):this.processRequests()}},ga=_a.postTurnstileEvent.bind(_a),ya=new class extends ma{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,i,s){this.skuToken=e,this.errorCb=s,Bt.EVENTS_URL&&(i||Bt.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(Ii)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),as(this.anonId)||(this.anonId=Fi()),this.postEvent(i,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},r))}},wl=ya.postMapLoadEvent.bind(ya),bl=new class extends ma{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,i,s){if(!Bt.API_URL||!Bt.SESSION_PATH)return;const c=Ai(Bt.API_URL+Bt.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||Bt.ACCESS_TOKEN||""}`);const d={url:Un(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Le(d,f=>{this.pendingRequest=null,i(f),this.saveEventData(),this.processRequests(s)})}getSessionAPI(r,e,i,s){this.skuToken=e,this.errorCb=s,Bt.SESSION_PATH&&Bt.API_URL&&(i||Bt.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(Ii)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},r)}},iu=bl.getSessionAPI.bind(bl),oo=new Set;let Nn,hs=500,Tl=50,mi={};function xa(r){const e=L(r);let i,s;e&&e.forEach(d=>{const f=d.split("=");f[0]==="language"?i=f[1]:f[0]==="worldview"&&(s=f[1])});let c="mapbox-tiles";return i&&(c+=`-${i}`),s&&(c+=`-${s}`),c}function X(r){U.caches&&!mi[r]&&(mi[r]=U.caches.open(r))}function L(r){const e=r.indexOf("?");return e>0?r.slice(e+1).split("&"):[]}function B(r){const e=r.indexOf("?");if(e<0)return r;const i=L(r).filter(s=>{const c=s.split("=");return c[0]==="language"||c[0]==="worldview"});return i.length?`${r.slice(0,e)}?${i.join("&")}`:r.slice(0,e)}let W=1/0;const Q={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Q);class ae extends Error{constructor(e,i,s){i===401&&zo(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _e=qr()?()=>self.worker&&self.worker.referrer:()=>(U.location.protocol==="blob:"?U.parent:U).location.href,pe=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(_e())&&!/^\w+:/.test(i))){if(U.fetch&&U.Request&&U.AbortController&&U.Request.prototype.hasOwnProperty("signal"))return function(s,c){const d=new U.AbortController,f=new U.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:_e(),signal:d.signal});let g=!1,x=!1;const v=(E=f.url).indexOf("sku=")>0&&zo(E);var E;s.type==="json"&&f.headers.set("Accept","application/json");const I=(k,D,O)=>{if(x)return;if(k&&k.message!=="SecurityError"&&zt(k),D&&O)return A(D);const $=Date.now();U.fetch(f).then(H=>{if(H.ok){const ie=v?H.clone():null;return A(H,ie,$)}return c(new ae(H.statusText,H.status,s.url))}).catch(H=>{H.code!==20&&c(new Error(H.message))})},A=(k,D,O)=>{(s.type==="arrayBuffer"?k.arrayBuffer():s.type==="json"?k.json():k.text()).then($=>{x||(D&&O&&function(H,ie,re){const oe=xa(H.url);if(X(oe),!mi[oe])return;const le={status:ie.status,statusText:ie.statusText,headers:new U.Headers};ie.headers.forEach((Ce,ke)=>le.headers.set(ke,Ce));const ue=Wr(ie.headers.get("Cache-Control")||"");if(ue["no-store"])return;ue["max-age"]&&le.headers.set("Expires",new Date(re+1e3*ue["max-age"]).toUTCString());const Ee=le.headers.get("Expires");Ee&&(new Date(Ee).getTime()-re<42e4||function(Ce,ke){if(Nn===void 0)try{new Response(new ReadableStream),Nn=!0}catch{Nn=!1}Nn?ke(Ce.body):Ce.blob().then(ke)}(ie,Ce=>{const ke=new U.Response(Ce,le);X(oe),mi[oe]&&mi[oe].then(Oe=>Oe.put(B(H.url),ke)).catch(Oe=>zt(Oe.message))}))}(f,D,O),g=!0,c(null,$,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch($=>{x||c(new Error($.message))})};return v?function(k,D){const O=xa(k.url);if(X(O),!mi[O])return D(null);const $=B(k.url);mi[O].then(H=>{H.match($).then(ie=>{const re=function(oe){if(!oe)return!1;const le=new Date(oe.headers.get("Expires")||0),ue=Wr(oe.headers.get("Cache-Control")||"");return le>Date.now()&&!ue["no-cache"]}(ie);H.delete($),re&&H.put($,ie.clone()),D(null,ie,re)}).catch(D)}).catch(D)}(f,I):I(null,null),{cancel:()=>{x=!0,g||d.abort()}}}(r,e);if(qr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(s,c){const d=new U.XMLHttpRequest;d.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in s.headers)d.setRequestHeader(f,s.headers[f]);return s.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=s.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(s.type==="json")try{f=JSON.parse(d.response)}catch(g){return c(g)}c(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new ae(d.statusText,d.status,s.url))},d.send(s.body),{cancel:()=>d.abort()}}(r,e)},ce=function(r,e){return pe(xt(r,{type:"arrayBuffer"}),e)},ye=function(r,e){return pe(xt(r,{method:"POST"}),e)},Le=function(r,e){return pe(xt(r,{method:"GET"}),e)};function Qe(r){const e=U.document.createElement("a");return e.href=r,e.protocol===U.document.location.protocol&&e.host===U.document.location.host}const Be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let dt,mt;dt=[],mt=0;const pt=function(r,e){if(no.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),mt>=Bt.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return dt.push(d),d}mt++;let i=!1;const s=()=>{if(!i)for(i=!0,mt--;dt.length&&mt<Bt.MAX_PARALLEL_IMAGE_REQUESTS;){const d=dt.shift(),{requestParameters:f,callback:g,cancelled:x}=d;x||(d.cancel=pt(f,g).cancel)}},c=ce(r,(d,f,g,x)=>{s(),d?e(d):f&&(U.createImageBitmap?function(v,E){const I=new U.Blob([new Uint8Array(v)],{type:"image/png"});U.createImageBitmap(I).then(A=>{E(null,A)}).catch(A=>{E(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(v,E)=>e(v,E,g,x)):function(v,E){const I=new U.Image,A=U.URL;I.onload=()=>{E(null,I),A.revokeObjectURL(I.src),I.onload=null,U.requestAnimationFrame(()=>{I.src=Be})},I.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new U.Blob([new Uint8Array(v)],{type:"image/png"});I.src=v.byteLength?A.createObjectURL(k):Be}(f,(v,E)=>e(v,E,g,x)))});return{cancel:()=>{c.cancel(),s()}}};function gt(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function It(r,e,i){if(i&&i[r]){const s=i[r].indexOf(e);s!==-1&&i[r].splice(s,1)}}class jt{constructor(e,i={}){xt(this,i),this.type=e}}class or extends jt{constructor(e,i={}){super("error",xt({error:e},i))}}class Xt{on(e,i){return this._listeners=this._listeners||{},gt(e,i,this._listeners),this}off(e,i){return It(e,i,this._listeners),It(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},gt(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){typeof e=="string"&&(e=new jt(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const g of c)g.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const g of d)It(s,g,this._oneTimeListeners),g.call(this,e);const f=this._eventedParent;f&&(xt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof or&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var fe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Mi(r,...e){for(const i of e)for(const s in i)r[s]=i[s];return r}function dr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Vi(r){if(Array.isArray(r))return r.map(Vi);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Vi(r[i]);return e}return dr(r)}class vm extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var ki=vm;class El{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,c]of i)this.bindings[s]=c}concat(e){return new El(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var ud=El;const va={kind:"null"},Ke={kind:"number"},Lt={kind:"string"},At={kind:"boolean"},sn={kind:"color"},Po={kind:"object"},Et={kind:"value"},Vn={kind:"collator"},ds={kind:"formatted"},wa={kind:"resolvedImage"};function ji(r,e){return{kind:"array",itemType:r,N:e}}function pr(r){if(r.kind==="array"){const e=pr(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const hd=[va,Ke,Lt,At,sn,ds,Po,ji(Et),wa];function ps(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ps(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of hd)if(!ps(i,e))return null}}return`Expected ${pr(r)} but found ${pr(e)} instead.`}function Sl(r,e){return e.some(i=>i.kind===r.kind)}function fs(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function ms(r){var e={exports:{}};return r(e,e.exports),e.exports}var dd=ms(function(r,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(g){return(g=Math.round(g))<0?0:g>255?255:g}function c(g){return s(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function d(g){return(x=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:x>1?1:x;var x}function f(g,x,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?g+(x-g)*v*6:2*v<1?x:3*v<2?g+(x-g)*(2/3-v)*6:g}try{e.parseCSSColor=function(g){var x,v=g.replace(/ /g,"").toLowerCase();if(v in i)return i[v].slice();if(v[0]==="#")return v.length===4?(x=parseInt(v.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:v.length===7&&(x=parseInt(v.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var E=v.indexOf("("),I=v.indexOf(")");if(E!==-1&&I+1===v.length){var A=v.substr(0,E),k=v.substr(E+1,I-(E+1)).split(","),D=1;switch(A){case"rgba":if(k.length!==4)return null;D=d(k.pop());case"rgb":return k.length!==3?null:[c(k[0]),c(k[1]),c(k[2]),D];case"hsla":if(k.length!==4)return null;D=d(k.pop());case"hsl":if(k.length!==3)return null;var O=(parseFloat(k[0])%360+360)%360/360,$=d(k[1]),H=d(k[2]),ie=H<=.5?H*($+1):H+$-H*$,re=2*H-ie;return[s(255*f(re,ie,O+1/3)),s(255*f(re,ie,O)),s(255*f(re,ie,O-1/3)),D];default:return null}}return null}}catch{}});class Br{constructor(e,i,s,c=1){this.r=e,this.g=i,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof Br)return e;if(typeof e!="string")return;const i=dd.parseCSSColor(e);return i?new Br(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${c})`}toArray(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*s/c,c]}toArray01(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,s/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:c}=this;return[e,i,s,c]}}Br.black=new Br(0,0,0,1),Br.white=new Br(1,1,1,1),Br.transparent=new Br(0,0,0,0),Br.red=new Br(1,0,0,1),Br.blue=new Br(0,0,1,1);var xr=Br;class Gi{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class nu{constructor(e,i,s,c,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=c,this.textColor=d}}class ti{constructor(e){this.sections=e}static fromString(e){return new ti([new nu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ti?e:ti.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class $i{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new $i({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Cl(r,e,i,s){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[r,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[r,e,i,s]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ba(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof xr||r instanceof Gi||r instanceof ti||r instanceof $i)return!0;if(Array.isArray(r)){for(const e of r)if(!ba(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!ba(r[e]))return!1;return!0}return!1}function _r(r){if(r===null)return va;if(typeof r=="string")return Lt;if(typeof r=="boolean")return At;if(typeof r=="number")return Ke;if(r instanceof xr)return sn;if(r instanceof Gi)return Vn;if(r instanceof ti)return ds;if(r instanceof $i)return wa;if(Array.isArray(r)){const e=r.length;let i;for(const s of r){const c=_r(s);if(i){if(i===c)continue;i=Et;break}i=c}return ji(i||Et,e)}return Po}function Do(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof xr||r instanceof ti||r instanceof $i?r.toString():JSON.stringify(r)}class ou{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ba(e[1]))return i.error("invalid value");const s=e[1];let c=_r(s);const d=i.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new ou(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof xr?["rgba"].concat(this.value.toArray()):this.value instanceof ti?this.value.serialize():this.value}}var Ta=ou,Xr=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const Il={string:Lt,number:Ke,boolean:At,object:Po};class Ea{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,c=1;const d=e[0];if(d==="array"){let g,x;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in Il)||v==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=Il[v],c++}else g=Et;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}s=ji(g,x)}else s=Il[d];const f=[];for(;c<e.length;c++){const g=i.parse(e[c],c,Et);if(!g)return null;f.push(g)}return new Ea(s,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!ps(this.type,_r(s)))return s;if(i===this.args.length-1)throw new Xr(`Expected value to be of type ${pr(this.type)}, but found ${pr(_r(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(s=>s.serialize()))}}var jn=Ea;class so{constructor(e){this.type=ds,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const c=[];let d=!1;for(let f=1;f<=e.length-1;++f){const g=e[f];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let x=null;if(g["font-scale"]&&(x=i.parse(g["font-scale"],1,Ke),!x))return null;let v=null;if(g["text-font"]&&(v=i.parse(g["text-font"],1,ji(Lt)),!v))return null;let E=null;if(g["text-color"]&&(E=i.parse(g["text-color"],1,sn),!E))return null;const I=c[c.length-1];I.scale=x,I.font=v,I.textColor=E}else{const x=i.parse(e[f],1,Et);if(!x)return null;const v=x.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new so(c)}evaluate(e){return new ti(this.sections.map(i=>{const s=i.content.evaluate(e);return _r(s)===wa?new nu("",s,null,null,null):new nu(Do(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class Al{constructor(e){this.type=wa,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Lt);return s?new Al(s):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),s=$i.fromString(i);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(i)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const wm={"to-boolean":At,"to-color":sn,"to-number":Ke,"to-string":Lt};class su{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=wm[s],d=[];for(let f=1;f<e.length;f++){const g=i.parse(e[f],f,Et);if(!g)return null;d.push(g)}return new su(c,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,s;for(const c of this.args){if(i=c.evaluate(e),s=null,i instanceof xr)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Cl(i[0],i[1],i[2],i[3]),!s))return new xr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Xr(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Xr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ti.fromString(Do(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?$i.fromString(Do(this.args[0].evaluate(e))):Do(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new so([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Al(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var _s=su;const bm=["Unknown","Point","LineString","Polygon"];var pd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-r[0])+this.featureDistanceData.bearing[1]*(s*e-r[1])}return 0}parseColor(r){let e=this._parseColorCache[r];return e||(e=this._parseColorCache[r]=xr.parse(r)),e}};class gs{constructor(e,i,s,c){this.name=e,this.type=i,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],c=gs.definitions[s];if(!c)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=f.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let x=null;for(const[v,E]of g){x=new gd(i.registry,i.path,null,i.scope);const I=[];let A=!1;for(let k=1;k<e.length;k++){const D=e[k],O=Array.isArray(v)?v[k-1]:v.type,$=x.parse(D,1+I.length,O);if(!$){A=!0;break}I.push($)}if(!A)if(Array.isArray(v)&&v.length!==I.length)x.error(`Expected ${v.length} arguments, but found ${I.length} instead.`);else{for(let k=0;k<I.length;k++){const D=Array.isArray(v)?v[k]:v.type,O=I[k];x.concat(k+1).checkSubtype(D,O.type)}if(x.errors.length===0)return new gs(s,d,E,I)}}if(g.length===1)i.errors.push(...x.errors);else{const v=(g.length?g:f).map(([I])=>{return A=I,Array.isArray(A)?`(${A.map(pr).join(", ")})`:`(${pr(A.type)}...)`;var A}).join(" | "),E=[];for(let I=1;I<e.length;I++){const A=i.parse(e[I],1+E.length);if(!A)return null;E.push(pr(A.type))}i.error(`Expected arguments of type ${v}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){gs.definitions=i;for(const s in i)e[s]=gs}}var Gn=gs;class Lo{constructor(e,i,s){this.type=Vn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const c=i.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,At);if(!c)return null;const d=i.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,At);if(!d)return null;let f=null;return s.locale&&(f=i.parse(s.locale,1,Lt),!f)?null:new Lo(c,d,f)}evaluate(e){return new Gi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ao=8192;function au(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Ml(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Tm(r,e){const i=(180+r[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*ao),Math.round(s*c*ao)]}function Em(r,e,i){const s=r[0]-e[0],c=r[1]-e[1],d=r[0]-i[0],f=r[1]-i[1];return s*f-d*c==0&&s*d<=0&&c*f<=0}function lu(r,e){let i=!1;for(let f=0,g=e.length;f<g;f++){const x=e[f];for(let v=0,E=x.length;v<E-1;v++){if(Em(r,x[v],x[v+1]))return!1;(c=x[v])[1]>(s=r)[1]!=(d=x[v+1])[1]>s[1]&&s[0]<(d[0]-c[0])*(s[1]-c[1])/(d[1]-c[1])+c[0]&&(i=!i)}}var s,c,d;return i}function fd(r,e){for(let i=0;i<e.length;i++)if(lu(r,e[i]))return!0;return!1}function Sa(r,e,i,s){const c=s[0]-i[0],d=s[1]-i[1],f=(r[0]-i[0])*d-c*(r[1]-i[1]),g=(e[0]-i[0])*d-c*(e[1]-i[1]);return f>0&&g<0||f<0&&g>0}function Sm(r,e,i){for(const v of i)for(let E=0;E<v.length-1;++E)if((g=[(f=v[E+1])[0]-(d=v[E])[0],f[1]-d[1]])[0]*(x=[(c=e)[0]-(s=r)[0],c[1]-s[1]])[1]-g[1]*x[0]!=0&&Sa(s,c,d,f)&&Sa(d,f,s,c))return!0;var s,c,d,f,g,x;return!1}function md(r,e){for(let i=0;i<r.length;++i)if(!lu(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(Sm(r[i],r[i+1],e))return!1;return!0}function Cm(r,e){for(let i=0;i<e.length;i++)if(md(r,e[i]))return!0;return!1}function cu(r,e,i){const s=[];for(let c=0;c<r.length;c++){const d=[];for(let f=0;f<r[c].length;f++){const g=Tm(r[c][f],i);au(e,g),d.push(g)}s.push(d)}return s}function an(r,e,i){const s=[];for(let c=0;c<r.length;c++){const d=cu(r[c],e,i);s.push(d)}return s}function uu(r,e,i,s){if(r[0]<i[0]||r[0]>i[2]){const c=.5*s;let d=r[0]-i[0]>c?-s:i[0]-r[0]>c?s:0;d===0&&(d=r[0]-i[2]>c?-s:i[2]-r[0]>c?s:0),r[0]+=d}au(e,r)}function hu(r,e,i,s){const c=Math.pow(2,s.z)*ao,d=[s.x*ao,s.y*ao],f=[];if(!r)return f;for(const g of r)for(const x of g){const v=[x.x+d[0],x.y+d[1]];uu(v,e,i,c),f.push(v)}return f}function Ca(r,e,i,s){const c=Math.pow(2,s.z)*ao,d=[s.x*ao,s.y*ao],f=[];if(!r)return f;for(const x of r){const v=[];for(const E of x){const I=[E.x+d[0],E.y+d[1]];au(e,I),v.push(I)}f.push(v)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const x of f)for(const v of x)uu(v,e,i,c)}var g;return f}class $n{constructor(e,i){this.type=At,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ba(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const d=s.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new $n(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new $n(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new $n(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(s.type==="Polygon"){const g=cu(s.coordinates,d,f),x=hu(i.geometry(),c,d,f);if(!Ml(c,d))return!1;for(const v of x)if(!lu(v,g))return!1}if(s.type==="MultiPolygon"){const g=an(s.coordinates,d,f),x=hu(i.geometry(),c,d,f);if(!Ml(c,d))return!1;for(const v of x)if(!fd(v,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(s.type==="Polygon"){const g=cu(s.coordinates,d,f),x=Ca(i.geometry(),c,d,f);if(!Ml(c,d))return!1;for(const v of x)if(!md(v,g))return!1}if(s.type==="MultiPolygon"){const g=an(s.coordinates,d,f),x=Ca(i.geometry(),c,d,f);if(!Ml(c,d))return!1;for(const v of x)if(!Cm(v,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var kl=$n;function ys(r){if(r instanceof Gn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof kl)return!1;let e=!0;return r.eachChild(i=>{e&&!ys(i)&&(e=!1)}),e}function xs(r){if(r instanceof Gn&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!xs(i)&&(e=!1)}),e}function zl(r,e){if(r instanceof Gn&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(s=>{i&&!zl(s,e)&&(i=!1)}),i}class Gt{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new Gt(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var _d=Gt;class du{constructor(e,i=[],s,c=new ud,d=[]){this.registry=e,this.path=i,this.key=i.map(f=>`[${f}]`).join(""),this.scope=c,this.errors=d,this.expectedType=s}parse(e,i,s,c,d={}){return i?this.concat(i,s,c)._parse(e,d):this._parse(e,d)}_parse(e,i){function s(c,d,f){return f==="assert"?new jn(d,[c]):f==="coerce"?new _s(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let f=d.parse(e,this);if(!f)return null;if(this.expectedType){const g=this.expectedType,x=f.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||x.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(g,x))return null}else f=s(f,g,i.typeAnnotation||"coerce");else f=s(f,g,i.typeAnnotation||"assert")}if(!(f instanceof Ta)&&f.type.kind!=="resolvedImage"&&Pl(f)){const g=new pd;try{f=new Ta(f.type,f.evaluate(g))}catch(x){return this.error(x.message),null}}return f}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const c=typeof e=="number"?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new du(this.registry,c,i||null,d,this.errors)}error(e,...i){const s=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new ki(s,e))}checkSubtype(e,i){const s=ps(e,i);return s&&this.error(s),s}}var gd=du;function Pl(r){if(r instanceof _d)return Pl(r.boundExpression);if(r instanceof Gn&&r.name==="error"||r instanceof Lo||r instanceof kl)return!1;const e=r instanceof _s||r instanceof jn;let i=!0;return r.eachChild(s=>{i=e?i&&Pl(s):i&&s instanceof Ta}),!!i&&ys(r)&&zl(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Dl(r,e){const i=r.length-1;let s,c,d=0,f=i,g=0;for(;d<=f;)if(g=Math.floor((d+f)/2),s=r[g],c=r[g+1],s<=e){if(g===i||e<c)return g;d=g+1}else{if(!(s>e))throw new Xr("Input is not a number.");f=g-1}return 0}class Ll{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,d]of s)this.labels.push(c),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Ke);if(!s)return null;const c=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<e.length;f+=2){const g=f===1?-1/0:e[f],x=e[f+1],v=f,E=f+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(c.length&&c[c.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const I=i.parse(x,E,d);if(!I)return null;d=d||I.type,c.push([g,I])}return new Ll(d,s,c)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return s[0].evaluate(e);const d=i.length;return c>=i[d-1]?s[d-1].evaluate(e):s[Dl(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Rl=Ll;function Ut(r,e,i){return r*(1-i)+e*i}var Ia=Object.freeze({__proto__:null,number:Ut,color:function(r,e,i){return new xr(Ut(r.r,e.r,i),Ut(r.g,e.g,i),Ut(r.b,e.b,i),Ut(r.a,e.a,i))},array:function(r,e,i){return r.map((s,c)=>Ut(s,e[c],i))}});const Ro=.95047,Aa=1.08883,yd=4/29,Ma=6/29,pu=3*Ma*Ma,Im=Math.PI/180,Am=180/Math.PI;function Bl(r){return r>.008856451679035631?Math.pow(r,1/3):r/pu+yd}function fu(r){return r>Ma?r*r*r:pu*(r-yd)}function Ol(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Fl(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function mu(r){const e=Fl(r.r),i=Fl(r.g),s=Fl(r.b),c=Bl((.4124564*e+.3575761*i+.1804375*s)/Ro),d=Bl((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-Bl((.0193339*e+.119192*i+.9503041*s)/Aa)),alpha:r.a}}function xd(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,s=isNaN(r.b)?e:e-r.b/200;return e=1*fu(e),i=Ro*fu(i),s=Aa*fu(s),new xr(Ol(3.2404542*i-1.5371385*e-.4985314*s),Ol(-.969266*i+1.8760108*e+.041556*s),Ol(.0556434*i-.2040259*e+1.0572252*s),r.alpha)}function vd(r,e,i){const s=e-r;return r+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const ka={forward:mu,reverse:xd,interpolate:function(r,e,i){return{l:Ut(r.l,e.l,i),a:Ut(r.a,e.a,i),b:Ut(r.b,e.b,i),alpha:Ut(r.alpha,e.alpha,i)}}},vs={forward:function(r){const{l:e,a:i,b:s}=mu(r),c=Math.atan2(s,i)*Am;return{h:c<0?c+360:c,c:Math.sqrt(i*i+s*s),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Im,i=r.c;return xd({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:vd(r.h,e.h,i),c:Ut(r.c,e.c,i),l:Ut(r.l,e.l,i),alpha:Ut(r.alpha,e.alpha,i)}}};var _u=Object.freeze({__proto__:null,lab:ka,hcl:vs});class Ul{constructor(e,i,s,c,d){this.type=e,this.operator=i,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[f,g]of d)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(e,i,s,c){let d=0;if(e.name==="exponential")d=gu(i,e.base,s,c);else if(e.name==="linear")d=gu(i,1,s,c);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new de(f[0],f[1],f[2],f[3]).solve(gu(i,1,s,c))}return d}static parse(e,i){let[s,c,d,...f]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const v=c[1];if(typeof v!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:v}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const v=c.slice(1);if(v.length!==4||v.some(E=>typeof E!="number"||E<0||E>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,Ke),!d)return null;const g=[];let x=null;s==="interpolate-hcl"||s==="interpolate-lab"?x=sn:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let v=0;v<f.length;v+=2){const E=f[v],I=f[v+1],A=v+3,k=v+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(g.length&&g[g.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const D=i.parse(I,k,x);if(!D)return null;x=x||D.type,g.push([E,D])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new Ul(x,s,c,d,g):i.error(`Type ${pr(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return s[0].evaluate(e);const d=i.length;if(c>=i[d-1])return s[d-1].evaluate(e);const f=Dl(i,c),g=Ul.interpolationFactor(this.interpolation,c,i[f],i[f+1]),x=s[f].evaluate(e),v=s[f+1].evaluate(e);return this.operator==="interpolate"?Ia[this.type.kind.toLowerCase()](x,v,g):this.operator==="interpolate-hcl"?vs.reverse(vs.interpolate(vs.forward(x),vs.forward(v),g)):ka.reverse(ka.interpolate(ka.forward(x),ka.forward(v),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function gu(r,e,i,s){const c=s-i,d=r-i;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}var wn=Ul;class yu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const c=i.expectedType;c&&c.kind!=="value"&&(s=c);const d=[];for(const g of e.slice(1)){const x=i.parse(g,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,d.push(x)}const f=c&&d.some(g=>ps(c,g.type));return new yu(f?Et:s,d)}evaluate(e){let i,s=null,c=0;for(const d of this.args){if(c++,s=d.evaluate(e),s&&s instanceof $i&&!s.available&&(i||(i=s),s=null,c===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var wd=yu;class xu{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=i.parse(e[d+1],d+1);if(!g)return null;s.push([f,g])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return c?new xu(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}var vu=xu;class wu{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ke),c=i.parse(e[2],2,ji(i.expectedType||Et));return s&&c?new wu(c.type.itemType,s,c):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Xr(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new Xr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new Xr(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Mm=wu;class bu{constructor(e,i){this.type=At,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Et),c=i.parse(e[2],2,Et);return s&&c?Sl(s.type,[At,Lt,Ke,va,Et])?new bu(s,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pr(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!fs(i,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${pr(_r(i))} instead.`);if(!fs(s,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${pr(_r(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var km=bu;class za{constructor(e,i,s){this.type=Ke,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Et),c=i.parse(e[2],2,Et);if(!s||!c)return null;if(!Sl(s.type,[At,Lt,Ke,va,Et]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pr(s.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Ke);return d?new za(s,c,d):null}return new za(s,c)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!fs(i,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${pr(_r(i))} instead.`);if(!fs(s,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${pr(_r(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(i,c)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var bd=za;class Nl{constructor(e,i,s,c,d,f){this.inputType=e,this.type=i,this.input=s,this.cases=c,this.outputs=d,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const d={},f=[];for(let v=2;v<e.length-1;v+=2){let E=e[v];const I=e[v+1];Array.isArray(E)||(E=[E]);const A=i.concat(v);if(E.length===0)return A.error("Expected at least one branch label.");for(const D of E){if(typeof D!="number"&&typeof D!="string")return A.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return A.error("Numeric branch labels must be integer values.");if(s){if(A.checkSubtype(s,_r(D)))return null}else s=_r(D);if(d[String(D)]!==void 0)return A.error("Branch labels must be unique.");d[String(D)]=f.length}const k=i.parse(I,v,c);if(!k)return null;c=c||k.type,f.push(k)}const g=i.parse(e[1],1,Et);if(!g)return null;const x=i.parse(e[e.length-1],e.length-1,c);return x?g.type.kind!=="value"&&i.concat(1).checkSubtype(s,g.type)?null:new Nl(s,c,g,d,f,x):null}evaluate(e){const i=this.input.evaluate(e);return(_r(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],c={};for(const f of i){const g=c[this.cases[f]];g===void 0?(c[this.cases[f]]=s.length,s.push([this.cases[f],[f]])):s[g][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,g]of s)e.push(g.length===1?d(g[0]):g.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var zm=Nl;class Tu{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const g=i.parse(e[f],f,At);if(!g)return null;const x=i.parse(e[f+1],f+1,s);if(!x)return null;c.push([g,x]),s=s||x.type}const d=i.parse(e[e.length-1],e.length-1,s);return d?new Tu(s,c,d):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Td=Tu;class Pa{constructor(e,i,s,c){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Et),c=i.parse(e[2],2,Ke);if(!s||!c)return null;if(!Sl(s.type,[ji(Et),Lt,Et]))return i.error(`Expected first argument to be of type array or string, but found ${pr(s.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Ke);return d?new Pa(s.type,s,c,d):null}return new Pa(s.type,s,c)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!fs(i,["string","array"]))throw new Xr(`Expected first argument to be of type array or string, but found ${pr(_r(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(s,c)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ed=Pa;function Sd(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Cd(r,e,i,s){return s.compare(e,i)===0}function ws(r,e,i){const s=r!=="=="&&r!=="!=";return class U2{constructor(d,f,g){this.type=At,this.lhs=d,this.rhs=f,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const g=d[0];let x=f.parse(d[1],1,Et);if(!x)return null;if(!Sd(g,x.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${pr(x.type)}'.`);let v=f.parse(d[2],2,Et);if(!v)return null;if(!Sd(g,v.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${pr(v.type)}'.`);if(x.type.kind!==v.type.kind&&x.type.kind!=="value"&&v.type.kind!=="value")return f.error(`Cannot compare types '${pr(x.type)}' and '${pr(v.type)}'.`);s&&(x.type.kind==="value"&&v.type.kind!=="value"?x=new jn(v.type,[x]):x.type.kind!=="value"&&v.type.kind==="value"&&(v=new jn(x.type,[v])));let E=null;if(d.length===4){if(x.type.kind!=="string"&&v.type.kind!=="string"&&x.type.kind!=="value"&&v.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(E=f.parse(d[3],3,Vn),!E)return null}return new U2(x,v,E)}evaluate(d){const f=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const x=_r(f),v=_r(g);if(x.kind!==v.kind||x.kind!=="string"&&x.kind!=="number")throw new Xr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${v.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=_r(f),v=_r(g);if(x.kind!=="string"||v.kind!=="string")return e(d,f,g)}return this.collator?i(d,f,g,this.collator.evaluate(d)):e(d,f,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[r];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const Pm=ws("==",function(r,e,i){return e===i},Cd),Vl=ws("!=",function(r,e,i){return e!==i},function(r,e,i,s){return!Cd(0,e,i,s)}),Id=ws("<",function(r,e,i){return e<i},function(r,e,i,s){return s.compare(e,i)<0}),Ad=ws(">",function(r,e,i){return e>i},function(r,e,i,s){return s.compare(e,i)>0}),Dm=ws("<=",function(r,e,i){return e<=i},function(r,e,i,s){return s.compare(e,i)<=0}),Lm=ws(">=",function(r,e,i){return e>=i},function(r,e,i,s){return s.compare(e,i)>=0});class Eu{constructor(e,i,s,c,d){this.type=Lt,this.number=e,this.locale=i,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Ke);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=i.parse(c.locale,1,Lt),!d))return null;let f=null;if(c.currency&&(f=i.parse(c.currency,1,Lt),!f))return null;let g=null;if(c["min-fraction-digits"]&&(g=i.parse(c["min-fraction-digits"],1,Ke),!g))return null;let x=null;return c["max-fraction-digits"]&&(x=i.parse(c["max-fraction-digits"],1,Ke),!x)?null:new Eu(s,d,f,g,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class jl{constructor(e){this.type=Ke,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${pr(s.type)} instead.`):new jl(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Xr(`Expected value to be of type string or array, but found ${pr(_r(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Su={"==":Pm,"!=":Vl,">":Ad,"<":Id,">=":Lm,"<=":Dm,array:jn,at:Mm,boolean:jn,case:Td,coalesce:wd,collator:Lo,format:so,image:Al,in:km,"index-of":bd,interpolate:wn,"interpolate-hcl":wn,"interpolate-lab":wn,length:jl,let:vu,literal:Ta,match:zm,number:jn,"number-format":Eu,object:jn,slice:Ed,step:Rl,string:jn,"to-boolean":_s,"to-color":_s,"to-number":_s,"to-string":_s,var:_d,within:kl};function Cu(r,[e,i,s,c]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const d=c?c.evaluate(r):1,f=Cl(e,i,s,d);if(f)throw new Xr(f);return new xr(e/255*d,i/255*d,s/255*d,d)}function Gl(r,e){return r in e}function Iu(r,e){const i=e[r];return i===void 0?null:i}function Bo(r){return{type:r}}Gn.register(Su,{error:[{kind:"error"},[Lt],(r,[e])=>{throw new Xr(e.evaluate(r))}],typeof:[Lt,[Et],(r,[e])=>pr(_r(e.evaluate(r)))],"to-rgba":[ji(Ke,4),[sn],(r,[e])=>e.evaluate(r).toArray()],rgb:[sn,[Ke,Ke,Ke],Cu],rgba:[sn,[Ke,Ke,Ke,Ke],Cu],has:{type:At,overloads:[[[Lt],(r,[e])=>Gl(e.evaluate(r),r.properties())],[[Lt,Po],(r,[e,i])=>Gl(e.evaluate(r),i.evaluate(r))]]},get:{type:Et,overloads:[[[Lt],(r,[e])=>Iu(e.evaluate(r),r.properties())],[[Lt,Po],(r,[e,i])=>Iu(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Et,[Lt],(r,[e])=>Iu(e.evaluate(r),r.featureState||{})],properties:[Po,[],r=>r.properties()],"geometry-type":[Lt,[],r=>r.geometryType()],id:[Et,[],r=>r.id()],zoom:[Ke,[],r=>r.globals.zoom],pitch:[Ke,[],r=>r.globals.pitch||0],"distance-from-center":[Ke,[],r=>r.distanceFromCenter()],"heatmap-density":[Ke,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ke,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[Ke,[],r=>r.globals.skyRadialProgress||0],accumulated:[Et,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ke,Bo(Ke),(r,e)=>{let i=0;for(const s of e)i+=s.evaluate(r);return i}],"*":[Ke,Bo(Ke),(r,e)=>{let i=1;for(const s of e)i*=s.evaluate(r);return i}],"-":{type:Ke,overloads:[[[Ke,Ke],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Ke],(r,[e])=>-e.evaluate(r)]]},"/":[Ke,[Ke,Ke],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Ke,[Ke,Ke],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Ke,[Ke],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Ke,[Ke],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Ke,[Ke],(r,[e])=>Math.log(e.evaluate(r))],log2:[Ke,[Ke],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Ke,[Ke],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Ke,[Ke],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Ke,[Ke],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Ke,[Ke],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Ke,[Ke],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Ke,[Ke],(r,[e])=>Math.atan(e.evaluate(r))],min:[Ke,Bo(Ke),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Ke,Bo(Ke),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Ke,[Ke],(r,[e])=>Math.abs(e.evaluate(r))],round:[Ke,[Ke],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ke,[Ke],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Ke,[Ke],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[At,[Lt,Et],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[At,[Et],(r,[e])=>r.id()===e.value],"filter-type-==":[At,[Lt],(r,[e])=>r.geometryType()===e.value],"filter-<":[At,[Lt,Et],(r,[e,i])=>{const s=r.properties()[e.value],c=i.value;return typeof s==typeof c&&s<c}],"filter-id-<":[At,[Et],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[At,[Lt,Et],(r,[e,i])=>{const s=r.properties()[e.value],c=i.value;return typeof s==typeof c&&s>c}],"filter-id->":[At,[Et],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[At,[Lt,Et],(r,[e,i])=>{const s=r.properties()[e.value],c=i.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[At,[Et],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[At,[Lt,Et],(r,[e,i])=>{const s=r.properties()[e.value],c=i.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[At,[Et],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[At,[Et],(r,[e])=>e.value in r.properties()],"filter-has-id":[At,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[At,[ji(Lt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[At,[ji(Et)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[At,[Lt,ji(Et)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[At,[Lt,ji(Et)],(r,[e,i])=>function(s,c,d,f){for(;d<=f;){const g=d+f>>1;if(c[g]===s)return!0;c[g]>s?f=g-1:d=g+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:At,overloads:[[[At,At],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Bo(At),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:At,overloads:[[[At,At],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Bo(At),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[At,[At],(r,[e])=>!e.evaluate(r)],"is-supported-script":[At,[Lt],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Lt,[Lt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Lt,[Lt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Lt,Bo(Et),(r,e)=>e.map(i=>Do(i.evaluate(r))).join("")],"resolved-locale":[Lt,[Vn],(r,[e])=>e.evaluate(r).resolvedLocale()]});var Da=Su;function Md(r){return{result:"success",value:r}}function bs(r){return{result:"error",value:r}}function Ts(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Au(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function $l(r){return!!r.expression&&r.expression.interpolated}function Nt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Zl(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Rm(r){return r}function kd(r,e){const i=e.type==="color",s=r.stops&&typeof r.stops[0][0]=="object",c=s||!(s||r.property!==void 0),d=r.type||($l(e)?"exponential":"interval");if(i&&((r=Mi({},r)).stops&&(r.stops=r.stops.map(v=>[v[0],xr.parse(v[1])])),r.default=xr.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!_u[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let f,g,x;if(d==="exponential")f=Pd;else if(d==="interval")f=Es;else if(d==="categorical"){f=zd,g=Object.create(null);for(const v of r.stops)g[v[0]]=v[1];x=typeof r.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=Bm}if(s){const v={},E=[];for(let k=0;k<r.stops.length;k++){const D=r.stops[k],O=D[0].zoom;v[O]===void 0&&(v[O]={zoom:O,type:r.type,property:r.property,default:r.default,stops:[]},E.push(O)),v[O].stops.push([D[0].value,D[1]])}const I=[];for(const k of E)I.push([v[k].zoom,kd(v[k],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:wn.interpolationFactor.bind(void 0,A),zoomStops:I.map(k=>k[0]),evaluate:({zoom:k},D)=>Pd({stops:I,base:r.base},e,k).evaluate(k,D)}}if(c){const v=d==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:wn.interpolationFactor.bind(void 0,v),zoomStops:r.stops.map(E=>E[0]),evaluate:({zoom:E})=>f(r,e,E,g,x)}}return{kind:"source",evaluate(v,E){const I=E&&E.properties?E.properties[r.property]:void 0;return I===void 0?Zi(r.default,e.default):f(r,e,I,g,x)}}}function Zi(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function zd(r,e,i,s,c){return Zi(typeof i===c?s[i]:void 0,r.default,e.default)}function Es(r,e,i){if(Nt(i)!=="number")return Zi(r.default,e.default);const s=r.stops.length;if(s===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[s-1][0])return r.stops[s-1][1];const c=Dl(r.stops.map(d=>d[0]),i);return r.stops[c][1]}function Pd(r,e,i){const s=r.base!==void 0?r.base:1;if(Nt(i)!=="number")return Zi(r.default,e.default);const c=r.stops.length;if(c===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[c-1][0])return r.stops[c-1][1];const d=Dl(r.stops.map(E=>E[0]),i),f=function(E,I,A,k){const D=k-A,O=E-A;return D===0?0:I===1?O/D:(Math.pow(I,O)-1)/(Math.pow(I,D)-1)}(i,s,r.stops[d][0],r.stops[d+1][0]),g=r.stops[d][1],x=r.stops[d+1][1];let v=Ia[e.type]||Rm;if(r.colorSpace&&r.colorSpace!=="rgb"){const E=_u[r.colorSpace];v=(I,A)=>E.reverse(E.interpolate(E.forward(I),E.forward(A),f))}return typeof g.evaluate=="function"?{evaluate(...E){const I=g.evaluate.apply(void 0,E),A=x.evaluate.apply(void 0,E);if(I!==void 0&&A!==void 0)return v(I,A,f)}}:v(g,x,f)}function Bm(r,e,i){return e.type==="color"?i=xr.parse(i):e.type==="formatted"?i=ti.fromString(i.toString()):e.type==="resolvedImage"?i=$i.fromString(i.toString()):Nt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Zi(i,r.default,e.default)}class ql{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new pd,this._defaultValue=i?function(s){return s.type==="color"&&(Zl(s.default)||Array.isArray(s.default))?new xr(0,0,0,0):s.type==="color"?xr.parse(s.default)||null:s.default===void 0?null:s.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,s,c,d,f,g,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,c,d,f,g,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Xr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Wl(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Da}function Oo(r,e){const i=new gd(Da,[],e?function(c){const d={color:sn,string:Lt,number:Ke,enum:Lt,boolean:At,formatted:ds,resolvedImage:wa};return c.type==="array"?ji(d[c.value]||Et,c.length):d[c.type]}(e):void 0),s=i.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Md(new ql(s,e)):bs(i.errors)}class Xl{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!xs(i.expression)}evaluateWithoutErrorHandling(e,i,s,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,c,d,f)}evaluate(e,i,s,c,d,f){return this._styleExpression.evaluate(e,i,s,c,d,f)}}class La{constructor(e,i,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!xs(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,s,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,c,d,f)}evaluate(e,i,s,c,d,f){return this._styleExpression.evaluate(e,i,s,c,d,f)}interpolationFactor(e,i,s){return this.interpolationType?wn.interpolationFactor(this.interpolationType,e,i,s):0}}function Hl(r,e){if((r=Oo(r,e)).result==="error")return r;const i=r.value.expression,s=ys(i);if(!s&&!Ts(e))return bs([new ki("","data expressions not supported")]);const c=zl(i,["zoom","pitch","distance-from-center"]);if(!c&&!Au(e))return bs([new ki("","zoom expressions not supported")]);const d=Ss(i);return d||c?d instanceof ki?bs([d]):d instanceof wn&&!$l(e)?bs([new ki("",'"interpolate" expressions cannot be used with this property')]):Md(d?new La(s?"camera":"composite",r.value,d.labels,d instanceof wn?d.interpolation:void 0):new Xl(s?"constant":"source",r.value)):bs([new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ra{constructor(e,i){this._parameters=e,this._specification=i,Mi(this,kd(this._parameters,this._specification))}static deserialize(e){return new Ra(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ss(r){let e=null;if(r instanceof vu)e=Ss(r.result);else if(r instanceof wd){for(const i of r.args)if(e=Ss(i),e)break}else(r instanceof Rl||r instanceof wn)&&r.input instanceof Gn&&r.input.name==="zoom"&&(e=r);return e instanceof ki||r.eachChild(i=>{const s=Ss(i);s instanceof ki?e=s:!e&&s?e=new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class et{constructor(e,i,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function qi(r){const e=r.key,i=r.value,s=r.valueSpec||{},c=r.objectElementValidators||{},d=r.style,f=r.styleSpec;let g=[];const x=Nt(i);if(x!=="object")return[new et(e,i,`object expected, ${x} found`)];for(const v in i){const E=v.split(".")[0],I=s[E]||s["*"];let A;c[E]?A=c[E]:s[E]?A=Nr:c["*"]?A=c["*"]:s["*"]&&(A=Nr),A?g=g.concat(A({key:(e&&`${e}.`)+v,value:i[v],valueSpec:I,style:d,styleSpec:f,object:i,objectKey:v},i)):g.push(new et(e,i[v],`unknown property "${v}"`))}for(const v in s)c[v]||s[v].required&&s[v].default===void 0&&i[v]===void 0&&g.push(new et(e,i,`missing required property "${v}"`));return g}function Ba(r){const e=r.value,i=r.valueSpec,s=r.style,c=r.styleSpec,d=r.key,f=r.arrayElementValidator||Nr;if(Nt(e)!=="array")return[new et(d,e,`array expected, ${Nt(e)} found`)];if(i.length&&e.length!==i.length)return[new et(d,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new et(d,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let g={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(g.function=i.function),Nt(i.value)==="object"&&(g=i.value);let x=[];for(let v=0;v<e.length;v++)x=x.concat(f({array:e,arrayIndex:v,value:e[v],valueSpec:g,style:s,styleSpec:c,key:`${d}[${v}]`}));return x}function Fo(r){const e=r.key,i=r.value,s=r.valueSpec;let c=Nt(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new et(e,i,`number expected, ${c} found`)];if("minimum"in s){let d=s.minimum;if(Nt(s.minimum)==="array"&&(d=s.minimum[r.arrayIndex]),i<d)return[new et(e,i,`${i} is less than the minimum value ${d}`)]}if("maximum"in s){let d=s.maximum;if(Nt(s.maximum)==="array"&&(d=s.maximum[r.arrayIndex]),i>d)return[new et(e,i,`${i} is greater than the maximum value ${d}`)]}return[]}function Mu(r){const e=r.valueSpec,i=dr(r.value.type);let s,c,d,f={};const g=i!=="categorical"&&r.value.property===void 0,x=!g,v=Nt(r.value.stops)==="array"&&Nt(r.value.stops[0])==="array"&&Nt(r.value.stops[0][0])==="object",E=qi({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(k){if(i==="identity")return[new et(k.key,k.value,'identity function may not have a "stops" property')];let D=[];const O=k.value;return D=D.concat(Ba({key:k.key,value:O,valueSpec:k.valueSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:I})),Nt(O)==="array"&&O.length===0&&D.push(new et(k.key,O,"array must have at least one stop")),D},default:function(k){return Nr({key:k.key,value:k.value,valueSpec:e,style:k.style,styleSpec:k.styleSpec})}}});return i==="identity"&&g&&E.push(new et(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||E.push(new et(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!$l(r.valueSpec)&&E.push(new et(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!Ts(r.valueSpec)?E.push(new et(r.key,r.value,"property functions not supported")):g&&!Au(r.valueSpec)&&E.push(new et(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!v||r.value.property!==void 0||E.push(new et(r.key,r.value,'"property" property is required')),E;function I(k){let D=[];const O=k.value,$=k.key;if(Nt(O)!=="array")return[new et($,O,`array expected, ${Nt(O)} found`)];if(O.length!==2)return[new et($,O,`array length 2 expected, length ${O.length} found`)];if(v){if(Nt(O[0])!=="object")return[new et($,O,`object expected, ${Nt(O[0])} found`)];if(O[0].zoom===void 0)return[new et($,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new et($,O,"object stop key must have value")];const H=dr(O[0].zoom);if(typeof H!="number")return[new et($,O[0].zoom,"stop zoom values must be numbers")];if(d&&d>H)return[new et($,O[0].zoom,"stop zoom values must appear in ascending order")];H!==d&&(d=H,c=void 0,f={}),D=D.concat(qi({key:`${$}[0]`,value:O[0],valueSpec:{zoom:{}},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:Fo,value:A}}))}else D=D.concat(A({key:`${$}[0]`,value:O[0],valueSpec:{},style:k.style,styleSpec:k.styleSpec},O));return Wl(Vi(O[1]))?D.concat([new et(`${$}[1]`,O[1],"expressions are not allowed in function stops.")]):D.concat(Nr({key:`${$}[1]`,value:O[1],valueSpec:e,style:k.style,styleSpec:k.styleSpec}))}function A(k,D){const O=Nt(k.value),$=dr(k.value),H=k.value!==null?k.value:D;if(s){if(O!==s)return[new et(k.key,H,`${O} stop domain type must match previous stop domain type ${s}`)]}else s=O;if(O!=="number"&&O!=="string"&&O!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new et(k.key,H,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&i!=="categorical"){let ie=`number expected, ${O} found`;return Ts(e)&&i===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new et(k.key,H,ie)]}return i!=="categorical"||O!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?i!=="categorical"&&O==="number"&&typeof $=="number"&&typeof c=="number"&&c!==void 0&&$<c?[new et(k.key,H,"stop domain values must appear in ascending order")]:(c=$,i==="categorical"&&$ in f?[new et(k.key,H,"stop domain values must be unique")]:(f[$]=!0,[])):[new et(k.key,H,`integer expected, found ${String($)}`)]}}function Uo(r){const e=(r.expressionContext==="property"?Hl:Oo)(Vi(r.value),r.valueSpec);if(e.result==="error")return e.value.map(s=>new et(`${r.key}${s.key}`,r.value,s.message));const i=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new et(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!xs(i))return[new et(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter")return Yl(i,r);if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!zl(i,["zoom","feature-state"]))return[new et(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!ys(i))return[new et(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yl(r,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];const s=[];return r instanceof Gn&&i.has(r.name)?[new et(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(c=>{s.push(...Yl(c,e))}),s)}function Oa(r){const e=r.key,i=r.value,s=r.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(dr(i))===-1&&c.push(new et(e,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(s.values).indexOf(dr(i))===-1&&c.push(new et(e,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function ku(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ku(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function No(r,e="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ku(r)||(r=Vo(r));const i=r;let s=!0;try{s=function(v){if(!Cs(v))return v;let E=Vi(v);return Ld(E),E=Dd(E),E}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const c=fe[`filter_${e}`],d=Oo(s,c);let f=null;if(d.result==="error")throw new Error(d.value.map(v=>`${v.key}: ${v.message}`).join(", "));f=(v,E,I)=>d.value.evaluate(v,E,{},I);let g=null,x=null;if(s!==i){const v=Oo(i,c);if(v.result==="error")throw new Error(v.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,I,A,k,D)=>v.value.evaluate(E,I,{},A,void 0,void 0,k,D),x=!ys(v.value.expression)}return f=f,{filter:f,dynamicFilter:g||void 0,needGeometry:Fa(s),needFeature:!!x}}function Dd(r){if(!Array.isArray(r))return r;const e=function(i){if(Om.has(i[0])){for(let s=1;s<i.length;s++)if(Cs(i[s]))return!0}return i}(r);return e===!0?e:e.map(i=>Dd(i))}function Ld(r){let e=!1;const i=[];if(r[0]==="case"){for(let s=1;s<r.length-1;s+=2)e=e||Cs(r[s]),i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Cs(r[1]);for(let s=2;s<r.length-1;s+=2)i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Cs(r[1]);for(let s=1;s<r.length-1;s+=2)i.push(r[s+1])}e&&(r.length=0,r.push("any",...i));for(let s=1;s<r.length;s++)Ld(r[s])}function Cs(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Cs(r[i]))return!0;return!1}const Om=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Fm(r,e){return r<e?-1:r>e?1:0}function Fa(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Fa(r[e]))return!0;return!1}function Vo(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?li(r[1],r[2],"=="):e==="!="?Kl(li(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?li(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Vo))):e==="all"?["all"].concat(r.slice(1).map(Vo)):e==="none"?["all"].concat(r.slice(1).map(Vo).map(Kl)):e==="in"?Ua(r[1],r.slice(2)):e==="!in"?Kl(Ua(r[1],r.slice(2))):e==="has"?Rd(r[1]):e==="!has"?Kl(Rd(r[1])):e!=="within"||r;var i}function li(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Ua(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Fm)]]:["filter-in-small",r,["literal",e]]}}function Rd(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Kl(r){return["!",r]}function zu(r){return ku(Vi(r.value))?Uo(Mi({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):Bd(r)}function Bd(r){const e=r.value,i=r.key;if(Nt(e)!=="array")return[new et(i,e,`array expected, ${Nt(e)} found`)];const s=r.styleSpec;let c,d=[];if(e.length<1)return[new et(i,e,"filter array must have at least 1 element")];switch(d=d.concat(Oa({key:`${i}[0]`,value:e[0],valueSpec:s.filter_operator,style:r.style,styleSpec:r.styleSpec})),dr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&dr(e[1])==="$type"&&d.push(new et(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new et(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Nt(e[1]),c!=="string"&&d.push(new et(`${i}[1]`,e[1],`string expected, ${c} found`)));for(let f=2;f<e.length;f++)c=Nt(e[f]),dr(e[1])==="$type"?d=d.concat(Oa({key:`${i}[${f}]`,value:e[f],valueSpec:s.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new et(`${i}[${f}]`,e[f],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)d=d.concat(Bd({key:`${i}[${f}]`,value:e[f],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Nt(e[1]),e.length!==2?d.push(new et(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new et(`${i}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Nt(e[1]),e.length!==2?d.push(new et(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&d.push(new et(`${i}[1]`,e[1],`object expected, ${c} found`))}return d}function Jl(r,e){const i=r.key,s=r.style,c=r.styleSpec,d=r.value,f=r.objectKey,g=c[`${e}_${r.layerType}`];if(!g)return[];const x=f.match(/^(.*)-transition$/);if(e==="paint"&&x&&g[x[1]]&&g[x[1]].transition)return Nr({key:i,value:d,valueSpec:c.transition,style:s,styleSpec:c});const v=r.valueSpec||g[f];if(!v)return[new et(i,d,`unknown property "${f}"`)];let E;if(Nt(d)==="string"&&Ts(v)&&!v.tokens&&(E=/^{([^}]+)}$/.exec(d)))return[new et(i,d,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const I=[];return r.layerType==="symbol"&&(f==="text-field"&&s&&!s.glyphs&&I.push(new et(i,d,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&Zl(Vi(d))&&dr(d.type)==="identity"&&I.push(new et(i,d,'"text-font" does not support identity functions'))),I.concat(Nr({key:r.key,value:d,valueSpec:v,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:f}))}function Od(r){return Jl(r,"paint")}function Ql(r){return Jl(r,"layout")}function Fd(r){let e=[];const i=r.value,s=r.key,c=r.style,d=r.styleSpec;i.type||i.ref||e.push(new et(s,i,'either "type" or "ref" is required'));let f=dr(i.type);const g=dr(i.ref);if(i.id){const x=dr(i.id);for(let v=0;v<r.arrayIndex;v++){const E=c.layers[v];dr(E.id)===x&&e.push(new et(s,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach(v=>{v in i&&e.push(new et(s,i[v],`"${v}" is prohibited for ref layers`))}),c.layers.forEach(v=>{dr(v.id)===g&&(x=v)}),x?x.ref?e.push(new et(s,i.ref,"ref cannot reference another ref layer")):f=dr(x.type):typeof g=="string"&&e.push(new et(s,i.ref,`ref layer "${g}" not found`))}else if(f!=="background"&&f!=="sky")if(i.source){const x=c.sources&&c.sources[i.source],v=x&&dr(x.type);x?v==="vector"&&f==="raster"?e.push(new et(s,i.source,`layer "${i.id}" requires a raster source`)):v==="raster"&&f!=="raster"?e.push(new et(s,i.source,`layer "${i.id}" requires a vector source`)):v!=="vector"||i["source-layer"]?v==="raster-dem"&&f!=="hillshade"?e.push(new et(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||v==="geojson"&&x.lineMetrics||e.push(new et(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new et(s,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new et(s,i.source,`source "${i.source}" not found`))}else e.push(new et(s,i,'missing required property "source"'));return e=e.concat(qi({key:s,value:i,valueSpec:d.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Nr({key:`${s}.type`,value:i.type,valueSpec:d.layer.type,style:r.style,styleSpec:r.styleSpec,object:i,objectKey:"type"}),filter:x=>zu(Mi({layerType:f},x)),layout:x=>qi({layer:i,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":v=>Ql(Mi({layerType:f},v))}}),paint:x=>qi({layer:i,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":v=>Od(Mi({layerType:f},v))}})}})),e}function Is(r){const e=r.value,i=r.key,s=Nt(e);return s!=="string"?[new et(i,e,`string expected, ${s} found`)]:[]}const ec={promoteId:function({key:r,value:e}){if(Nt(e)==="string")return Is({key:r,value:e});{const i=[];for(const s in e)i.push(...Is({key:`${r}.${s}`,value:e[s]}));return i}}};function Ud(r){const e=r.value,i=r.key,s=r.styleSpec,c=r.style;if(!e.type)return[new et(i,e,'"type" is required')];const d=dr(e.type);let f;switch(d){case"vector":case"raster":case"raster-dem":return f=qi({key:i,value:e,valueSpec:s[`source_${d.replace("-","_")}`],style:r.style,styleSpec:s,objectElementValidators:ec}),f;case"geojson":if(f=qi({key:i,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:ec}),e.cluster)for(const g in e.clusterProperties){const[x,v]=e.clusterProperties[g],E=typeof x=="string"?[x,["accumulated"],["get",g]]:x;f.push(...Uo({key:`${i}.${g}.map`,value:v,expressionContext:"cluster-map"})),f.push(...Uo({key:`${i}.${g}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return f;case"video":return qi({key:i,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return qi({key:i,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new et(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oa({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:s})}}function Pu(r){const e=r.value,i=r.styleSpec,s=i.light,c=r.style;let d=[];const f=Nt(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new et("light",e,`object expected, ${f} found`)]),d;for(const g in e){const x=g.match(/^(.*)-transition$/);d=d.concat(x&&s[x[1]]&&s[x[1]].transition?Nr({key:g,value:e[g],valueSpec:i.transition,style:c,styleSpec:i}):s[g]?Nr({key:g,value:e[g],valueSpec:s[g],style:c,styleSpec:i}):[new et(g,e[g],`unknown property "${g}"`)])}return d}function Du(r){const e=r.value,i=r.key,s=r.style,c=r.styleSpec,d=c.terrain;let f=[];const g=Nt(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new et("terrain",e,`object expected, ${g} found`)]),f;for(const x in e){const v=x.match(/^(.*)-transition$/);f=f.concat(v&&d[v[1]]&&d[v[1]].transition?Nr({key:x,value:e[x],valueSpec:c.transition,style:s,styleSpec:c}):d[x]?Nr({key:x,value:e[x],valueSpec:d[x],style:s,styleSpec:c}):[new et(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=s.sources&&s.sources[e.source],v=x&&dr(x.type);x?v!=="raster-dem"&&f.push(new et(i,e.source,`terrain cannot be used with a source of type ${String(v)}, it only be used with a "raster-dem" source type`)):f.push(new et(i,e.source,`source "${e.source}" not found`))}else f.push(new et(i,e,'terrain is missing required property "source"'));return f}function Nd(r){const e=r.value,i=r.style,s=r.styleSpec,c=s.fog;let d=[];const f=Nt(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new et("fog",e,`object expected, ${f} found`)]),d;for(const g in e){const x=g.match(/^(.*)-transition$/);d=d.concat(x&&c[x[1]]&&c[x[1]].transition?Nr({key:g,value:e[g],valueSpec:s.transition,style:i,styleSpec:s}):c[g]?Nr({key:g,value:e[g],valueSpec:c[g],style:i,styleSpec:s}):[new et(g,e[g],`unknown property "${g}"`)])}return d}const tc={"*":()=>[],array:Ba,boolean:function(r){const e=r.value,i=r.key,s=Nt(e);return s!=="boolean"?[new et(i,e,`boolean expected, ${s} found`)]:[]},number:Fo,color:function(r){const e=r.key,i=r.value,s=Nt(i);return s!=="string"?[new et(e,i,`color expected, ${s} found`)]:dd.parseCSSColor(i)===null?[new et(e,i,`color expected, "${i}" found`)]:[]},enum:Oa,filter:zu,function:Mu,layer:Fd,object:qi,source:Ud,light:Pu,terrain:Du,fog:Nd,string:Is,formatted:function(r){return Is(r).length===0?[]:Uo(r)},resolvedImage:function(r){return Is(r).length===0?[]:Uo(r)},projection:function(r){const e=r.value,i=r.styleSpec,s=i.projection,c=r.style;let d=[];const f=Nt(e);if(f==="object")for(const g in e)d=d.concat(Nr({key:g,value:e[g],valueSpec:s[g],style:c,styleSpec:i}));else f!=="string"&&(d=d.concat([new et("projection",e,`object or string expected, ${f} found`)]));return d}};function Nr(r){const e=r.value,i=r.valueSpec,s=r.styleSpec;return i.expression&&Zl(dr(e))?Mu(r):i.expression&&Wl(Vi(e))?Uo(r):i.type&&tc[i.type]?tc[i.type](r):qi(Mi({},r,{valueSpec:i.type?s[i.type]:i}))}function Vd(r){const e=r.value,i=r.key,s=Is(r);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new et(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new et(i,e,'"glyphs" url must include a "{range}" token'))),s}function jd(r,e=fe){return ln(Nr({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:Vd,"*":()=>[]}}))}const Gd=r=>ln(Od(r)),Um=r=>ln(Ql(r));function ln(r){return r.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function $d(r,e){let i=!1;if(e&&e.length)for(const s of e)r.fire(new or(new Error(s.message))),i=!0;return i}var As=bn;function bn(r,e,i){var s=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var c=new Int32Array(this.arrayBuffer);r=c[0],this.d=(e=c[1])+2*(i=c[2]);for(var d=0;d<this.d*this.d;d++){var f=c[3+d],g=c[3+d+1];s.push(f===g?null:c.subarray(f,g))}var x=c[3+s.length+1];this.keys=c.subarray(c[3+s.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var v=0;v<this.d*this.d;v++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=i,this.scale=e/r,this.uid=0;var E=i/e*r;this.min=-E,this.max=r+E}bn.prototype.insert=function(r,e,i,s,c){this._forEachCell(e,i,s,c,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c)},bn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},bn.prototype._insertCell=function(r,e,i,s,c,d){this.cells[c].push(d)},bn.prototype.query=function(r,e,i,s,c){var d=this.min,f=this.max;if(r<=d&&e<=d&&f<=i&&f<=s&&!c)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(r,e,i,s,this._queryCell,g,{},c),g},bn.prototype._queryCell=function(r,e,i,s,c,d,f,g){var x=this.cells[c];if(x!==null)for(var v=this.keys,E=this.bboxes,I=0;I<x.length;I++){var A=x[I];if(f[A]===void 0){var k=4*A;(g?g(E[k+0],E[k+1],E[k+2],E[k+3]):r<=E[k+2]&&e<=E[k+3]&&i>=E[k+0]&&s>=E[k+1])?(f[A]=!0,d.push(v[A])):f[A]=!1}}},bn.prototype._forEachCell=function(r,e,i,s,c,d,f,g){for(var x=this._convertToCellCoord(r),v=this._convertToCellCoord(e),E=this._convertToCellCoord(i),I=this._convertToCellCoord(s),A=x;A<=E;A++)for(var k=v;k<=I;k++){var D=this.d*k+A;if((!g||g(this._convertFromCellCoord(A),this._convertFromCellCoord(k),this._convertFromCellCoord(A+1),this._convertFromCellCoord(k+1)))&&c.call(this,r,e,i,s,D,d,f,g))return}},bn.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},bn.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},bn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=3+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var c=new Int32Array(e+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,f=0;f<r.length;f++){var g=r[f];c[3+f]=d,c.set(g,d),d+=g.length}return c[3+r.length]=d,c.set(this.keys,d),c[3+r.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};const rc={};function tt(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),rc[e]={klass:r,omit:i.omit||[]}}tt(Object,"Object"),As.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.push(i),{buffer:i}},As.deserialize=function(r){return new As(r.buffer)},Object.defineProperty(As,"name",{value:"Grid"}),tt(As,"Grid"),tt(xr,"Color"),tt(Error,"Error"),tt(ae,"AJAXError"),tt($i,"ResolvedImage"),tt(Ra,"StylePropertyFunction"),tt(ql,"StyleExpression",{omit:["_evaluator"]}),tt(La,"ZoomDependentExpression"),tt(Xl,"ZoomConstantExpression"),tt(Gn,"CompoundExpression",{omit:["_evaluate"]});for(const r in Da)rc[Da[r]._classRegistryKey]||tt(Da[r],`Expression${r}`);function Zd(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function qd(r){return U.ImageBitmap&&r instanceof U.ImageBitmap}function Na(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Zd(r)||qd(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const i=r;return e&&e.push(i.buffer),i}if(r instanceof U.ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const s of r)i.push(Na(s,e));return i}if(typeof r=="object"){const i=r.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const c=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const d in r)r.hasOwnProperty(d)&&(rc[s].omit.indexOf(d)>=0||(c[d]=Na(r[d],e)));r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof r)}function Va(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Zd(r)||qd(r)||ArrayBuffer.isView(r)||r instanceof U.ImageData)return r;if(Array.isArray(r))return r.map(Va);if(typeof r=="object"){const e=r.$name||"Object",{klass:i}=rc[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(r);const s=Object.create(i.prototype);for(const c of Object.keys(r))c!=="$name"&&(s[c]=Va(r[c]));return s}throw new Error("can't deserialize object of type "+typeof r)}class Wd{constructor(){this.first=!0}update(e,i){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Xd=r=>r>=1536&&r<=1791,Hd=r=>r>=1872&&r<=1919,ja=r=>r>=2208&&r<=2303,Yd=r=>r>=11904&&r<=12031,Kd=r=>r>=12032&&r<=12255,Ga=r=>r>=12272&&r<=12287,ic=r=>r>=12288&&r<=12351,nc=r=>r>=12352&&r<=12447,oc=r=>r>=12448&&r<=12543,Lu=r=>r>=12544&&r<=12591,Ru=r=>r>=12704&&r<=12735,Bu=r=>r>=12736&&r<=12783,Ou=r=>r>=12784&&r<=12799,sc=r=>r>=12800&&r<=13055,ac=r=>r>=13056&&r<=13311,Jd=r=>r>=13312&&r<=19903,Fu=r=>r>=19968&&r<=40959,Qd=r=>r>=40960&&r<=42127,lc=r=>r>=42128&&r<=42191,ep=r=>r>=44032&&r<=55215,tp=r=>r>=63744&&r<=64255,Uu=r=>r>=64336&&r<=65023,rp=r=>r>=65040&&r<=65055,Nu=r=>r>=65072&&r<=65103,Vu=r=>r>=65104&&r<=65135,ju=r=>r>=65136&&r<=65279,Gu=r=>r>=65280&&r<=65519;function cc(r){for(const e of r)if(t(e.charCodeAt(0)))return!0;return!1}function uc(r){for(const e of r)if(!h(e.charCodeAt(0)))return!1;return!0}function h(r){return!(Xd(r)||Hd(r)||ja(r)||Uu(r)||ju(r))}function t(r){return!(r!==746&&r!==747&&(r<4352||!(Ru(r)||Lu(r)||Nu(r)&&!(r>=65097&&r<=65103)||tp(r)||ac(r)||Yd(r)||Bu(r)||!(!ic(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Jd(r)||Fu(r)||sc(r)||(e=>e>=12592&&e<=12687)(r)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||ep(r)||nc(r)||Ga(r)||(e=>e>=12688&&e<=12703)(r)||Kd(r)||Ou(r)||oc(r)&&r!==12540||!(!Gu(r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Vu(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||rp(r)||(e=>e>=19904&&e<=19967)(r)||Qd(r)||lc(r))))}function l(r){return!(t(r)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ic(e)||oc(e)||(i=>i>=57344&&i<=63743)(e)||Nu(e)||Vu(e)||Gu(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function p(r){return r>=1424&&r<=2303||Uu(r)||ju(r)}function _(r,e){return!(!e&&p(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(i=>i>=6016&&i<=6143)(r))}function y(r){for(const e of r)if(p(e.charCodeAt(0)))return!0;return!1}const b="deferred",T="loading",C="loaded";let M=null,z="unavailable",R=null;const F=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(z="error"),M&&M(r)};function j(){G.fire(new jt("pluginStateChange",{pluginStatus:z,pluginURL:R}))}const G=new Xt,N=function(){return z},K=function(){if(z!==b||!R)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");z=T,j(),R&&ce({url:R},r=>{r?F(r):(z=C,j())})},V={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>z===C||V.applyArabicShaping!=null,isLoading:()=>z===T,setState(r){z=r.pluginStatus,R=r.pluginURL},isParsed:()=>V.applyArabicShaping!=null&&V.processBidirectionalText!=null&&V.processStyledBidirectionalText!=null,getPluginURL:()=>R};class Z{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Wd,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,s){for(const c of i)if(!_(c.charCodeAt(0),s))return!1;return!0}(e,V.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*i}}}class q{constructor(e,i){this.property=e,this.value=i,this.expression=function(s,c){if(Zl(s))return new Ra(s,c);if(Wl(s)){const d=Hl(s,c);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=s;return typeof s=="string"&&c.type==="color"&&(d=xr.parse(s)),{kind:"constant",evaluate:()=>d}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class te{constructor(e){this.property=e,this.value=new q(e,void 0)}transitioned(e,i){return new J(this.property,this.value,i,xt({},e.transition,this.transition),e.now)}untransitioned(){return new J(this.property,this.value,null,{},0)}}class Y{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return vt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new te(this._values[e].property)),this._values[e].value=new q(this._values[e].property,i===null?void 0:vt(i))}getTransition(e){return vt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new te(this._values[e].property)),this._values[e].transition=vt(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const s=new se(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,i._values[c]);return s}untransitioned(){const e=new se(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class J{constructor(e,i,s,c,d){const f=c.delay||0,g=c.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+f,this.end=this.begin+g,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const c=e.now||0,d=this.value.possiblyEvaluate(e,i,s),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(e,i,s);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,s),d,he(g))}}return d}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const c=new Te(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,i,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class be{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return vt(this._values[e].value)}setValue(e,i){this._values[e]=new q(this._values[e].property,i===null?void 0:vt(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const c=new Te(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,i,s);return c}}class Se{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,c){return this.property.evaluate(this.value,this.parameters,e,i,s,c)}}class Te{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ve{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const c=Ia[this.specification.type];return c?c(e,i,s):e}}class ee{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,c){return new Se(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,c)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Se(this,{kind:"constant",value:void 0},e.parameters);const c=Ia[this.specification.type];return c?new Se(this,{kind:"constant",value:c(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,c,d,f){return e.kind==="constant"?e.value:e.evaluate(i,s,c,d,f)}}class De extends ee{possiblyEvaluate(e,i,s,c){if(e.value===void 0)return new Se(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const d=e.expression.evaluate(i,null,{},s,c),f=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,g=this._calculate(f,f,f,i);return new Se(this,{kind:"constant",value:g},i)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Se(this,{kind:"constant",value:d},i)}return new Se(this,e.expression,i)}evaluate(e,i,s,c,d,f){if(e.kind==="source"){const g=e.evaluate(i,s,c,d,f);return this._calculate(g,g,g,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},s,c),e.evaluate({zoom:Math.floor(i.zoom)},s,c),e.evaluate({zoom:Math.floor(i.zoom)+1},s,c),i):e.value}_calculate(e,i,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i,other:s}:{from:s,to:i,other:e}}interpolate(e){return e}}class Pe{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(i,null,{},s,c);return this._calculate(d,d,d,i)}return this._calculate(e.expression.evaluate(new Z(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Z(Math.floor(i.zoom),i)),e.expression.evaluate(new Z(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:s,to:i}}interpolate(e){return e}}class We{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,c){return!!e.expression.evaluate(i,null,{},s,c)}interpolate(){return!1}}class Ie{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Z(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new q(c,void 0),f=this.defaultTransitionablePropertyValues[s]=new te(c);this.defaultTransitioningPropertyValues[s]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate(i)}}}function at(r,e){return 256*(r=Fe(Math.floor(r),0,255))+Fe(Math.floor(e),0,255)}tt(ee,"DataDrivenProperty"),tt(ve,"DataConstantProperty"),tt(De,"CrossFadedDataDrivenProperty"),tt(Pe,"CrossFadedProperty"),tt(We,"ColorRampProperty");const qe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ze{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ve{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $e(r,e=1){let i=0,s=0;return{members:r.map(c=>{const d=qe[c.type].BYTES_PER_ELEMENT,f=i=yt(i,Math.max(e,d)),g=c.components||1;return s=Math.max(s,d),i+=d*g,{name:c.name,type:c.type,components:g,offset:f}}),size:yt(i,Math.max(s,e)),alignment:e}}function yt(r,e){return Math.ceil(r/e)*e}class ut extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=s,e}}ut.prototype.bytesPerElement=4,tt(ut,"StructArrayLayout2i4");class St extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=s,this.int16[d+2]=c,e}}St.prototype.bytesPerElement=6,tt(St,"StructArrayLayout3i6");class ot extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=c,this.int16[f+3]=d,e}}ot.prototype.bytesPerElement=8,tt(ot,"StructArrayLayout4i8");class bt extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,c,d,f,g)}emplace(e,i,s,c,d,f,g,x){const v=6*e,E=12*e,I=3*e;return this.int16[v+0]=i,this.int16[v+1]=s,this.uint8[E+4]=c,this.uint8[E+5]=d,this.uint8[E+6]=f,this.uint8[E+7]=g,this.float32[I+2]=x,e}}bt.prototype.bytesPerElement=12,tt(bt,"StructArrayLayout2i4ub1f12");class $t extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=c,this.float32[f+3]=d,e}}$t.prototype.bytesPerElement=16,tt($t,"StructArrayLayout4f16");class Ht extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g,x,v,E){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,s,c,d,f,g,x,v,E)}emplace(e,i,s,c,d,f,g,x,v,E,I){const A=10*e;return this.uint16[A+0]=i,this.uint16[A+1]=s,this.uint16[A+2]=c,this.uint16[A+3]=d,this.uint16[A+4]=f,this.uint16[A+5]=g,this.uint16[A+6]=x,this.uint16[A+7]=v,this.uint16[A+8]=E,this.uint16[A+9]=I,e}}Ht.prototype.bytesPerElement=20,tt(Ht,"StructArrayLayout10ui20");class Er extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g,x){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,c,d,f,g,x)}emplace(e,i,s,c,d,f,g,x,v){const E=8*e;return this.uint16[E+0]=i,this.uint16[E+1]=s,this.uint16[E+2]=c,this.uint16[E+3]=d,this.uint16[E+4]=f,this.uint16[E+5]=g,this.uint16[E+6]=x,this.uint16[E+7]=v,e}}Er.prototype.bytesPerElement=16,tt(Er,"StructArrayLayout8ui16");class er extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,c,d,f)}emplace(e,i,s,c,d,f,g){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=c,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=g,e}}er.prototype.bytesPerElement=12,tt(er,"StructArrayLayout6i12");class zi extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g,x,v,E,I,A){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,s,c,d,f,g,x,v,E,I,A)}emplace(e,i,s,c,d,f,g,x,v,E,I,A,k){const D=12*e;return this.int16[D+0]=i,this.int16[D+1]=s,this.int16[D+2]=c,this.int16[D+3]=d,this.uint16[D+4]=f,this.uint16[D+5]=g,this.uint16[D+6]=x,this.uint16[D+7]=v,this.int16[D+8]=E,this.int16[D+9]=I,this.int16[D+10]=A,this.int16[D+11]=k,e}}zi.prototype.bytesPerElement=24,tt(zi,"StructArrayLayout4i4ui4i24");class Tn extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,c,d,f)}emplace(e,i,s,c,d,f,g){const x=10*e,v=5*e;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=c,this.float32[v+2]=d,this.float32[v+3]=f,this.float32[v+4]=g,e}}Tn.prototype.bytesPerElement=20,tt(Tn,"StructArrayLayout3i3f20");class Zn extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Zn.prototype.bytesPerElement=4,tt(Zn,"StructArrayLayout1ul4");class ar extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g,x,v,E,I,A,k){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,s,c,d,f,g,x,v,E,I,A,k)}emplace(e,i,s,c,d,f,g,x,v,E,I,A,k,D){const O=20*e,$=10*e;return this.int16[O+0]=i,this.int16[O+1]=s,this.int16[O+2]=c,this.int16[O+3]=d,this.int16[O+4]=f,this.float32[$+3]=g,this.float32[$+4]=x,this.float32[$+5]=v,this.float32[$+6]=E,this.int16[O+14]=I,this.uint32[$+8]=A,this.uint16[O+18]=k,this.uint16[O+19]=D,e}}ar.prototype.bytesPerElement=40,tt(ar,"StructArrayLayout5i4f1i1ul2ui40");class ur extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,c,d,f,g)}emplace(e,i,s,c,d,f,g,x){const v=8*e;return this.int16[v+0]=i,this.int16[v+1]=s,this.int16[v+2]=c,this.int16[v+4]=d,this.int16[v+5]=f,this.int16[v+6]=g,this.int16[v+7]=x,e}}ur.prototype.bytesPerElement=16,tt(ur,"StructArrayLayout3i2i2i16");class Zt extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,c,d)}emplace(e,i,s,c,d,f){const g=4*e,x=8*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=c,this.int16[x+6]=d,this.int16[x+7]=f,e}}Zt.prototype.bytesPerElement=16,tt(Zt,"StructArrayLayout2f1f2i16");class kr extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=12*e,g=3*e;return this.uint8[f+0]=i,this.uint8[f+1]=s,this.float32[g+1]=c,this.float32[g+2]=d,e}}kr.prototype.bytesPerElement=12,tt(kr,"StructArrayLayout2ub2f12");class Hr extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=s,this.float32[d+2]=c,e}}Hr.prototype.bytesPerElement=12,tt(Hr,"StructArrayLayout3f12");class Ot extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=s,this.uint16[d+2]=c,e}}Ot.prototype.bytesPerElement=6,tt(Ot,"StructArrayLayout3ui6");class _i extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g,x,v,E,I,A,k,D,O,$,H,ie,re,oe,le){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,i,s,c,d,f,g,x,v,E,I,A,k,D,O,$,H,ie,re,oe,le)}emplace(e,i,s,c,d,f,g,x,v,E,I,A,k,D,O,$,H,ie,re,oe,le,ue){const Ee=30*e,Ce=15*e,ke=60*e;return this.int16[Ee+0]=i,this.int16[Ee+1]=s,this.int16[Ee+2]=c,this.float32[Ce+2]=d,this.float32[Ce+3]=f,this.uint16[Ee+8]=g,this.uint16[Ee+9]=x,this.uint32[Ce+5]=v,this.uint32[Ce+6]=E,this.uint32[Ce+7]=I,this.uint16[Ee+16]=A,this.uint16[Ee+17]=k,this.uint16[Ee+18]=D,this.float32[Ce+10]=O,this.float32[Ce+11]=$,this.uint8[ke+48]=H,this.uint8[ke+49]=ie,this.uint8[ke+50]=re,this.uint32[Ce+13]=oe,this.int16[Ee+28]=le,this.uint8[ke+58]=ue,e}}_i.prototype.bytesPerElement=60,tt(_i,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class jo extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g,x,v,E,I,A,k,D,O,$,H,ie,re,oe,le,ue,Ee,Ce,ke,Oe,xe,Ae,Ue,Ne){const Je=this.length;return this.resize(Je+1),this.emplace(Je,e,i,s,c,d,f,g,x,v,E,I,A,k,D,O,$,H,ie,re,oe,le,ue,Ee,Ce,ke,Oe,xe,Ae,Ue,Ne)}emplace(e,i,s,c,d,f,g,x,v,E,I,A,k,D,O,$,H,ie,re,oe,le,ue,Ee,Ce,ke,Oe,xe,Ae,Ue,Ne,Je){const Re=38*e,He=19*e;return this.int16[Re+0]=i,this.int16[Re+1]=s,this.int16[Re+2]=c,this.float32[He+2]=d,this.float32[He+3]=f,this.int16[Re+8]=g,this.int16[Re+9]=x,this.int16[Re+10]=v,this.int16[Re+11]=E,this.int16[Re+12]=I,this.int16[Re+13]=A,this.uint16[Re+14]=k,this.uint16[Re+15]=D,this.uint16[Re+16]=O,this.uint16[Re+17]=$,this.uint16[Re+18]=H,this.uint16[Re+19]=ie,this.uint16[Re+20]=re,this.uint16[Re+21]=oe,this.uint16[Re+22]=le,this.uint16[Re+23]=ue,this.uint16[Re+24]=Ee,this.uint16[Re+25]=Ce,this.uint16[Re+26]=ke,this.uint16[Re+27]=Oe,this.uint16[Re+28]=xe,this.uint32[He+15]=Ae,this.float32[He+16]=Ue,this.float32[He+17]=Ne,this.float32[He+18]=Je,e}}jo.prototype.bytesPerElement=76,tt(jo,"StructArrayLayout3i2f6i15ui1ul3f76");class cn extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}cn.prototype.bytesPerElement=4,tt(cn,"StructArrayLayout1f4");class Ms extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,c,d,f,g)}emplace(e,i,s,c,d,f,g,x){const v=7*e;return this.float32[v+0]=i,this.float32[v+1]=s,this.float32[v+2]=c,this.float32[v+3]=d,this.float32[v+4]=f,this.float32[v+5]=g,this.float32[v+6]=x,e}}Ms.prototype.bytesPerElement=28,tt(Ms,"StructArrayLayout7f28");class ks extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,c,d)}emplace(e,i,s,c,d,f){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=c,this.float32[g+3]=d,this.float32[g+4]=f,e}}ks.prototype.bytesPerElement=20,tt(ks,"StructArrayLayout5f20");class lo extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c)}emplace(e,i,s,c,d){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=s,this.uint16[f+3]=c,this.uint16[f+4]=d,e}}lo.prototype.bytesPerElement=12,tt(lo,"StructArrayLayout1ul3ui12");class zr extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=s,e}}zr.prototype.bytesPerElement=4,tt(zr,"StructArrayLayout2ui4");class En extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}En.prototype.bytesPerElement=2,tt(En,"StructArrayLayout1ui2");class qn extends Ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=s,e}}qn.prototype.bytesPerElement=8,tt(qn,"StructArrayLayout2f8");class $a extends Ze{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}$a.prototype.size=12;class v0 extends er{get(e){return new $a(this,e)}}tt(v0,"FillExtrusionExtArray");class w0 extends Ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}w0.prototype.size=40;class Nm extends ar{get(e){return new w0(this,e)}}tt(Nm,"CollisionBoxArray");class b0 extends Ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}b0.prototype.size=60;class T0 extends _i{get(e){return new b0(this,e)}}tt(T0,"PlacedSymbolArray");class E0 extends Ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}E0.prototype.size=76;class S0 extends jo{get(e){return new E0(this,e)}}tt(S0,"SymbolInstanceArray");class C0 extends cn{getoffsetX(e){return this.float32[1*e+0]}}tt(C0,"GlyphOffsetArray");class I0 extends St{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}tt(I0,"SymbolLineVertexArray");class A0 extends Ze{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}A0.prototype.size=12;class M0 extends lo{get(e){return new A0(this,e)}}tt(M0,"FeatureIndexArray");class k0 extends Ze{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}k0.prototype.size=4;class z0 extends zr{get(e){return new k0(this,e)}}tt(z0,"FillExtrusionCentroidArray");class P0 extends Ze{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}P0.prototype.size=12;class D0 extends er{get(e){return new P0(this,e)}}tt(D0,"CircleGlobeExtArray");const $2=$e([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Z2=$e([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var L0=ms(function(r){r.exports=function(e,i){var s,c,d,f,g,x,v,E;for(c=e.length-(s=3&e.length),d=i,g=3432918353,x=461845907,E=0;E<c;)v=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,d=27492+(65535&(f=5*(65535&(d=(d^=v=(65535&(v=(v=(65535&v)*g+(((v>>>16)*g&65535)<<16)&4294967295)<<15|v>>>17))*x+(((v>>>16)*x&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(v=0,s){case 3:v^=(255&e.charCodeAt(E+2))<<16;case 2:v^=(255&e.charCodeAt(E+1))<<8;case 1:d^=v=(65535&(v=(v=(65535&(v^=255&e.charCodeAt(E)))*g+(((v>>>16)*g&65535)<<16)&4294967295)<<15|v>>>17))*x+(((v>>>16)*x&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}),q2=ms(function(r){r.exports=function(e,i){for(var s,c=e.length,d=i^c,f=0;c>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++f;switch(c){case 3:d^=(255&e.charCodeAt(f+2))<<16;case 2:d^=(255&e.charCodeAt(f+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(f)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}}),$u=L0,W2=q2;$u.murmur3=L0,$u.murmur2=W2;class ip{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,s,c){this.ids.push(R0(e)),this.positions.push(i,s,c)}getPositions(e){const i=R0(e);let s=0,c=this.ids.length-1;for(;s<c;){const f=s+c>>1;this.ids[f]>=i?c=f:s=f+1}const d=[];for(;this.ids[s]===i;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(e,i){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Vm(s,c,0,s.length-1),i&&i.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const i=new ip;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function R0(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:$u(String(r))}function Vm(r,e,i,s){for(;i<s;){const c=r[i+s>>1];let d=i-1,f=s+1;for(;;){do d++;while(r[d]<c);do f--;while(r[f]>c);if(d>=f)break;np(r,d,f),np(e,3*d,3*f),np(e,3*d+1,3*f+1),np(e,3*d+2,3*f+2)}f-i<s-f?(Vm(r,e,i,f),i=f+1):(Vm(r,e,f+1,s),s=f)}}function np(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}tt(ip,"FeaturePositionMap");class Go{constructor(e,i){this.gl=e.gl,this.location=i}}class op extends Go{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class B0 extends Go{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class O0 extends Go{constructor(e,i){super(e,i),this.current=xr.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const X2=new Float32Array(16),H2=new Float32Array(9),Y2=new Float32Array(4);function jm(r){return[at(255*r.r,255*r.g),at(255*r.b,255*r.a)]}class Zu{constructor(e,i,s){this.value=e,this.uniformNames=i.map(c=>`u_${c}`),this.type=s}setUniform(e,i,s){e.set(s.constantOr(this.value))}getBinding(e,i,s){return this.type==="color"?new O0(e,i):new op(e,i)}}class hc{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,s,c){const d=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&e.set(d)}getBinding(e,i,s){return s==="u_pattern_from"||s==="u_pattern_to"||s==="u_dash_from"||s==="u_dash_to"?new B0(e,i):new op(e,i)}}class $o{constructor(e,i,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,s,c,d,f){const g=this.paintVertexArray.length,x=this.expression.evaluate(new Z(0),i,{},d,c,f);this.paintVertexArray.resize(e),this._setPaintValue(g,e,x)}updatePaintArray(e,i,s,c,d){const f=this.expression.evaluate({zoom:0},s,c,void 0,d);this._setPaintValue(e,i,f)}_setPaintValue(e,i,s){if(this.type==="color"){const c=jm(s);for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wn{constructor(e,i,s,c,d,f){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,s,c,d,f){const g=this.expression.evaluate(new Z(this.zoom),i,{},d,c,f),x=this.expression.evaluate(new Z(this.zoom+1),i,{},d,c,f),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,g,x)}updatePaintArray(e,i,s,c,d){const f=this.expression.evaluate({zoom:this.zoom},s,c,void 0,d),g=this.expression.evaluate({zoom:this.zoom+1},s,c,void 0,d);this._setPaintValue(e,i,f,g)}_setPaintValue(e,i,s,c){if(this.type==="color"){const d=jm(s),f=jm(c);for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,d[0],d[1],f[0],f[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const s=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,c=Fe(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,i,s){return new op(e,i)}}class zs{constructor(e,i,s,c,d,f,g){this.expression=e,this.type=s,this.useIntegerZoom=c,this.zoom=d,this.layerId=g,this.paintVertexAttributes=(s==="array"?Z2:$2).members;for(let x=0;x<i.length;++x);this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,i,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,c,d,f){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(e,i,s,c){if(!c||!s)return;const{min:d,mid:f,max:g}=s,x=c[d],v=c[f],E=c[g];if(x&&v&&E)for(let I=e;I<i;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,v,x),this._setPaintValue(this.zoomOutPaintVertexArray,I,v,E)}_setPaintValue(e,i,s,c){e.emplace(i,s.tl[0],s.tl[1],s.br[0],s.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],s.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ps{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!s(d))continue;const f=e.paint.get(d);if(!(f instanceof Se&&Ts(f.property.specification)))continue;const g=J2(d,e.type),x=f.value,v=f.property.specification.type,E=f.property.useIntegerZoom,I=f.property.specification["property-type"],A=I==="cross-faded"||I==="cross-faded-data-driven",k=String(d)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||k)if(x.kind==="source"||k||A){const D=F0(d,v,"source");this.binders[d]=A?new zs(x,g,v,E,i,D,e.id):new $o(x,g,v,D),c.push(`/a_${d}`)}else{const D=F0(d,v,"composite");this.binders[d]=new Wn(x,g,v,E,i,D),c.push(`/z_${d}`)}else this.binders[d]=A?new hc(x.value,g):new Zu(x.value,g,v),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof $o||i instanceof Wn?i.maxValue:0}populatePaintArrays(e,i,s,c,d,f){for(const g in this.binders){const x=this.binders[g];(x instanceof $o||x instanceof Wn||x instanceof zs)&&x.populatePaintArray(e,i,s,c,d,f)}}setConstantPatternPositions(e,i){for(const s in this.binders){const c=this.binders[s];c instanceof hc&&c.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,s,c,d,f){let g=!1;for(const x in e){const v=i.getPositions(x);for(const E of v){const I=s.feature(E.index);for(const A in this.binders){const k=this.binders[A];if((k instanceof $o||k instanceof Wn||k instanceof zs)&&k.expression.isStateDependent===!0){const D=c.paint.get(A);k.expression=D.value,k.updatePaintArray(E.start,E.end,I,e[x],d,f),g=!0}}}}return g}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Zu||s instanceof hc)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof $o||s instanceof Wn||s instanceof zs)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Zu||s instanceof hc||s instanceof Wn)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const s=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Zu||d instanceof hc||d instanceof Wn){for(const f of d.uniformNames)if(i[f]){const g=d.getBinding(e,i[f],f);s.push({name:f,property:c,binding:g})}}}return s}setUniforms(e,i,s,c){for(const{name:d,property:f,binding:g}of i)this.binders[f].setUniform(g,c,s.get(f),d)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const s=this.binders[i];if(e&&s instanceof zs){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof $o||s instanceof Wn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof $o||s instanceof Wn||s instanceof zs)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof $o||i instanceof Wn||i instanceof zs)&&i.destroy()}}}class Za{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Ps(c,i,s);this.needsUpload=!1,this._featureMap=new ip,this._bufferOffset=0}populatePaintArrays(e,i,s,c,d,f,g){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,i,c,d,f,g);i.id!==void 0&&this._featureMap.add(i.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,c,d){for(const f of s)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,c,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const K2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function J2(r,e){return K2[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Q2={"line-pattern":{source:Ht,composite:Ht},"fill-pattern":{source:Ht,composite:Ht},"fill-extrusion-pattern":{source:Ht,composite:Ht},"line-dasharray":{source:Er,composite:Er}},eT={color:{source:qn,composite:$t},number:{source:cn,composite:qn}};function F0(r,e,i){const s=Q2[r];return s&&s[i]||eT[e][i]}tt(Zu,"ConstantBinder"),tt(hc,"CrossFadedConstantBinder"),tt($o,"SourceExpressionBinder"),tt(zs,"CrossFadedCompositeBinder"),tt(Wn,"CompositeExpressionBinder"),tt(Ps,"ProgramConfiguration",{omit:["_buffers"]}),tt(Za,"ProgramConfigurationSet");const sp="-transition";class Xn extends Xt{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new be(i.layout)),i.paint)){this._transitionablePaint=new Y(i.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Te(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,s={}){i!=null&&this._validate(Um,`layers.${this.id}.layout.${e}`,e,i,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return yn(e,sp)?this._transitionablePaint.getTransition(e.slice(0,-sp.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,s={}){if(i!=null&&this._validate(Gd,`layers.${this.id}.paint.${e}`,e,i,s))return!1;if(yn(e,sp))return this._transitionablePaint.setTransition(e.slice(0,-sp.length),i||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.property.specification["property-type"]==="cross-faded-data-driven",f=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(e,g,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),wt(e,(i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length))}_validate(e,i,s,c,d={}){return(!d||d.validate!==!1)&&$d(this,e.call(jd,{key:i,layerType:this.type,objectKey:s,value:c,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Se&&Ts(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=No(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const tT=$e([{name:"a_pos",components:2,type:"Int16"}],4),rT=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Sr{constructor(e=[]){this.segments=e}prepareSegment(e,i,s,c){let d=this.segments[this.segments.length-1];return e>Sr.MAX_VERTEX_ARRAY_LENGTH&&zt(`Max vertices per segment is ${Sr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Sr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,c){return new Sr([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}Sr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tt(Sr,"SegmentVector");var _t=8192;class Ds{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Kt?new Kt(e.lng,e.lat):Kt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Kt?new Kt(e.lng,e.lat):Kt.convert(e),this}extend(e){const i=this._sw,s=this._ne;let c,d;if(e instanceof Kt)c=e,d=e;else{if(!(e instanceof Ds))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ds.convert(e)):this.extend(Kt.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return i||s?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),s.lng=Math.max(d.lng,s.lng),s.lat=Math.max(d.lat,s.lat)):(this._sw=new Kt(c.lng,c.lat),this._ne=new Kt(d.lng,d.lat)),this}getCenter(){return new Kt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Kt(this.getWest(),this.getNorth())}getSouthEast(){return new Kt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Kt.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof Ds?e:new Ds(e)}}const Gm=63710088e-1;class Kt{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Kt(lt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,c=e.lat*i,d=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return Gm*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Ds(new Kt(this.lng-s,this.lat-i),new Kt(this.lng+s,this.lat+i))}static convert(e){if(e instanceof Kt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Kt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Kt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const U0=2*Math.PI*Gm;function $m(r){return U0*Math.cos(r*Math.PI/180)}function qa(r){return(180+r)/360}function Wa(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Sn(r,e){return r/$m(e)}function gi(r){return 360*r-180}function Or(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function N0(r,e){return r*$m(Or(e))}const co=85.051129;class dc{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Kt.convert(e);return new dc(qa(s.lng),Wa(s.lat),Sn(i,s.lat))}toLngLat(){return new Kt(gi(this.x),Or(this.y))}toAltitude(){return N0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/U0*(e=Or(this.y),1/Math.cos(e*Math.PI/180));var e}}function Zm(r,e,i,s,c,d,f,g,x){const v=(e+s)/2,E=(i+c)/2,I=new ne(v,E);g(I),function(A,k,D,O,$,H){const ie=D-$,re=O-H;return Math.abs((O-k)*ie-(D-A)*re)/Math.hypot(ie,re)}(I.x,I.y,d.x,d.y,f.x,f.y)>=x?(Zm(r,e,i,v,E,d,I,g,x),Zm(r,v,E,s,c,I,f,g,x)):r.push(f)}function V0(r,e,i){let s=r[0],c=s.x,d=s.y;e(s);const f=[s];for(let g=1;g<r.length;g++){const x=r[g],{x:v,y:E}=x;e(x),Zm(f,c,d,v,E,s,x,e,i),c=v,d=E,s=x}return f}function qm(r,e,i,s,c){if(c(e,i)){const d=e.add(i).mult(.5);s(d),qm(r,e,d,s,c),qm(r,d,i,s,c)}else r.push(i)}function iT(r,e,i){let s=r[0];e(s);const c=[s];for(let d=1;d<r.length;d++){const f=r[d];e(f),qm(c,s,f,e,i),s=f}return c}const Wm=Math.pow(2,14)-1,j0=-Wm-1;function nT(r,e){const i=Math.round(r.x*e),s=Math.round(r.y*e);return r.x=Fe(i,j0,Wm),r.y=Fe(s,j0,Wm),(i<r.x||i>r.x+1||s<r.y||s>r.y+1)&&zt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Zo(r,e,i){const s=r.loadGeometry(),c=r.extent,d=_t/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:g,x,y:v,projection:E}=i,I=A=>{const k=gi((e.x+A.x/c)/f),D=Or((e.y+A.y/c)/f),O=E.project(k,D);A.x=(O.x*g-x)*c,A.y=(O.y*g-v)*c};for(let A=0;A<s.length;A++)if(r.type!==1)s[A]=V0(s[A],I,1);else{const k=[];for(const D of s[A])D.x<0||D.x>=c||D.y<0||D.y>=c||(I(D),k.push(D));s[A]=k}}for(const f of s)for(const g of f)nT(g,d);return s}function Xa(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Zo(r):[]}}function ap(r,e,i,s,c){r.emplaceBack(2*e+(s+1)/2,2*i+(c+1)/2)}function lp(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Xm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ut,this.indexArray=new Ot,this.segments=new Sr,this.programConfigurations=new Za(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,c){const d=this.layers[0],f=[];let g=null;d.type==="circle"&&(g=d.layout.get("circle-sort-key"));for(const{feature:v,id:E,index:I,sourceLayerIndex:A}of e){const k=this.layers[0]._featureFilter.needGeometry,D=Xa(v,k);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),D,s))continue;const O=g?g.evaluate(D,{},s):void 0,$={id:E,properties:v.properties,type:v.type,sourceLayerIndex:A,index:I,geometry:k?D.geometry:Zo(v,s,c),patterns:{},sortKey:O};f.push($)}g&&f.sort((v,E)=>v.sortKey-E.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new D0,x=c.projection);for(const v of f){const{geometry:E,index:I,sourceLayerIndex:A}=v,k=e[I].feature;this.addFeature(v,E,I,i.availableImages,s,x),i.featureIndex.insert(k,E,I,A,this.index)}}update(e,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,rT.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,c,d,f){for(const g of i)for(const x of g){const v=x.x,E=x.y;if(v<0||v>=_t||E<0||E>=_t)continue;if(f){const k=f.projectTilePoint(v,E,d),D=f.upVector(d,v,E),O=this.globeExtVertexArray;lp(O,k,D),lp(O,k,D),lp(O,k,D),lp(O,k,D)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=I.vertexLength;ap(this.layoutVertexArray,v,E,-1,-1),ap(this.layoutVertexArray,v,E,1,-1),ap(this.layoutVertexArray,v,E,1,1),ap(this.layoutVertexArray,v,E,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,d)}}function G0(r,e){for(let i=0;i<r.length;i++)if(Ha(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Ha(r,e[i]))return!0;return!!Hm(r,e)}function oT(r,e,i){return!!Ha(r,e)||!!Ym(e,r,i)}function $0(r,e){if(r.length===1)return q0(e,r[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let c=0;c<s.length;c++)if(Ha(r,s[c]))return!0}for(let i=0;i<r.length;i++)if(q0(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Hm(r,e[i]))return!0;return!1}function sT(r,e,i){if(r.length>1){if(Hm(r,e))return!0;for(let s=0;s<e.length;s++)if(Ym(e[s],r,i))return!0}for(let s=0;s<r.length;s++)if(Ym(r[s],e,i))return!0;return!1}function Hm(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const s=r[i],c=r[i+1];for(let d=0;d<e.length-1;d++)if(aT(s,c,e[d],e[d+1]))return!0}return!1}function aT(r,e,i,s){return Mr(r,i,s)!==Mr(e,i,s)&&Mr(r,e,i)!==Mr(r,e,s)}function Ym(r,e,i){const s=i*i;if(e.length===1)return r.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Z0(r,e[c-1],e[c])<s)return!0;return!1}function Z0(r,e,i){const s=e.distSqr(i);if(s===0)return r.distSqr(e);const c=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/s;return r.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function q0(r,e){let i,s,c,d=!1;for(let f=0;f<r.length;f++){i=r[f];for(let g=0,x=i.length-1;g<i.length;x=g++)s=i[g],c=i[x],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(d=!d)}return d}function Ha(r,e){let i=!1;for(let s=0,c=r.length-1;s<r.length;c=s++){const d=r[s],f=r[c];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function W0(r,e,i,s,c){for(const f of r)if(e<=f.x&&i<=f.y&&s>=f.x&&c>=f.y)return!0;const d=[new ne(e,i),new ne(e,c),new ne(s,c),new ne(s,i)];if(r.length>2){for(const f of d)if(Ha(r,f))return!0}for(let f=0;f<r.length-1;f++)if(lT(r[f],r[f+1],d))return!0;return!1}function lT(r,e,i){const s=i[0],c=i[2];if(r.x<s.x&&e.x<s.x||r.x>c.x&&e.x>c.x||r.y<s.y&&e.y<s.y||r.y>c.y&&e.y>c.y)return!1;const d=Mr(r,e,i[0]);return d!==Mr(r,e,i[1])||d!==Mr(r,e,i[2])||d!==Mr(r,e,i[3])}function pc(r,e,i){const s=e.paint.get(r).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(r)}function cp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function X0(r,e,i,s,c){if(!e[0]&&!e[1])return r;const d=ne.convert(e)._mult(c);i==="viewport"&&d._rotate(-s);const f=[];for(let g=0;g<r.length;g++)f.push(r[g].sub(d));return f}function H0(r,e,i,s){const c=ne.convert(r)._mult(s);return e==="viewport"&&c._rotate(-i),c}tt(Xm,"CircleBucket",{omit:["layers"]});const cT=new Ie({"circle-sort-key":new ee(fe.layout_circle["circle-sort-key"])});var uT={paint:new Ie({"circle-radius":new ee(fe.paint_circle["circle-radius"]),"circle-color":new ee(fe.paint_circle["circle-color"]),"circle-blur":new ee(fe.paint_circle["circle-blur"]),"circle-opacity":new ee(fe.paint_circle["circle-opacity"]),"circle-translate":new ve(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new ve(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ve(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ve(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ee(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ee(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ee(fe.paint_circle["circle-stroke-opacity"])}),layout:cT},up=1e-6,Wi=typeof Float32Array<"u"?Float32Array:Array;function Y0(){var r=new Wi(9);return Wi!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Xi(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ls(r,e,i){var s=e[0],c=e[1],d=e[2],f=e[3],g=e[4],x=e[5],v=e[6],E=e[7],I=e[8],A=e[9],k=e[10],D=e[11],O=e[12],$=e[13],H=e[14],ie=e[15],re=i[0],oe=i[1],le=i[2],ue=i[3];return r[0]=re*s+oe*g+le*I+ue*O,r[1]=re*c+oe*x+le*A+ue*$,r[2]=re*d+oe*v+le*k+ue*H,r[3]=re*f+oe*E+le*D+ue*ie,r[4]=(re=i[4])*s+(oe=i[5])*g+(le=i[6])*I+(ue=i[7])*O,r[5]=re*c+oe*x+le*A+ue*$,r[6]=re*d+oe*v+le*k+ue*H,r[7]=re*f+oe*E+le*D+ue*ie,r[8]=(re=i[8])*s+(oe=i[9])*g+(le=i[10])*I+(ue=i[11])*O,r[9]=re*c+oe*x+le*A+ue*$,r[10]=re*d+oe*v+le*k+ue*H,r[11]=re*f+oe*E+le*D+ue*ie,r[12]=(re=i[12])*s+(oe=i[13])*g+(le=i[14])*I+(ue=i[15])*O,r[13]=re*c+oe*x+le*A+ue*$,r[14]=re*d+oe*v+le*k+ue*H,r[15]=re*f+oe*E+le*D+ue*ie,r}function Ya(r,e,i){var s,c,d,f,g,x,v,E,I,A,k,D,O=i[0],$=i[1],H=i[2];return e===r?(r[12]=e[0]*O+e[4]*$+e[8]*H+e[12],r[13]=e[1]*O+e[5]*$+e[9]*H+e[13],r[14]=e[2]*O+e[6]*$+e[10]*H+e[14],r[15]=e[3]*O+e[7]*$+e[11]*H+e[15]):(c=e[1],d=e[2],f=e[3],g=e[4],x=e[5],v=e[6],E=e[7],I=e[8],A=e[9],k=e[10],D=e[11],r[0]=s=e[0],r[1]=c,r[2]=d,r[3]=f,r[4]=g,r[5]=x,r[6]=v,r[7]=E,r[8]=I,r[9]=A,r[10]=k,r[11]=D,r[12]=s*O+g*$+I*H+e[12],r[13]=c*O+x*$+A*H+e[13],r[14]=d*O+v*$+k*H+e[14],r[15]=f*O+E*$+D*H+e[15]),r}function uo(r,e,i){var s=i[0],c=i[1],d=i[2];return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r[4]=e[4]*c,r[5]=e[5]*c,r[6]=e[6]*c,r[7]=e[7]*c,r[8]=e[8]*d,r[9]=e[9]*d,r[10]=e[10]*d,r[11]=e[11]*d,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function hp(r,e,i){var s=Math.sin(i),c=Math.cos(i),d=e[4],f=e[5],g=e[6],x=e[7],v=e[8],E=e[9],I=e[10],A=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=d*c+v*s,r[5]=f*c+E*s,r[6]=g*c+I*s,r[7]=x*c+A*s,r[8]=v*c-d*s,r[9]=E*c-f*s,r[10]=I*c-g*s,r[11]=A*c-x*s,r}function dp(r,e,i){var s=Math.sin(i),c=Math.cos(i),d=e[0],f=e[1],g=e[2],x=e[3],v=e[8],E=e[9],I=e[10],A=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=d*c-v*s,r[1]=f*c-E*s,r[2]=g*c-I*s,r[3]=x*c-A*s,r[8]=d*s+v*c,r[9]=f*s+E*c,r[10]=g*s+I*c,r[11]=x*s+A*c,r}function K0(r,e,i){var s,c,d,f=i[0],g=i[1],x=i[2],v=Math.hypot(f,g,x);return v<up?null:(f*=v=1/v,g*=v,x*=v,s=Math.sin(e),c=Math.cos(e),r[0]=f*f*(d=1-c)+c,r[1]=g*f*d+x*s,r[2]=x*f*d-g*s,r[3]=0,r[4]=f*g*d-x*s,r[5]=g*g*d+c,r[6]=x*g*d+f*s,r[7]=0,r[8]=f*x*d+g*s,r[9]=g*x*d-f*s,r[10]=x*x*d+c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var hT=Ls;function Km(){var r=new Wi(3);return Wi!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function J0(r){var e=new Wi(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function qu(r){return Math.hypot(r[0],r[1],r[2])}function fc(r,e,i){var s=new Wi(3);return s[0]=r,s[1]=e,s[2]=i,s}function Rs(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function Jm(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function Q0(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function pp(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function fp(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function ho(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function mp(r,e,i,s){return r[0]=e[0]+i[0]*s,r[1]=e[1]+i[1]*s,r[2]=e[2]+i[2]*s,r}function yi(r,e){var i=e[0],s=e[1],c=e[2],d=i*i+s*s+c*c;return d>0&&(d=1/Math.sqrt(d)),r[0]=e[0]*d,r[1]=e[1]*d,r[2]=e[2]*d,r}function Cn(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Qm(r,e,i){var s=e[0],c=e[1],d=e[2],f=i[0],g=i[1],x=i[2];return r[0]=c*x-d*g,r[1]=d*f-s*x,r[2]=s*g-c*f,r}function ri(r,e,i){var s=e[0],c=e[1],d=e[2],f=i[3]*s+i[7]*c+i[11]*d+i[15];return r[0]=(i[0]*s+i[4]*c+i[8]*d+i[12])/(f=f||1),r[1]=(i[1]*s+i[5]*c+i[9]*d+i[13])/f,r[2]=(i[2]*s+i[6]*c+i[10]*d+i[14])/f,r}function ex(r,e,i){var s=i[0],c=i[1],d=i[2],f=e[0],g=e[1],x=e[2],v=c*x-d*g,E=d*f-s*x,I=s*g-c*f,A=c*I-d*E,k=d*v-s*I,D=s*E-c*v,O=2*i[3];return E*=O,I*=O,k*=2,D*=2,r[0]=f+(v*=O)+(A*=2),r[1]=g+E+k,r[2]=x+I+D,r}var Wu,In=Jm,dT=Q0,pT=qu;function tx(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function Ka(r,e,i){var s=e[0],c=e[1],d=e[2],f=e[3];return r[0]=i[0]*s+i[4]*c+i[8]*d+i[12]*f,r[1]=i[1]*s+i[5]*c+i[9]*d+i[13]*f,r[2]=i[2]*s+i[6]*c+i[10]*d+i[14]*f,r[3]=i[3]*s+i[7]*c+i[11]*d+i[15]*f,r}function rx(){var r=new Wi(4);return Wi!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function ix(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function nx(r,e,i){i*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return r[0]=s*x+f*g,r[1]=c*x+d*g,r[2]=d*x-c*g,r[3]=f*x-s*g,r}function ox(r,e,i){i*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return r[0]=s*x-d*g,r[1]=c*x+f*g,r[2]=d*x+s*g,r[3]=f*x-c*g,r}Km(),Wu=new Wi(4),Wi!=Float32Array&&(Wu[0]=0,Wu[1]=0,Wu[2]=0,Wu[3]=0),Km(),fc(1,0,0),fc(0,1,0),rx(),rx(),Y0();class e_{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const c=Cn(i,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return s[0]=this.pos[0]+this.dir[0]*d,s[1]=this.pos[1]+this.dir[1]*d,s[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,s){if(function(k,D){var O=k[0],$=k[1],H=k[2],ie=D[0],re=D[1],oe=D[2];return Math.abs(O-ie)<=up*Math.max(1,Math.abs(O),Math.abs(ie))&&Math.abs($-re)<=up*Math.max(1,Math.abs($),Math.abs(re))&&Math.abs(H-oe)<=up*Math.max(1,Math.abs(H),Math.abs(oe))}(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[c,d,f]=this.dir,g=this.pos[0]-e[0],x=this.pos[1]-e[1],v=this.pos[2]-e[2],E=c*c+d*d+f*f,I=2*(g*c+x*d+v*f),A=I*I-4*E*(g*g+x*x+v*v-i*i);if(A<0){const k=Math.max(-I/2,0),D=g+c*k,O=x+d*k,$=v+f*k,H=Math.hypot(D,O,$);return s[0]=D*i/H,s[1]=O*i/H,s[2]=$*i/H,!1}{const k=(-I-Math.sqrt(A))/(2*E);if(k<0){const D=Math.hypot(g,x,v);return s[0]=g*i/D,s[1]=x*i/D,s[2]=v*i/D,!1}return s[0]=g+c*k,s[1]=x+d*k,s[2]=v+f*k,!0}}}class t_{constructor(e,i,s,c,d){this.TL=e,this.TR=i,this.BR=s,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,i,s){const c=[-1,1,1],d=[1,1,1],f=[1,-1,1],g=[-1,-1,1],x=ri(c,c,e),v=ri(d,d,e),E=ri(f,f,e),I=ri(g,g,e);return new t_(x,v,E,I,i/s)}}class r_{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,s,c){const d=Math.pow(2,s),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const v=Ka([],x,e),E=1/v[3]/i*d;return function(I,A,k){return I[0]=A[0]*k[0],I[1]=A[1]*k[1],I[2]=A[2]*k[2],I[3]=A[3]*k[3],I}(v,v,[E,E,c?1/v[3]:E,E])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const v=yi([],Qm([],In([],f[x[0]],f[x[1]]),In([],f[x[2]],f[x[1]]))),E=-Cn(v,f[x[1]]);return v.concat(E)});return new r_(f,g)}}class un{constructor(e,i){this.min=e,this.max=i,this.center=ho([],Rs([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=J0(this.min),c=J0(this.max);for(let d=0;d<i.length;d++)s[d]=i[d]?this.min[d]:this.center[d],c[d]=i[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new un(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let s=!0;for(let c=0;c<e.planes.length;c++){const d=e.planes[c];let f=0;for(let g=0;g<i.length;g++)f+=Cn(d,i[g])+d[3]>=0;if(f===0)return 0;f!==i.length&&(s=!1)}if(s)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let g=0;g<e.points.length;g++){const x=e.points[g][c]-this.min[c];d=Math.min(d,x),f=Math.max(f,x)}if(f<0||d>this.max[c]-this.min[c])return 0}return 1}}function sx(r,e,i,s,c,d,f,g,x){if(d&&r.queryGeometry.isAboveHorizon)return!1;d&&(x*=r.pixelToTileUnitsFactor);const v=r.tileID.canonical,E=i.projection.upVectorScale(v,i.center.lat,i.worldSize).metersToTile;for(const I of e)for(const A of I){const k=A.add(g),D=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(k.x,k.y,!0):0,O=i.projection.projectTilePoint(k.x,k.y,v);if(D>0){const re=i.projection.upVector(v,k.x,k.y);O.x+=re[0]*E*D,O.y+=re[1]*E*D,O.z+=re[2]*E*D}const $=d?k:fT(O.x,O.y,O.z,s),H=d?r.tilespaceRays.map(re=>_T(re,D)):r.queryGeometry.screenGeometry,ie=Ka([],[O.x,O.y,O.z,1],s);if(!f&&d?x*=ie[3]/i.cameraToCenterDistance:f&&!d&&(x*=i.cameraToCenterDistance/ie[3]),d){const re=Or((A.y/_t+v.y)/(1<<v.z));x/=i.projection.pixelsPerMeter(re,1)/Sn(1,re)}if(oT(H,$,x))return!0}return!1}function fT(r,e,i,s){const c=Ka([],[r,e,i,1],s);return new ne(c[0]/c[3],c[1]/c[3])}const ax=fc(0,0,0),mT=fc(0,0,1);function _T(r,e){const i=Km();return ax[2]=e,r.intersectsPlane(ax,mT,i),new ne(i[0],i[1])}class lx extends Xm{}function cx(r,{width:e,height:i},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*s);return r.width=e,r.height=i,r.data=c,r}function ux(r,e,i){const{width:s,height:c}=e;s===r.width&&c===r.height||(i_(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,s),height:Math.min(r.height,c)},i),r.width=s,r.height=c,r.data=e.data)}function i_(r,e,i,s,c,d){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||i.x>r.width-c.width||i.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const f=r.data,g=e.data;for(let x=0;x<c.height;x++){const v=((i.y+x)*r.width+i.x)*d,E=((s.y+x)*e.width+s.x)*d;for(let I=0;I<c.width*d;I++)g[E+I]=f[v+I]}return e}tt(lx,"HeatmapBucket",{omit:["layers"]});class qo{constructor(e,i){cx(this,e,1,i)}resize(e){ux(this,new qo(e),1)}clone(){return new qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,c,d){i_(e,i,s,c,d,1)}}class Hi{constructor(e,i){cx(this,e,4,i)}resize(e){ux(this,new Hi(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Hi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,c,d){i_(e,i,s,c,d,4)}}tt(qo,"AlphaImage"),tt(Hi,"RGBAImage");var gT={paint:new Ie({"heatmap-radius":new ee(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ee(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ve(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new We(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ve(fe.paint_heatmap["heatmap-opacity"])})};function n_(r){const e={},i=r.resolution||256,s=r.clips?r.clips.length:1,c=r.image||new Hi({width:i,height:s}),d=(f,g,x)=>{e[r.evaluationKey]=x;const v=r.expression.evaluate(e);c.data[f+g+0]=Math.floor(255*v.r/v.a),c.data[f+g+1]=Math.floor(255*v.g/v.a),c.data[f+g+2]=Math.floor(255*v.b/v.a),c.data[f+g+3]=Math.floor(255*v.a)};if(r.clips)for(let f=0,g=0;f<s;++f,g+=4*i)for(let x=0,v=0;x<i;x++,v+=4){const E=x/(i-1),{start:I,end:A}=r.clips[f];d(g,v,I*(1-E)+A*E)}else for(let f=0,g=0;f<i;f++,g+=4)d(0,g,f/(i-1));return c}var yT={paint:new Ie({"hillshade-illumination-direction":new ve(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ve(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ve(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ve(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ve(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ve(fe.paint_hillshade["hillshade-accent-color"])})};const xT=$e([{name:"a_pos",components:2,type:"Int16"}],4),{members:vT}=xT;var _p=gp,wT=gp;function gp(r,e,i){i=i||2;var s,c,d,f,g,x,v,E=e&&e.length,I=E?e[0]*i:r.length,A=hx(r,0,I,i,!0),k=[];if(!A||A.next===A.prev)return k;if(E&&(A=function(O,$,H,ie){var re,oe,le,ue=[];for(re=0,oe=$.length;re<oe;re++)(le=hx(O,$[re]*ie,re<oe-1?$[re+1]*ie:O.length,ie,!1))===le.next&&(le.steiner=!0),ue.push(MT(le));for(ue.sort(CT),re=0;re<ue.length;re++)H=Bs(H=IT(ue[re],H),H.next);return H}(r,e,A,i)),r.length>80*i){s=d=r[0],c=f=r[1];for(var D=i;D<I;D+=i)(g=r[D])<s&&(s=g),(x=r[D+1])<c&&(c=x),g>d&&(d=g),x>f&&(f=x);v=(v=Math.max(d-s,f-c))!==0?1/v:0}return Xu(A,k,i,s,c,v),k}function hx(r,e,i,s,c){var d,f;if(c===a_(r,e,i,s)>0)for(d=e;d<i;d+=s)f=fx(d,r[d],r[d+1],f);else for(d=i-s;d>=e;d-=s)f=fx(d,r[d],r[d+1],f);return f&&yp(f,f.next)&&(Yu(f),f=f.next),f}function Bs(r,e){if(!r)return r;e||(e=r);var i,s=r;do if(i=!1,s.steiner||!yp(s,s.next)&&Pr(s.prev,s,s.next)!==0)s=s.next;else{if(Yu(s),(s=e=s.prev)===s.next)break;i=!0}while(i||s!==e);return e}function Xu(r,e,i,s,c,d,f){if(r){!f&&d&&function(E,I,A,k){var D=E;do D.z===null&&(D.z=o_(D.x,D.y,I,A,k)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==E);D.prevZ.nextZ=null,D.prevZ=null,function(O){var $,H,ie,re,oe,le,ue,Ee,Ce=1;do{for(H=O,O=null,oe=null,le=0;H;){for(le++,ie=H,ue=0,$=0;$<Ce&&(ue++,ie=ie.nextZ);$++);for(Ee=Ce;ue>0||Ee>0&&ie;)ue!==0&&(Ee===0||!ie||H.z<=ie.z)?(re=H,H=H.nextZ,ue--):(re=ie,ie=ie.nextZ,Ee--),oe?oe.nextZ=re:O=re,re.prevZ=oe,oe=re;H=ie}oe.nextZ=null,Ce*=2}while(le>1)}(D)}(r,s,c,d);for(var g,x,v=r;r.prev!==r.next;)if(g=r.prev,x=r.next,d?TT(r,s,c,d):bT(r))e.push(g.i/i),e.push(r.i/i),e.push(x.i/i),Yu(r),r=x.next,v=x.next;else if((r=x)===v){f?f===1?Xu(r=ET(Bs(r),e,i),e,i,s,c,d,2):f===2&&ST(r,e,i,s,c,d):Xu(Bs(r),e,i,s,c,d,1);break}}}function bT(r){var e=r.prev,i=r,s=r.next;if(Pr(e,i,s)>=0)return!1;for(var c=r.next.next;c!==r.prev;){if(mc(e.x,e.y,i.x,i.y,s.x,s.y,c.x,c.y)&&Pr(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function TT(r,e,i,s){var c=r.prev,d=r,f=r.next;if(Pr(c,d,f)>=0)return!1;for(var g=c.x>d.x?c.x>f.x?c.x:f.x:d.x>f.x?d.x:f.x,x=c.y>d.y?c.y>f.y?c.y:f.y:d.y>f.y?d.y:f.y,v=o_(c.x<d.x?c.x<f.x?c.x:f.x:d.x<f.x?d.x:f.x,c.y<d.y?c.y<f.y?c.y:f.y:d.y<f.y?d.y:f.y,e,i,s),E=o_(g,x,e,i,s),I=r.prevZ,A=r.nextZ;I&&I.z>=v&&A&&A.z<=E;){if(I!==r.prev&&I!==r.next&&mc(c.x,c.y,d.x,d.y,f.x,f.y,I.x,I.y)&&Pr(I.prev,I,I.next)>=0||(I=I.prevZ,A!==r.prev&&A!==r.next&&mc(c.x,c.y,d.x,d.y,f.x,f.y,A.x,A.y)&&Pr(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;I&&I.z>=v;){if(I!==r.prev&&I!==r.next&&mc(c.x,c.y,d.x,d.y,f.x,f.y,I.x,I.y)&&Pr(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;A&&A.z<=E;){if(A!==r.prev&&A!==r.next&&mc(c.x,c.y,d.x,d.y,f.x,f.y,A.x,A.y)&&Pr(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function ET(r,e,i){var s=r;do{var c=s.prev,d=s.next.next;!yp(c,d)&&dx(c,s,s.next,d)&&Hu(c,d)&&Hu(d,c)&&(e.push(c.i/i),e.push(s.i/i),e.push(d.i/i),Yu(s),Yu(s.next),s=r=d),s=s.next}while(s!==r);return Bs(s)}function ST(r,e,i,s,c,d){var f=r;do{for(var g=f.next.next;g!==f.prev;){if(f.i!==g.i&&kT(f,g)){var x=px(f,g);return f=Bs(f,f.next),x=Bs(x,x.next),Xu(f,e,i,s,c,d),void Xu(x,e,i,s,c,d)}g=g.next}f=f.next}while(f!==r)}function CT(r,e){return r.x-e.x}function IT(r,e){var i=function(d,f){var g,x=f,v=d.x,E=d.y,I=-1/0;do{if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){var A=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(A<=v&&A>I){if(I=A,A===v){if(E===x.y)return x;if(E===x.next.y)return x.next}g=x.x<x.next.x?x:x.next}}x=x.next}while(x!==f);if(!g)return null;if(v===I)return g;var k,D=g,O=g.x,$=g.y,H=1/0;x=g;do v>=x.x&&x.x>=O&&v!==x.x&&mc(E<$?v:I,E,O,$,E<$?I:v,E,x.x,x.y)&&(k=Math.abs(E-x.y)/(v-x.x),Hu(x,d)&&(k<H||k===H&&(x.x>g.x||x.x===g.x&&AT(g,x)))&&(g=x,H=k)),x=x.next;while(x!==D);return g}(r,e);if(!i)return e;var s=px(i,r),c=Bs(i,i.next);return Bs(s,s.next),e===i?c:e}function AT(r,e){return Pr(r.prev,r,e.prev)<0&&Pr(e.next,r,r.next)<0}function o_(r,e,i,s,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-i)*c)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function MT(r){var e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function mc(r,e,i,s,c,d,f,g){return(c-f)*(e-g)-(r-f)*(d-g)>=0&&(r-f)*(s-g)-(i-f)*(e-g)>=0&&(i-f)*(d-g)-(c-f)*(s-g)>=0}function kT(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,s){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==s.i&&c.next.i!==s.i&&dx(c,c.next,i,s))return!0;c=c.next}while(c!==i);return!1}(r,e)&&(Hu(r,e)&&Hu(e,r)&&function(i,s){var c=i,d=!1,f=(i.x+s.x)/2,g=(i.y+s.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&f<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==i);return d}(r,e)&&(Pr(r.prev,r,e.prev)||Pr(r,e.prev,e))||yp(r,e)&&Pr(r.prev,r,r.next)>0&&Pr(e.prev,e,e.next)>0)}function Pr(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function yp(r,e){return r.x===e.x&&r.y===e.y}function dx(r,e,i,s){var c=vp(Pr(r,e,i)),d=vp(Pr(r,e,s)),f=vp(Pr(i,s,r)),g=vp(Pr(i,s,e));return c!==d&&f!==g||!(c!==0||!xp(r,i,e))||!(d!==0||!xp(r,s,e))||!(f!==0||!xp(i,r,s))||!(g!==0||!xp(i,e,s))}function xp(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function vp(r){return r>0?1:r<0?-1:0}function Hu(r,e){return Pr(r.prev,r,r.next)<0?Pr(r,e,r.next)>=0&&Pr(r,r.prev,e)>=0:Pr(r,e,r.prev)<0||Pr(r,r.next,e)<0}function px(r,e){var i=new s_(r.i,r.x,r.y),s=new s_(e.i,e.x,e.y),c=r.next,d=e.prev;return r.next=e,e.prev=r,i.next=c,c.prev=i,s.next=i,i.prev=s,d.next=s,s.prev=d,s}function fx(r,e,i,s){var c=new s_(r,e,i);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function Yu(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function s_(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function a_(r,e,i,s){for(var c=0,d=e,f=i-s;d<i;d+=s)c+=(r[f]-r[d])*(r[d+1]+r[f+1]),f=d;return c}function zT(r,e,i,s,c){mx(r,e,i||0,s||r.length-1,c||PT)}function mx(r,e,i,s,c){for(;s>i;){if(s-i>600){var d=s-i+1,f=e-i+1,g=Math.log(d),x=.5*Math.exp(2*g/3),v=.5*Math.sqrt(g*x*(d-x)/d)*(f-d/2<0?-1:1);mx(r,e,Math.max(i,Math.floor(e-f*x/d+v)),Math.min(s,Math.floor(e+(d-f)*x/d+v)),c)}var E=r[e],I=i,A=s;for(Ku(r,i,e),c(r[s],E)>0&&Ku(r,i,s);I<A;){for(Ku(r,I,A),I++,A--;c(r[I],E)<0;)I++;for(;c(r[A],E)>0;)A--}c(r[i],E)===0?Ku(r,i,A):Ku(r,++A,s),A<=e&&(i=A+1),e<=A&&(s=A-1)}}function Ku(r,e,i){var s=r[e];r[e]=r[i],r[i]=s}function PT(r,e){return r<e?-1:r>e?1:0}function l_(r,e){const i=r.length;if(i<=1)return[r];const s=[];let c,d;for(let f=0;f<i;f++){const g=Zr(r[f]);g!==0&&(r[f].area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(c&&s.push(c),c=[r[f]]):c.push(r[f]))}if(c&&s.push(c),e>1)for(let f=0;f<s.length;f++)s[f].length<=e||(zT(s[f],e,1,s[f].length-1,DT),s[f]=s[f].slice(0,e));return s}function DT(r,e){return e.area-r.area}function c_(r,e,i){const s=i.patternDependencies;let c=!1;for(const d of e){const f=d.paint.get(`${r}-pattern`);f.isConstant()||(c=!0);const g=f.constantOr(null);g&&(c=!0,s[g.to]=!0,s[g.from]=!0)}return c}function u_(r,e,i,s,c){const d=c.patternDependencies;for(const f of e){const g=f.paint.get(`${r}-pattern`).value;if(g.kind!=="constant"){let x=g.evaluate({zoom:s-1},i,{},c.availableImages),v=g.evaluate({zoom:s},i,{},c.availableImages),E=g.evaluate({zoom:s+1},i,{},c.availableImages);x=x&&x.name?x.name:x,v=v&&v.name?v.name:v,E=E&&E.name?E.name:E,d[x]=!0,d[v]=!0,d[E]=!0,i.patterns[f.id]={min:x,mid:v,max:E}}}return i}gp.deviation=function(r,e,i,s){var c=e&&e.length,d=Math.abs(a_(r,0,c?e[0]*i:r.length,i));if(c)for(var f=0,g=e.length;f<g;f++)d-=Math.abs(a_(r,e[f]*i,f<g-1?e[f+1]*i:r.length,i));var x=0;for(f=0;f<s.length;f+=3){var v=s[f]*i,E=s[f+1]*i,I=s[f+2]*i;x+=Math.abs((r[v]-r[I])*(r[E+1]-r[v+1])-(r[v]-r[E])*(r[I+1]-r[v+1]))}return d===0&&x===0?0:Math.abs((x-d)/d)},gp.flatten=function(r){for(var e=r[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,c=0;c<r.length;c++){for(var d=0;d<r[c].length;d++)for(var f=0;f<e;f++)i.vertices.push(r[c][d][f]);c>0&&i.holes.push(s+=r[c-1].length)}return i},_p.default=wT;class wp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ut,this.indexArray=new Ot,this.indexArray2=new zr,this.programConfigurations=new Za(e.layers,e.zoom),this.segments=new Sr,this.segments2=new Sr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,s,c){this.hasPattern=c_("fill",this.layers,i);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:g,id:x,index:v,sourceLayerIndex:E}of e){const I=this.layers[0]._featureFilter.needGeometry,A=Xa(g,I);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),A,s))continue;const k=d?d.evaluate(A,{},s,i.availableImages):void 0,D={id:x,properties:g.properties,type:g.type,sourceLayerIndex:E,index:v,geometry:I?A.geometry:Zo(g,s,c),patterns:{},sortKey:k};f.push(D)}d&&f.sort((g,x)=>g.sortKey-x.sortKey);for(const g of f){const{geometry:x,index:v,sourceLayerIndex:E}=g;if(this.hasPattern){const I=u_("fill",this.layers,g,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(g,x,v,s,{},i.availableImages);i.featureIndex.insert(e[v].feature,x,v,E,this.index)}}update(e,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,c)}addFeatures(e,i,s,c,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,c,d,f=[]){for(const g of l_(i,500)){let x=0;for(const D of g)x+=D.length;const v=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),E=v.vertexLength,I=[],A=[];for(const D of g){if(D.length===0)continue;D!==g[0]&&A.push(I.length/2);const O=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),$=O.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack($+D.length-1,$),I.push(D[0].x),I.push(D[0].y);for(let H=1;H<D.length;H++)this.layoutVertexArray.emplaceBack(D[H].x,D[H].y),this.indexArray2.emplaceBack($+H-1,$+H),I.push(D[H].x),I.push(D[H].y);O.vertexLength+=D.length,O.primitiveLength+=D.length}const k=_p(I,A);for(let D=0;D<k.length;D+=3)this.indexArray.emplaceBack(E+k[D],E+k[D+1],E+k[D+2]);v.vertexLength+=x,v.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c)}}tt(wp,"FillBucket",{omit:["layers","patternFeatures"]});const LT=new Ie({"fill-sort-key":new ee(fe.layout_fill["fill-sort-key"])});var RT={paint:new Ie({"fill-antialias":new ve(fe.paint_fill["fill-antialias"]),"fill-opacity":new ee(fe.paint_fill["fill-opacity"]),"fill-color":new ee(fe.paint_fill["fill-color"]),"fill-outline-color":new ee(fe.paint_fill["fill-outline-color"]),"fill-translate":new ve(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new ve(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new De(fe.paint_fill["fill-pattern"])}),layout:LT};const BT=$e([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),OT=$e([{name:"a_centroid_pos",components:2,type:"Uint16"}]),FT=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:UT}=BT;var _x=_c;function _c(r,e,i,s,c){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=s,this._values=c,r.readFields(NT,this,e)}function NT(r,e,i){r==1?e.id=i.readVarint():r==2?function(s,c){for(var d=s.readVarint()+s.pos;s.pos<d;){var f=c._keys[s.readVarint()],g=c._values[s.readVarint()];c.properties[f]=g}}(i,e):r==3?e.type=i.readVarint():r==4&&(e._geometry=i.pos)}function VT(r){for(var e,i,s=0,c=0,d=r.length,f=d-1;c<d;f=c++)s+=((i=r[f]).x-(e=r[c]).x)*(e.y+i.y);return s}_c.types=["Unknown","Point","LineString","Polygon"],_c.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,i=r.readVarint()+r.pos,s=1,c=0,d=0,f=0,g=[];r.pos<i;){if(c<=0){var x=r.readVarint();s=7&x,c=x>>3}if(c--,s===1||s===2)d+=r.readSVarint(),f+=r.readSVarint(),s===1&&(e&&g.push(e),e=[]),e.push(new ne(d,f));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&g.push(e),g},_c.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,i=1,s=0,c=0,d=0,f=1/0,g=-1/0,x=1/0,v=-1/0;r.pos<e;){if(s<=0){var E=r.readVarint();i=7&E,s=E>>3}if(s--,i===1||i===2)(c+=r.readSVarint())<f&&(f=c),c>g&&(g=c),(d+=r.readSVarint())<x&&(x=d),d>v&&(v=d);else if(i!==7)throw new Error("unknown command "+i)}return[f,x,g,v]},_c.prototype.toGeoJSON=function(r,e,i){var s,c,d=this.extent*Math.pow(2,i),f=this.extent*r,g=this.extent*e,x=this.loadGeometry(),v=_c.types[this.type];function E(k){for(var D=0;D<k.length;D++){var O=k[D];k[D]=[360*(O.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+g)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(s=0;s<x.length;s++)I[s]=x[s][0];E(x=I);break;case 2:for(s=0;s<x.length;s++)E(x[s]);break;case 3:for(x=function(k){var D=k.length;if(D<=1)return[k];for(var O,$,H=[],ie=0;ie<D;ie++){var re=VT(k[ie]);re!==0&&($===void 0&&($=re<0),$===re<0?(O&&H.push(O),O=[k[ie]]):O.push(k[ie]))}return O&&H.push(O),H}(x),s=0;s<x.length;s++)for(c=0;c<x[s].length;c++)E(x[s][c])}x.length===1?x=x[0]:v="Multi"+v;var A={type:"Feature",geometry:{type:v,coordinates:x},properties:this.properties};return"id"in this&&(A.id=this.id),A};var gx=yx;function yx(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(jT,this,e),this.length=this._features.length}function jT(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(s){for(var c=null,d=s.readVarint()+s.pos;s.pos<d;){var f=s.readVarint()>>3;c=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}return c}(i))}function GT(r,e,i){if(r===3){var s=new gx(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}yx.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new _x(this._pbf,e,this.extent,this._keys,this._values)};var Ja={VectorTile:function(r,e){this.layers=r.readFields(GT,{},e)},VectorTileFeature:_x,VectorTileLayer:gx};function bp(r,e,i,s){const c=[],d=s===0?(f,g,x,v,E,I)=>{f.push(new ne(I,x+(I-g)/(v-g)*(E-x)))}:(f,g,x,v,E,I)=>{f.push(new ne(g+(I-x)/(E-x)*(v-g),I))};for(const f of r){const g=[];for(const x of f){if(x.length<=2)continue;const v=[];for(let A=0;A<x.length-1;A++){const k=x[A].x,D=x[A].y,O=x[A+1].x,$=x[A+1].y,H=s===0?k:D,ie=s===0?O:$;H<e?ie>e&&d(v,k,D,O,$,e):H>i?ie<i&&d(v,k,D,O,$,i):v.push(x[A]),ie<e&&H>=e&&d(v,k,D,O,$,e),ie>i&&H<=i&&d(v,k,D,O,$,i)}let E=x[x.length-1];const I=s===0?E.x:E.y;I>=e&&I<=i&&v.push(E),v.length&&(E=v[v.length-1],v[0].x===E.x&&v[0].y===E.y||v.push(v[0]),g.push(v))}g.length&&c.push(g)}return c}const $T=Ja.VectorTileFeature.types,ZT=Math.pow(2,13);function Ju(r,e,i,s,c,d,f,g){r.emplaceBack((e<<1)+f,(i<<1)+d,(Math.floor(s*ZT)<<1)+c,Math.round(g))}function Qu(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class xx{constructor(){this.acc=new ne(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ne(e.x,e.y),this.max=new ne(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,c=this.max;e.x<s.x?s.x=e.x:e.x>c.x&&(c.x=e.x),e.y<s.y?s.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===_t)&&e.x===i.x)!=((e.y===0||e.y===_t)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,Ut(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>_t!=e.x>_t&&this.addBorderIntersection(1,Ut(i.y,e.y,(_t-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ut(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>_t!=e.y>_t&&this.addBorderIntersection(3,Ut(i.x,e.x,(_t-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((i,s)=>i+s.edges,0);return e!==0?this.acc.div(e)._round():new ne(0,0)}span(){return new ne(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class eh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ot,this.centroidVertexArray=new z0,this.indexArray=new Ot,this.programConfigurations=new Za(e.layers,e.zoom),this.segments=new Sr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,s,c){this.features=[],this.hasPattern=c_("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){const f=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*f/(f*f+1)/_t/(1<<d.z)}(s);for(const{feature:d,id:f,index:g,sourceLayerIndex:x}of e){const v=this.layers[0]._featureFilter.needGeometry,E=Xa(d,v);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),E,s))continue;const I={id:f,sourceLayerIndex:x,index:g,geometry:v?E.geometry:Zo(d,s,c),properties:d.properties,type:d.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(u_("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,g,s,{},i.availableImages,c),i.featureIndex.insert(d,I.geometry,g,x,this.index,A)}this.sortBorders()}addFeatures(e,i,s,c,d){for(const f of this.features){const{geometry:g}=f;this.addFeature(f,g,f.index,i,s,c,d)}this.sortBorders()}update(e,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,FT.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,OT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,c,d,f,g){const x=[new ne(0,0),new ne(_t,_t)],v=g.projection,E=v.name==="globe",I=this.enableTerrain&&!E?new xx:null;E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new v0);const A=l_(i,500);for(let O=A.length-1;O>=0;O--){const $=A[O];($.length===0||(k=$[0]).every(H=>H.x<=0)||k.every(H=>H.x>=_t)||k.every(H=>H.y<=0)||k.every(H=>H.y>=_t))&&A.splice(O,1)}var k;let D;if(E)D=wx(A,x,c);else{D=[];for(const O of A)D.push({polygon:O,bounds:x})}for(const O of D){const $=O.polygon;let H=0,ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Ee=0;Ee<$.length;Ee++){const Ce=$[Ee];if(Ce.length===0)continue;H+=Ce.length;let ke=0;I&&I.startRing(Ce[0]);for(let Oe=0;Oe<Ce.length;Oe++){const xe=Ce[Oe];if(Oe>=1){const Ae=Ce[Oe-1];if(!qT(xe,Ae,O.bounds)){I&&I.append(xe,Ae),ie.vertexLength+4>Sr.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ue=xe.sub(Ae)._perp(),Ne=Ue.x/(Math.abs(Ue.x)+Math.abs(Ue.y)),Je=Ue.y>0?1:0,Re=Ae.dist(xe);ke+Re>32768&&(ke=0),Ju(this.layoutVertexArray,xe.x,xe.y,Ne,Je,0,0,ke),Ju(this.layoutVertexArray,xe.x,xe.y,Ne,Je,0,1,ke),ke+=Re,Ju(this.layoutVertexArray,Ae.x,Ae.y,Ne,Je,0,0,ke),Ju(this.layoutVertexArray,Ae.x,Ae.y,Ne,Je,0,1,ke);const He=ie.vertexLength;if(this.indexArray.emplaceBack(He,He+2,He+1),this.indexArray.emplaceBack(He+1,He+2,He+3),ie.vertexLength+=4,ie.primitiveLength+=2,E){const Tt=this.layoutVertexExtArray,Mt=v.projectTilePoint(xe.x,xe.y,c),ct=v.projectTilePoint(Ae.x,Ae.y,c),rt=v.upVector(c,xe.x,xe.y),Pt=v.upVector(c,Ae.x,Ae.y);Qu(Tt,Mt,rt),Qu(Tt,Mt,rt),Qu(Tt,ct,Pt),Qu(Tt,ct,Pt)}}}}}if(ie.vertexLength+H>Sr.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(H,this.layoutVertexArray,this.indexArray)),$T[e.type]!=="Polygon")continue;const re=[],oe=[],le=ie.vertexLength;for(let Ee=0;Ee<$.length;Ee++){const Ce=$[Ee];if(Ce.length!==0){Ce!==$[0]&&oe.push(re.length/2);for(let ke=0;ke<Ce.length;ke++){const Oe=Ce[ke];Ju(this.layoutVertexArray,Oe.x,Oe.y,0,0,1,1,0),re.push(Oe.x),re.push(Oe.y),I&&I.currentPolyCount.top++,E&&Qu(this.layoutVertexExtArray,v.projectTilePoint(Oe.x,Oe.y,c),v.upVector(c,Oe.x,Oe.y))}}}const ue=_p(re,oe);for(let Ee=0;Ee<ue.length;Ee+=3)this.indexArray.emplaceBack(le+ue[Ee],le+ue[Ee+2],le+ue[Ee+1]);ie.primitiveLength+=ue.length/3,ie.vertexLength+=H}if(I&&I.polyCount.length>0){if(I.borders){I.vertexArrayOffset=this.centroidVertexArray.length;const O=I.borders,$=this.featuresOnBorder.push(I)-1;for(let H=0;H<4;H++)O[H][0]!==Number.MAX_VALUE&&this.borders[H].push($)}this.encodeCentroid(I.borders?void 0:I.centroid(),I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,i,s=!0){let c,d;if(e)if(e.y!==0){const g=i.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else c=Math.ceil(7*(e.x+450)),d=0;else c=0,d=+s;let f=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const g of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let x=0;x<2*g.edges;x++)this.centroidVertexArray.emplace(f++,0,d),this.centroidVertexArray.emplace(f++,c,d);for(let x=0;x<g.top;x++)this.centroidVertexArray.emplace(f++,c,d)}}}function qT(r,e,i){return r.x===e.x&&(r.x<i[0].x||r.x>i[1].x)||r.y===e.y&&(r.y<i[0].y||r.y>i[1].y)}function vx(){const r=Math.PI/32,e=Math.tan(r),i=Gm;return i*Math.sqrt(1+2*e*e)-i}function wx(r,e,i){const s=1<<i.z,c=gi(i.x/s),d=gi((i.x+1)/s),f=Or(i.y/s),g=Or((i.y+1)/s);return function(x,v,E,I,A=0,k){const D=[];if(!x.length||!E||!I)return D;const O=(ue,Ee)=>{for(const Ce of ue)D.push({polygon:Ce,bounds:Ee})},$=Math.ceil(Math.log2(E)),H=Math.ceil(Math.log2(I)),ie=$-H,re=[];for(let ue=0;ue<Math.abs(ie);ue++)re.push(ie>0?0:1);for(let ue=0;ue<Math.min($,H);ue++)re.push(0),re.push(1);let oe=x;if(oe=bp(oe,v[0].y-A,v[1].y+A,1),oe=bp(oe,v[0].x-A,v[1].x+A,0),!oe.length)return D;const le=[];for(re.length?le.push({polygons:oe,bounds:v,depth:0}):O(oe,v);le.length;){const ue=le.pop(),Ee=ue.depth,Ce=re[Ee],ke=ue.bounds[0],Oe=ue.bounds[1],xe=Ce===0?ke.x:ke.y,Ae=Ce===0?Oe.x:Oe.y,Ue=k?k(Ce,xe,Ae):.5*(xe+Ae),Ne=bp(ue.polygons,xe-A,Ue+A,Ce),Je=bp(ue.polygons,Ue-A,Ae+A,Ce);if(Ne.length){const Re=[ke,new ne(Ce===0?Ue:Oe.x,Ce===1?Ue:Oe.y)];re.length>Ee+1?le.push({polygons:Ne,bounds:Re,depth:Ee+1}):O(Ne,Re)}if(Je.length){const Re=[new ne(Ce===0?Ue:ke.x,Ce===1?Ue:ke.y),Oe];re.length>Ee+1?le.push({polygons:Je,bounds:Re,depth:Ee+1}):O(Je,Re)}}return D}(r,e,Math.ceil((d-c)/11.25),Math.ceil((f-g)/11.25),1,(x,v,E)=>{if(x===0)return .5*(v+E);{const I=Or((i.y+v/_t)/s);return(Wa(.5*(Or((i.y+E/_t)/s)+I))*s-i.y)*_t}})}tt(eh,"FillExtrusionBucket",{omit:["layers","features"]}),tt(xx,"PartMetadata");var WT={paint:new Ie({"fill-extrusion-opacity":new ve(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ee(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ve(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ve(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new De(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ee(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ee(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ve(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function bx(r,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[r*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Tp{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=th(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=function(d,f,g){var x=bx(256*d,256*(f=Math.pow(2,g)-f-1),g),v=bx(256*(d+1),256*(f+1),g);return x[0]+","+x[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),c=function(d,f,g){let x,v="";for(let E=d;E>0;E--)x=1<<E-1,v+=(f&x?1:0)+(g&x?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tx{constructor(e,i){this.wrap=e,this.canonical=i,this.key=th(e,i.z,i.z,i.x,i.y)}}class xi{constructor(e,i,s,c,d){this.overscaledZ=e,this.wrap=i,this.canonical=new Tp(s,+c,+d),this.key=i===0&&e===s?this.canonical.key:th(i,e,s,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new xi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return th(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return th(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new xi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new xi(i,this.wrap,i,s,c),new xi(i,this.wrap,i,s+1,c),new xi(i,this.wrap,i,s,c+1),new xi(i,this.wrap,i,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new xi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new xi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function th(r,e,i,s,c){const d=1<<Math.min(i,22);let f=d*(c%d)+s%d;return r&&i<22&&(f+=d*d*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}function rh(r,e){return r.x*e.x+r.y*e.y}function Ex(r,e){if(r.length===1){let i=0;const s=e[i++];let c;for(;!c||s.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const d=e[i],f=r[0],g=c.sub(s),x=d.sub(s),v=f.sub(s),E=rh(g,g),I=rh(g,x),A=rh(x,x),k=rh(v,g),D=rh(v,x),O=E*A-I*I,$=(A*k-I*D)/O,H=(E*D-I*k)/O,ie=s.z*(1-$-H)+c.z*$+d.z*H;if(isFinite(ie))return ie}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function Ep(r){const e=new ne(r[0],r[1]);return e.z=r[2],e}function Sx(r,e,i,s,c,d,f,g){const x=f*c.getElevationAt(r,e,!0,!0),v=d[0]!==0,E=v?d[1]===0?f*(d[0]/7-450):f*function(I,A,k){const D=Math.floor(A[0]/8),O=Math.floor(A[1]/8),$=10*(A[0]-8*D),H=10*(A[1]-8*O),ie=I.getElevationAt(D,O,!0,!0),re=I.getMeterToDEM(k),oe=Math.floor(.5*($*re-1)),le=Math.floor(.5*(H*re-1)),ue=I.tileCoordToPixel(D,O),Ee=2*oe+1,Ce=2*le+1,ke=function(Je,Re,He,Tt,Mt){return[Je.getElevationAtPixel(Re,He,!0),Je.getElevationAtPixel(Re+Mt,He,!0),Je.getElevationAtPixel(Re,He+Mt,!0),Je.getElevationAtPixel(Re+Tt,He+Mt,!0)]}(I,ue.x-oe,ue.y-le,Ee,Ce),Oe=Math.abs(ke[0]-ke[1]),xe=Math.abs(ke[2]-ke[3]),Ae=Math.abs(ke[0]-ke[2])+Math.abs(ke[1]-ke[3]),Ue=Math.min(.25,.5*re*(Oe+xe)/Ee),Ne=Math.min(.25,.5*re*Ae/Ce);return ie+Math.max(Ue*$,Ne*H)}(c,d,g):x;return{base:x+(i===0)?-1:i,top:v?Math.max(E+s,x+i+2):x+s}}tt(Tp,"CanonicalTileID"),tt(xi,"OverscaledTileID",{omit:["projMatrix"]});const XT=$e([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:HT}=XT,YT=$e([{name:"a_packed",components:4,type:"Float32"}]),{members:KT}=YT,JT=Ja.VectorTileFeature.types,QT=Math.cos(Math.PI/180*37.5);class Sp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new bt,this.layoutVertexArray2=new $t,this.indexArray=new Ot,this.programConfigurations=new Za(e.layers,e.zoom),this.segments=new Sr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,c){this.hasPattern=c_("line",this.layers,i);const d=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:E,id:I,index:A,sourceLayerIndex:k}of e){const D=this.layers[0]._featureFilter.needGeometry,O=Xa(E,D);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),O,s))continue;const $=d?d.evaluate(O,{},s):void 0,H={id:I,properties:E.properties,type:E.type,sourceLayerIndex:k,index:A,geometry:D?O.geometry:Zo(E,s,c),patterns:{},sortKey:$};f.push(H)}d&&f.sort((E,I)=>E.sortKey-I.sortKey);const{lineAtlas:g,featureIndex:x}=i,v=this.addConstantDashes(g);for(const E of f){const{geometry:I,index:A,sourceLayerIndex:k}=E;if(v&&this.addFeatureDashes(E,g),this.hasPattern){const D=u_("line",this.layers,E,this.zoom,i);this.patternFeatures.push(D)}else this.addFeature(E,I,A,s,g.positions,i.availableImages);x.insert(e[A].feature,I,A,k,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")i=!0;else{const f=d.value,g=c.value;if(!g)continue;e.addDash(g.from,f),e.addDash(g.to,f),g.other&&e.addDash(g.other,f)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let g,x,v,E,I,A;if(d.kind==="constant"){const $=d.value;if(!$)continue;g=$.other||$.to,x=$.to,v=$.from}else g=d.evaluate({zoom:s-1},e),x=d.evaluate({zoom:s},e),v=d.evaluate({zoom:s+1},e);f.kind==="constant"?E=I=A=f.value:(E=f.evaluate({zoom:s-1},e),I=f.evaluate({zoom:s},e),A=f.evaluate({zoom:s+1},e)),i.addDash(g,E),i.addDash(x,I),i.addDash(v,A);const k=i.getKey(g,E),D=i.getKey(x,I),O=i.getKey(v,A);e.patterns[c.id]={min:k,mid:D,max:O}}}update(e,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,c)}addFeatures(e,i,s,c,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,KT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,HT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,c,d,f){const g=this.layers[0].layout,x=g.get("line-join").evaluate(e,{}),v=g.get("line-cap").evaluate(e,{}),E=g.get("line-miter-limit"),I=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of i)this.addLine(A,e,x,v,E,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c)}addLine(e,i,s,c,d,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<e.length-1;H++)this.totalDistance+=e[H].dist(e[H+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=JT[i.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let v=0;for(;v<x-1&&e[v].equals(e[v+1]);)v++;if(x<(g?3:2))return;s==="bevel"&&(d=1.05);const E=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let A,k,D,O,$;this.e1=this.e2=-1,g&&(A=e[x-2],$=e[v].sub(A)._unit()._perp());for(let H=v;H<x;H++){if(D=H===x-1?g?e[v+1]:void 0:e[H+1],D&&e[H].equals(D))continue;$&&(O=$),A&&(k=A),A=e[H],$=D?D.sub(A)._unit()._perp():O,O=O||$;let ie=O.add($);ie.x===0&&ie.y===0||ie._unit();const re=O.x*$.x+O.y*$.y,oe=ie.x*$.x+ie.y*$.y,le=oe!==0?1/oe:1/0,ue=2*Math.sqrt(2-2*oe),Ee=oe<QT&&k&&D,Ce=O.x*$.y-O.y*$.x>0;if(Ee&&H>v){const xe=A.dist(k);if(xe>2*E){const Ae=A.sub(A.sub(k)._mult(E/xe)._round());this.updateDistance(k,Ae),this.addCurrentVertex(Ae,O,0,0,I),k=Ae}}const ke=k&&D;let Oe=ke?s:g?"butt":c;if(ke&&Oe==="round"&&(le<f?Oe="miter":le<=2&&(Oe="fakeround")),Oe==="miter"&&le>d&&(Oe="bevel"),Oe==="bevel"&&(le>2&&(Oe="flipbevel"),le<d&&(Oe="miter")),k&&this.updateDistance(k,A),Oe==="miter")ie._mult(le),this.addCurrentVertex(A,ie,0,0,I);else if(Oe==="flipbevel"){if(le>100)ie=$.mult(-1);else{const xe=le*O.add($).mag()/O.sub($).mag();ie._perp()._mult(xe*(Ce?-1:1))}this.addCurrentVertex(A,ie,0,0,I),this.addCurrentVertex(A,ie.mult(-1),0,0,I)}else if(Oe==="bevel"||Oe==="fakeround"){const xe=-Math.sqrt(le*le-1),Ae=Ce?xe:0,Ue=Ce?0:xe;if(k&&this.addCurrentVertex(A,O,Ae,Ue,I),Oe==="fakeround"){const Ne=Math.round(180*ue/Math.PI/20);for(let Je=1;Je<Ne;Je++){let Re=Je/Ne;if(Re!==.5){const Tt=Re-.5;Re+=Re*Tt*(Re-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*Tt*Tt+(.848013+re*(.215638*re-1.06021)))}const He=$.sub(O)._mult(Re)._add(O)._unit()._mult(Ce?-1:1);this.addHalfVertex(A,He.x,He.y,!1,Ce,0,I)}}D&&this.addCurrentVertex(A,$,-Ae,-Ue,I)}else if(Oe==="butt")this.addCurrentVertex(A,ie,0,0,I);else if(Oe==="square"){const xe=k?1:-1;k||this.addCurrentVertex(A,ie,xe,xe,I),this.addCurrentVertex(A,ie,0,0,I),k&&this.addCurrentVertex(A,ie,xe,xe,I)}else Oe==="round"&&(k&&(this.addCurrentVertex(A,O,0,0,I),this.addCurrentVertex(A,O,1,1,I,!0)),D&&(this.addCurrentVertex(A,$,-1,-1,I,!0),this.addCurrentVertex(A,$,0,0,I)));if(Ee&&H<x-1){const xe=A.dist(D);if(xe>2*E){const Ae=A.add(D.sub(A)._mult(E/xe)._round());this.updateDistance(A,Ae),this.addCurrentVertex(Ae,$,0,0,I),A=Ae}}}}addCurrentVertex(e,i,s,c,d,f=!1){const g=i.y*c-i.x,x=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,f,!1,s,d),this.addHalfVertex(e,g,x,f,!0,-c,d)}addHalfVertex({x:e,y:i},s,c,d,f,g,x){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),x.primitiveLength++),f?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}tt(Sp,"LineBucket",{omit:["layers","patternFeatures"]});const eE=new Ie({"line-cap":new ee(fe.layout_line["line-cap"]),"line-join":new ee(fe.layout_line["line-join"]),"line-miter-limit":new ve(fe.layout_line["line-miter-limit"]),"line-round-limit":new ve(fe.layout_line["line-round-limit"]),"line-sort-key":new ee(fe.layout_line["line-sort-key"])});var Cx={paint:new Ie({"line-opacity":new ee(fe.paint_line["line-opacity"]),"line-color":new ee(fe.paint_line["line-color"]),"line-translate":new ve(fe.paint_line["line-translate"]),"line-translate-anchor":new ve(fe.paint_line["line-translate-anchor"]),"line-width":new ee(fe.paint_line["line-width"]),"line-gap-width":new ee(fe.paint_line["line-gap-width"]),"line-offset":new ee(fe.paint_line["line-offset"]),"line-blur":new ee(fe.paint_line["line-blur"]),"line-dasharray":new De(fe.paint_line["line-dasharray"]),"line-pattern":new De(fe.paint_line["line-pattern"]),"line-gradient":new We(fe.paint_line["line-gradient"]),"line-trim-offset":new ve(fe.paint_line["line-trim-offset"])}),layout:eE};const Ix=new class extends ee{possiblyEvaluate(r,e){return e=new Z(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,i,s){return e=xt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,i,s)}}(Cx.paint.properties["line-width"].specification);function Ax(r,e){return e>0?e+2*r:r}Ix.useIntegerZoom=!0;const tE=$e([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rE=$e([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),iE=$e([{name:"a_projected_pos",components:4,type:"Float32"}],4);$e([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nE=$e([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),oE=$e([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Mx=$e([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sE=$e([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$e([{name:"triangle",components:3,type:"Uint16"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),$e([{type:"Float32",name:"offsetX"}]),$e([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ii=24;const po=128;function h_(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Z(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=i;let d=0;for(;d<s.length&&s[d]<=r;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<r+1;)f++;f=Math.min(s.length-1,f);const g=s[d],x=s[f];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:x,minSize:i.evaluate(new Z(g)),maxSize:i.evaluate(new Z(x)),interpolationType:c}}}function Cp(r,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:c}){return r.kind==="source"?s/po:r.kind==="composite"?Ut(s/po,c/po,i):e}function gc(r,e){let i=0,s=0;if(r.kind==="constant")s=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:f}=r,g=c?Fe(wn.interpolationFactor(c,e,d,f),0,1):0;r.kind==="camera"?s=Ut(r.minSize,r.maxSize,g):i=g}return{uSizeT:i,uSize:s}}var aE=Object.freeze({__proto__:null,getSizeData:h_,evaluateSizeForFeature:Cp,evaluateSizeForZoom:gc,SIZE_PACK_FACTOR:po});function lE(r,e,i){return r.sections.forEach(s=>{s.text=function(c,d,f){const g=d.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),V.applyArabicShaping&&(c=V.applyArabicShaping(c)),c}(s.text,e,i)}),r}const ih={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function cE(r){return r==="\uFE36"||r==="\uFE48"||r==="\uFE38"||r==="\uFE44"||r==="\uFE42"||r==="\uFE3E"||r==="\uFE3C"||r==="\uFE3A"||r==="\uFE18"||r==="\uFE40"||r==="\uFE10"||r==="\uFE13"||r==="\uFE14"||r==="\uFF40"||r==="\uFFE3"||r==="\uFE11"||r==="\uFE12"}function uE(r){return r==="\uFE35"||r==="\uFE47"||r==="\uFE37"||r==="\uFE43"||r==="\uFE41"||r==="\uFE3D"||r==="\uFE3B"||r==="\uFE39"||r==="\uFE17"||r==="\uFE3F"}var kx=function(r,e,i,s,c){var d,f,g=8*c-s-1,x=(1<<g)-1,v=x>>1,E=-7,I=i?c-1:0,A=i?-1:1,k=r[e+I];for(I+=A,d=k&(1<<-E)-1,k>>=-E,E+=g;E>0;d=256*d+r[e+I],I+=A,E-=8);for(f=d&(1<<-E)-1,d>>=-E,E+=s;E>0;f=256*f+r[e+I],I+=A,E-=8);if(d===0)d=1-v;else{if(d===x)return f?NaN:1/0*(k?-1:1);f+=Math.pow(2,s),d-=v}return(k?-1:1)*f*Math.pow(2,d-s)},zx=function(r,e,i,s,c,d){var f,g,x,v=8*d-c-1,E=(1<<v)-1,I=E>>1,A=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=s?0:d-1,D=s?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,f=E):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+I>=1?A/x:A*Math.pow(2,1-I))*x>=2&&(f++,x/=2),f+I>=E?(g=0,f=E):f+I>=1?(g=(e*x-1)*Math.pow(2,c),f+=I):(g=e*Math.pow(2,I-1)*Math.pow(2,c),f=0));c>=8;r[i+k]=255&g,k+=D,g/=256,c-=8);for(f=f<<c|g,v+=c;v>0;r[i+k]=255&f,k+=D,f/=256,v-=8);r[i+k-D]|=128*O},nh=rr;function rr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}rr.Varint=0,rr.Fixed64=1,rr.Bytes=2,rr.Fixed32=5;var d_=4294967296,Px=1/d_,Dx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Wo(r){return r.type===rr.Bytes?r.readVarint()+r.pos:r.pos+1}function yc(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Lx(r,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var c=i.pos-1;c>=r;c--)i.buf[c+s]=i.buf[c]}function hE(r,e){for(var i=0;i<r.length;i++)e.writeVarint(r[i])}function dE(r,e){for(var i=0;i<r.length;i++)e.writeSVarint(r[i])}function pE(r,e){for(var i=0;i<r.length;i++)e.writeFloat(r[i])}function fE(r,e){for(var i=0;i<r.length;i++)e.writeDouble(r[i])}function mE(r,e){for(var i=0;i<r.length;i++)e.writeBoolean(r[i])}function _E(r,e){for(var i=0;i<r.length;i++)e.writeFixed32(r[i])}function gE(r,e){for(var i=0;i<r.length;i++)e.writeSFixed32(r[i])}function yE(r,e){for(var i=0;i<r.length;i++)e.writeFixed64(r[i])}function xE(r,e){for(var i=0;i<r.length;i++)e.writeSFixed64(r[i])}function Ip(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function xc(r,e,i){r[i]=e,r[i+1]=e>>>8,r[i+2]=e>>>16,r[i+3]=e>>>24}function Rx(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function vE(r,e,i){e.glyphs=[],r===1&&i.readMessage(wE,e)}function wE(r,e,i){if(r===3){const{id:s,bitmap:c,width:d,height:f,left:g,top:x,advance:v}=i.readMessage(bE,{});e.glyphs.push({id:s,bitmap:new qo({width:d+6,height:f+6},c),metrics:{width:d,height:f,left:g,top:x,advance:v}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function bE(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}function p_(r){let e=0,i=0;for(const f of r)e+=f.w*f.h,i=Math.max(i,f.w);r.sort((f,g)=>g.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,d=0;for(const f of r)for(let g=s.length-1;g>=0;g--){const x=s[g];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===x.w&&f.h===x.h){const v=s.pop();g<s.length&&(s[g]=v)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(s.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}rr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),c=s>>3,d=this.pos;this.type=7&s,r(c,e,this),this.pos===d&&this.skip(s)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=Ip(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Rx(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Ip(this.buf,this.pos)+Ip(this.buf,this.pos+4)*d_;return this.pos+=8,r},readSFixed64:function(){var r=Ip(this.buf,this.pos)+Rx(this.buf,this.pos+4)*d_;return this.pos+=8,r},readFloat:function(){var r=kx(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=kx(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(c,d,f){var g,x,v=f.buf;if(g=(112&(x=v[f.pos++]))>>4,x<128||(g|=(127&(x=v[f.pos++]))<<3,x<128)||(g|=(127&(x=v[f.pos++]))<<10,x<128)||(g|=(127&(x=v[f.pos++]))<<17,x<128)||(g|=(127&(x=v[f.pos++]))<<24,x<128)||(g|=(1&(x=v[f.pos++]))<<31,x<128))return yc(c,g,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Dx?function(i,s,c){return Dx.decode(i.subarray(s,c))}(this.buf,e,r):function(i,s,c){for(var d="",f=s;f<c;){var g,x,v,E=i[f],I=null,A=E>239?4:E>223?3:E>191?2:1;if(f+A>c)break;A===1?E<128&&(I=E):A===2?(192&(g=i[f+1]))==128&&(I=(31&E)<<6|63&g)<=127&&(I=null):A===3?(x=i[f+2],(192&(g=i[f+1]))==128&&(192&x)==128&&((I=(15&E)<<12|(63&g)<<6|63&x)<=2047||I>=55296&&I<=57343)&&(I=null)):A===4&&(x=i[f+2],v=i[f+3],(192&(g=i[f+1]))==128&&(192&x)==128&&(192&v)==128&&((I=(15&E)<<18|(63&g)<<12|(63&x)<<6|63&v)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,A=1):I>65535&&(I-=65536,d+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),d+=String.fromCharCode(I),f+=A}return d}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==rr.Bytes)return r.push(this.readVarint(e));var i=Wo(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==rr.Bytes)return r.push(this.readSVarint());var e=Wo(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==rr.Bytes)return r.push(this.readBoolean());var e=Wo(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==rr.Bytes)return r.push(this.readFloat());var e=Wo(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==rr.Bytes)return r.push(this.readDouble());var e=Wo(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==rr.Bytes)return r.push(this.readFixed32());var e=Wo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==rr.Bytes)return r.push(this.readSFixed32());var e=Wo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==rr.Bytes)return r.push(this.readFixed64());var e=Wo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==rr.Bytes)return r.push(this.readSFixed64());var e=Wo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===rr.Varint)for(;this.buf[this.pos++]>127;);else if(e===rr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===rr.Fixed32)this.pos+=4;else{if(e!==rr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),xc(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),xc(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),xc(this.buf,-1&r,this.pos),xc(this.buf,Math.floor(r*Px),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),xc(this.buf,-1&r,this.pos),xc(this.buf,Math.floor(r*Px),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,i){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,f,g){g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,g.buf[g.pos]=127&(d>>>=7)}(s,0,i),function(d,f){var g=(7&d)<<4;f.buf[f.pos++]|=g|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(c,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(s,c,d){for(var f,g,x=0;x<c.length;x++){if((f=c.charCodeAt(x))>55295&&f<57344){if(!g){f>56319||x+1===c.length?(s[d++]=239,s[d++]=191,s[d++]=189):g=f;continue}if(f<56320){s[d++]=239,s[d++]=191,s[d++]=189,g=f;continue}f=g-55296<<10|f-56320|65536,g=null}else g&&(s[d++]=239,s[d++]=191,s[d++]=189,g=null);f<128?s[d++]=f:(f<2048?s[d++]=f>>6|192:(f<65536?s[d++]=f>>12|224:(s[d++]=f>>18|240,s[d++]=f>>12&63|128),s[d++]=f>>6&63|128),s[d++]=63&f|128)}return d}(this.buf,r,this.pos);var i=this.pos-e;i>=128&&Lx(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),zx(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),zx(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,e){this.pos++;var i=this.pos;r(e,this);var s=this.pos-i;s>=128&&Lx(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(r,e,i){this.writeTag(r,rr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,hE,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,dE,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,mE,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,pE,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,fE,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,_E,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,gE,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,yE,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,xE,e)},writeBytesField:function(r,e){this.writeTag(r,rr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,rr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,rr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,rr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,rr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,rr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,rr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,rr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,rr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,rr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class f_{constructor(e,{pixelRatio:i,version:s,stretchX:c,stretchY:d,content:f}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=d,this.content=f,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Bx{constructor(e,i){const s={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,d),this.addImages(i,c,d);const{w:f,h:g}=p_(d),x=new Hi({width:f||1,height:g||1});for(const v in e){const E=e[v],I=s[v].paddedRect;Hi.copy(E.data,x,{x:0,y:0},{x:I.x+1,y:I.y+1},E.data)}for(const v in i){const E=i[v],I=c[v].paddedRect,A=I.x+1,k=I.y+1,D=E.data.width,O=E.data.height;Hi.copy(E.data,x,{x:0,y:0},{x:A,y:k},E.data),Hi.copy(E.data,x,{x:0,y:O-1},{x:A,y:k-1},{width:D,height:1}),Hi.copy(E.data,x,{x:0,y:0},{x:A,y:k+O},{width:D,height:1}),Hi.copy(E.data,x,{x:D-1,y:0},{x:A-1,y:k},{width:1,height:O}),Hi.copy(E.data,x,{x:0,y:0},{x:A+D,y:k},{width:1,height:O})}this.image=x,this.iconPositions=s,this.patternPositions=c}addImages(e,i,s){for(const c in e){const d=e[c],f={x:0,y:0,w:d.data.width+2,h:d.data.height+2};s.push(f),i[c]=new f_(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,d]=e.tl;s.update(i.data,void 0,{x:c,y:d})}}tt(f_,"ImagePosition"),tt(Bx,"ImageAtlas");const hn={horizontal:1,vertical:2,horizontalOnly:3};class oh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new oh;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new oh;return i.imageName=e,i}}class vc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new vc;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?s.addImageSection(d):s.addTextSection(d,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,s){let c="";for(let d=0;d<i.length;d++){const f=i.charCodeAt(d+1)||null,g=i.charCodeAt(d-1)||null;c+=!s&&(f&&l(f)&&!ih[i[d+1]]||g&&l(g)&&!ih[i[d-1]])||!ih[i[d]]?i[d]:ih[i[d]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Ap[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Ap[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new vc;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(oh.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void zt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(oh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):zt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function m_(r,e,i,s,c,d,f,g,x,v,E,I,A,k,D,O){const $=vc.fromFeature(r,c);let H;I===hn.vertical&&$.verticalizePunctuation(A);const{processBidirectionalText:ie,processStyledBidirectionalText:re}=V;if(ie&&$.sections.length===1){H=[];const ue=ie($.toString(),__($,v,d,e,s,k,D));for(const Ee of ue){const Ce=new vc;Ce.text=Ee,Ce.sections=$.sections;for(let ke=0;ke<Ee.length;ke++)Ce.sectionIndex.push(0);H.push(Ce)}}else if(re){H=[];const ue=re($.text,$.sectionIndex,__($,v,d,e,s,k,D));for(const Ee of ue){const Ce=new vc;Ce.text=Ee[0],Ce.sectionIndex=Ee[1],Ce.sections=$.sections,H.push(Ce)}}else H=function(ue,Ee){const Ce=[],ke=ue.text;let Oe=0;for(const xe of Ee)Ce.push(ue.substring(Oe,xe)),Oe=xe;return Oe<ke.length&&Ce.push(ue.substring(Oe,ke.length)),Ce}($,__($,v,d,e,s,k,D));const oe=[],le={positionedLines:oe,text:$.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ue,Ee,Ce,ke,Oe,xe,Ae,Ue,Ne,Je,Re,He){let Tt=0,Mt=0,ct=0;const rt=Ue==="right"?1:Ue==="left"?0:.5;let Pt=!1;for(const Dt of Oe){const Vt=Dt.getSections();for(const ir of Vt){if(ir.imageName)continue;const tr=Ee[ir.fontStack];if(tr&&(Pt=tr.ascender!==void 0&&tr.descender!==void 0,!Pt))break}if(!Pt)break}let Ct=0;for(const Dt of Oe){Dt.trim();const Vt=Dt.getMaxScale(),ir=(Vt-1)*ii,tr={positionedGlyphs:[],lineOffset:0};ue.positionedLines[Ct]=tr;const Jt=tr.positionedGlyphs;let lr=0;if(!Dt.length()){Mt+=xe,++Ct;continue}let fr=0,Yr=0;for(let Rt=0;Rt<Dt.length();Rt++){const wr=Dt.getSection(Rt),ci=Dt.getSectionIndex(Rt),qt=Dt.getCharCode(Rt);let mr=wr.scale,wi=null,hr=null,Ir=null,Kr=ii,jr=0;const ni=!(Ne===hn.horizontal||!Re&&!t(qt)||Re&&(Ap[qt]||(nt=qt,Xd(nt)||Hd(nt)||ja(nt)||Uu(nt)||ju(nt))));if(wr.imageName){const bi=ke[wr.imageName];if(!bi)continue;Ir=wr.imageName,ue.iconsInText=ue.iconsInText||!0,hr=bi.paddedRect;const Jr=bi.displaySize;mr=mr*ii/He,wi={width:Jr[0],height:Jr[1],left:1,top:-3,advance:ni?Jr[1]:Jr[0],localGlyph:!1},jr=Pt?-wi.height*mr:Vt*ii-17-Jr[1]*mr,Kr=wi.advance;const Ho=(ni?Jr[0]:Jr[1])*mr-ii*Vt;Ho>0&&Ho>lr&&(lr=Ho)}else{const bi=Ce[wr.fontStack];if(!bi)continue;bi[qt]&&(hr=bi[qt]);const Jr=Ee[wr.fontStack];if(!Jr)continue;const Ho=Jr.glyphs[qt];if(!Ho)continue;if(wi=Ho.metrics,Kr=qt!==8203?ii:0,Pt){const Cc=Jr.ascender!==void 0?Math.abs(Jr.ascender):0,mh=Jr.descender!==void 0?Math.abs(Jr.descender):0,_h=(Cc+mh)*mr;fr<_h&&(fr=_h,Yr=(Cc-mh)/2*mr),jr=-Cc*mr}else jr=(Vt-mr)*ii-17}ni?(ue.verticalizable=!0,Jt.push({glyph:qt,imageName:Ir,x:Tt,y:Mt+jr,vertical:ni,scale:mr,localGlyph:wi.localGlyph,fontStack:wr.fontStack,sectionIndex:ci,metrics:wi,rect:hr}),Tt+=Kr*mr+Je):(Jt.push({glyph:qt,imageName:Ir,x:Tt,y:Mt+jr,vertical:ni,scale:mr,localGlyph:wi.localGlyph,fontStack:wr.fontStack,sectionIndex:ci,metrics:wi,rect:hr}),Tt+=wi.advance*mr+Je)}Jt.length!==0&&(ct=Math.max(Tt-Je,ct),Pt?Vx(Jt,rt,lr,Yr,xe*Vt/2):Vx(Jt,rt,lr,0,xe/2)),Tt=0;const Pi=xe*Vt+lr;tr.lineOffset=Math.max(lr,ir),Mt+=Pi,++Ct}var nt;const Fr=Mt,{horizontalAlign:Cr,verticalAlign:vr}=g_(Ae);(function(Dt,Vt,ir,tr,Jt,lr){const fr=(Vt-ir)*Jt,Yr=-lr*tr;for(const Pi of Dt)for(const Rt of Pi.positionedGlyphs)Rt.x+=fr,Rt.y+=Yr})(ue.positionedLines,rt,Cr,vr,ct,Fr),ue.top+=-vr*Fr,ue.bottom=ue.top+Fr,ue.left+=-Cr*ct,ue.right=ue.left+ct,ue.hasBaseline=Pt}(le,e,i,s,H,f,g,x,I,v,A,O),!function(ue){for(const Ee of ue)if(Ee.positionedGlyphs.length!==0)return!1;return!0}(oe)&&le}const Ap={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},TE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ox(r,e,i,s,c,d){if(e.imageName){const f=s[e.imageName];return f?f.displaySize[0]*e.scale*ii/d+c:0}{const f=i[e.fontStack],g=f&&f.glyphs[r];return g?g.metrics.advance*e.scale+c:0}}function Fx(r,e,i,s){const c=Math.pow(r-e,2);return s?r<e?c/2:2*c:c+Math.abs(i)*i}function EE(r,e,i){let s=0;return r===10&&(s-=1e4),i&&(s+=150),r!==40&&r!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Ux(r,e,i,s,c,d){let f=null,g=Fx(e,i,c,d);for(const x of s){const v=Fx(e-x.x,i,c,d)+x.badness;v<=g&&(f=x,g=v)}return{index:r,x:e,priorBreak:f,badness:g}}function Nx(r){return r?Nx(r.priorBreak).concat(r.index):[]}function __(r,e,i,s,c,d,f){if(d!=="point")return[];if(!r)return[];const g=[],x=function(A,k,D,O,$,H){let ie=0;for(let re=0;re<A.length();re++){const oe=A.getSection(re);ie+=Ox(A.getCharCode(re),oe,O,$,k,H)}return ie/Math.max(1,Math.ceil(ie/D))}(r,e,i,s,c,f),v=r.text.indexOf("\u200B")>=0;let E=0;for(let A=0;A<r.length();A++){const k=r.getSection(A),D=r.getCharCode(A);if(Ap[D]||(E+=Ox(D,k,s,c,e,f)),A<r.length()-1){const O=!((I=D)<11904||!(Ru(I)||Lu(I)||Nu(I)||tp(I)||ac(I)||Yd(I)||Bu(I)||ic(I)||Jd(I)||Fu(I)||sc(I)||Gu(I)||nc(I)||Ga(I)||Kd(I)||Ou(I)||oc(I)||rp(I)||lc(I)||Qd(I)));(TE[D]||O||k.imageName)&&g.push(Ux(A+1,E,x,g,EE(D,r.getCharCode(A+1),O&&v),!1))}}var I;return Nx(Ux(r.length(),E,x,g,0,!0))}function g_(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Vx(r,e,i,s,c){if(!(e||i||s||c))return;const d=r.length-1,f=r[d],g=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)r[x].x-=g,r[x].y+=i+s+c}function SE(r,e,i){const{horizontalAlign:s,verticalAlign:c}=g_(i),d=e[0]-r.displaySize[0]*s,f=e[1]-r.displaySize[1]*c;return{image:r,top:f,bottom:f+r.displaySize[1],left:d,right:d+r.displaySize[0]}}function jx(r,e,i,s,c,d){const f=r.image;let g;if(f.content){const $=f.content,H=f.pixelRatio||1;g=[$[0]/H,$[1]/H,f.displaySize[0]-$[2]/H,f.displaySize[1]-$[3]/H]}const x=e.left*d,v=e.right*d;let E,I,A,k;i==="width"||i==="both"?(k=c[0]+x-s[3],I=c[0]+v+s[1]):(k=c[0]+(x+v-f.displaySize[0])/2,I=k+f.displaySize[0]);const D=e.top*d,O=e.bottom*d;return i==="height"||i==="both"?(E=c[1]+D-s[0],A=c[1]+O+s[2]):(E=c[1]+(D+O-f.displaySize[1])/2,A=E+f.displaySize[1]),{image:f,top:E,right:I,bottom:A,left:k,collisionPadding:g}}class Xo extends ne{constructor(e,i,s,c,d){super(e,i),this.angle=c,this.z=s,d!==void 0&&(this.segment=d)}clone(){return new Xo(this.x,this.y,this.z,this.angle,this.segment)}}function Gx(r,e,i,s,c){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,g=0;for(;g>-i/2;){if(f--,f<0)return!1;g-=r[f].dist(d),d=r[f]}g+=r[f].dist(r[f+1]),f++;const x=[];let v=0;for(;g<i/2;){const E=r[f],I=r[f+1];if(!I)return!1;let A=r[f-1].angleTo(E)-E.angleTo(I);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:g,angleDelta:A}),v+=A;g-x[0].distance>s;)v-=x.shift().angleDelta;if(v>c)return!1;f++,g+=E.dist(I)}return!0}function $x(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function Zx(r,e,i){return r?.6*e*i:0}function qx(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function CE(r,e,i,s,c,d){const f=Zx(i,c,d),g=qx(i,s)*d;let x=0;const v=$x(r)/2;for(let E=0;E<r.length-1;E++){const I=r[E],A=r[E+1],k=I.dist(A);if(x+k>v){const D=(v-x)/k,O=Ut(I.x,A.x,D),$=Ut(I.y,A.y,D),H=new Xo(O,$,0,A.angleTo(I),E);return!f||Gx(r,H,g,f,e)?H:void 0}x+=k}}function IE(r,e,i,s,c,d,f,g,x){const v=Zx(s,d,f),E=qx(s,c),I=E*f,A=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return e-I<e/4&&(e=I+e/4),Wx(r,A?e/2*g%e:(E/2+2*d)*f*g%e,e,v,i,I,A,!1,x)}function Wx(r,e,i,s,c,d,f,g,x){const v=d/2,E=$x(r);let I=0,A=e-i,k=[];for(let D=0;D<r.length-1;D++){const O=r[D],$=r[D+1],H=O.dist($),ie=$.angleTo(O);for(;A+i<I+H;){A+=i;const re=(A-I)/H,oe=Ut(O.x,$.x,re),le=Ut(O.y,$.y,re);if(oe>=0&&oe<x&&le>=0&&le<x&&A-v>=0&&A+v<=E){const ue=new Xo(oe,le,0,ie,D);ue._round(),s&&!Gx(r,ue,d,s,c)||k.push(ue)}}I+=H}return g||k.length||f||(k=Wx(r,I/2,i,s,c,d,f,!0,x)),k}function Xx(r,e,i,s,c){const d=[];for(let f=0;f<r.length;f++){const g=r[f];let x;for(let v=0;v<g.length-1;v++){let E=g[v],I=g[v+1];E.x<e&&I.x<e||(E.x<e?E=new ne(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<e&&(I=new ne(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<i&&I.y<i||(E.y<i?E=new ne(E.x+(i-E.y)/(I.y-E.y)*(I.x-E.x),i)._round():I.y<i&&(I=new ne(E.x+(i-E.y)/(I.y-E.y)*(I.x-E.x),i)._round()),E.x>=s&&I.x>=s||(E.x>=s?E=new ne(s,E.y+(s-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=s&&(I=new ne(s,E.y+(s-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=c&&I.y>=c||(E.y>=c?E=new ne(E.x+(c-E.y)/(I.y-E.y)*(I.x-E.x),c)._round():I.y>=c&&(I=new ne(E.x+(c-E.y)/(I.y-E.y)*(I.x-E.x),c)._round()),x&&E.equals(x[x.length-1])||(x=[E],d.push(x)),x.push(I)))))}}return d}tt(Xo,"Anchor");const sh=1e20;function Hx(r,e,i,s,c,d,f,g,x){for(let v=e;v<e+s;v++)Yx(r,i*d+v,d,c,f,g,x);for(let v=i;v<i+c;v++)Yx(r,v*d+e,1,s,f,g,x)}function Yx(r,e,i,s,c,d,f){d[0]=0,f[0]=-sh,f[1]=sh,c[0]=r[e];for(let g=1,x=0,v=0;g<s;g++){c[g]=r[e+g*i];const E=g*g;do{const I=d[x];v=(c[g]-c[I]+E-I*I)/(g-I)/2}while(v<=f[x]&&--x>-1);x++,d[x]=g,f[x]=v,f[x+1]=sh}for(let g=0,x=0;g<s;g++){for(;f[x+1]<g;)x++;const v=d[x],E=g-v;r[e+g*i]=c[v]+E*E}}const y_={none:0,ideographs:1,all:2};class wc{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[];for(const c in e)for(const d of e[c])s.push({stack:c,id:d});ft(s,({stack:c,id:d},f)=>{let g=this.entries[c];g||(g=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=g.glyphs[d];if(x!==void 0)return void f(null,{stack:c,id:d,glyph:x});if(x=this._tinySDF(g,c,d),x)return g.glyphs[d]=x,void f(null,{stack:c,id:d,glyph:x});const v=Math.floor(d/256);if(256*v>65535)return void f(new Error("glyphs > 65535 not supported"));if(g.ranges[v])return void f(null,{stack:c,id:d,glyph:x});let E=g.requests[v];E||(E=g.requests[v]=[],wc.loadGlyphRange(c,v,this.url,this.requestManager,(I,A)=>{if(A){g.ascender=A.ascender,g.descender=A.descender;for(const k in A.glyphs)this._doesCharSupportLocalGlyph(+k)||(g.glyphs[+k]=A.glyphs[+k]);g.ranges[v]=!0}for(const k of E)k(I,A);delete g.requests[v]})),E.push((I,A)=>{I?f(I):A&&f(null,{stack:c,id:d,glyph:A.glyphs[d]||null})})},(c,d)=>{if(c)i(c);else if(d){const f={};for(const{stack:g,id:x,glyph:v}of d)f[g]===void 0&&(f[g]={}),f[g].glyphs===void 0&&(f[g].glyphs={}),f[g].glyphs[x]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},f[g].ascender=this.entries[g].ascender,f[g].descender=this.entries[g].descender;i(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==y_.none&&(this.localGlyphMode===y_.all?!!this.localFontFamily:!!this.localFontFamily&&(Fu(e)||ep(e)||nc(e)||oc(e)||ic(e)))}_tinySDF(e,i,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let d=e.tinySDF;if(!d){let O="400";/bold/i.test(i)?O="900":/medium/i.test(i)?O="500":/light/i.test(i)&&(O="200"),d=e.tinySDF=new wc.TinySDF({fontFamily:c,fontWeight:O,fontSize:48,buffer:6,radius:16}),d.fontWeight=O}if(this.localGlyphs[d.fontWeight][s])return this.localGlyphs[d.fontWeight][s];const f=String.fromCharCode(s),{data:g,width:x,height:v,glyphWidth:E,glyphHeight:I,glyphLeft:A,glyphTop:k,glyphAdvance:D}=d.draw(f);return this.localGlyphs[d.fontWeight][s]={id:s,bitmap:new qo({width:x,height:v},g),metrics:{width:E/2,height:I/2,left:A/2,top:k/2-27,advance:D/2,localGlyph:!0}}}}function Kx(r,e,i,s){const c=[],d=r.image,f=d.pixelRatio,g=d.paddedRect.w-2,x=d.paddedRect.h-2,v=r.right-r.left,E=r.bottom-r.top,I=d.stretchX||[[0,g]],A=d.stretchY||[[0,x]],k=(xe,Ae)=>xe+Ae[1]-Ae[0],D=I.reduce(k,0),O=A.reduce(k,0),$=g-D,H=x-O;let ie=0,re=D,oe=0,le=O,ue=0,Ee=$,Ce=0,ke=H;if(d.content&&s){const xe=d.content;ie=Mp(I,0,xe[0]),oe=Mp(A,0,xe[1]),re=Mp(I,xe[0],xe[2]),le=Mp(A,xe[1],xe[3]),ue=xe[0]-ie,Ce=xe[1]-oe,Ee=xe[2]-xe[0]-re,ke=xe[3]-xe[1]-le}const Oe=(xe,Ae,Ue,Ne)=>{const Je=kp(xe.stretch-ie,re,v,r.left),Re=zp(xe.fixed-ue,Ee,xe.stretch,D),He=kp(Ae.stretch-oe,le,E,r.top),Tt=zp(Ae.fixed-Ce,ke,Ae.stretch,O),Mt=kp(Ue.stretch-ie,re,v,r.left),ct=zp(Ue.fixed-ue,Ee,Ue.stretch,D),rt=kp(Ne.stretch-oe,le,E,r.top),Pt=zp(Ne.fixed-Ce,ke,Ne.stretch,O),Ct=new ne(Je,He),nt=new ne(Mt,He),Fr=new ne(Mt,rt),Cr=new ne(Je,rt),vr=new ne(Re/f,Tt/f),Dt=new ne(ct/f,Pt/f),Vt=e*Math.PI/180;if(Vt){const Jt=Math.sin(Vt),lr=Math.cos(Vt),fr=[lr,-Jt,Jt,lr];Ct._matMult(fr),nt._matMult(fr),Cr._matMult(fr),Fr._matMult(fr)}const ir=xe.stretch+xe.fixed,tr=Ae.stretch+Ae.fixed;return{tl:Ct,tr:nt,bl:Cr,br:Fr,tex:{x:d.paddedRect.x+1+ir,y:d.paddedRect.y+1+tr,w:Ue.stretch+Ue.fixed-ir,h:Ne.stretch+Ne.fixed-tr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vr,pixelOffsetBR:Dt,minFontScaleX:Ee/f/v,minFontScaleY:ke/f/E,isSDF:i}};if(s&&(d.stretchX||d.stretchY)){const xe=Jx(I,$,D),Ae=Jx(A,H,O);for(let Ue=0;Ue<xe.length-1;Ue++){const Ne=xe[Ue],Je=xe[Ue+1];for(let Re=0;Re<Ae.length-1;Re++)c.push(Oe(Ne,Ae[Re],Je,Ae[Re+1]))}}else c.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:x+1}));return c}function Mp(r,e,i){let s=0;for(const c of r)s+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return s}function Jx(r,e,i){const s=[{fixed:-1,stretch:0}];for(const[c,d]of r){const f=s[s.length-1];s.push({fixed:c-f.stretch,stretch:f.stretch}),s.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return s.push({fixed:e+1,stretch:i}),s}function kp(r,e,i,s){return r/e*i+s}function zp(r,e,i,s){return r-e*i/s}function AE(r,e,i,s){const c=e+r.positionedLines[s].lineOffset;return s===0?i+c/2:i+(c+(e+r.positionedLines[s-1].lineOffset))/2}wc.loadGlyphRange=function(r,e,i,s,c){const d=256*e,f=d+255,g=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${d}-${f}`),Q.Glyphs);ce(g,(x,v)=>{if(x)c(x);else if(v){const E={},I=function(A){return new nh(A).readFields(vE,{})}(v);for(const A of I.glyphs)E[A.id]=A;c(null,{glyphs:E,ascender:I.ascender,descender:I.descender})}})},wc.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const g=this.size=r+4*e,x=this._createCanvas(g),v=this.ctx=x.getContext("2d",{willReadFrequently:!0});v.font=`${f} ${d} ${r}px ${c}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(r),f=Math.ceil(i),g=Math.min(this.size-this.buffer,Math.ceil(d-c)),x=Math.min(this.size-this.buffer,f+Math.ceil(s)),v=g+2*this.buffer,E=x+2*this.buffer,I=Math.max(v*E,0),A=new Uint8ClampedArray(I),k={data:A,width:v,height:E,glyphWidth:g,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||x===0)return k;const{ctx:D,buffer:O,gridInner:$,gridOuter:H}=this;D.clearRect(O,O,g,x),D.fillText(r,O,O+f);const ie=D.getImageData(O,O,g,x);H.fill(sh,0,I),$.fill(0,0,I);for(let re=0;re<x;re++)for(let oe=0;oe<g;oe++){const le=ie.data[4*(re*g+oe)+3]/255;if(le===0)continue;const ue=(re+O)*v+oe+O;if(le===1)H[ue]=0,$[ue]=sh;else{const Ee=.5-le;H[ue]=Ee>0?Ee*Ee:0,$[ue]=Ee<0?Ee*Ee:0}}Hx(H,0,0,v,E,v,this.f,this.v,this.z),Hx($,O,O,g,x,v,this.f,this.v,this.z);for(let re=0;re<I;re++){const oe=Math.sqrt(H[re])-Math.sqrt($[re]);A[re]=Math.round(255-255*(oe/this.radius+this.cutoff))}return k}};class ME{constructor(e=[],i=kE){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,c=i[e];for(;e>0;){const d=e-1>>1,f=i[d];if(s(c,f)>=0)break;i[e]=f,e=d}i[e]=c}_down(e){const{data:i,compare:s}=this,c=this.length>>1,d=i[e];for(;e<c;){let f=1+(e<<1),g=i[f];const x=f+1;if(x<this.length&&s(i[x],g)<0&&(f=x,g=i[x]),s(g,d)>=0)break;i[e]=g,e=f}i[e]=d}}function kE(r,e){return r<e?-1:r>e?1:0}function zE(r,e=1,i=!1){let s=1/0,c=1/0,d=-1/0,f=-1/0;const g=r[0];for(let k=0;k<g.length;k++){const D=g[k];(!k||D.x<s)&&(s=D.x),(!k||D.y<c)&&(c=D.y),(!k||D.x>d)&&(d=D.x),(!k||D.y>f)&&(f=D.y)}const x=Math.min(d-s,f-c);let v=x/2;const E=new ME([],PE);if(x===0)return new ne(s,c);for(let k=s;k<d;k+=x)for(let D=c;D<f;D+=x)E.push(new bc(k+v,D+v,v,r));let I=function(k){let D=0,O=0,$=0;const H=k[0];for(let ie=0,re=H.length,oe=re-1;ie<re;oe=ie++){const le=H[ie],ue=H[oe],Ee=le.x*ue.y-ue.x*le.y;O+=(le.x+ue.x)*Ee,$+=(le.y+ue.y)*Ee,D+=3*Ee}return new bc(O/D,$/D,0,k)}(r),A=E.length;for(;E.length;){const k=E.pop();(k.d>I.d||!I.d)&&(I=k,i&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,A)),k.max-I.d<=e||(v=k.h/2,E.push(new bc(k.p.x-v,k.p.y-v,v,r)),E.push(new bc(k.p.x+v,k.p.y-v,v,r)),E.push(new bc(k.p.x-v,k.p.y+v,v,r)),E.push(new bc(k.p.x+v,k.p.y+v,v,r)),A+=4)}return i&&(console.log(`num probes: ${A}`),console.log(`best distance: ${I.d}`)),I.p}function PE(r,e){return e.max-r.max}function bc(r,e,i,s){this.p=new ne(r,e),this.h=i,this.d=function(c,d){let f=!1,g=1/0;for(let x=0;x<d.length;x++){const v=d[x];for(let E=0,I=v.length,A=I-1;E<I;A=E++){const k=v[E],D=v[A];k.y>c.y!=D.y>c.y&&c.x<(D.x-k.x)*(c.y-k.y)/(D.y-k.y)+k.x&&(f=!f),g=Math.min(g,Z0(c,k,D))}}return(f?1:-1)*Math.sqrt(g)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const x_=Number.POSITIVE_INFINITY,DE=Math.sqrt(2);function Qx(r,e){return e[1]!==x_?function(i,s,c){let d=0,f=0;switch(s=Math.abs(s),c=Math.abs(c),i){case"top-right":case"top-left":case"top":f=c-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-c}switch(i){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,f]}(r,e[0],e[1]):function(i,s){let c=0,d=0;s<0&&(s=0);const f=s/DE;switch(i){case"top-right":case"top-left":d=f-7;break;case"bottom-right":case"bottom-left":d=7-f;break;case"bottom":d=7-s;break;case"top":d=s-7}switch(i){case"top-right":case"bottom-right":c=-f;break;case"top-left":case"bottom-left":c=f;break;case"left":c=s;break;case"right":c=-s}return[c,d]}(r,e[0])}function LE(r,e,i,s,c,d,f,g,x,v){r.createArrays(),r.tilePixelRatio=_t/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const E=r.layers[0].layout,I=r.layers[0]._unevaluatedLayout._values,A={};if(r.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:$}=r.textSizeData;A.compositeTextSizes=[I["text-size"].possiblyEvaluate(new Z(O),g),I["text-size"].possiblyEvaluate(new Z($),g)]}if(r.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:$}=r.iconSizeData;A.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new Z(O),g),I["icon-size"].possiblyEvaluate(new Z($),g)]}A.layoutTextSize=I["text-size"].possiblyEvaluate(new Z(x+1),g),A.layoutIconSize=I["icon-size"].possiblyEvaluate(new Z(x+1),g),A.textMaxSize=I["text-size"].possiblyEvaluate(new Z(18),g);const k=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",D=E.get("text-size");for(const O of r.features){const $=E.get("text-font").evaluate(O,{},g).join(","),H=D.evaluate(O,{},g),ie=A.layoutTextSize.evaluate(O,{},g),re=(A.layoutIconSize.evaluate(O,{},g),{horizontal:{},vertical:void 0}),oe=O.text;let le,ue=[0,0];if(oe){const ke=oe.toString(),Oe=E.get("text-letter-spacing").evaluate(O,{},g)*ii,xe=E.get("text-line-height").evaluate(O,{},g)*ii,Ae=uc(ke)?Oe:0,Ue=E.get("text-anchor").evaluate(O,{},g),Ne=E.get("text-variable-anchor");if(!Ne){const ct=E.get("text-radial-offset").evaluate(O,{},g);ue=ct?Qx(Ue,[ct*ii,x_]):E.get("text-offset").evaluate(O,{},g).map(rt=>rt*ii)}let Je=k?"center":E.get("text-justify").evaluate(O,{},g);const Re=E.get("symbol-placement"),He=Re==="point",Tt=Re==="point"?E.get("text-max-width").evaluate(O,{},g)*ii:0,Mt=ct=>{r.allowVerticalPlacement&&cc(ke)&&(re.vertical=m_(oe,e,i,c,$,Tt,xe,Ue,ct,Ae,ue,hn.vertical,!0,Re,ie,H))};if(!k&&Ne){const ct=Je==="auto"?Ne.map(Pt=>v_(Pt)):[Je];let rt=!1;for(let Pt=0;Pt<ct.length;Pt++){const Ct=ct[Pt];if(!re.horizontal[Ct])if(rt)re.horizontal[Ct]=re.horizontal[0];else{const nt=m_(oe,e,i,c,$,Tt,xe,"center",Ct,Ae,ue,hn.horizontal,!1,Re,ie,H);nt&&(re.horizontal[Ct]=nt,rt=nt.positionedLines.length===1)}}Mt("left")}else{if(Je==="auto"&&(Je=v_(Ue)),He||E.get("text-writing-mode").indexOf("horizontal")>=0||!cc(ke)){const ct=m_(oe,e,i,c,$,Tt,xe,Ue,Je,Ae,ue,hn.horizontal,!1,Re,ie,H);ct&&(re.horizontal[Je]=ct)}Mt(Re==="point"?"left":Je)}}let Ee=!1;if(O.icon&&O.icon.name){const ke=s[O.icon.name];ke&&(le=SE(c[O.icon.name],E.get("icon-offset").evaluate(O,{},g),E.get("icon-anchor").evaluate(O,{},g)),Ee=ke.sdf,r.sdfIcons===void 0?r.sdfIcons=ke.sdf:r.sdfIcons!==ke.sdf&&zt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==r.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Ce=tv(re.horizontal)||re.vertical;r.iconsInText||(r.iconsInText=!!Ce&&Ce.iconsInText),(Ce||le)&&RE(r,O,re,le,s,A,ie,0,ue,Ee,f,g,v)}d&&r.generateCollisionDebugBuffers(x,r.collisionBoxArray)}function v_(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function RE(r,e,i,s,c,d,f,g,x,v,E,I,A){let k=d.textMaxSize.evaluate(e,{},I);k===void 0&&(k=f);const D=r.layers[0].layout,O=D.get("icon-offset").evaluate(e,{},I),$=tv(i.horizontal)||i.vertical,H=A.name==="globe",ie=f/24,re=r.tilePixelRatio*k/24,oe=(Ae=r.overscaling,r.zoom>18&&Ae>2&&(Ae>>=1),Math.max(_t/(512*Ae),1)*D.get("symbol-spacing")),le=D.get("text-padding")*r.tilePixelRatio,ue=D.get("icon-padding")*r.tilePixelRatio,Ee=ze(D.get("text-max-angle")),Ce=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ke=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Oe=D.get("symbol-placement"),xe=oe/2;var Ae;const Ue=D.get("icon-text-fit");let Ne;s&&Ue!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(Ne=jx(s,i.vertical,Ue,D.get("icon-text-fit-padding"),O,ie)),$&&(s=jx(s,$,Ue,D.get("icon-text-fit-padding"),O,ie)));const Je=(Re,He,Tt)=>{if(He.x<0||He.x>=_t||He.y<0||He.y>=_t)return;let Mt=null;if(H){const{x:ct,y:rt,z:Pt}=A.projectTilePoint(He.x,He.y,Tt);Mt={anchor:new Xo(ct,rt,Pt,0,void 0),up:A.upVector(Tt,He.x,He.y)}}(function(ct,rt,Pt,Ct,nt,Fr,Cr,vr,Dt,Vt,ir,tr,Jt,lr,fr,Yr,Pi,Rt,wr,ci,qt,mr,wi,hr,Ir){const Kr=ct.addToLineVertexArray(rt,Ct);let jr,ni,bi,Jr,Ho,Cc,mh,_h=0,Fv=0,Uv=0,Nv=0,O_=-1,F_=-1;const yo={};let Vv=$u("");const rl=Pt?Pt.anchor:rt;let U_=0,N_=0;if(Dt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[U_,N_]=Dt.layout.get("text-offset").evaluate(qt,{},Ir).map(Ji=>Ji*ii):(U_=Dt.layout.get("text-radial-offset").evaluate(qt,{},Ir)*ii,N_=x_),ct.allowVerticalPlacement&&nt.vertical){const Ji=nt.vertical;if(fr)Cc=w_(Ji),vr&&(mh=w_(vr));else{const Qi=Dt.layout.get("text-rotate").evaluate(qt,{},Ir)+90;bi=Pp(Vt,rl,rt,ir,tr,Jt,Ji,lr,Qi,Yr),vr&&(Jr=Pp(Vt,rl,rt,ir,tr,Jt,vr,Rt,Qi))}}if(Fr){const Ji=Dt.layout.get("icon-rotate").evaluate(qt,{},Ir),Qi=Dt.layout.get("icon-text-fit")!=="none",gh=Kx(Fr,Ji,wi,Qi),j_=vr?Kx(vr,Ji,wi,Qi):void 0;ni=Pp(Vt,rl,rt,ir,tr,Jt,Fr,Rt,Ji),_h=4*gh.length;const jv=ct.iconSizeData;let il=null;jv.kind==="source"?(il=[po*Dt.layout.get("icon-size").evaluate(qt,{},Ir)],il[0]>Os&&zt(`${ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):jv.kind==="composite"&&(il=[po*mr.compositeIconSizes[0].evaluate(qt,{},Ir),po*mr.compositeIconSizes[1].evaluate(qt,{},Ir)],(il[0]>Os||il[1]>Os)&&zt(`${ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ct.addSymbols(ct.icon,gh,il,ci,wr,qt,!1,Pt,rt,Kr.lineStartIndex,Kr.lineLength,-1,hr,Ir),O_=ct.icon.placedSymbolArray.length-1,j_&&(Fv=4*j_.length,ct.addSymbols(ct.icon,j_,il,ci,wr,qt,hn.vertical,Pt,rt,Kr.lineStartIndex,Kr.lineLength,-1,hr,Ir),F_=ct.icon.placedSymbolArray.length-1)}for(const Ji in nt.horizontal){const Qi=nt.horizontal[Ji];jr||(Vv=$u(Qi.text),fr?Ho=w_(Qi):jr=Pp(Vt,rl,rt,ir,tr,Jt,Qi,lr,Dt.layout.get("text-rotate").evaluate(qt,{},Ir),Yr));const gh=Qi.positionedLines.length===1;if(Uv+=ev(ct,Pt,rt,Qi,Cr,Dt,fr,qt,Yr,Kr,nt.vertical?hn.horizontal:hn.horizontalOnly,gh?Object.keys(nt.horizontal):[Ji],yo,O_,mr,hr,Ir),gh)break}nt.vertical&&(Nv+=ev(ct,Pt,rt,nt.vertical,Cr,Dt,fr,qt,Yr,Kr,hn.vertical,["vertical"],yo,F_,mr,hr,Ir));let Gs=-1;const V_=(Ji,Qi)=>Ji?Math.max(Ji,Qi):Qi;Gs=V_(Ho,Gs),Gs=V_(Cc,Gs),Gs=V_(mh,Gs);const pS=Gs>-1?1:0;ct.glyphOffsetArray.length>=Us.MAX_GLYPHS&&zt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qt.sortKey!==void 0&&ct.addToSortKeyRanges(ct.symbolInstances.length,qt.sortKey),ct.symbolInstances.emplaceBack(rl.x,rl.y,rl.z,rt.x,rt.y,yo.right>=0?yo.right:-1,yo.center>=0?yo.center:-1,yo.left>=0?yo.left:-1,yo.vertical>=0?yo.vertical:-1,O_,F_,Vv,jr!==void 0?jr:ct.collisionBoxArray.length,jr!==void 0?jr+1:ct.collisionBoxArray.length,bi!==void 0?bi:ct.collisionBoxArray.length,bi!==void 0?bi+1:ct.collisionBoxArray.length,ni!==void 0?ni:ct.collisionBoxArray.length,ni!==void 0?ni+1:ct.collisionBoxArray.length,Jr||ct.collisionBoxArray.length,Jr?Jr+1:ct.collisionBoxArray.length,ir,Uv,Nv,_h,Fv,pS,0,U_,N_,Gs)})(r,He,Mt,Re,i,s,c,Ne,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,le,Ce,x,0,ue,ke,O,e,d,v,E,I)};if(Oe==="line")for(const Re of Xx(e.geometry,0,0,_t,_t)){const He=IE(Re,oe,Ee,i.vertical||$,s,24,re,r.overscaling,_t);for(const Tt of He){const Mt=$;Mt&&BE(r,Mt.text,xe,Tt)||Je(Re,Tt,I)}}else if(Oe==="line-center"){for(const Re of e.geometry)if(Re.length>1){const He=CE(Re,Ee,i.vertical||$,s,24,re);He&&Je(Re,He,I)}}else if(e.type==="Polygon")for(const Re of l_(e.geometry,0)){const He=zE(Re,16);Je(Re[0],new Xo(He.x,He.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Re of e.geometry)Je(Re,new Xo(Re[0].x,Re[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Re of e.geometry)for(const He of Re)Je([He],new Xo(He.x,He.y,0,0,void 0),I)}const Os=32640;function ev(r,e,i,s,c,d,f,g,x,v,E,I,A,k,D,O,$){const H=function(oe,le,ue,Ee,Ce,ke,Oe,xe){const Ae=[];if(le.positionedLines.length===0)return Ae;const Ue=Ee.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,Ne=function(Mt){const ct=Mt[0],rt=Mt[1],Pt=ct*rt;return Pt>0?[ct,-rt]:Pt<0?[-ct,rt]:ct===0?[rt,ct]:[rt,-ct]}(ue);let Je=Math.abs(le.top-le.bottom);for(const Mt of le.positionedLines)Je-=Mt.lineOffset;const Re=le.positionedLines.length,He=Je/Re;let Tt=le.top-ue[1];for(let Mt=0;Mt<Re;++Mt){const ct=le.positionedLines[Mt];Tt=AE(le,He,Tt,Mt);for(const rt of ct.positionedGlyphs){if(!rt.rect)continue;const Pt=rt.rect||{};let Ct=4,nt=!0,Fr=1,Cr=0;if(rt.imageName){const hr=Oe[rt.imageName];if(!hr)continue;if(hr.sdf){zt("SDF images are not supported in formatted text and will be ignored.");continue}nt=!1,Fr=hr.pixelRatio,Ct=1/Fr}const vr=(Ce||xe)&&rt.vertical,Dt=rt.metrics.advance*rt.scale/2,Vt=rt.metrics,ir=rt.rect;if(ir===null)continue;xe&&le.verticalizable&&(Cr=rt.imageName?Dt-rt.metrics.width*rt.scale/2:0);const tr=Ce?[rt.x+Dt,rt.y]:[0,0];let Jt=[0,0],lr=[0,0],fr=!1;Ce||(vr?(lr=[rt.x+Dt+Ne[0],rt.y+Ne[1]-Cr],fr=!0):Jt=[rt.x+Dt+ue[0],rt.y+ue[1]-Cr]);const Yr=ir.w*rt.scale/(Fr*(rt.localGlyph?2:1)),Pi=ir.h*rt.scale/(Fr*(rt.localGlyph?2:1));let Rt,wr,ci,qt;if(vr){const hr=rt.y-Tt,Ir=new ne(-Dt,Dt-hr),Kr=-Math.PI/2,jr=new ne(...lr);Rt=new ne(-Dt+Jt[0],Jt[1]),Rt._rotateAround(Kr,Ir)._add(jr),Rt.x+=-hr+Dt,Rt.y-=(Vt.left-Ct)*rt.scale;const ni=rt.imageName?Vt.advance*rt.scale:ii*rt.scale,bi=String.fromCharCode(rt.glyph);cE(bi)?Rt.x+=(1-Ct)*rt.scale:uE(bi)?Rt.x+=ni-Vt.height*rt.scale+(-Ct-1)*rt.scale:Rt.x+=rt.imageName||Vt.width+2*Ct===ir.w&&Vt.height+2*Ct===ir.h?(ni-Pi)/2:(ni-(Vt.height+2*Ct)*rt.scale)/2,wr=new ne(Rt.x,Rt.y-Yr),ci=new ne(Rt.x+Pi,Rt.y),qt=new ne(Rt.x+Pi,Rt.y-Yr)}else{const hr=(Vt.left-Ct)*rt.scale-Dt+Jt[0],Ir=(-Vt.top-Ct)*rt.scale+Jt[1],Kr=hr+Yr,jr=Ir+Pi;Rt=new ne(hr,Ir),wr=new ne(Kr,Ir),ci=new ne(hr,jr),qt=new ne(Kr,jr)}if(Ue){let hr;hr=Ce?new ne(0,0):fr?new ne(Ne[0],Ne[1]):new ne(ue[0],ue[1]),Rt._rotateAround(Ue,hr),wr._rotateAround(Ue,hr),ci._rotateAround(Ue,hr),qt._rotateAround(Ue,hr)}const mr=new ne(0,0),wi=new ne(0,0);Ae.push({tl:Rt,tr:wr,bl:ci,br:qt,tex:Pt,writingMode:le.writingMode,glyphOffset:tr,sectionIndex:rt.sectionIndex,isSDF:nt,pixelOffsetTL:mr,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}}return Ae}(0,s,x,d,f,g,c,r.allowVerticalPlacement),ie=r.textSizeData;let re=null;ie.kind==="source"?(re=[po*d.layout.get("text-size").evaluate(g,{},$)],re[0]>Os&&zt(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(re=[po*D.compositeTextSizes[0].evaluate(g,{},$),po*D.compositeTextSizes[1].evaluate(g,{},$)],(re[0]>Os||re[1]>Os)&&zt(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,H,re,x,f,g,E,e,i,v.lineStartIndex,v.lineLength,k,O,$);for(const oe of I)A[oe]=r.text.placedSymbolArray.length-1;return 4*H.length}function tv(r){for(const e in r)return r[e];return null}function Pp(r,e,i,s,c,d,f,g,x,v){let E=f.top,I=f.bottom,A=f.left,k=f.right;const D=f.collisionPadding;if(D&&(A-=D[0],E-=D[1],k+=D[2],I+=D[3]),x){const O=new ne(A,E),$=new ne(k,E),H=new ne(A,I),ie=new ne(k,I),re=ze(x);let oe=new ne(0,0);v&&(oe=new ne(v[0],v[1])),O._rotateAround(re,oe),$._rotateAround(re,oe),H._rotateAround(re,oe),ie._rotateAround(re,oe),A=Math.min(O.x,$.x,H.x,ie.x),k=Math.max(O.x,$.x,H.x,ie.x),E=Math.min(O.y,$.y,H.y,ie.y),I=Math.max(O.y,$.y,H.y,ie.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,A,E,k,I,g,s,c,d),r.length-1}function w_(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function BE(r,e,i,s){const c=r.compareText;if(e in c){const d=c[e];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<i)return!0}else c[e]=[];return c[e].push(s),!1}const OE=$e([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:rv}=OE,iv=$e([{name:"a_pos_3",components:3,type:"Int16"}]);var ah=$e([{name:"a_pos",type:"Int16",components:2}]);const Qa=_t/Math.PI/2,b_=2*Sn(1,0)*Qa*Math.PI,Tc=[64,32,16],Yi=-Qa,Ki=Qa,FE=[new un([Yi,Yi,Yi],[Ki,Ki,Ki]),new un([Yi,Yi,Yi],[0,0,Ki]),new un([0,Yi,Yi],[Ki,0,Ki]),new un([Yi,0,Yi],[0,Ki,Ki]),new un([0,0,Yi],[Ki,Ki,Ki])];function nv(r,e,i,s=!0){const c=ho([],r._camera.position,r.worldSize),d=[e,i,1,1];Ka(d,d,r.pixelMatrixInverse),tx(d,d,1/d[3]);const f=yi([],In([],d,c)),g=r.globeMatrix,x=[g[12],g[13],g[14]],v=In([],x,c),E=qu(v),I=yi([],v),A=r.worldSize/(2*Math.PI),k=Cn(I,f),D=Math.asin(A/E);if(D<Math.acos(k)){if(!s)return null;const Oe=[],xe=[];ho(Oe,f,E/k),yi(xe,In(xe,Oe,v)),yi(f,Rs(f,v,ho(f,xe,Math.tan(D)*E)))}const O=[];new e_(c,f).closestPointOnSphere(x,A,O);const $=yi([],Rn(g,0)),H=yi([],Rn(g,1)),ie=yi([],Rn(g,2)),re=Cn($,O),oe=Cn(H,O),le=Cn(ie,O),ue=kt(Math.asin(-oe/A));let Ee=kt(Math.atan2(re,le));Ee=r.center.lng+function(Oe,xe){const Ae=(xe-Oe+180)%360-180;return Ae<-180?Ae+360:Ae}(r.center.lng,Ee);const Ce=qa(Ee),ke=Fe(Wa(ue),0,1);return new dc(Ce,ke)}class UE{constructor(e,i,s){this.a=In([],e,s),this.b=In([],i,s),this.center=s;const c=yi([],this.a),d=yi([],this.b);this.angle=Math.acos(Cn(c,d))}}function T_(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(s,c,d,f){const g=Math.sin(d);return s*(Math.sin((1-f)*d)/g)+c*(Math.sin(f*d)/g)}(r.a[e],r.b[e],r.angle,Fe(i,0,1))+r.center[e]}function fo(r){if(r.z<=1)return FE[r.z+2*r.y+r.x];const[e,i]=E_(r),s=[vi(e[0],e[1]),vi(e[0],i[1]),vi(i[0],e[1]),vi(i[0],i[1])],c=[Ki,Ki,Ki],d=[Yi,Yi,Yi];for(const f of s)c[0]=Math.min(c[0],f[0]),c[1]=Math.min(c[1],f[1]),c[2]=Math.min(c[2],f[2]),d[0]=Math.max(d[0],f[0]),d[1]=Math.max(d[1],f[1]),d[2]=Math.max(d[2],f[2]);return new un(c,d)}function NE(r,e,i){const s=e/r.worldSize,c=Number.MAX_VALUE,d=[-c,-c,-c],f=[c,c,c],g=Xi(new Float64Array(16));if(uo(g,g,[s,s,s]),Ls(g,g,r.globeMatrix),i.z<=1){const xe=fo(i).getCorners();for(let Ae=0;Ae<xe.length;Ae++)ri(xe[Ae],xe[Ae],g),pp(f,f,xe[Ae]),fp(d,d,xe[Ae]);return new un(f,d)}const[x,v]=E_(i),E=new Ds;E.setSouthWest([x[1],v[0]]),E.setNorthEast([v[1],x[0]]);const I=[vi(E.getSouth(),E.getWest()),vi(E.getSouth(),E.getEast()),vi(E.getNorth(),E.getEast()),vi(E.getNorth(),E.getWest())];for(let xe=0;xe<I.length;xe++)ri(I[xe],I[xe],g),pp(f,f,I[xe]),fp(d,d,I[xe]);if(E.contains(r.center)){d[2]=0;const xe=r.point,Ae=[xe.x*s,xe.y*s,0];return pp(f,f,Ae),fp(d,d,Ae),new un(f,d)}const A=[g[12],g[13],g[14]],k=r.center.lng,D=Fe(r.center.lat,-85.051129,co),O=[qa(k),Wa(D)],$=E.getCenter().lng,H=Fe(E.getCenter().lat,-85.051129,co),ie=[qa($),Wa(H)];let re=new Array(3),oe=0,le=O[0]-ie[0];const ue=O[1]-ie[1];if(le>.5?le-=1:le<-.5&&(le+=1),Math.abs(le)>Math.abs(ue))oe=le>=0?1:3,re=A;else{oe=ue>=0?0:2;const xe=[g[4],g[5],g[6]];let Ae;Ae=ue>=0?-Math.sin(ze(E.getSouth()))*Qa:-Math.sin(ze(E.getNorth()))*Qa,re=mp(re,A,xe,Ae)}const Ee=I[oe],Ce=I[(oe+1)%4],ke=new UE(Ee,Ce,re),Oe=[T_(ke,0)||Ee[0],T_(ke,1)||Ee[1],T_(ke,2)||Ee[2]];return f[2]=Math.min(Ee[2],Ce[2]),pp(f,f,Oe),fp(d,d,Oe),new un(f,d)}function E_(r){const e=1<<r.z,i=r.x/e,s=(r.x+1)/e,c=(r.y+1)/e;return[[Or(r.y/e),gi(i)],[Or(c),gi(s)]]}function ov(r,e,i,s=Qa){return i=ze(i),[r*Math.sin(i)*s,-e*s,r*Math.cos(i)*s]}function vi(r,e,i){return ov(Math.cos(ze(r)),Math.sin(ze(r)),e,i)}function sv(r,e,i){const s=Math.pow(2,i.z),c=(r/_t+i.x)/s;return vi(Or((e/_t+i.y)/s),gi(c))}function Dp(r){return 16383/Math.max(...In([],r.max,r.min))}function lh(r){const e=Xi(new Float64Array(16)),i=Dp(r);var s,c;return uo(e,e,[i,i,i]),Ya(e,e,((s=[])[0]=-(c=r.min)[0],s[1]=-c[1],s[2]=-c[2],s)),e}function av(r){const e=Xi(new Float64Array(16)),i=1/Dp(r);return Ya(e,e,r.min),uo(e,e,[i,i,i]),e}function lv(r,e,i,s,c){const d=function(x){const v=_t/(2*Math.PI);return x/(2*Math.PI)/v}(i),f=[r,e,-i/(2*Math.PI)],g=Xi(new Float64Array(16));return Ya(g,g,f),uo(g,g,[d,d,d]),hp(g,g,ze(-c)),dp(g,g,ze(-s)),g}function S_(r){return st(5,6,r)}function cv(r,e){const i=vi(e.lat,e.lng);return d=(s=Jm([],function(k){const D=vi(k._center.lat,k._center.lng);let O=Qm([],fc(0,1,0),D);const $=K0([],-k.angle,D);O=ri(O,O,$),K0($,-k._pitch,O);const H=yi([],D);return ho(H,H,k.cameraToCenterDistance/k.pixelsPerMeter*b_),ri(H,H,$),Rs([],D,H)}(r),i))[0],f=s[1],g=s[2],x=(c=i)[0],v=c[1],E=c[2],A=(I=Math.sqrt(d*d+f*f+g*g)*Math.sqrt(x*x+v*v+E*E))&&Cn(s,c)/I,Math.acos(Math.min(Math.max(A,-1),1));var s,c,d,f,g,x,v,E,I,A}const uv=ze(85),VE=Math.cos(uv),jE=Math.sin(uv);function hv(r,e){const i=r.fovAboveCenter,s=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,c=(r._camera.position[2]*r.worldSize-s)/Math.cos(r._pitch),d=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01)),f=Math.sin(r._pitch)*d+c;return Math.min(1.01*f,c*(1/r._horizonShift))}function el(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),s=r.x*i,c=(r.x+1)*i,d=r.y*i,f=(r.y+1)*i,g=gi(s),x=gi(c),v=Or(d),E=Or(f),I=e.project(g,v),A=e.project(x,v),k=e.project(x,E),D=e.project(g,E);let O=Math.min(I.x,A.x,k.x,D.x),$=Math.min(I.y,A.y,k.y,D.y),H=Math.max(I.x,A.x,k.x,D.x),ie=Math.max(I.y,A.y,k.y,D.y);const re=i/16;function oe(ue,Ee,Ce,ke,Oe,xe){const Ae=(Ce+Oe)/2,Ue=(ke+xe)/2,Ne=e.project(gi(Ae),Or(Ue)),Je=Math.max(0,O-Ne.x,$-Ne.y,Ne.x-H,Ne.y-ie);O=Math.min(O,Ne.x),H=Math.max(H,Ne.x),$=Math.min($,Ne.y),ie=Math.max(ie,Ne.y),Je>re&&(oe(ue,Ne,Ce,ke,Ae,Ue),oe(Ne,Ee,Ae,Ue,Oe,xe))}oe(I,A,s,d,c,d),oe(A,k,c,d,c,f),oe(k,D,c,f,s,f),oe(D,I,s,f,s,d),O-=re,$-=re,H+=re,ie+=re;const le=1/Math.max(H-O,ie-$);return{scale:le,x:O*le,y:$*le,x2:H*le,y2:ie*le,projection:e}}const GE=Xi(new Float32Array(16));class Fs{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Kt(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return Sn(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return hv(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,c){const d=e.horizonLineFromTop(!1),f=new ne(i,Math.max(d,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,i,s){const c=new ne(i,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return GE}createTileMatrix(e,i,s){let c,d,f;const g=s.canonical,x=Xi(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=el(g,this);c=1,d=v.x+s.wrap*v.scale,f=v.y,uo(x,x,[c/v.scale,c/v.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(g.z),d=(g.x+Math.pow(2,g.z)*s.wrap)*c,f=g.y*c;return Ya(x,x,[d,f,0]),uo(x,x,[c/_t,c/_t,1]),x}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class $E extends Fs{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(ze(i));this.n=(c+Math.sin(ze(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c,r0:d}=this,f=ze(e-this.center[0]),g=ze(i),x=Math.sqrt(c-2*s*Math.sin(g))/s;return{x:x*Math.sin(f*s),y:x*Math.cos(f*s)-d,z:0}}unproject(e,i){const{n:s,c,r0:d}=this,f=d+i;let g=Math.atan2(e,Math.abs(f))*Math.sign(f);f*s<0&&(g-=Math.PI*Math.sign(e)*Math.sign(f));const x=ze(this.center[0])*s;g=lt(g,-Math.PI-x,Math.PI-x);const v=kt(g/s)+this.center[0],E=Math.asin(Fe((c-(e*e+f*f)*s*s)/(2*s),-1,1)),I=Fe(kt(E),-85.051129,co);return new Kt(v,I)}}const ch=1.340264,uh=-.081106,hh=893e-6,dh=.003796,Lp=Math.sqrt(3)/2;class ZE extends Fs{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Lp*Math.sin(i)),c=s*s,d=c*c*c;return{x:.5*(e*Math.cos(s)/(Lp*(ch+3*uh*c+d*(7*hh+9*dh*c)))/Math.PI+.5),y:1-.5*(s*(ch+uh*c+d*(hh+dh*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=s*s,d=c*c*c;for(let E,I,A,k=0;k<12&&(I=s*(ch+uh*c+d*(hh+dh*c))-i,A=ch+3*uh*c+d*(7*hh+9*dh*c),E=I/A,s=Fe(s-E,-Math.PI/3,Math.PI/3),c=s*s,d=c*c*c,!(Math.abs(E)<1e-12));++k);const f=Lp*e*(ch+3*uh*c+d*(7*hh+9*dh*c))/Math.cos(s),g=Math.asin(Math.sin(s)/Lp),x=Fe(180*f/Math.PI,-180,180),v=Fe(180*g/Math.PI,-85.051129,co);return new Kt(x,v)}}class qE extends Fs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),c=Fe(360*(.5-i),-85.051129,co);return new Kt(s,c)}}const Ec=Math.PI/2;function Rp(r){return Math.tan((Ec+r)/2)}class WE extends Fs{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30],c=ze(i),d=ze(s),f=Math.cos(c);this.n=c===d?Math.sin(c):Math.log(f/Math.cos(d))/Math.log(Rp(d)/Rp(c)),this.f=f*Math.pow(Rp(c),this.n)/this.n}project(e,i){i=ze(i),e=ze(e-this.center[0]);const s=1e-6,{n:c,f:d}=this;d>0?i<-Ec+s&&(i=-Ec+s):i>Ec-s&&(i=Ec-s);const f=d/Math.pow(Rp(i),c),g=f*Math.sin(c*e),x=d-f*Math.cos(c*e);return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,i=(2*(1-i)-.5)*Math.PI;const{n:s,f:c}=this,d=c-i,f=Math.sign(d),g=Math.sign(s)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*s<0&&(x-=Math.PI*Math.sign(e)*f);const v=Fe(kt(x/s)+this.center[0],-180,180),E=Fe(kt(2*Math.atan(Math.pow(c/g,1/s))-Ec),-85.051129,co);return new Kt(v,E)}}class dv extends Fs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:qa(e),y:Wa(i),z:0}}unproject(e,i){const s=gi(e),c=Or(i);return new Kt(s,c)}}const pv=ze(co);class XE extends Fs{project(e,i){const s=(i=ze(i))*i,c=s*s;return{x:.5*((e=ze(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=25,d=0,f=s*s;do{f=s*s;const v=f*f;d=(s*(1.007226+f*(.015085+v*(.028874*f-.044475-.005916*v)))-i)/(1.007226+f*(.045255+v*(.259866*f-.311325-.005916*11*v))),s=Fe(s-d,-pv,pv)}while(Math.abs(d)>1e-6&&--c>0);f=s*s;const g=Fe(kt(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=kt(s);return new Kt(g,x)}}const fv=ze(co);class HE extends Fs{project(e,i){i=ze(i),e=ze(e);const s=Math.cos(i),c=2/Math.PI,d=Math.acos(s*Math.cos(e/2)),f=Math.sin(d)/d,g=.5*(e*c+2*s*Math.sin(e/2)/f)||0,x=.5*(i+Math.sin(i)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,d=25;const f=1e-6;let g=0,x=0;do{const v=Math.cos(c),E=Math.sin(c),I=2*E*v,A=E*E,k=v*v,D=Math.cos(s/2),O=Math.sin(s/2),$=2*D*O,H=O*O,ie=1-k*D*D,re=ie?1/ie:0,oe=ie?Math.acos(v*D)*Math.sqrt(1/ie):0,le=.5*(2*oe*v*O+2*s/Math.PI)-e,ue=.5*(oe*E+c)-i,Ee=.5*re*(k*H+oe*v*D*A)+1/Math.PI,Ce=re*($*I/4-oe*E*O),ke=.125*re*(I*O-oe*E*k*$),Oe=.5*re*(A*D+oe*H*v)+.5,xe=Ce*ke-Oe*Ee;g=(ue*Ce-le*Oe)/xe,x=(le*ke-ue*Ee)/xe,s=Fe(s-g,-Math.PI,Math.PI),c=Fe(c-x,-fv,fv)}while((Math.abs(g)>f||Math.abs(x)>f)&&--d>0);return new Kt(kt(s),kt(c))}}class mv extends Fs{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ze(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:c}=this;return{x:ze(e)*c*s+.5,y:-Math.sin(ze(i))/c*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:c}=this,d=-(i-.5)/s,f=Fe(kt((e-.5)/s)/c,-180,180),g=Math.asin(Fe(d*c,-1,1)),x=Fe(kt(g),-85.051129,co);return new Kt(f,x)}}class YE extends dv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,i,s){const c=Math.pow(2,s.z),d=(e/_t+s.x)/c,f=vi(Or((i/_t+s.y)/c),gi(d));return ri(f,f,lh(fo(s))),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,i){const s=vi(i.lat,i.lng),c=yi([],s),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;mp(s,s,c,Sn(1,0)*_t*d);const f=Xi(new Float64Array(16));return Ls(f,e.pixelMatrix,e.globeMatrix),ri(s,s,f),new ne(s[0],s[1])}pixelsPerMeter(e,i){return Sn(1,0)*i}pixelSpaceConversion(e,i,s){const c=Ut(Sn(1,45)*i,Sn(1,e)*i,s);return this.pixelsPerMeter(e,i)/c}createTileMatrix(e,i,s){const c=av(fo(s.canonical));return Ls(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:s}=e,c=Xi(new Float64Array(16));return Ls(c,c,lh(fo(i))),dp(c,c,ze(s.lng)),hp(c,c,ze(s.lat)),uo(c,c,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(c)}pointCoordinate(e,i,s,c){return nv(e,i,s,!0)||new dc(0,0)}pointCoordinate3D(e,i,s){const c=this.pointCoordinate(e,i,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!nv(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,d){const f=c.cameraToCenterDistance,g=c._centerAltitude*d,x=c._camera,v=c._camera.forward(),E=Rs([],ho([],v,-f),[0,0,g]),I=c.worldSize/(2*Math.PI),A=[0,0,-I],k=c.width/c.height,D=Math.tan(c.fovAboveCenter),O=ho([],x.up(),D),$=ho([],x.right(),D*k),H=yi([],Rs([],Rs([],v,O),$)),ie=[];let re;if(new e_(E,H).closestPointOnSphere(A,I,ie)){const oe=Rs([],ie,A),le=In([],oe,E);re=Math.cos(c.fovAboveCenter)*qu(le)}else{const oe=In([],E,A),le=In([],A,E);yi(le,le);const ue=qu(oe)-I;re=Math.sqrt(ue*(ue+2*I));const Ee=Math.acos(re/(I+ue))-Math.acos(Cn(v,le));re*=Math.cos(Ee)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=S_(e.zoom);if(s>0){const c=hv(e,Sn(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ut(i,c+d*(1-Math.cos(f)),Math.pow(s,10))}return i}upVector(e,i,s){const c=1<<e.z,d=(i/_t+e.x)/c;return vi(Or((s/_t+e.y)/c),gi(d),1)}upVectorScale(e){return{metersToTile:b_*Dp(fo(e))}}}function _v(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new dv(r);case"equirectangular":return new qE(r);case"naturalEarth":return new XE(r);case"equalEarth":return new ZE(r);case"winkelTripel":return new HE(r);case"albers":return i?new mv(r):new $E(r);case"lambertConformalConic":return i?new mv(r):new WE(r);case"globe":return new YE(r)}throw new Error(`Invalid projection name: ${r.name}`)}const KE=Ja.VectorTileFeature.types,JE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bp(r,e,i,s,c,d,f,g,x,v,E,I,A){const k=g?Math.min(Os,Math.round(g[0])):0,D=g?Math.min(Os,Math.round(g[1])):0;r.emplaceBack(e,i,Math.round(32*s),Math.round(32*c),d,f,(k<<1)+(x?1:0),D,16*v,16*E,256*I,256*A)}function Op(r,e,i,s,c,d,f){r.emplaceBack(e,i,s,c,d,f)}function Fp(r,e,i,s,c){r.emplaceBack(e,i,s,c),r.emplaceBack(e,i,s,c),r.emplaceBack(e,i,s,c),r.emplaceBack(e,i,s,c)}function QE(r){for(const e of r.sections)if(y(e.text))return!0;return!1}class C_{constructor(e){this.layoutVertexArray=new zi,this.indexArray=new Ot,this.programConfigurations=e,this.segments=new Sr,this.dynamicLayoutVertexArray=new $t,this.opacityVertexArray=new Zn,this.placedSymbolArray=new T0,this.globeExtVertexArray=new Tn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,iE.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,JE,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,rE.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}tt(C_,"SymbolBuffers");class I_{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Sr,this.collisionVertexArray=new kr,this.collisionVertexArrayExt=new Hr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,nE.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,oE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}tt(I_,"CollisionBuffers");class Us{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xi([]),this.placementViewportMatrix=Xi([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=h_(this.zoom,i["text-size"]),this.iconSizeData=h_(this.zoom,i["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(f=>hn[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new C_(new Za(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new C_(new Za(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new C0,this.lineVertexArray=new I0,this.symbolInstances=new S0}calculateGlyphDependencies(e,i,s,c,d){for(let f=0;f<e.length;f++)if(i[e.charCodeAt(f)]=!0,c&&d){const g=ih[e.charAt(f)];g&&(i[g.charCodeAt(0)]=!0)}}populate(e,i,s,c){const d=this.layers[0],f=d.layout,g=this.projection.name==="globe",x=f.get("text-font"),v=f.get("text-field"),E=f.get("icon-image"),I=(v.value.kind!=="constant"||v.value.value instanceof ti&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),A=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,k=f.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const D=i.iconDependencies,O=i.glyphDependencies,$=i.availableImages,H=new Z(this.zoom);for(const{feature:ie,id:re,index:oe,sourceLayerIndex:le}of e){const ue=d._featureFilter.needGeometry,Ee=Xa(ie,ue);if(!d._featureFilter.filter(H,Ee,s))continue;if(ue||(Ee.geometry=Zo(ie,s,c)),g&&ie.type!==1&&s.z<=5){const xe=Ee.geometry,Ae=1<<s.z,Ue=s.x,Ne=s.y,Je=.98078528056;for(let Re=0;Re<xe.length;Re++)xe[Re]=iT(xe[Re],He=>He,(He,Tt)=>Cn(vi(Or((He.y/_t+Ne)/Ae),gi((He.x/_t+Ue)/Ae),1),vi(Or((Tt.y/_t+Ne)/Ae),gi((Tt.x/_t+Ue)/Ae),1))<Je)}let Ce,ke;if(I){const xe=d.getValueAndResolveTokens("text-field",Ee,s,$),Ae=ti.factory(xe);QE(Ae)&&(this.hasRTLText=!0),(!this.hasRTLText||N()==="unavailable"||this.hasRTLText&&V.isParsed())&&(Ce=lE(Ae,d,Ee))}if(A){const xe=d.getValueAndResolveTokens("icon-image",Ee,s,$);ke=xe instanceof $i?xe:$i.fromString(xe)}if(!Ce&&!ke)continue;const Oe=this.sortFeaturesByKey?k.evaluate(Ee,{},s):void 0;if(this.features.push({id:re,text:Ce,icon:ke,index:oe,sourceLayerIndex:le,geometry:Ee.geometry,properties:ie.properties,type:KE[ie.type],sortKey:Oe}),ke&&(D[ke.name]=!0),Ce){const xe=x.evaluate(Ee,{},s).join(","),Ae=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(hn.vertical)>=0;for(const Ue of Ce.sections)if(Ue.image)D[Ue.image.name]=!0;else{const Ne=cc(Ce.toString()),Je=Ue.fontStack||xe,Re=O[Je]=O[Je]||{};this.calculateGlyphDependencies(Ue.text,Re,Ae,this.allowVerticalPlacement,Ne)}}}f.get("symbol-placement")==="line"&&(this.features=function(ie){const re={},oe={},le=[];let ue=0;function Ee(xe){le.push(ie[xe]),ue++}function Ce(xe,Ae,Ue){const Ne=oe[xe];return delete oe[xe],oe[Ae]=Ne,le[Ne].geometry[0].pop(),le[Ne].geometry[0]=le[Ne].geometry[0].concat(Ue[0]),Ne}function ke(xe,Ae,Ue){const Ne=re[Ae];return delete re[Ae],re[xe]=Ne,le[Ne].geometry[0].shift(),le[Ne].geometry[0]=Ue[0].concat(le[Ne].geometry[0]),Ne}function Oe(xe,Ae,Ue){const Ne=Ue?Ae[0][Ae[0].length-1]:Ae[0][0];return`${xe}:${Ne.x}:${Ne.y}`}for(let xe=0;xe<ie.length;xe++){const Ae=ie[xe],Ue=Ae.geometry,Ne=Ae.text?Ae.text.toString():null;if(!Ne){Ee(xe);continue}const Je=Oe(Ne,Ue),Re=Oe(Ne,Ue,!0);if(Je in oe&&Re in re&&oe[Je]!==re[Re]){const He=ke(Je,Re,Ue),Tt=Ce(Je,Re,le[He].geometry);delete re[Je],delete oe[Re],oe[Oe(Ne,le[Tt].geometry,!0)]=Tt,le[He].geometry=null}else Je in oe?Ce(Je,Re,Ue):Re in re?ke(Je,Re,Ue):(Ee(xe),re[Je]=ue-1,oe[Re]=ue-1)}return le.filter(xe=>xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,re)=>ie.sortKey-re.sortKey)}update(e,i,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,s,c),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,s,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_v(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length,c=e.segment;if(c!==void 0){let d=e.dist(i[c+1]),f=e.dist(i[c]);const g={};for(let x=c+1;x<i.length;x++)g[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:d},x<i.length-1&&(d+=i[x+1].dist(i[x]));for(let x=c||0;x>=0;x--)g[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:f},x>0&&(f+=i[x-1].dist(i[x]));for(let x=0;x<i.length;x++){const v=g[x];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,c,d,f,g,x,v,E,I,A,k,D){const O=e.indexArray,$=e.layoutVertexArray,H=e.globeExtVertexArray,ie=e.segments.prepareSegment(4*i.length,$,O,this.canOverlap?f.sortKey:void 0),re=this.glyphOffsetArray.length,oe=ie.vertexLength,le=this.allowVerticalPlacement&&g===hn.vertical?Math.PI/2:0,ue=f.text&&f.text.sections;for(let Ce=0;Ce<i.length;Ce++){const{tl:ke,tr:Oe,bl:xe,br:Ae,tex:Ue,pixelOffsetTL:Ne,pixelOffsetBR:Je,minFontScaleX:Re,minFontScaleY:He,glyphOffset:Tt,isSDF:Mt,sectionIndex:ct}=i[Ce],rt=ie.vertexLength,Pt=Tt[1];if(Bp($,v.x,v.y,ke.x,Pt+ke.y,Ue.x,Ue.y,s,Mt,Ne.x,Ne.y,Re,He),Bp($,v.x,v.y,Oe.x,Pt+Oe.y,Ue.x+Ue.w,Ue.y,s,Mt,Je.x,Ne.y,Re,He),Bp($,v.x,v.y,xe.x,Pt+xe.y,Ue.x,Ue.y+Ue.h,s,Mt,Ne.x,Je.y,Re,He),Bp($,v.x,v.y,Ae.x,Pt+Ae.y,Ue.x+Ue.w,Ue.y+Ue.h,s,Mt,Je.x,Je.y,Re,He),x){const Ct=x.anchor,nt=x.up;Op(H,Ct.x,Ct.y,Ct.z,nt[0],nt[1],nt[2]),Op(H,Ct.x,Ct.y,Ct.z,nt[0],nt[1],nt[2]),Op(H,Ct.x,Ct.y,Ct.z,nt[0],nt[1],nt[2]),Op(H,Ct.x,Ct.y,Ct.z,nt[0],nt[1],nt[2]),Fp(e.dynamicLayoutVertexArray,Ct.x,Ct.y,Ct.z,le)}else Fp(e.dynamicLayoutVertexArray,v.x,v.y,v.z,le);O.emplaceBack(rt,rt+1,rt+2),O.emplaceBack(rt+1,rt+2,rt+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tt[0]),Ce!==i.length-1&&ct===i[Ce+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,f,f.index,{},k,D,ue&&ue[ct])}const Ee=x?x.anchor:v;e.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,v.x,v.y,re,this.glyphOffsetArray.length-re,oe,E,I,v.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],g,0,!1,0,A,0)}_commitLayoutVertex(e,i,s,c,d,f,g){e.emplaceBack(i,s,c,d,f,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,s,c,d,f,g){const x=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),v=x.vertexLength,E=g.tileAnchorX,I=g.tileAnchorY;for(let k=0;k<4;k++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,E,I,new ne(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,E,I,new ne(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,E,I,new ne(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,E,I,new ne(e.x1,e.y2)),x.vertexLength+=4;const A=s.indexArray;A.emplaceBack(v,v+1),A.emplaceBack(v+1,v+2),A.emplaceBack(v+2,v+3),A.emplaceBack(v+3,v),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,c,d,f){for(let g=c;g<d;g++){const x=s.get(g),v=this.getSymbolInstanceTextSize(e,f,i,g);this._addCollisionDebugVertices(x,v,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,s,c,d,f){for(let g=c;g<d;g++){const x=s.get(g),v=this.getSymbolInstanceIconSize(e,i,g);this._addCollisionDebugVertices(x,v,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new I_(ur,Mx.members,zr),this.iconCollisionBox=new I_(ur,Mx.members,zr);const s=gc(this.iconSizeData,e),c=gc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(c,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,i,s,c){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),f=Cp(this.textSizeData,e,d)/ii;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,s){const c=this.icon.placedSymbolArray.get(s),d=Cp(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,s){e.emplaceBack(i,-s,-s),e.emplaceBack(i,s,-s),e.emplaceBack(i,s,s),e.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(e,i,s,c,d,f){for(let g=c;g<d;g++){const x=s.get(g),v=this.getSymbolInstanceTextSize(e,f,i,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,x.padding)}}_updateIconDebugCollisionBoxes(e,i,s,c,d){for(let f=c;f<d;f++){const g=s.get(f),x=this.getSymbolInstanceIconSize(e,i,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,g.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=gc(this.iconSizeData,e),c=gc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(c,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(s,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,c,d,f,g,x,v){const E={};for(let I=i;I<s;I++){const A=e.get(I);E.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},E.textFeatureIndex=A.featureIndex;break}for(let I=c;I<d;I++){const A=e.get(I);E.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},E.verticalTextFeatureIndex=A.featureIndex;break}for(let I=f;I<g;I++){const A=e.get(I);E.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},E.iconFeatureIndex=A.featureIndex;break}for(let I=x;I<v;I++){const A=e.get(I);E.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},E.verticalIconFeatureIndex=A.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),c=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),c=[],d=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const x=this.symbolInstances.get(g);c.push(0|Math.round(i*x.tileAnchorX+s*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((g,x)=>c[g]-c[x]||d[x]-d[g]),f}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,d,f)=>{c>=0&&f.indexOf(c)===d&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tt(Us,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Us.MAX_GLYPHS=65535,Us.addDynamicAttributes=Fp;const eS=new Ie({"symbol-placement":new ve(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new ve(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ve(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ee(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ve(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ve(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ve(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new ve(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ve(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ee(fe.layout_symbol["icon-size"]),"icon-text-fit":new ve(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ve(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ee(fe.layout_symbol["icon-image"]),"icon-rotate":new ee(fe.layout_symbol["icon-rotate"]),"icon-padding":new ve(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new ve(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new ee(fe.layout_symbol["icon-offset"]),"icon-anchor":new ee(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ve(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ve(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ve(fe.layout_symbol["text-rotation-alignment"]),"text-field":new ee(fe.layout_symbol["text-field"]),"text-font":new ee(fe.layout_symbol["text-font"]),"text-size":new ee(fe.layout_symbol["text-size"]),"text-max-width":new ee(fe.layout_symbol["text-max-width"]),"text-line-height":new ee(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new ee(fe.layout_symbol["text-letter-spacing"]),"text-justify":new ee(fe.layout_symbol["text-justify"]),"text-radial-offset":new ee(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ve(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new ee(fe.layout_symbol["text-anchor"]),"text-max-angle":new ve(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new ve(fe.layout_symbol["text-writing-mode"]),"text-rotate":new ee(fe.layout_symbol["text-rotate"]),"text-padding":new ve(fe.layout_symbol["text-padding"]),"text-keep-upright":new ve(fe.layout_symbol["text-keep-upright"]),"text-transform":new ee(fe.layout_symbol["text-transform"]),"text-offset":new ee(fe.layout_symbol["text-offset"]),"text-allow-overlap":new ve(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ve(fe.layout_symbol["text-ignore-placement"]),"text-optional":new ve(fe.layout_symbol["text-optional"])});var A_={paint:new Ie({"icon-opacity":new ee(fe.paint_symbol["icon-opacity"]),"icon-color":new ee(fe.paint_symbol["icon-color"]),"icon-halo-color":new ee(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ee(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ee(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new ve(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new ve(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ee(fe.paint_symbol["text-opacity"]),"text-color":new ee(fe.paint_symbol["text-color"],{runtimeType:sn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ee(fe.paint_symbol["text-halo-color"]),"text-halo-width":new ee(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new ee(fe.paint_symbol["text-halo-blur"]),"text-translate":new ve(fe.paint_symbol["text-translate"]),"text-translate-anchor":new ve(fe.paint_symbol["text-translate-anchor"])}),layout:eS};class gv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:va,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tt(gv,"FormatSectionOverride",{omit:["defaultValue"]});class Up extends Xn{constructor(e){super(e,A_)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const d of s)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,s,c){const d=this.layout.get(e).evaluate(i,{},s,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Wl(f.value)||!d?d:function(g,x){return x.replace(/{([^{}]+)}/g,(v,E)=>E in g?String(g[E]):"")}(i.properties,d)}createBucket(e){return new Us(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of A_.paint.overridableProperties){if(!Up.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new gv(i),c=new ql(s,i.property.specification);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new Xl("source",c):new La("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Se(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Up.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),c=A_.paint.properties[i];let d=!1;const f=g=>{for(const x of g)if(c.overrides&&c.overrides.hasOverride(x))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof ti)f(s.value.value.sections);else if(s.value.kind==="source"){const g=v=>{d||(v instanceof Ta&&_r(v.value)===ds?f(v.value.sections):v instanceof so?f(v.sections):v.eachChild(g))},x=s.value;x._styleExpression&&g(x._styleExpression.expression)}return d}getProgramConfiguration(e){return new Ps(this,e)}}var tS={paint:new Ie({"background-color":new ve(fe.paint_background["background-color"]),"background-pattern":new Pe(fe.paint_background["background-pattern"]),"background-opacity":new ve(fe.paint_background["background-opacity"])})},rS={paint:new Ie({"raster-opacity":new ve(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new ve(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ve(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ve(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new ve(fe.paint_raster["raster-saturation"]),"raster-contrast":new ve(fe.paint_raster["raster-contrast"]),"raster-resampling":new ve(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new ve(fe.paint_raster["raster-fade-duration"])})};class iS extends Xn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var nS={paint:new Ie({"sky-type":new ve(fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new ve(fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ve(fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ve(fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ve(fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new We(fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ve(fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ve(fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ve(fe.paint_sky["sky-opacity"])})};function M_(r,e,i){const s=[0,0,1],c=ix([]);return ox(c,c,i?-ze(r)+Math.PI:ze(r)),nx(c,c,-ze(e)),ex(s,s,c),yi(s,s)}const oS={circle:class extends Xn{constructor(r){super(r,uT)}createBucket(r){return new Xm(r)}queryRadius(r){const e=r;return pc("circle-radius",this,e)+pc("circle-stroke-width",this,e)+cp(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,s,c,d,f,g){const x=H0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return sx(r,s,d,f,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,v)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new Ps(this,r)}},heatmap:class extends Xn{createBucket(r){return new lx(r)}constructor(r){super(r,gT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=n_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return pc("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,s,c,d,f,g){const x=this.paint.get("heatmap-radius").evaluate(e,i);return sx(r,s,d,f,g,!0,!0,new ne(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new Ps(this,r)}},hillshade:class extends Xn{constructor(r){super(r,yT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Xn{constructor(r){super(r,RT)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(r){return new Ps(this,r)}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new wp(r)}queryRadius(){return cp(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,s,c,d){return!r.queryGeometry.isAboveHorizon&&$0(X0(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Xn{constructor(r){super(r,WT)}createBucket(r){return new eh(r)}queryRadius(){return cp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new Ps(this,r)}queryIntersectsFeature(r,e,i,s,c,d,f,g,x){const v=H0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,i),I=this.paint.get("fill-extrusion-base").evaluate(e,i),A=[0,0],k=g&&d.elevation,D=d.elevation?d.elevation.exaggeration():1,O=r.tile.getBucket(this);if(k&&O instanceof eh){const ie=O.centroidVertexArray,re=x+1;if(re<ie.length){const oe=ie.get(re);A[0]=oe.a_centroid_pos0,A[1]=oe.a_centroid_pos1}}if(A[0]===0&&A[1]===1)return!1;d.projection.name==="globe"&&(s=wx([s],[new ne(0,0),new ne(_t,_t)],r.tileID.canonical).map(ie=>ie.polygon).flat());const $=function(ie,re,oe,le,ue,Ee,Ce,ke,Oe,xe,Ae){return ie.projection.name==="globe"?function(Ue,Ne,Je,Re,He,Tt,Mt,ct,rt,Pt,Ct){const nt=[],Fr=[],Cr=Ue.projection.upVectorScale(Ct,Ue.center.lat,Ue.worldSize).metersToTile,vr=[0,0,0,1],Dt=[0,0,0,1],Vt=(tr,Jt,lr,fr)=>{tr[0]=Jt,tr[1]=lr,tr[2]=fr,tr[3]=1},ir=vx();Je>0&&(Je+=ir),Re+=ir;for(const tr of Ne){const Jt=[],lr=[];for(const fr of tr){const Yr=fr.x+He.x,Pi=fr.y+He.y,Rt=Ue.projection.projectTilePoint(Yr,Pi,Ct),wr=Ue.projection.upVector(Ct,fr.x,fr.y);let ci=Je,qt=Re;if(Mt){const mr=Sx(Yr,Pi,Je,Re,Mt,ct,rt,Pt);ci+=mr.base,qt+=mr.top}Je!==0?Vt(vr,Rt.x+wr[0]*Cr*ci,Rt.y+wr[1]*Cr*ci,Rt.z+wr[2]*Cr*ci):Vt(vr,Rt.x,Rt.y,Rt.z),Vt(Dt,Rt.x+wr[0]*Cr*qt,Rt.y+wr[1]*Cr*qt,Rt.z+wr[2]*Cr*qt),ri(vr,vr,Tt),ri(Dt,Dt,Tt),Jt.push(Ep(vr)),lr.push(Ep(Dt))}nt.push(Jt),Fr.push(lr)}return[nt,Fr]}(ie,re,oe,le,ue,Ee,Ce,ke,Oe,xe,Ae):Ce?function(Ue,Ne,Je,Re,He,Tt,Mt,ct,rt){const Pt=[],Ct=[],nt=[0,0,0,1];for(const Fr of Ue){const Cr=[],vr=[];for(const Dt of Fr){const Vt=Dt.x+Re.x,ir=Dt.y+Re.y,tr=Sx(Vt,ir,Ne,Je,Tt,Mt,ct,rt);nt[0]=Vt,nt[1]=ir,nt[2]=tr.base,nt[3]=1,Ka(nt,nt,He),nt[3]=Math.max(nt[3],1e-5);const Jt=Ep([nt[0]/nt[3],nt[1]/nt[3],nt[2]/nt[3]]);nt[0]=Vt,nt[1]=ir,nt[2]=tr.top,nt[3]=1,Ka(nt,nt,He),nt[3]=Math.max(nt[3],1e-5);const lr=Ep([nt[0]/nt[3],nt[1]/nt[3],nt[2]/nt[3]]);Cr.push(Jt),vr.push(lr)}Pt.push(Cr),Ct.push(vr)}return[Pt,Ct]}(re,oe,le,ue,Ee,Ce,ke,Oe,xe):function(Ue,Ne,Je,Re,He){const Tt=[],Mt=[],ct=He[8]*Ne,rt=He[9]*Ne,Pt=He[10]*Ne,Ct=He[11]*Ne,nt=He[8]*Je,Fr=He[9]*Je,Cr=He[10]*Je,vr=He[11]*Je;for(const Dt of Ue){const Vt=[],ir=[];for(const tr of Dt){const Jt=tr.x+Re.x,lr=tr.y+Re.y,fr=He[0]*Jt+He[4]*lr+He[12],Yr=He[1]*Jt+He[5]*lr+He[13],Pi=He[2]*Jt+He[6]*lr+He[14],Rt=He[3]*Jt+He[7]*lr+He[15],wr=fr+ct,ci=Yr+rt,qt=Pi+Pt,mr=Math.max(Rt+Ct,1e-5),wi=fr+nt,hr=Yr+Fr,Ir=Pi+Cr,Kr=Math.max(Rt+vr,1e-5),jr=new ne(wr/mr,ci/mr);jr.z=qt/mr,Vt.push(jr);const ni=new ne(wi/Kr,hr/Kr);ni.z=Ir/Kr,ir.push(ni)}Tt.push(Vt),Mt.push(ir)}return[Tt,Mt]}(re,oe,le,ue,Ee)}(d,s,I,E,v,f,k?g:null,A,D,d.center.lat,r.tileID.canonical),H=r.queryGeometry;return function(ie,re,oe){let le=1/0;$0(oe,re)&&(le=Ex(oe,re[0]));for(let ue=0;ue<re.length;ue++){const Ee=re[ue],Ce=ie[ue];for(let ke=0;ke<Ee.length-1;ke++){const Oe=Ee[ke],xe=[Oe,Ee[ke+1],Ce[ke+1],Ce[ke],Oe];G0(oe,xe)&&(le=Math.min(le,Ex(oe,xe)))}}return le!==1/0&&le}($[0],$[1],H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends Xn{constructor(r){super(r,Cx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Rl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=Ix.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Sp(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new Ps(this,r)}queryRadius(r){const e=r,i=Ax(pc("line-width",this,e),pc("line-gap-width",this,e)),s=pc("line-offset",this,e);return i/2+Math.abs(s)+cp(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,s,c,d){if(r.queryGeometry.isAboveHorizon)return!1;const f=X0(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),g=r.pixelToTileUnitsFactor/2*Ax(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(s=function(v,E){const I=[],A=new ne(0,0);for(let k=0;k<v.length;k++){const D=v[k],O=[];for(let $=0;$<D.length;$++){const H=D[$-1],ie=D[$],re=D[$+1],oe=$===0?A:ie.sub(H)._unit()._perp(),le=$===D.length-1?A:re.sub(ie)._unit()._perp(),ue=oe._add(le)._unit();ue._mult(1/(ue.x*le.x+ue.y*le.y)),O.push(ue._mult(E)._add(ie))}I.push(O)}return I}(s,x*r.pixelToTileUnitsFactor)),function(v,E,I){for(let A=0;A<E.length;A++){const k=E[A];if(v.length>=3){for(let D=0;D<k.length;D++)if(Ha(v,k[D]))return!0}if(sT(v,k,I))return!0}return!1}(f,s,g)}isTileClipped(){return!0}},symbol:Up,background:class extends Xn{constructor(r){super(r,tS)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Xn{constructor(r){super(r,rS)}getProgramIds(){return["raster"]}},sky:class extends Xn{constructor(r){super(r,nS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=n_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),c=!s,d=r.style.light,f=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&zt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?M_(f.azimuthal,90-f.polar,e):M_(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return M_(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}}};class ph{constructor(e,i,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,s){const{width:c,height:d}=e,{context:f}=this,{gl:g}=f,{HTMLImageElement:x,HTMLCanvasElement:v,HTMLVideoElement:E,ImageData:I,ImageBitmap:A}=U;if(g.bindTexture(g.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!i||i.premultiply!==!1)),s||this.size&&this.size[0]===c&&this.size[1]===d){const{x:k,y:D}=s||{x:0,y:0};e instanceof x||e instanceof v||e instanceof E||e instanceof I||A&&e instanceof A?g.texSubImage2D(g.TEXTURE_2D,0,k,D,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,k,D,c,d,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[c,d],e instanceof x||e instanceof v||e instanceof E||e instanceof I||A&&e instanceof A?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,c,d,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class k_{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new qo({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=Co(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const c=[];let d=e.length%2==1?-e[e.length-1]*s:0,f=e[0]*s,g=!0;c.push({left:d,right:f,isDash:g,zeroLength:e[0]===0});let x=e[0];for(let v=1;v<e.length;v++){g=!g;const E=e[v];d=x*s,x+=E,f=x*s,c.push({left:d,right:f,isDash:g,zeroLength:E===0})}return c}addRoundDash(e,i,s){const c=i/2;for(let d=-s;d<=s;d++){const f=this.width*(this.nextRow+s+d);let g=0,x=e[g];for(let v=0;v<this.width;v++){v/x.right>1&&(x=e[++g]);const E=Math.abs(v-x.left),I=Math.abs(v-x.right),A=Math.min(E,I);let k;const D=d/s*(c+1);if(x.isDash){const O=c-Math.abs(D);k=Math.sqrt(A*A+O*O)}else k=c-Math.sqrt(A*A+D*D);this.image.data[f+v]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const v=e[x],E=e[x+1];v.zeroLength?e.splice(x,1):E&&E.isDash===v.isDash&&(E.left=v.left,e.splice(x,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const d=this.width*this.nextRow;let f=0,g=e[f];for(let x=0;x<this.width;x++){x/g.right>1&&(g=e[++f]);const v=Math.abs(x-g.left),E=Math.abs(x-g.right),I=Math.min(v,E);this.image.data[d+x]=Math.max(0,Math.min(255,(g.isDash?I:-I)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const c=i==="round",d=c?7:0,f=2*d+1;if(this.nextRow+f>this.height)return zt("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let E=0;E<e.length;E++)e[E]<0&&(zt("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),g+=e[E];if(g!==0){const E=this.width/g,I=this.getDashRanges(e,this.width,E);c?this.addRoundDash(I,E,d):this.addRegularDash(I,i==="square"?.5*E:0)}const x=this.nextRow+d;this.nextRow+=f;const v={tl:[x,d],br:[g,0]};return this.positions[s]=v,v}}tt(k_,"LineAtlas");class sS{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class aS{constructor(){this.tasks={},this.taskQueue=[],Ui(["process"],this),this.invoker=new sS(this.process),this.nextId=0}add(e,i){const s=this.nextId++,c=function({type:d,isSymbolTile:f,zoom:g}){return g=g||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-g:d==="maybePrepare"&&f?400-g:500:200-g:100-g}(i);if(c===0){qr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:i,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){qr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<i&&(i=d.priority,e=c)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class yv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const lS=["tile","layer","source","sourceLayer","state"];class xv{constructor(e,i,s,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=c,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of lS)this[i]!==void 0&&(e[i]=this[i]);return e}}const An=32,mo=33,Ns=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,i=0,s=0,c=0,d=0,f=0,g=0;for(1&e?c=d=f=An:i=s=g=An;(e>>=1)>1;){const v=i+c>>1,E=s+d>>1;1&e?(c=i,d=s,i=f,s=g):(i=c,s=d,c=f,d=g),f=v,g=E}const x=4*r;Ns[x+0]=i,Ns[x+1]=s,Ns[x+2]=c,Ns[x+3]=d}const _o=new Uint16Array(2178),Vs=new Uint8Array(1089),Np=new Uint16Array(1089);function vv(r){return r===0?-.03125:r===32?.03125:0}var wv=$e([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const bv={type:2,extent:_t,loadGeometry:()=>[[new ne(0,0),new ne(8193,0),new ne(8193,8193),new ne(0,8193),new ne(0,0)]]};class z_{constructor(e,i,s,c,d){this.tileID=e,this.uid=Oi(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Ni.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=el(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const f={};if(!d)return f;for(const g of c){const x=g.layerIds.map(v=>d.getLayer(v)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(v=>x.filter(E=>E.id===v)[0]));for(const v of x)f[v.id]=g}}return f}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Us){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Us&&d.hasRTLText){this.hasRTLText=!0,V.isLoading()||V.isLoaded()||N()!=="deferred"||K();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Nm}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ph(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ph(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ph(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,s,c,d,f,g,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:g,transform:f,params:d,tileTransform:this.tileTransform},e,i,s):{}}querySourceFeatures(e,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),d=i?i.sourceLayer:"",f=c._geojsonTileLayer||c[d];if(!f)return;const g=No(i&&i.filter),{z:x,x:v,y:E}=this.tileID.canonical,I={z:x,x:v,y:E};for(let A=0;A<f.length;A++){const k=f.feature(A);if(g.needGeometry){const $=Xa(k,!0);if(!g.filter(new Z(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!g.filter(new Z(this.tileID.overscaledZ),k))continue;const D=s.getId(k,d),O=new xv(k,x,v,E,D);O.tile=I,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const s=Wr(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const d=this.expirationTime-i;d?this.expirationTime=s+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages();for(const d in this.buckets){if(!i.style.hasLayer(d))continue;const f=this.buckets[d],g=f.layers[0].sourceLayer||"_geojsonTileLayer",x=s[g],v=e[g];if(!x||!v||Object.keys(v).length===0)continue;if(f.update(v,x,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof Sp||f instanceof wp){const I=i.style._getSourceCache(f.layers[0].source);i._terrain&&i._terrain.enabled&&I&&f.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(I.id,this.tileID)}const E=i&&i.style&&i.style.getLayer(d);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ni.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ni.now()+e}setTexture(e,i){const s=i.context,c=s.gl;this.texture=i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new ph(s,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,i){const s={};for(const c of i)s[c]=!0;this.dependencies[e]=s}hasDependency(e,i){for(const s of e){const c=this.dependencies[s];if(c){for(const d of i)if(c[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const s=Zo(bv,this.tileID.canonical,this.tileTransform)[0],c=new ut,d=new En;for(let f=0;f<s.length;f++){const{x:g,y:x}=s[f];c.emplaceBack(g,x),d.emplaceBack(f)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,ah.members),this._tileDebugSegments=Sr.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const s=Zo(bv,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const f=function(g,x){const v=el(g,x),E=Math.pow(2,g.z);for(let $=0;$<mo;$++)for(let H=0;H<mo;H++){const ie=gi((g.x+(H+vv(H))/An)/E),re=Or((g.y+($+vv($))/An)/E),oe=x.project(ie,re),le=$*mo+H;_o[2*le+0]=Math.round((oe.x*v.scale-v.x)*_t),_o[2*le+1]=Math.round((oe.y*v.scale-v.y)*_t)}Vs.fill(0),Np.fill(0);for(let $=2045;$>=0;$--){const H=4*$,ie=Ns[H+0],re=Ns[H+1],oe=Ns[H+2],le=Ns[H+3],ue=ie+oe>>1,Ee=re+le>>1,Ce=ue+Ee-re,ke=Ee+ie-ue,Oe=re*mo+ie,xe=le*mo+oe,Ae=Ee*mo+ue,Ue=Math.hypot((_o[2*Oe+0]+_o[2*xe+0])/2-_o[2*Ae+0],(_o[2*Oe+1]+_o[2*xe+1])/2-_o[2*Ae+1])>=16;if(Vs[Ae]=Vs[Ae]||(Ue?1:0),$<1022){const Ne=(re+ke>>1)*mo+(ie+Ce>>1),Je=(le+ke>>1)*mo+(oe+Ce>>1);Vs[Ae]=Vs[Ae]||Vs[Ne]||Vs[Je]}}const I=new ot,A=new Ot;let k=0;function D($,H){const ie=H*mo+$;return Np[ie]===0&&(I.emplaceBack(_o[2*ie+0],_o[2*ie+1],$*_t/An,H*_t/An),Np[ie]=++k),Np[ie]-1}function O($,H,ie,re,oe,le){const ue=$+ie>>1,Ee=H+re>>1;if(Math.abs($-oe)+Math.abs(H-le)>1&&Vs[Ee*mo+ue])O(oe,le,$,H,ue,Ee),O(ie,re,oe,le,ue,Ee);else{const Ce=D($,H),ke=D(ie,re),Oe=D(oe,le);A.emplaceBack(Ce,ke,Oe)}}return O(0,0,An,An,An,0),O(An,An,0,0,0,An),{vertices:I,indices:A}}(this.tileID.canonical,i);c=f.vertices,d=f.indices}else{c=new ot,d=new Ot;for(const{x:g,y:x}of s)c.emplaceBack(g,x,0,0);const f=_p(c.int16,void 0,4);for(let g=0;g<f.length;g+=3)d.emplaceBack(f[g],f[g+1],f[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,wv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Sr.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(e,i){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!i||i.name!=="globe")return;const s=this.tileID.canonical,c=lh(fo(s));this._makeGlobeTileDebugBorderBuffer(e,s,c),this._makeGlobeTileDebugTextBuffer(e,s,c)}_makeGlobeTileDebugBorderBuffer(e,i,s){const c=new ut,d=new En,f=new St,g=(v,E,I,A,k)=>{const D=(I-v)/(k-1),O=(A-E)/(k-1),$=c.length;for(let H=0;H<k;H++){const ie=v+H*D,re=E+H*O;c.emplaceBack(ie,re);const oe=sv(ie,re,i),le=ri(oe,oe,s);f.emplaceBack(le[0],le[1],le[2]),d.emplaceBack($+H)}},x=_t;g(0,0,x,0,16),g(x,0,x,x,16),g(x,x,0,x,16),g(0,x,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,ah.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(f,iv.members),this._tileDebugSegments=Sr.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugTextBuffer(e,i,s){const c=new ut,d=new Ot,f=new St,g=25;d.reserve(32),c.reserve(g),f.reserve(g);const x=(v,E)=>g*v+E;for(let v=0;v<g;v++){const E=2048*v;for(let I=0;I<g;I++){const A=2048*I;c.emplaceBack(A,E);const k=sv(A,E,i),D=ri(k,k,s);f.emplaceBack(D[0],D[1],D[2])}}for(let v=0;v<4;v++)for(let E=0;E<4;E++){const I=x(v,E),A=x(v,E+1),k=x(v+1,E),D=x(v+1,E+1);d.emplaceBack(I,A,k),d.emplaceBack(k,A,D)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(d),this._tileDebugTextBuffer=e.createVertexBuffer(c,ah.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(f,iv.members),this._tileDebugTextSegments=Sr.simpleSegment(0,0,g,32)}}class cS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,s){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},xt(this.stateChanges[e][c],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])s[d]||(this.deletedStates[e][c][d]=null)}else for(const d in s)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,i,s){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const s=String(i),c=xt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][i];if(d===null)return{};for(const f in d)delete c[f]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const f in this.stateChanges[c])this.state[c][f]||(this.state[c][f]={}),xt(this.state[c][f],this.stateChanges[c][f]),d[f]=this.state[c][f];s[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const f in this.state[c])d[f]={},this.state[c][f]={};else for(const f in this.deletedStates[c]){if(this.deletedStates[c][f]===null)this.state[c][f]={};else for(const g of Object.keys(this.deletedStates[c][f]))delete this.state[c][f][g];d[f]=this.state[c][f]}s[c]=s[c]||{},xt(s[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const c in e)e[c].setFeatureState(s,i)}}class Tv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Ev(r,e,i,s){let c=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(s[f])<1e-15){if(i[f]<r[f]||i[f]>e[f])return null}else{const g=1/s[f];let x=(r[f]-i[f])*g,v=(e[f]-i[f])*g;if(x>v){const E=x;x=v,v=E}if(x>c&&(c=x),v<d&&(d=v),c>d)return null}return c}function Sv(r,e,i,s,c,d,f,g,x,v,E){const I=s-r,A=c-e,k=d-i,D=f-r,O=g-e,$=x-i,H=E[1]*$-E[2]*O,ie=E[2]*D-E[0]*$,re=E[0]*O-E[1]*D,oe=I*H+A*ie+k*re;if(Math.abs(oe)<1e-15)return null;const le=1/oe,ue=v[0]-r,Ee=v[1]-e,Ce=v[2]-i,ke=(ue*H+Ee*ie+Ce*re)*le;if(ke<0||ke>1)return null;const Oe=Ee*k-Ce*A,xe=Ce*I-ue*k,Ae=ue*A-Ee*I,Ue=(E[0]*Oe+E[1]*xe+E[2]*Ae)*le;return Ue<0||ke+Ue>1?null:(D*Oe+O*xe+$*Ae)*le}function Cv(r,e,i){return(r-e)/(i-e)}function Iv(r,e,i,s,c,d,f,g,x){const v=1<<i,E=d-s,I=f-c,A=(r+1)/v*E+s,k=(e+0)/v*I+c,D=(e+1)/v*I+c;g[0]=(r+0)/v*E+s,g[1]=k,x[0]=A,x[1]=D}class Av{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const f=Math.ceil(Math.log2(d.dim/8)),g=[];let x=Math.ceil(Math.pow(2,f));const v=1/x,E=(k,D,O,$,H)=>{const ie=$?1:0,re=(k+1)*O-ie,oe=D*O,le=(D+1)*O-ie;H[0]=k*O,H[1]=oe,H[2]=re,H[3]=le};let I=new Tv(x);const A=[];for(let k=0;k<x*x;k++){E(k%x,Math.floor(k/x),v,!1,A);const D=js(A[0],A[1],d),O=js(A[2],A[1],d),$=js(A[2],A[3],d),H=js(A[0],A[3],d);I.minimums.push(Math.min(D,O,$,H)),I.maximums.push(Math.max(D,O,$,H)),I.leaves.push(1)}for(g.push(I),x/=2;x>=1;x/=2){const k=g[g.length-1];I=new Tv(x);for(let D=0;D<x*x;D++){E(D%x,Math.floor(D/x),2,!0,A);const O=k.getElevation(A[0],A[1]),$=k.getElevation(A[2],A[1]),H=k.getElevation(A[2],A[3]),ie=k.getElevation(A[0],A[3]),re=k.isLeaf(A[0],A[1]),oe=k.isLeaf(A[2],A[1]),le=k.isLeaf(A[2],A[3]),ue=k.isLeaf(A[0],A[3]),Ee=Math.min(O.min,$.min,H.min,ie.min),Ce=Math.max(O.max,$.max,H.max,ie.max),ke=re&&oe&&le&&ue;I.maximums.push(Ce),I.minimums.push(Ee),I.leaves.push(Ce-Ee<=5&&ke?1:0)}g.push(I)}return g}(this.dem),s=i.length-1,c=i[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,c,d,f,g=1){return Ev([e,i,-100],[s,c,this.maximums[0]*g],d,f)}raycast(e,i,s,c,d,f,g=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,s,c,d,f,g);if(x==null)return null;const v=[],E=[],I=[],A=[],k=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;k.length>0;){const{idx:D,t:O,nodex:$,nodey:H,depth:ie}=k.pop();if(this.leaves[D]){Iv($,H,ie,e,i,s,c,I,A);const oe=1<<ie,le=($+0)/oe,ue=($+1)/oe,Ee=(H+0)/oe,Ce=(H+1)/oe,ke=js(le,Ee,this.dem)*g,Oe=js(ue,Ee,this.dem)*g,xe=js(ue,Ce,this.dem)*g,Ae=js(le,Ce,this.dem)*g,Ue=Sv(I[0],I[1],ke,A[0],I[1],Oe,A[0],A[1],xe,d,f),Ne=Sv(A[0],A[1],xe,I[0],A[1],Ae,I[0],I[1],ke,d,f),Je=Math.min(Ue!==null?Ue:Number.MAX_VALUE,Ne!==null?Ne:Number.MAX_VALUE);if(Je!==Number.MAX_VALUE)return Je;{const Re=mp([],d,f,O);if(Mv(ke,Oe,Ae,xe,Cv(Re[0],I[0],A[0]),Cv(Re[1],I[1],A[1]))>=Re[2])return O}continue}let re=0;for(let oe=0;oe<this._siblingOffset.length;oe++){Iv(($<<1)+this._siblingOffset[oe][0],(H<<1)+this._siblingOffset[oe][1],ie+1,e,i,s,c,I,A),I[2]=-100,A[2]=this.maximums[this.childOffsets[D]+oe]*g;const le=Ev(I,A,d,f);if(le!=null){const ue=le;v[oe]=ue;let Ee=!1;for(let Ce=0;Ce<re&&!Ee;Ce++)ue>=v[E[Ce]]&&(E.splice(Ce,0,oe),Ee=!0);Ee||(E[re]=oe),re++}}for(let oe=0;oe<re;oe++){const le=E[oe];k.push({idx:this.childOffsets[D]+le,t:v[le],nodex:($<<1)+this._siblingOffset[le][0],nodey:(H<<1)+this._siblingOffset[le][1],depth:ie+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,c,d){if(e[c].isLeaf(i,s)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=c-1,g=e[f];let x=0,v=0;for(let E=0;E<this._siblingOffset.length;E++){const I=2*i+this._siblingOffset[E][0],A=2*s+this._siblingOffset[E][1],k=g.getElevation(I,A),D=g.isLeaf(I,A),O=this._addNode(k.min,k.max,D);D&&(x|=1<<E),v||(v=O)}for(let E=0;E<this._siblingOffset.length;E++)x&1<<E||this._construct(e,2*i+this._siblingOffset[E][0],2*s+this._siblingOffset[E][1],f,v+E)}}function Mv(r,e,i,s,c,d){return Ut(Ut(r,i,d),Ut(e,s,d),c)}function js(r,e,i){const s=i.dim,c=Fe(r*s-.5,0,s-1),d=Fe(e*s-.5,0,s-1),f=Math.floor(c),g=Math.floor(d),x=Math.min(f+1,s-1),v=Math.min(g+1,s-1);return Mv(i.get(f,g),i.get(x,g),i.get(f,v),i.get(x,v),c-f,d-g)}const kv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Vp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,c=!1,d=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return zt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,g=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,!c){for(let x=0;x<f;x++)g[this._idx(-1,x)]=g[this._idx(0,x)],g[this._idx(f,x)]=g[this._idx(f-1,x)],g[this._idx(x,-1)]=g[this._idx(x,0)],g[this._idx(x,f)]=g[this._idx(x,f-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(f,-1)]=g[this._idx(f-1,0)],g[this._idx(-1,f)]=g[this._idx(0,f-1)],g[this._idx(f,f)]=g[this._idx(f-1,f-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Av(this)}get(e,i,s=!1){s&&(e=Fe(e,-1,this.dim),i=Fe(i,-1,this.dim));const c=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return kv[e]}get unpackVector(){return kv[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,s){return(256*e*256+256*i+s)/10-1e4}_unpackTerrarium(e,i,s){return 256*e+i+s/256-32768}static pack(e,i){const s=[0,0,0,0],c=Vp.getUnpackVector(i);let d=Math.floor((e+c[3])/c[2]);return s[2]=d%256,d=Math.floor(d/256),s[1]=d%256,d=Math.floor(d/256),s[0]=d,s}getPixels(){return new Hi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,d=i*this.dim+this.dim,f=s*this.dim,g=s*this.dim+this.dim;switch(i){case-1:c=d-1;break;case 1:d=c+1}switch(s){case-1:f=g-1;break;case 1:g=f+1}const x=-i*this.dim,v=-s*this.dim;for(let E=f;E<g;E++)for(let I=c;I<d;I++){const A=4*this._idx(I,E),k=4*this._idx(I+x,E+v);this.pixels[A+0]=e.pixels[k+0],this.pixels[A+1]=e.pixels[k+1],this.pixels[A+2]=e.pixels[k+2],this.pixels[A+3]=e.pixels[k+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}tt(Vp,"DEMData"),tt(Av,"DemMinMaxQuadTree",{omit:["dem"]});class uS{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,s){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:i,timeout:void 0};if(s!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},s)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const s=e.wrapped().key,c=i===void 0?0:this.data[s].indexOf(i),d=this.data[s][c];return this.data[s].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||i.push(c);for(const s of i)this.remove(s.value.tileID,s)}}class Sc{constructor(e,i,s){this.func=e,this.mask=i,this.range=s}}Sc.ReadOnly=!1,Sc.ReadWrite=!0,Sc.disabled=new Sc(519,Sc.ReadOnly,[0,1]);const P_=7680;class D_{constructor(e,i,s,c,d,f){this.test=e,this.ref=i,this.mask=s,this.fail=c,this.depthFail=d,this.pass=f}}D_.disabled=new D_({func:519,mask:0},0,0,P_,P_,P_);class go{constructor(e,i,s){this.blendFunction=e,this.blendColor=i,this.mask=s}}go.Replace=[1,0],go.disabled=new go(go.Replace,xr.transparent,[!1,!1,!1,!1]),go.unblended=new go(go.Replace,xr.transparent,[!0,!0,!0,!0]),go.alphaBlended=new go([1,771],xr.transparent,[!0,!0,!0,!0]);const L_=1029,R_=2305;class Hn{constructor(e,i,s){this.enable=e,this.mode=i,this.frontFace=s}}Hn.disabled=new Hn(!1,L_,R_),Hn.backCCW=new Hn(!0,L_,R_),Hn.backCW=new Hn(!0,L_,2304),Hn.frontCW=new Hn(!0,1028,2304),Hn.frontCCW=new Hn(!0,1028,R_);class tl extends Xt{constructor(e,i,s){super(),this.id=e,this._onlySymbols=s,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new uS(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new cS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const i in this._tiles){const s=this._tiles[i];this._source.prepareTile(s)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,s.tileID),s.upload(e),s.prepare(this.map.style.imageManager)}else for(const i in this._tiles){const s=this._tiles[i];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return nr(this._tiles).map(e=>e.tileID).sort(zv).map(e=>e.key)}getRenderableIds(e){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&i.push(this._tiles[s]);return e?i.sort((s,c)=>{const d=s.tileID,f=c.tileID,g=new ne(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),x=new ne(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-f.overscaledZ||x.y-g.y||x.x-g.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(zv).map(s=>s.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,e,i)))}_tileLoaded(e,i,s,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new or(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ni.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new jt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const d=i[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const f=this.getTileByID(d);s(e,f),s(f,e)}}function s(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let f=d.tileID.canonical.x-c.tileID.canonical.x;const g=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),v=d.tileID.key;f===0&&g===0||Math.abs(g)>1||(Math.abs(f)>1&&(Math.abs(f+x)===1?f+=x:Math.abs(f-x)===1&&(f-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,f,g),c.neighboringTiles&&c.neighboringTiles[v]&&(c.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,s,c){for(const d in this._tiles){let f=this._tiles[d];if(c[d]||!f.hasData()||f.tileID.overscaledZ<=i||f.tileID.overscaledZ>s)continue;let g=f.tileID;for(;f&&f.tileID.overscaledZ>i+1;){const v=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[v.key],f&&f.hasData()&&(g=v)}let x=g;for(;x.overscaledZ>i;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){c[g.key]=g;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=e.overscaledZ-1;s>=i;s--){const c=e.scaledTo(s),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const s=Math.ceil(e.width/i)+1,c=Math.ceil(e.height/i)+1,d=Math.floor(s*c*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const s={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),s[d.tileID.key]=d}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new xi(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(c=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(g=>this._source.hasTile(g)))):c=[];const d=this._updateRetainedTiles(c);if(Pv(this._source.type)&&c.length!==0){const g={},x={},v=Object.keys(d);for(const I of v){const A=d[I],k=this._tiles[I];if(!k||k.fadeEndTime&&k.fadeEndTime<=Ni.now())continue;const D=this.findLoadedParent(A,Math.max(A.overscaledZ-tl.maxOverzooming,this._source.minzoom));D&&(this._addTile(D.tileID),g[D.tileID.key]=D.tileID),x[I]=A}const E=c[c.length-1].overscaledZ;for(const I in this._tiles){const A=this._tiles[I];if(d[I]||!A.hasData())continue;let k=A.tileID;for(;k.overscaledZ>E;){k=k.scaledTo(k.overscaledZ-1);const D=this._tiles[k.key];if(D&&D.hasData()&&x[k.key]){d[I]=A.tileID;break}}}for(const I in g)d[I]||(this._coveredTiles[I]=!0,d[I]=g[I])}for(const g in d)this._tiles[g].clearFadeHold();const f=function(g,x){const v=[];for(const E in g)E in x||v.push(E);return v}(this._tiles,d);for(const g of f){const x=this._tiles[g];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const s={},c=e.reduce((v,E)=>Math.min(v,E.overscaledZ),1/0),d=e[0].overscaledZ,f=Math.max(d-tl.maxOverzooming,this._source.minzoom),g=Math.max(d+tl.maxUnderzooming,this._source.minzoom),x={};for(const v of e){const E=this._addTile(v);i[v.key]=v,E.hasData()||c<this._source.maxzoom&&(x[v.key]=v)}this._retainLoadedChildren(x,c,g,i);for(const v of e){let E=this._tiles[v.key];if(E.hasData())continue;if(v.canonical.z>=this._source.maxzoom){const A=v.children(this._source.maxzoom)[0],k=this.getTile(A);if(k&&k.hasData()){i[A.key]=A;continue}}else{const A=v.children(this._source.maxzoom);if(i[A[0].key]&&i[A[1].key]&&i[A[2].key]&&i[A[3].key])continue}let I=E.wasRequested();for(let A=v.overscaledZ-1;A>=f;--A){const k=v.scaledTo(A);if(s[k.key]||(s[k.key]=!0,E=this.getTile(k),!E&&I&&(E=this._addTile(k)),E&&(i[k.key]=k,I=E.wasRequested(),E.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}i.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(d),s)break;c=d}for(const d of i)this._loadedParentTiles[d]=s}}_addTile(e){let i=this._tiles[e.key];if(i)return this._source.prepareTile&&this._source.prepareTile(i),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const s=Boolean(i);if(!s){const c=this.map?this.map.painter:null;i=new z_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._source.prepareTile&&this._source.prepareTile(i)||this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,s||this._source.fire(new jt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=i.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,s){const c=[],d=this.transform;if(!d)return c;const f=d.projection.name==="globe",g=qa(d.center.lng);for(const x in this._tiles){const v=this._tiles[x];if(s&&v.clearQueryDebugViz(),v.holdingForFade())continue;let E;if(f){const I=v.tileID.canonical;if(I.z===0){const A=[Math.abs(Fe(g,...fh(I,-1))-g),Math.abs(Fe(g,...fh(I,1))-g)];E=[0,2*A.indexOf(Math.min(...A))-1]}else{const A=[Math.abs(Fe(g,...fh(I,-1))-g),Math.abs(Fe(g,...fh(I,0))-g),Math.abs(Fe(g,...fh(I,1))-g)];E=[A.indexOf(Math.min(...A))-1]}}else E=[0];for(const I of E){const A=e.containsTile(v,d,i,I);A&&c.push(A)}}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Pv(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Ni.now())return!0}return!1}setFeatureState(e,i,s){this._state.updateState(e=e||"_geojsonTileLayer",i,s)}removeFeatureState(e,i,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,s)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,s){const c=this._tiles[e];c&&c.setDependencies(i,s)}reloadTilesForDependencies(e,i){for(const s in this._tiles)this._tiles[s].hasDependency(e,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,i))}_preloadTiles(e,i){const s=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,f=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const g of c){const x=g.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const v of x)s.set(v.key,v);this.usedForTerrain&&g.updateElevation(!1)}ft(Array.from(s.values()),(g,x)=>{const v=new z_(g,this._source.tileSize*g.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(v,E=>{this._source.type==="raster-dem"&&v.dem&&this._backfillDEM(v),x(E,v)})},i)}}function zv(r,e){const i=Math.abs(2*r.wrap)-+(r.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||s-i||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function Pv(r){return r==="raster"||r==="image"||r==="video"}function fh(r,e){const i=1<<r.z;return[r.x/i+e,(r.x+1)/i+e]}tl.maxOverzooming=10,tl.maxUnderzooming=3;class jp{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const c=s||e.findDEMTileFor(i);if(!c||!c.dem)return;const d=c.dem,f=c.tileID,g=1<<i.canonical.z-f.canonical.z;return new jp(c,c.tileSize/_t/g,[(i.canonical.x/g-f.canonical.x)*d.dim,(i.canonical.y/g-f.canonical.y)*d.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(s);return new ne(c,d)}getElevationAt(e,i,s,c){const d=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],g=Math.floor(d),x=Math.floor(f),v=this._dem;return c=!!c,s?Ut(Ut(v.get(g,x,c),v.get(g,x+1,c),f-x),Ut(v.get(g+1,x,c),v.get(g+1,x+1,c),f-x),d-g):v.get(g,x,c)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Sn(1,e)*this._dem.stride}}class Dv{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new As(_t,16,0),this.featureIndexArray=new M0,this.promoteId=i}insert(e,i,s,c,d,f=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,d,f);const x=this.grid;for(let v=0;v<i.length;v++){const E=i[v],I=[1/0,1/0,-1/0,-1/0];for(let A=0;A<E.length;A++){const k=E[A];I[0]=Math.min(I[0],k.x),I[1]=Math.min(I[1],k.y),I[2]=Math.max(I[2],k.x),I[3]=Math.max(I[3],k.y)}I[0]<_t&&I[1]<_t&&I[2]>=0&&I[3]>=0&&x.insert(g,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ja.VectorTile(new nh(this.rawTileData)).layers,this.sourceLayerCoder=new yv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,c){this.loadVTLayers();const d=e.params||{},f=No(d.filter),g=e.tileResult,x=e.transform,v=g.bufferedTilespaceBounds,E=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(D,O,$,H)=>W0(g.bufferedTilespaceGeometry,D,O,$,H));E.sort(hS);let I=null;x.elevation&&E.length>0&&(I=jp.create(x.elevation,this.tileID));const A={};let k;for(let D=0;D<E.length;D++){const O=E[D];if(O===k)continue;k=O;const $=this.featureIndexArray.get(O);let H=null;this.loadMatchingFeature(A,$,f,d.layers,d.availableImages,i,s,c,(ie,re,oe,le=0)=>(H||(H=Zo(ie,this.tileID.canonical,e.tileTransform)),re.queryIntersectsFeature(g,ie,oe,H,this.z,e.transform,e.pixelPosMatrix,I,le)))}return A}loadMatchingFeature(e,i,s,c,d,f,g,x,v){const{featureIndex:E,bucketIndex:I,sourceLayerIndex:A,layoutVertexArrayOffset:k}=i,D=this.bucketLayerIDs[I];if(c&&!function(ie,re){for(let oe=0;oe<ie.length;oe++)if(re.indexOf(ie[oe])>=0)return!0;return!1}(c,D))return;const O=this.sourceLayerCoder.decode(A),$=this.vtLayers[O].feature(E);if(s.needGeometry){const ie=Xa($,!0);if(!s.filter(new Z(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!s.filter(new Z(this.tileID.overscaledZ),$))return;const H=this.getId($,O);for(let ie=0;ie<D.length;ie++){const re=D[ie];if(c&&c.indexOf(re)<0)continue;const oe=f[re];if(!oe)continue;let le={};H!==void 0&&x&&(le=x.getState(oe.sourceLayer||"_geojsonTileLayer",H));const ue=xt({},g[re]);ue.paint=Lv(ue.paint,oe.paint,$,le,d),ue.layout=Lv(ue.layout,oe.layout,$,le,d);const Ee=!v||v($,oe,le,k);if(!Ee)continue;const Ce=new xv($,this.z,this.x,this.y,H);Ce.layer=ue;let ke=e[re];ke===void 0&&(ke=e[re]=[]),ke.push({featureIndex:E,feature:Ce,intersectionZ:Ee})}}lookupSymbolFeatures(e,i,s,c,d,f,g,x){const v={};this.loadVTLayers();const E=No(d);for(const I of e)this.loadMatchingFeature(v,{bucketIndex:s,sourceLayerIndex:c,featureIndex:I,layoutVertexArrayOffset:0},E,f,g,x,i);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),d=this.vtFeatures[c];if(d[i])return d[i];const f=this.vtLayers[c].feature(i);return d[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof s=="boolean"&&(s=Number(s))),s}}function Lv(r,e,i,s,c){return it(r,(d,f)=>{const g=e instanceof Te?e.get(f):null;return g&&g.evaluate?g.evaluate(i,s,c):g})}function hS(r,e){return e-r}tt(Dv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Rv{constructor(e){const i={},s=[];for(const g in e){const x=e[g],v=i[g]={};for(const E in x.glyphs){const I=x.glyphs[+E];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const A=I.metrics.localGlyph?2:1,k={x:0,y:0,w:I.bitmap.width+2*A,h:I.bitmap.height+2*A};s.push(k),v[E]=k}}const{w:c,h:d}=p_(s),f=new qo({width:c||1,height:d||1});for(const g in e){const x=e[g];for(const v in x.glyphs){const E=x.glyphs[+v];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const I=i[g][v],A=E.metrics.localGlyph?2:1;qo.copy(E.bitmap,f,{x:0,y:0},{x:I.x+A,y:I.y+A},E.bitmap)}}this.image=f,this.positions=i}}tt(Rv,"GlyphAtlas");class dS{constructor(e){this.tileID=new xi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=el(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,s,c,d){this.status="parsing",this.data=e,this.collisionBoxArray=new Nm;const f=new yv(Object.keys(e.layers).sort()),g=new Dv(this.tileID,this.promoteId);g.bucketLayerIDs=[];const x={},v=new k_(256,256),E={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:v,availableImages:s},I=i.familiesBySource[this.source];for(const le in I){const ue=e.layers[le];if(!ue)continue;let Ee=!1,Ce=!1;for(const xe of I[le])xe[0].type==="symbol"?Ee=!0:Ce=!0;if(this.isSymbolTile===!0&&!Ee||this.isSymbolTile===!1&&!Ce)continue;ue.version===1&&zt(`Vector tile source "${this.source}" layer "${le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ke=f.encode(le),Oe=[];for(let xe=0;xe<ue.length;xe++){const Ae=ue.feature(xe),Ue=g.getId(Ae,le);Oe.push({feature:Ae,id:Ue,index:xe,sourceLayerIndex:ke})}for(const xe of I[le]){const Ae=xe[0];this.isSymbolTile!==void 0&&Ae.type==="symbol"!==this.isSymbolTile||Ae.minzoom&&this.zoom<Math.floor(Ae.minzoom)||Ae.maxzoom&&this.zoom>=Ae.maxzoom||Ae.visibility!=="none"&&(B_(xe,this.zoom,s),(x[Ae.id]=Ae.createBucket({index:g.bucketLayerIDs.length,layers:xe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ke,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Oe,E,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(xe.map(Ue=>Ue.id)))}}let A,k,D,O;v.trim();const $={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},H=it(E.glyphDependencies,le=>Object.keys(le).map(Number));Object.keys(H).length?c.send("getGlyphs",{uid:this.uid,stacks:H},(le,ue)=>{A||(A=le,k=ue,oe.call(this))},void 0,!1,$):k={};const ie=Object.keys(E.iconDependencies);ie.length?c.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(le,ue)=>{A||(A=le,D=ue,oe.call(this))},void 0,!1,$):D={};const re=Object.keys(E.patternDependencies);function oe(){if(A)return d(A);if(k&&D&&O){const le=new Rv(k),ue=new Bx(D,O);for(const Ee in x){const Ce=x[Ee];Ce instanceof Us?(B_(Ce.layers,this.zoom,s),LE(Ce,k,le.positions,D,ue.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Ce.hasPattern&&(Ce instanceof Sp||Ce instanceof wp||Ce instanceof eh)&&(B_(Ce.layers,this.zoom,s),Ce.addFeatures(E,this.tileID.canonical,ue.patternPositions,s,this.tileTransform))}this.status="done",d(null,{buckets:nr(x).filter(Ee=>!Ee.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:le.image,lineAtlas:v,imageAtlas:ue,glyphMap:this.returnDependencies?k:null,iconMap:this.returnDependencies?D:null,glyphPositions:this.returnDependencies?le.positions:null})}}re.length?c.send("getImages",{icons:re,source:this.source,tileID:this.tileID,type:"patterns"},(le,ue)=>{A||(A=le,O=ue,oe.call(this))},void 0,!1,$):O={},oe.call(this)}}function B_(r,e,i){const s=new Z(e);for(const c of r)c.recalculate(s,i)}class Bv{constructor(e){this.entries={},this.scheduler=e}request(e,i,s,c){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[f,g]=d.result;return this.scheduler?this.scheduler.add(()=>{c(f,g)},i):c(f,g),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=s((f,g)=>{d.result=[f,g];for(const x of d.callbacks)this.scheduler?this.scheduler.add(()=>{x(f,g)},i):x(f,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(f=>f!==c),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function Ov(r,e,i){const s=JSON.stringify(r.request);return r.data&&(this.deduped.entries[s]={result:[null,r.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},c=>{const d=ce(r.request,(f,g,x,v)=>{f?c(f):g&&c(null,{vectorTile:i?void 0:new Ja.VectorTile(new nh(g)),rawData:g,cacheControl:x,expires:v})});return()=>{d.cancel(),c()}},e)}a.ARRAY_TYPE=Wi,a.AUTH_ERR_MSG=Ii,a.Aabb=un,a.Actor=class{constructor(r,e,i){this.target=r,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Ui(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=qr()?r:U,this.scheduler=new aS}send(r,e,i,s,c=!1,d){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=d,this.callbacks[f]=i);const g=ls(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:r,hasCallback:!!i,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:Na(e,g)},g),{cancel:()=>{i&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(r){const e=r.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(e.mustQueue||qr()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),s&&s.metadata||{type:"message"})}else this.processTask(i,e)}processTask(r,e){if(e.type==="<response>"){const i=this.callbacks[r];delete this.callbacks[r],i&&(e.error?i(Va(e.error)):i(null,Va(e.data)))}else{const i=ls(this.globalScope)?void 0:[],s=e.hasCallback?(d,f)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:d?Na(d):null,data:Na(f,i)},i)}:d=>{},c=Va(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,s);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],c.source)[d[1]](c,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Tp,a.Color=xr,a.ColorMode=go,a.CullFaceMode=Hn,a.DEMData=Vp,a.DataConstantProperty=ve,a.DedupedRequest=Bv,a.DepthMode=Sc,a.EXTENT=_t,a.Elevation=class{isDataAvailableAtPoint(r){const e=this._source();if(!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,c=Math.floor(r.x),d=Math.floor((r.x-c)*s),f=Math.floor(r.y*s),g=this.findDEMTileFor(new xi(i,c,i,d,f));return!(!g||!g.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){e==null&&(e=null);const s=this._source();if(!s||r.y<0||r.y>1)return e;const c=s.getSource().maxzoom,d=1<<c,f=Math.floor(r.x),g=r.x-f,x=new xi(c,f,c,Math.floor(g*d),Math.floor(r.y*d)),v=this.findDEMTileFor(x);if(!v||!v.dem)return e;const E=v.dem,I=1<<v.tileID.canonical.z,A=(g*I-v.tileID.canonical.x)*E.dim,k=(r.y*I-v.tileID.canonical.y)*E.dim,D=Math.floor(A),O=Math.floor(k);return(i?this.exaggeration():1)*Ut(Ut(E.get(D,O),E.get(D,O+1),k-O),Ut(E.get(D+1,O),E.get(D+1,O+1),k-O),A-D)}getAtTileOffset(r,e,i){const s=1<<r.canonical.z;return this.getAtPointOrZero(new dc(r.wrap+(r.canonical.x+e/_t)/s,(r.canonical.y+i/_t)/s))}getAtTileOffsetFunc(r,e,i,s){return c=>{const d=this.getAtTileOffset(r,c.x,c.y),f=s.upVector(r.canonical,c.x,c.y);return ho(f,f,d*s.upVectorScale(r.canonical,e,i).metersToTile),f}}getForTilePoints(r,e,i,s){const c=jp.create(this,r,s);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(r){const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,c=1<<r.canonical.z-s.canonical.z;let d=r.canonical.x/c-s.canonical.x,f=r.canonical.y/c-s.canonical.y,g=0;for(let x=0;x<r.canonical.z-s.canonical.z&&!i.leaves[g];x++){d*=2,f*=2;const v=2*Math.floor(f)+Math.floor(d);g=i.childOffsets[g]+v,d%=1,f%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=or,a.EvaluationParameters=Z,a.Event=jt,a.Evented=Xt,a.FillExtrusionBucket=eh,a.Frustum=r_,a.FrustumCorners=t_,a.GLOBE_METERS_TO_ECEF=b_,a.GLOBE_RADIUS=Qa,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GLOBE_ZOOM_THRESHOLD_MIN=5,a.GlobeSharedBuffers=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const r of this._wireframeSegments)r.destroy()}}_createGrid(r){const e=new ut,i=new Ot,s=65;for(let c=0;c<s;c++)for(let d=0;d<s;d++)e.emplaceBack(d,c);this._gridSegments=[];for(let c=0,d=0;c<Tc.length;c++){const f=Tc[c];for(let x=0;x<f;x++)for(let v=0;v<64;v++){const E=x*s+v;i.emplaceBack(E+1,E,E+s),i.emplaceBack(E+s,E+s+1,E+1)}const g=64*f*2;this._gridSegments.push(Sr.simpleSegment(0,d,(f+1)*s,g)),d+=g}this._gridBuffer=r.createVertexBuffer(e,ah.members),this._gridIndexBuffer=r.createIndexBuffer(i,!0)}_createPoles(r){const e=new Ot;for(let c=0;c<=64;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new Ms,s=new Ms;this._poleSegments=[];for(let c=0,d=0;c<5;c++){const f=1<<c,g=512*f/Math.PI/2,x=360/f;i.emplaceBack(0,-g,0,0,0,.5,0),s.emplaceBack(0,-g,0,0,0,.5,1);for(let v=0;v<=64;v++){const E=v/64,I=Ut(0,x,E),[A,k,D]=ov(VE,jE,I,g);i.emplaceBack(A,k,D,0,0,E,0),s.emplaceBack(A,k,D,0,0,E,1)}this._poleSegments.push(Sr.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,rv,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(s,rv,!1)}getGridBuffers(r){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[r]]}getPoleBuffers(r){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}getWirefameBuffers(r,e){if(!this._wireframeSegments){const i=new zr,s=64,c=s+1;this._wireframeSegments=[];for(let d=0,f=0;d<Tc.length;d++){const g=Tc[d];for(let v=0;v<g;v++)for(let E=0;E<s;E++){const I=v*c+E;i.emplaceBack(I,I+1),i.emplaceBack(I,I+c),i.emplaceBack(I,I+c+1)}const x=g*s*3;this._wireframeSegments.push(Sr.simpleSegment(0,f,(g+1)*c,x)),f+=x}this._wireframeIndexBuffer=r.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},a.GlyphManager=wc,a.ImagePosition=f_,a.LineAtlas=k_,a.LngLat=Kt,a.LngLatBounds=Ds,a.LocalGlyphMode=y_,a.MAX_MERCATOR_LATITUDE=co,a.MercatorCoordinate=dc,a.ONE_EM=ii,a.OverscaledTileID=xi,a.Properties=Ie,a.RGBAImage=Hi,a.Ray=e_,a.RequestManager=class{constructor(r,e,i){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const r=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",fa,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!vn(r))return r;const i=Ai(r);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!vn(r))return r;const i=Ai(r);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(r,e,i,s){if(!vn(r))return r;const c=Ai(r);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(r,e,i,s){const c=Ai(r);return vn(r)?(c.path=`/styles/v1${c.path}/sprite${e}${i}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${i}`,Un(c))}normalizeTileURL(r,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!vn(r))return r;const s=Ai(r);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&s.authority!=="raster"&&i===512?"@2x":""}${no.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${Bt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Bt.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(d){for(const f of d){const g=f.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(s.params)||Bt.ACCESS_TOKEN;return Bt.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(r,e){const i=Ai(r);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return r;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${Bt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${Bt.TILE_URL_VERSION}/`,"")}`;let c=i.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(r,e){const i=!!e&&vn(e),s=[];for(const c of r.tiles||[])zo(c)?s.push(this.canonicalizeTileURL(c,i)):s.push(c);return s}_makeAPIURL(r,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=Ai(Bt.API_URL);if(r.protocol=s.protocol,r.authority=s.authority,r.protocol==="http"){const c=r.params.indexOf("secure");c>=0&&r.params.splice(c,1)}if(s.path!=="/"&&(r.path=`${s.path}${r.path}`),!Bt.REQUIRE_ACCESS_TOKEN)return Un(r);if(e=e||Bt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return r.params=r.params.filter(c=>c.indexOf("access_token")===-1),r.params.push(`access_token=${e||""}`),Un(r)}},a.ResourceType=Q,a.SegmentVector=Sr,a.SourceCache=tl,a.StencilMode=D_,a.StructArrayLayout1ui2=En,a.StructArrayLayout2f1f2i16=Zt,a.StructArrayLayout2i4=ut,a.StructArrayLayout2ui4=zr,a.StructArrayLayout3f12=Hr,a.StructArrayLayout3ui6=Ot,a.StructArrayLayout4i8=ot,a.StructArrayLayout5f20=ks,a.Texture=ph,a.Tile=z_,a.Transitionable=Y,a.Uniform1f=op,a.Uniform1i=class extends Go{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},a.Uniform2f=class extends Go{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},a.Uniform3f=class extends Go{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},a.Uniform4f=B0,a.UniformColor=O0,a.UniformMatrix2f=class extends Go{constructor(r,e){super(r,e),this.current=Y2}set(r){for(let e=0;e<4;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}},a.UniformMatrix3f=class extends Go{constructor(r,e){super(r,e),this.current=H2}set(r){for(let e=0;e<9;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},a.UniformMatrix4f=class extends Go{constructor(r,e){super(r,e),this.current=X2}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},a.UnwrappedTileID=Tx,a.ValidationError=et,a.VectorTileWorkerSource=class extends Xt{constructor(r,e,i,s,c){super(),this.actor=r,this.layerIndex=e,this.availableImages=i,this.loadVectorData=c||Ov,this.loading={},this.loaded={},this.deduped=new Bv(r.scheduler),this.isSpriteLoaded=s,this.scheduler=r.scheduler}loadTile(r,e){const i=r.uid,s=r&&r.request,c=s&&s.collectResourceTiming,d=this.loading[i]=new dS(r);d.abort=this.loadVectorData(r,(f,g)=>{const x=!this.loading[i];if(delete this.loading[i],x||f||!g)return d.status="done",x||(this.loaded[i]=d),e(f);const v=g.rawData,E={};g.expires&&(E.expires=g.expires),g.cacheControl&&(E.cacheControl=g.cacheControl),d.vectorTile=g.vectorTile||new Ja.VectorTile(new nh(v));const I=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(A,k)=>{if(A||!k)return e(A);const D={};if(c){const O=Io(s);O.length>0&&(D.resourceTiming=JSON.parse(JSON.stringify(O)))}e(null,xt({rawTileData:v.slice(0)},k,E,D))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[i]=d})}reloadTile(r,e){const i=this.loaded,s=r.uid,c=this;if(i&&i[s]){const d=i[s];d.showCollisionBoxes=r.showCollisionBoxes,d.enableTerrain=!!r.enableTerrain,d.projection=r.projection,d.tileTransform=el(r.tileID.canonical,r.projection);const f=(g,x)=>{const v=d.reloadCallback;v&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,v)),e(g,x)};d.status==="parsing"?d.reloadCallback=f:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(r,e){const i=r.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),e()}removeTile(r,e){const i=this.loaded,s=r.uid;i&&i[s]&&delete i[s],e()}},a.WritingMode=hn,a.ZoomHistory=Wd,a.add=Rs,a.addDynamicAttributes=Fp,a.adjoint=function(r,e){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],g=e[5],x=e[6],v=e[7],E=e[8];return r[0]=f*E-g*v,r[1]=c*v-s*E,r[2]=s*g-c*f,r[3]=g*x-d*E,r[4]=i*E-c*x,r[5]=c*d-i*g,r[6]=d*v-f*x,r[7]=s*x-i*v,r[8]=i*f-s*d,r},a.asyncAll=ft,a.bezier=we,a.bindAll=Ui,a.boundsAttributes=wv,a.bufferConvexPolygon=function(r,e){const i=[];for(let s=0;s<r.length;s++){const c=lt(s-1,-1,r.length-1),d=lt(s+1,-1,r.length-1),f=r[s],g=r[d],x=r[c].sub(f).unit(),v=g.sub(f).unit(),E=v.angleWithSep(x.x,x.y),I=x.add(v).unit().mult(-1*e/Math.sin(E/2));i.push(f.add(I))}return i},a.cacheEntryPossiblyAdded=function(r){W++,W>Tl&&(r.getActor().send("enforceCacheSizeLimit",hs),W=0)},a.calculateGlobeLabelMatrix=function(r,e){const{x:i,y:s}=r.point,c=lv(i,s,r.worldSize/r._projectionScaler,0,0);return Ls(c,c,av(fo(e)))},a.calculateGlobeMatrix=function(r){const{x:e,y:i}=r.point,{lng:s,lat:c}=r._center;return lv(e,i,r.worldSize,s,c)},a.calculateGlobeMercatorMatrix=function(r){const e=r.worldSize,i=r.point,s=Sn(1,r.center.lat)*e,c=r.pixelsPerMeter,d=e/(s/r.pixelsPerMeter),f=Xi(new Float64Array(16));return Ya(f,f,[i.x,i.y,0]),uo(f,f,[d,d,c]),Float32Array.from(f)},a.circumferenceAtLatitude=$m,a.clamp=Fe,a.clearTileCache=function(r){const e=[];for(const i in mi)e.push(U.caches.delete(i)),delete mi[i];r&&Promise.all(e).catch(r).then(()=>r())},a.clipLine=Xx,a.clone=function(r){var e=new Wi(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},a.clone$1=vt,a.collisionCircleLayout=sE,a.config=Bt,a.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},a.create=function(){var r=new Wi(16);return Wi!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},a.create$1=Y0,a.createExpression=Oo,a.createLayout=$e,a.createStyleLayer=function(r){return r.type==="custom"?new iS(r):new oS[r.type](r)},a.cross=Qm,a.degToRad=ze,a.distance=function(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])},a.div=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},a.dot=Cn,a.ease=je,a.easeCubicInOut=he,a.emitValidationErrors=$d,a.endsWith=yn,a.enforceCacheSizeLimit=function(r){for(const e in mi)X(e),mi[e].then(i=>{i.keys().then(s=>{for(let c=0;c<s.length-r;c++)i.delete(s[c])})})},a.evaluateSizeForFeature=Cp,a.evaluateSizeForZoom=gc,a.evaluateVariableOffset=Qx,a.evented=G,a.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},a.exactEquals$1=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},a.exported=Ni,a.exported$1=no,a.extend=xt,a.extend$1=Mi,a.fillExtrusionHeightLift=vx,a.filterObject=wt,a.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},a.fromQuat=function(r,e){var i=e[0],s=e[1],c=e[2],d=e[3],f=i+i,g=s+s,x=c+c,v=i*f,E=s*f,I=s*g,A=c*f,k=c*g,D=c*x,O=d*f,$=d*g,H=d*x;return r[0]=1-I-D,r[1]=E+H,r[2]=A-$,r[3]=0,r[4]=E-H,r[5]=1-v-D,r[6]=k+O,r[7]=0,r[8]=A+$,r[9]=k-O,r[10]=1-v-I,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},a.fromRotation=function(r,e){var i=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=i,r[2]=0,r[3]=-i,r[4]=s,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},a.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},a.furthestTileCorner=function(r){const e=Math.round((r+45+360)%360/90)%4;return ge[e]},a.getAABBPointSquareDist=function(r,e,i){let s=0;for(let c=0;c<2;++c){const d=i?i[c]:0;r[c]>d&&(s+=(r[c]-d)*(r[c]-d)),e[c]<d&&(s+=(d-e[c])*(d-e[c]))}return s},a.getAnchorAlignment=g_,a.getAnchorJustification=v_,a.getBounds=function(r){let e=1/0,i=1/0,s=-1/0,c=-1/0;for(const d of r)e=Math.min(e,d.x),i=Math.min(i,d.y),s=Math.max(s,d.x),c=Math.max(c,d.y);return{min:new ne(e,i),max:new ne(s,c)}},a.getColumn=Rn,a.getGridMatrix=function(r,e,i){const[s,c]=e,d=.015625;return[0,(c[1]-s[1])*d,1<<r.z,(c[0]-s[0])/Tc[i],0,r.y,s[0],s[1],d]},a.getImage=pt,a.getJSON=function(r,e){return pe(xt(r,{type:"json"}),e)},a.getLatitudinalLod=function(r){const e=80.051129;r=Fe(r,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(ze(r))),3);return Math.round(i*(Tc.length-1))},a.getMapSessionAPI=iu,a.getPerformanceMeasurement=Io,a.getProjection=_v,a.getRTLTextPluginStatus=N,a.getReferrer=_e,a.getTilePoint=function(r,{x:e,y:i},s=0){return new ne(((e-s)*r.scale-r.x)*_t,(i*r.scale-r.y)*_t)},a.getTileVec3=function(r,e,i=0){return fc(((e.x-i)*r.scale-r.x)*_t,(e.y*r.scale-r.y)*_t,N0(e.z,e.y))},a.getVideo=function(r,e){const i=U.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<r.length;s++){const c=U.document.createElement("source");Qe(r[s])||(i.crossOrigin="Anonymous"),c.src=r[s],i.appendChild(c)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(r){const e=[0,0,0],i=Xi(new Float64Array(16));return Ls(i,r.pixelMatrix,r.globeMatrix),ri(e,e,i),new ne(e[0],e[1])},a.globeECEFOrigin=function(r,e){const i=[0,0,0];return ri(i,i,lh(fo(e.canonical))),ri(i,i,r),i},a.globeNormalizeECEF=lh,a.globePixelsToTileUnits=function(r,e){return _t/(512*Math.pow(2,r))*Dp(fo(e))},a.globePoleMatrixForTile=function(r,e,i){const s=Xi(new Float64Array(16)),c=1<<r,d=360*(e/c-.5),f=i.point,g=i.worldSize/(i.tileSize*c);return Ya(s,s,[f.x,f.y,-i.worldSize/Math.PI/2]),uo(s,s,[g,g,g]),hp(s,s,ze(-i._center.lat)),dp(s,s,ze(-i._center.lng+d)),Float32Array.from(s)},a.globeTileBounds=fo,a.globeTileLatLngCorners=E_,a.globeTiltAtLngLat=cv,a.globeToMercatorTransition=S_,a.globeUseCustomAntiAliasing=function(r,e,i){const s=S_(i.zoom),c=r.style.map._antialias,d=!!e.extStandardDerivatives,f=e.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return s===0&&!c&&!f&&d},a.identity=Xi,a.identity$1=ix,a.invert=function(r,e){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],g=e[5],x=e[6],v=e[7],E=e[8],I=e[9],A=e[10],k=e[11],D=e[12],O=e[13],$=e[14],H=e[15],ie=i*g-s*f,re=i*x-c*f,oe=i*v-d*f,le=s*x-c*g,ue=s*v-d*g,Ee=c*v-d*x,Ce=E*O-I*D,ke=E*$-A*D,Oe=E*H-k*D,xe=I*$-A*O,Ae=I*H-k*O,Ue=A*H-k*$,Ne=ie*Ue-re*Ae+oe*xe+le*Oe-ue*ke+Ee*Ce;return Ne?(r[0]=(g*Ue-x*Ae+v*xe)*(Ne=1/Ne),r[1]=(c*Ae-s*Ue-d*xe)*Ne,r[2]=(O*Ee-$*ue+H*le)*Ne,r[3]=(A*ue-I*Ee-k*le)*Ne,r[4]=(x*Oe-f*Ue-v*ke)*Ne,r[5]=(i*Ue-c*Oe+d*ke)*Ne,r[6]=($*oe-D*Ee-H*re)*Ne,r[7]=(E*Ee-A*oe+k*re)*Ne,r[8]=(f*Ae-g*Oe+v*Ce)*Ne,r[9]=(s*Oe-i*Ae-d*Ce)*Ne,r[10]=(D*ue-O*oe+H*ie)*Ne,r[11]=(I*oe-E*ue-k*ie)*Ne,r[12]=(g*ke-f*xe-x*Ce)*Ne,r[13]=(i*xe-s*ke+c*Ce)*Ne,r[14]=(O*re-D*le-$*ie)*Ne,r[15]=(E*le-I*re+A*ie)*Ne,r):null},a.isLngLatBehindGlobe=function(r,e){return cv(r,e)>Math.PI/2*1.01},a.isMapAuthenticated=function(r){return oo.has(r)},a.isMapboxURL=vn,a.isSafariWithAntialiasingBug=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!ls(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Or,a.len=pT,a.length=qu,a.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},a.loadVectorTile=Ov,a.makeRequest=pe,a.mapValue=function(r,e,i,s,c){return Fe((r-e)/(i-e)*(c-s)+s,s,c)},a.mercatorXfromLng=qa,a.mercatorYfromLat=Wa,a.mercatorZfromAltitude=Sn,a.mul=hT,a.mul$1=dT,a.multiply=Ls,a.multiply$1=function(r,e,i){var s=e[0],c=e[1],d=e[2],f=e[3],g=e[4],x=e[5],v=e[6],E=e[7],I=e[8],A=i[0],k=i[1],D=i[2],O=i[3],$=i[4],H=i[5],ie=i[6],re=i[7],oe=i[8];return r[0]=A*s+k*f+D*v,r[1]=A*c+k*g+D*E,r[2]=A*d+k*x+D*I,r[3]=O*s+$*f+H*v,r[4]=O*c+$*g+H*E,r[5]=O*d+$*x+H*I,r[6]=ie*s+re*f+oe*v,r[7]=ie*c+re*g+oe*E,r[8]=ie*d+re*x+oe*I,r},a.multiply$2=Q0,a.nextPowerOfTwo=Co,a.normalize=yi,a.normalize$1=function(r,e){var i=e[0],s=e[1],c=e[2],d=e[3],f=i*i+s*s+c*c+d*d;return f>0&&(f=1/Math.sqrt(f)),r[0]=i*f,r[1]=s*f,r[2]=c*f,r[3]=d*f,r},a.number=Ut,a.ortho=function(r,e,i,s,c,d,f){var g=1/(e-i),x=1/(s-c),v=1/(d-f);return r[0]=-2*g,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*v,r[11]=0,r[12]=(e+i)*g,r[13]=(c+s)*x,r[14]=(f+d)*v,r[15]=1,r},a.pbf=nh,a.perspective=function(r,e,i,s,c){var d,f=1/Math.tan(e/2);return r[0]=f/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=f,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+s)*(d=1/(s-c)),r[14]=2*c*s*d):(r[10]=-1,r[14]=-2*s),r},a.pick=function(r,e){const i={};for(let s=0;s<e.length;s++){const c=e[s];c in r&&(i[c]=r[c])}return i},a.plugin=V,a.pointGeometry=ne,a.polygonContainsPoint=Ha,a.polygonIntersectsBox=W0,a.polygonIntersectsPolygon=G0,a.polygonizeBounds=function(r,e,i=0,s=!0){const c=new ne(i,i),d=r.sub(c),f=e.add(c),g=[d,new ne(f.x,d.y),f,new ne(d.x,f.y)];return s&&g.push(d.clone()),g},a.posAttributes=ah,a.postMapLoadEvent=wl,a.postTurnstileEvent=ga,a.potpack=p_,a.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},a.radToDeg=kt,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(r){return r({pluginStatus:z,pluginURL:R}),G.on("pluginStateChange",r),r},a.removeAuthState=function(r){oo.delete(r)},a.renderColorRamp=n_,a.resample=V0,a.rotateX=hp,a.rotateX$1=nx,a.rotateY=dp,a.rotateY$1=ox,a.rotateZ=function(r,e,i){var s=Math.sin(i),c=Math.cos(i),d=e[0],f=e[1],g=e[2],x=e[3],v=e[4],E=e[5],I=e[6],A=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=d*c+v*s,r[1]=f*c+E*s,r[2]=g*c+I*s,r[3]=x*c+A*s,r[4]=v*c-d*s,r[5]=E*c-f*s,r[6]=I*c-g*s,r[7]=A*c-x*s,r},a.rotateZ$1=function(r,e,i){i*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return r[0]=s*x+c*g,r[1]=c*x-s*g,r[2]=d*x+f*g,r[3]=f*x-d*g,r},a.scale=uo,a.scale$1=tx,a.scale$2=ho,a.scaleAndAdd=mp,a.setCacheLimits=function(r,e){hs=r,Tl=e},a.setColumn=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},a.setRTLTextPlugin=function(r,e,i=!1){if(z===b||z===T||z===C)throw new Error("setRTLTextPlugin cannot be called multiple times.");R=Ni.resolveURL(r),z=b,M=e,j(),i||K()},a.smoothstep=st,a.spec=fe,a.storeAuthState=function(r,e){e?oo.add(r):oo.delete(r)},a.sub=In,a.subtract=Jm,a.symbolSize=aE,a.tileAABB=function(r,e,i,s,c,d,f,g,x){if(x.name==="globe")return NE(r,e,new Tp(i,s,c));const v=el({z:i,x:s,y:c},x);return new un([(d+v.x/v.scale)*e,e*(v.y/v.scale),f],[(d+v.x2/v.scale)*e,e*(v.y2/v.scale),g])},a.tileTransform=el,a.transformMat3=function(r,e,i){var s=e[0],c=e[1],d=e[2];return r[0]=s*i[0]+c*i[3]+d*i[6],r[1]=s*i[1]+c*i[4]+d*i[7],r[2]=s*i[2]+c*i[5]+d*i[8],r},a.transformMat4=ri,a.transformMat4$1=Ka,a.transformQuat=ex,a.translate=Ya,a.transpose=function(r,e){if(r===e){var i=e[1],s=e[2],c=e[5];r[1]=e[3],r[2]=e[6],r[3]=i,r[5]=e[7],r[6]=s,r[7]=c}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r},a.triggerPluginCompletionEvent=F,a.uniqueId=Oi,a.updateGlobeVertexNormal=function(r,e,i,s,c){const d=5*e+2;r.float32[d+0]=i,r.float32[d+1]=s,r.float32[d+2]=c},a.validateCustomStyleLayer=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=r=>ln(zu(r)),a.validateFog=r=>ln(Nd(r)),a.validateLayer=r=>ln(Fd(r)),a.validateLight=r=>ln(Pu(r)),a.validateSource=r=>ln(Ud(r)),a.validateStyle=jd,a.validateTerrain=r=>ln(Du(r)),a.values=nr,a.vectorTile=Ja,a.version=Ao,a.warnOnce=zt,a.window=U,a.wrap=lt}),S(["./shared"],function(a){function U(X){if(typeof X=="number"||typeof X=="boolean"||typeof X=="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){let B="[";for(const W of X)B+=`${U(W)},`;return`${B}]`}let L="{";for(const B of Object.keys(X).sort())L+=`${B}:${U(X[B])},`;return`${L}}`}function de(X){let L="";for(const B of a.refProperties)L+=`/${U(X[B])}`;return L}class Me{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,B){for(const Q of L)this._layerConfigs[Q.id]=Q,(this._layers[Q.id]=a.createStyleLayer(Q)).compileFilter(),this.keyCache[Q.id]&&delete this.keyCache[Q.id];for(const Q of B)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const W=function(Q,ae){const _e={};for(let ce=0;ce<Q.length;ce++){const ye=ae&&ae[Q[ce].id]||de(Q[ce]);ae&&(ae[Q[ce].id]=ye);let Le=_e[ye];Le||(Le=_e[ye]=[]),Le.push(Q[ce])}const pe=[];for(const ce in _e)pe.push(_e[ce]);return pe}(a.values(this._layerConfigs),this.keyCache);for(const Q of W){const ae=Q.map(Qe=>this._layers[Qe.id]),_e=ae[0];if(_e.visibility==="none")continue;const pe=_e.source||"";let ce=this.familiesBySource[pe];ce||(ce=this.familiesBySource[pe]={});const ye=_e.sourceLayer||"_geojsonTileLayer";let Le=ce[ye];Le||(Le=ce[ye]=[]),Le.push(ae)}}}class ne{loadTile(L,B){const{uid:W,encoding:Q,rawImageData:ae,padding:_e,buildQuadTree:pe}=L,ce=a.window.ImageBitmap&&ae instanceof a.window.ImageBitmap?this.getImageData(ae,_e):ae;B(null,new a.DEMData(W,ce,Q,_e<1,pe))}getImageData(L,B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const W=this.offscreenCanvasContext.getImageData(-B,-B,L.width+2*B,L.height+2*B);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),W}}var me=function X(L,B){var W,Q=L&&L.type;if(Q==="FeatureCollection")for(W=0;W<L.features.length;W++)X(L.features[W],B);else if(Q==="GeometryCollection")for(W=0;W<L.geometries.length;W++)X(L.geometries[W],B);else if(Q==="Feature")X(L.geometry,B);else if(Q==="Polygon")Ge(L.coordinates,B);else if(Q==="MultiPolygon")for(W=0;W<L.coordinates.length;W++)Ge(L.coordinates[W],B);return L};function Ge(X,L){if(X.length!==0){Ye(X[0],L);for(var B=1;B<X.length;B++)Ye(X[B],!L)}}function Ye(X,L){for(var B=0,W=0,Q=0,ae=X.length,_e=ae-1;Q<ae;_e=Q++){var pe=(X[Q][0]-X[_e][0])*(X[_e][1]+X[Q][1]),ce=B+pe;W+=Math.abs(B)>=Math.abs(pe)?B-ce+pe:pe-ce+B,B=ce}B+W>=0!=!!L&&X.reverse()}const ze=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class kt{constructor(L){this._feature=L,this.extent=a.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const B of this._feature.geometry)L.push([new a.pointGeometry(B[0],B[1])]);return L}{const L=[];for(const B of this._feature.geometry){const W=[];for(const Q of B)W.push(new a.pointGeometry(Q[0],Q[1]));L.push(W)}return L}}toGeoJSON(L,B,W){return ze.call(this,L,B,W)}}class ge{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=L.length,this._features=L}feature(L){return new kt(this._features[L])}}var he=a.vectorTile.VectorTileFeature,we=je;function je(X,L){this.options=L||{},this.features=X,this.length=X.length}function Fe(X,L){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=L||4096}je.prototype.feature=function(X){return new Fe(this.features[X],this.options.extent)},Fe.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var L=0;L<X.length;L++){for(var B=X[L],W=[],Q=0;Q<B.length;Q++)W.push(new a.pointGeometry(B[Q][0],B[Q][1]));this.geometry.push(W)}return this.geometry},Fe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,L=1/0,B=-1/0,W=1/0,Q=-1/0,ae=0;ae<X.length;ae++)for(var _e=X[ae],pe=0;pe<_e.length;pe++){var ce=_e[pe];L=Math.min(L,ce.x),B=Math.max(B,ce.x),W=Math.min(W,ce.y),Q=Math.max(Q,ce.y)}return[L,W,B,Q]},Fe.prototype.toGeoJSON=he.prototype.toGeoJSON;var st=ft,lt=we;function ft(X){var L=new a.pbf;return function(B,W){for(var Q in B.layers)W.writeMessage(3,nr,B.layers[Q])}(X,L),L.finish()}function nr(X,L){var B;L.writeVarintField(15,X.version||1),L.writeStringField(1,X.name||""),L.writeVarintField(5,X.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<X.length;B++)W.feature=X.feature(B),L.writeMessage(2,xt,W);var Q=W.keys;for(B=0;B<Q.length;B++)L.writeStringField(3,Q[B]);var ae=W.values;for(B=0;B<ae.length;B++)L.writeMessage(4,as,ae[B])}function xt(X,L){var B=X.feature;B.id!==void 0&&L.writeVarintField(1,B.id),L.writeMessage(2,ai,X),L.writeVarintField(3,B.type),L.writeMessage(4,Co,B)}function ai(X,L){var B=X.feature,W=X.keys,Q=X.values,ae=X.keycache,_e=X.valuecache;for(var pe in B.properties){var ce=B.properties[pe],ye=ae[pe];if(ce!==null){ye===void 0&&(W.push(pe),ae[pe]=ye=W.length-1),L.writeVarint(ye);var Le=typeof ce;Le!=="string"&&Le!=="boolean"&&Le!=="number"&&(ce=JSON.stringify(ce));var Qe=Le+":"+ce,Be=_e[Qe];Be===void 0&&(Q.push(ce),_e[Qe]=Be=Q.length-1),L.writeVarint(Be)}}}function Oi(X,L){return(L<<3)+(7&X)}function Fi(X){return X<<1^X>>31}function Co(X,L){for(var B=X.loadGeometry(),W=X.type,Q=0,ae=0,_e=B.length,pe=0;pe<_e;pe++){var ce=B[pe],ye=1;W===1&&(ye=ce.length),L.writeVarint(Oi(1,ye));for(var Le=W===3?ce.length-1:ce.length,Qe=0;Qe<Le;Qe++){Qe===1&&W!==1&&L.writeVarint(Oi(2,Le-1));var Be=ce[Qe].x-Q,dt=ce[Qe].y-ae;L.writeVarint(Fi(Be)),L.writeVarint(Fi(dt)),Q+=Be,ae+=dt}W===3&&L.writeVarint(Oi(7,1))}}function as(X,L){var B=typeof X;B==="string"?L.writeStringField(1,X):B==="boolean"?L.writeBooleanField(7,X):B==="number"&&(X%1!=0?L.writeDoubleField(3,X):X<0?L.writeSVarintField(6,X):L.writeVarintField(5,X))}function Ui(X,L,B,W,Q,ae){if(Q-W<=B)return;const _e=W+Q>>1;yn(X,L,_e,W,Q,ae%2),Ui(X,L,B,W,_e-1,ae+1),Ui(X,L,B,_e+1,Q,ae+1)}function yn(X,L,B,W,Q,ae){for(;Q>W;){if(Q-W>600){const ye=Q-W+1,Le=B-W+1,Qe=Math.log(ye),Be=.5*Math.exp(2*Qe/3),dt=.5*Math.sqrt(Qe*Be*(ye-Be)/ye)*(Le-ye/2<0?-1:1);yn(X,L,B,Math.max(W,Math.floor(B-Le*Be/ye+dt)),Math.min(Q,Math.floor(B+(ye-Le)*Be/ye+dt)),ae)}const _e=L[2*B+ae];let pe=W,ce=Q;for(it(X,L,W,B),L[2*Q+ae]>_e&&it(X,L,W,Q);pe<ce;){for(it(X,L,pe,ce),pe++,ce--;L[2*pe+ae]<_e;)pe++;for(;L[2*ce+ae]>_e;)ce--}L[2*W+ae]===_e?it(X,L,W,ce):(ce++,it(X,L,ce,Q)),ce<=B&&(W=ce+1),B<=ce&&(Q=ce-1)}}function it(X,L,B,W){wt(X,B,W),wt(L,2*B,2*W),wt(L,2*B+1,2*W+1)}function wt(X,L,B){const W=X[L];X[L]=X[B],X[B]=W}function vt(X,L,B,W){const Q=X-B,ae=L-W;return Q*Q+ae*ae}st.fromVectorTileJs=ft,st.fromGeojsonVt=function(X,L){L=L||{};var B={};for(var W in X)B[W]=new we(X[W].features,L),B[W].name=W,B[W].version=L.version,B[W].extent=L.extent;return ft({layers:B})},st.GeoJSONWrapper=lt;const sr=X=>X[0],zt=X=>X[1];class Mr{constructor(L,B=sr,W=zt,Q=64,ae=Float64Array){this.nodeSize=Q,this.points=L;const _e=L.length<65536?Uint16Array:Uint32Array,pe=this.ids=new _e(L.length),ce=this.coords=new ae(2*L.length);for(let ye=0;ye<L.length;ye++)pe[ye]=ye,ce[2*ye]=B(L[ye]),ce[2*ye+1]=W(L[ye]);Ui(pe,ce,Q,0,pe.length-1,0)}range(L,B,W,Q){return function(ae,_e,pe,ce,ye,Le,Qe){const Be=[0,ae.length-1,0],dt=[];let mt,pt;for(;Be.length;){const gt=Be.pop(),It=Be.pop(),jt=Be.pop();if(It-jt<=Qe){for(let fe=jt;fe<=It;fe++)mt=_e[2*fe],pt=_e[2*fe+1],mt>=pe&&mt<=ye&&pt>=ce&&pt<=Le&&dt.push(ae[fe]);continue}const or=Math.floor((jt+It)/2);mt=_e[2*or],pt=_e[2*or+1],mt>=pe&&mt<=ye&&pt>=ce&&pt<=Le&&dt.push(ae[or]);const Xt=(gt+1)%2;(gt===0?pe<=mt:ce<=pt)&&(Be.push(jt),Be.push(or-1),Be.push(Xt)),(gt===0?ye>=mt:Le>=pt)&&(Be.push(or+1),Be.push(It),Be.push(Xt))}return dt}(this.ids,this.coords,L,B,W,Q,this.nodeSize)}within(L,B,W){return function(Q,ae,_e,pe,ce,ye){const Le=[0,Q.length-1,0],Qe=[],Be=ce*ce;for(;Le.length;){const dt=Le.pop(),mt=Le.pop(),pt=Le.pop();if(mt-pt<=ye){for(let Xt=pt;Xt<=mt;Xt++)vt(ae[2*Xt],ae[2*Xt+1],_e,pe)<=Be&&Qe.push(Q[Xt]);continue}const gt=Math.floor((pt+mt)/2),It=ae[2*gt],jt=ae[2*gt+1];vt(It,jt,_e,pe)<=Be&&Qe.push(Q[gt]);const or=(dt+1)%2;(dt===0?_e-ce<=It:pe-ce<=jt)&&(Le.push(pt),Le.push(gt-1),Le.push(or)),(dt===0?_e+ce>=It:pe+ce>=jt)&&(Le.push(gt+1),Le.push(mt),Le.push(or))}return Qe}(this.ids,this.coords,L,B,W,this.nodeSize)}}const Zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},qr=Math.fround||(Wr=new Float32Array(1),X=>(Wr[0]=+X,Wr[0]));var Wr;class fi{constructor(L){this.options=Bn(Object.create(Zr),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:B,minZoom:W,maxZoom:Q,nodeSize:ae}=this.options;B&&console.time("total time");const _e=`prepare ${L.length} points`;B&&console.time(_e),this.points=L;let pe=[];for(let ce=0;ce<L.length;ce++)L[ce].geometry&&pe.push(da(L[ce],ce));this.trees[Q+1]=new Mr(pe,Mo,xn,ae,Float32Array),B&&console.timeEnd(_e);for(let ce=Q;ce>=W;ce--){const ye=+Date.now();pe=this._cluster(pe,ce),this.trees[ce]=new Mr(pe,Mo,xn,ae,Float32Array),B&&console.log("z%d: %d clusters in %dms",ce,pe.length,+Date.now()-ye)}return B&&console.timeEnd("total time"),this}getClusters(L,B){let W=((L[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,L[1]));let ae=L[2]===180?180:((L[2]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)W=-180,ae=180;else if(W>ae){const Le=this.getClusters([W,Q,180,_e],B),Qe=this.getClusters([-180,Q,ae,_e],B);return Le.concat(Qe)}const pe=this.trees[this._limitZoom(B)],ce=pe.range(Io(W),Ao(_e),Io(ae),Ao(Q)),ye=[];for(const Le of ce){const Qe=pe.points[Le];ye.push(Qe.numPoints?Rn(Qe):this.points[Qe.index])}return ye}getChildren(L){const B=this._getOriginId(L),W=this._getOriginZoom(L),Q="No cluster with the specified id.",ae=this.trees[W];if(!ae)throw new Error(Q);const _e=ae.points[B];if(!_e)throw new Error(Q);const pe=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ce=ae.within(_e.x,_e.y,pe),ye=[];for(const Le of ce){const Qe=ae.points[Le];Qe.parentId===L&&ye.push(Qe.numPoints?Rn(Qe):this.points[Qe.index])}if(ye.length===0)throw new Error(Q);return ye}getLeaves(L,B,W){const Q=[];return this._appendLeaves(Q,L,B=B||10,W=W||0,0),Q}getTile(L,B,W){const Q=this.trees[this._limitZoom(L)],ae=Math.pow(2,L),{extent:_e,radius:pe}=this.options,ce=pe/_e,ye=(W-ce)/ae,Le=(W+1+ce)/ae,Qe={features:[]};return this._addTileFeatures(Q.range((B-ce)/ae,ye,(B+1+ce)/ae,Le),Q.points,B,W,ae,Qe),B===0&&this._addTileFeatures(Q.range(1-ce/ae,ye,1,Le),Q.points,ae,W,ae,Qe),B===ae-1&&this._addTileFeatures(Q.range(0,ye,ce/ae,Le),Q.points,-1,W,ae,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(L){let B=this._getOriginZoom(L)-1;for(;B<=this.options.maxZoom;){const W=this.getChildren(L);if(B++,W.length!==1)break;L=W[0].properties.cluster_id}return B}_appendLeaves(L,B,W,Q,ae){const _e=this.getChildren(B);for(const pe of _e){const ce=pe.properties;if(ce&&ce.cluster?ae+ce.point_count<=Q?ae+=ce.point_count:ae=this._appendLeaves(L,ce.cluster_id,W,Q,ae):ae<Q?ae++:L.push(pe),L.length===W)break}return ae}_addTileFeatures(L,B,W,Q,ae,_e){for(const pe of L){const ce=B[pe],ye=ce.numPoints;let Le,Qe,Be;if(ye)Le=yl(ce),Qe=ce.x,Be=ce.y;else{const pt=this.points[ce.index];Le=pt.properties,Qe=Io(pt.geometry.coordinates[0]),Be=Ao(pt.geometry.coordinates[1])}const dt={type:1,geometry:[[Math.round(this.options.extent*(Qe*ae-W)),Math.round(this.options.extent*(Be*ae-Q))]],tags:Le};let mt;ye?mt=ce.id:this.options.generateId?mt=ce.index:this.points[ce.index].id&&(mt=this.points[ce.index].id),mt!==void 0&&(dt.id=mt),_e.features.push(dt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))}_cluster(L,B){const W=[],{radius:Q,extent:ae,reduce:_e,minPoints:pe}=this.options,ce=Q/(ae*Math.pow(2,B));for(let ye=0;ye<L.length;ye++){const Le=L[ye];if(Le.zoom<=B)continue;Le.zoom=B;const Qe=this.trees[B+1],Be=Qe.within(Le.x,Le.y,ce),dt=Le.numPoints||1;let mt=dt;for(const pt of Be){const gt=Qe.points[pt];gt.zoom>B&&(mt+=gt.numPoints||1)}if(mt>dt&&mt>=pe){let pt=Le.x*dt,gt=Le.y*dt,It=_e&&dt>1?this._map(Le,!0):null;const jt=(ye<<5)+(B+1)+this.points.length;for(const or of Be){const Xt=Qe.points[or];if(Xt.zoom<=B)continue;Xt.zoom=B;const fe=Xt.numPoints||1;pt+=Xt.x*fe,gt+=Xt.y*fe,Xt.parentId=jt,_e&&(It||(It=this._map(Le,!0)),_e(It,this._map(Xt)))}Le.parentId=jt,W.push(ls(pt/mt,gt/mt,jt,mt,It))}else if(W.push(Le),mt>1)for(const pt of Be){const gt=Qe.points[pt];gt.zoom<=B||(gt.zoom=B,W.push(gt))}}return W}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,B){if(L.numPoints)return B?Bn({},L.properties):L.properties;const W=this.points[L.index].properties,Q=this.options.map(W);return B&&Q===W?Bn({},Q):Q}}function ls(X,L,B,W,Q){return{x:qr(X),y:qr(L),zoom:1/0,id:B,parentId:-1,numPoints:W,properties:Q}}function da(X,L){const[B,W]=X.geometry.coordinates;return{x:qr(Io(B)),y:qr(Ao(W)),zoom:1/0,index:L,parentId:-1}}function Rn(X){return{type:"Feature",id:X.id,properties:yl(X),geometry:{type:"Point",coordinates:[(L=X.x,360*(L-.5)),Ft(X.y)]}};var L}function yl(X){const L=X.numPoints,B=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return Bn(Bn({},X.properties),{cluster:!0,cluster_id:X.id,point_count:L,point_count_abbreviated:B})}function Io(X){return X/360+.5}function Ao(X){const L=Math.sin(X*Math.PI/180),B=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return B<0?0:B>1?1:B}function Ft(X){const L=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Bn(X,L){for(const B in L)X[B]=L[B];return X}function Mo(X){return X.x}function xn(X){return X.y}function Ni(X,L,B,W){for(var Q,ae=W,_e=B-L>>1,pe=B-L,ce=X[L],ye=X[L+1],Le=X[B],Qe=X[B+1],Be=L+3;Be<B;Be+=3){var dt=cs(X[Be],X[Be+1],ce,ye,Le,Qe);if(dt>ae)Q=Be,ae=dt;else if(dt===ae){var mt=Math.abs(Be-_e);mt<pe&&(Q=Be,pe=mt)}}ae>W&&(Q-L>3&&Ni(X,L,Q,W),X[Q+2]=ae,B-Q>3&&Ni(X,Q,B,W))}function cs(X,L,B,W,Q,ae){var _e=Q-B,pe=ae-W;if(_e!==0||pe!==0){var ce=((X-B)*_e+(L-W)*pe)/(_e*_e+pe*pe);ce>1?(B=Q,W=ae):ce>0&&(B+=_e*ce,W+=pe*ce)}return(_e=X-B)*_e+(pe=L-W)*pe}function Bt(X,L,B,W){var Q={id:X===void 0?null:X,type:L,geometry:B,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ae){var _e=ae.geometry,pe=ae.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")no(ae,_e);else if(pe==="Polygon"||pe==="MultiLineString")for(var ce=0;ce<_e.length;ce++)no(ae,_e[ce]);else if(pe==="MultiPolygon")for(ce=0;ce<_e.length;ce++)for(var ye=0;ye<_e[ce].length;ye++)no(ae,_e[ce][ye])}(Q),Q}function no(X,L){for(var B=0;B<L.length;B+=3)X.minX=Math.min(X.minX,L[B]),X.minY=Math.min(X.minY,L[B+1]),X.maxX=Math.max(X.maxX,L[B]),X.maxY=Math.max(X.maxY,L[B+1])}function On(X,L,B,W){if(L.geometry){var Q=L.geometry.coordinates,ae=L.geometry.type,_e=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),pe=[],ce=L.id;if(B.promoteId?ce=L.properties[B.promoteId]:B.generateId&&(ce=W||0),ae==="Point")Fn(Q,pe);else if(ae==="MultiPoint")for(var ye=0;ye<Q.length;ye++)Fn(Q[ye],pe);else if(ae==="LineString")ko(Q,pe,_e,!1);else if(ae==="MultiLineString"){if(B.lineMetrics){for(ye=0;ye<Q.length;ye++)ko(Q[ye],pe=[],_e,!1),X.push(Bt(ce,"LineString",pe,L.properties));return}us(Q,pe,_e,!1)}else if(ae==="Polygon")us(Q,pe,_e,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(ye=0;ye<L.geometry.geometries.length;ye++)On(X,{id:ce,geometry:L.geometry.geometries[ye],properties:L.properties},B,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<Q.length;ye++){var Le=[];us(Q[ye],Le,_e,!0),pe.push(Le)}}X.push(Bt(ce,ae,pe,L.properties))}}function Fn(X,L){L.push(pa(X[0])),L.push(fa(X[1])),L.push(0)}function ko(X,L,B,W){for(var Q,ae,_e=0,pe=0;pe<X.length;pe++){var ce=pa(X[pe][0]),ye=fa(X[pe][1]);L.push(ce),L.push(ye),L.push(0),pe>0&&(_e+=W?(Q*ye-ce*ae)/2:Math.sqrt(Math.pow(ce-Q,2)+Math.pow(ye-ae,2))),Q=ce,ae=ye}var Le=L.length-3;L[2]=1,Ni(L,0,Le,B),L[Le+2]=1,L.size=Math.abs(_e),L.start=0,L.end=L.size}function us(X,L,B,W){for(var Q=0;Q<X.length;Q++){var ae=[];ko(X[Q],ae,B,W),L.push(ae)}}function pa(X){return X/360+.5}function fa(X){var L=Math.sin(X*Math.PI/180),B=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return B<0?0:B>1?1:B}function Ii(X,L,B,W,Q,ae,_e,pe){if(W/=L,ae>=(B/=L)&&_e<W)return X;if(_e<B||ae>=W)return null;for(var ce=[],ye=0;ye<X.length;ye++){var Le=X[ye],Qe=Le.geometry,Be=Le.type,dt=Q===0?Le.minX:Le.minY,mt=Q===0?Le.maxX:Le.maxY;if(dt>=B&&mt<W)ce.push(Le);else if(!(mt<B||dt>=W)){var pt=[];if(Be==="Point"||Be==="MultiPoint")vn(Qe,pt,B,W,Q);else if(Be==="LineString")zo(Qe,pt,B,W,Q,!1,pe.lineMetrics);else if(Be==="MultiLineString")Ai(Qe,pt,B,W,Q,!1);else if(Be==="Polygon")Ai(Qe,pt,B,W,Q,!0);else if(Be==="MultiPolygon")for(var gt=0;gt<Qe.length;gt++){var It=[];Ai(Qe[gt],It,B,W,Q,!0),It.length&&pt.push(It)}if(pt.length){if(pe.lineMetrics&&Be==="LineString"){for(gt=0;gt<pt.length;gt++)ce.push(Bt(Le.id,Be,pt[gt],Le.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(pt.length===1?(Be="LineString",pt=pt[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=pt.length===3?"Point":"MultiPoint"),ce.push(Bt(Le.id,Be,pt,Le.tags))}}}return ce.length?ce:null}function vn(X,L,B,W,Q){for(var ae=0;ae<X.length;ae+=3){var _e=X[ae+Q];_e>=B&&_e<=W&&(L.push(X[ae]),L.push(X[ae+1]),L.push(X[ae+2]))}}function zo(X,L,B,W,Q,ae,_e){for(var pe,ce,ye=xl(X),Le=Q===0?vl:ma,Qe=X.start,Be=0;Be<X.length-3;Be+=3){var dt=X[Be],mt=X[Be+1],pt=X[Be+2],gt=X[Be+3],It=X[Be+4],jt=Q===0?dt:mt,or=Q===0?gt:It,Xt=!1;_e&&(pe=Math.sqrt(Math.pow(dt-gt,2)+Math.pow(mt-It,2))),jt<B?or>B&&(ce=Le(ye,dt,mt,gt,It,B),_e&&(ye.start=Qe+pe*ce)):jt>W?or<W&&(ce=Le(ye,dt,mt,gt,It,W),_e&&(ye.start=Qe+pe*ce)):Un(ye,dt,mt,pt),or<B&&jt>=B&&(ce=Le(ye,dt,mt,gt,It,B),Xt=!0),or>W&&jt<=W&&(ce=Le(ye,dt,mt,gt,It,W),Xt=!0),!ae&&Xt&&(_e&&(ye.end=Qe+pe*ce),L.push(ye),ye=xl(X)),_e&&(Qe+=pe)}var fe=X.length-3;dt=X[fe],mt=X[fe+1],pt=X[fe+2],(jt=Q===0?dt:mt)>=B&&jt<=W&&Un(ye,dt,mt,pt),fe=ye.length-3,ae&&fe>=3&&(ye[fe]!==ye[0]||ye[fe+1]!==ye[1])&&Un(ye,ye[0],ye[1],ye[2]),ye.length&&L.push(ye)}function xl(X){var L=[];return L.size=X.size,L.start=X.start,L.end=X.end,L}function Ai(X,L,B,W,Q,ae){for(var _e=0;_e<X.length;_e++)zo(X[_e],L,B,W,Q,ae,!1)}function Un(X,L,B,W){X.push(L),X.push(B),X.push(W)}function vl(X,L,B,W,Q,ae){var _e=(ae-L)/(W-L);return X.push(ae),X.push(B+(Q-B)*_e),X.push(1),_e}function ma(X,L,B,W,Q,ae){var _e=(ae-B)/(Q-B);return X.push(L+(W-L)*_e),X.push(ae),X.push(1),_e}function _a(X,L){for(var B=[],W=0;W<X.length;W++){var Q,ae=X[W],_e=ae.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Q=ga(ae.geometry,L);else if(_e==="MultiLineString"||_e==="Polygon"){Q=[];for(var pe=0;pe<ae.geometry.length;pe++)Q.push(ga(ae.geometry[pe],L))}else if(_e==="MultiPolygon")for(Q=[],pe=0;pe<ae.geometry.length;pe++){for(var ce=[],ye=0;ye<ae.geometry[pe].length;ye++)ce.push(ga(ae.geometry[pe][ye],L));Q.push(ce)}B.push(Bt(ae.id,_e,Q,ae.tags))}return B}function ga(X,L){var B=[];B.size=X.size,X.start!==void 0&&(B.start=X.start,B.end=X.end);for(var W=0;W<X.length;W+=3)B.push(X[W]+L,X[W+1],X[W+2]);return B}function ya(X,L){if(X.transformed)return X;var B,W,Q,ae=1<<X.z,_e=X.x,pe=X.y;for(B=0;B<X.features.length;B++){var ce=X.features[B],ye=ce.geometry,Le=ce.type;if(ce.geometry=[],Le===1)for(W=0;W<ye.length;W+=2)ce.geometry.push(wl(ye[W],ye[W+1],L,ae,_e,pe));else for(W=0;W<ye.length;W++){var Qe=[];for(Q=0;Q<ye[W].length;Q+=2)Qe.push(wl(ye[W][Q],ye[W][Q+1],L,ae,_e,pe));ce.geometry.push(Qe)}}return X.transformed=!0,X}function wl(X,L,B,W,Q,ae){return[Math.round(B*(X*W-Q)),Math.round(B*(L*W-ae))]}function bl(X,L,B,W,Q){for(var ae=L===Q.maxZoom?0:Q.tolerance/((1<<L)*Q.extent),_e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:W,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<X.length;pe++){_e.numFeatures++,iu(_e,X[pe],ae,Q);var ce=X[pe].minX,ye=X[pe].minY,Le=X[pe].maxX,Qe=X[pe].maxY;ce<_e.minX&&(_e.minX=ce),ye<_e.minY&&(_e.minY=ye),Le>_e.maxX&&(_e.maxX=Le),Qe>_e.maxY&&(_e.maxY=Qe)}return _e}function iu(X,L,B,W){var Q=L.geometry,ae=L.type,_e=[];if(ae==="Point"||ae==="MultiPoint")for(var pe=0;pe<Q.length;pe+=3)_e.push(Q[pe]),_e.push(Q[pe+1]),X.numPoints++,X.numSimplified++;else if(ae==="LineString")oo(_e,Q,X,B,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(pe=0;pe<Q.length;pe++)oo(_e,Q[pe],X,B,ae==="Polygon",pe===0);else if(ae==="MultiPolygon")for(var ce=0;ce<Q.length;ce++){var ye=Q[ce];for(pe=0;pe<ye.length;pe++)oo(_e,ye[pe],X,B,!0,pe===0)}if(_e.length){var Le=L.tags||null;if(ae==="LineString"&&W.lineMetrics){for(var Qe in Le={},L.tags)Le[Qe]=L.tags[Qe];Le.mapbox_clip_start=Q.start/Q.size,Le.mapbox_clip_end=Q.end/Q.size}var Be={geometry:_e,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:Le};L.id!==null&&(Be.id=L.id),X.features.push(Be)}}function oo(X,L,B,W,Q,ae){var _e=W*W;if(W>0&&L.size<(Q?_e:W))B.numPoints+=L.length/3;else{for(var pe=[],ce=0;ce<L.length;ce+=3)(W===0||L[ce+2]>_e)&&(B.numSimplified++,pe.push(L[ce]),pe.push(L[ce+1])),B.numPoints++;Q&&function(ye,Le){for(var Qe=0,Be=0,dt=ye.length,mt=dt-2;Be<dt;mt=Be,Be+=2)Qe+=(ye[Be]-ye[mt])*(ye[Be+1]+ye[mt+1]);if(Qe>0===Le)for(Be=0,dt=ye.length;Be<dt/2;Be+=2){var pt=ye[Be],gt=ye[Be+1];ye[Be]=ye[dt-2-Be],ye[Be+1]=ye[dt-1-Be],ye[dt-2-Be]=pt,ye[dt-1-Be]=gt}}(pe,ae),X.push(pe)}}function Nn(X,L){var B=(L=this.options=function(Q,ae){for(var _e in ae)Q[_e]=ae[_e];return Q}(Object.create(this.options),L)).debug;if(B&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var W=function(Q,ae){var _e=[];if(Q.type==="FeatureCollection")for(var pe=0;pe<Q.features.length;pe++)On(_e,Q.features[pe],ae,pe);else On(_e,Q.type==="Feature"?Q:{geometry:Q},ae);return _e}(X,L);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(W=function(Q,ae){var _e=ae.buffer/ae.extent,pe=Q,ce=Ii(Q,1,-1-_e,_e,0,-1,2,ae),ye=Ii(Q,1,1-_e,2+_e,0,-1,2,ae);return(ce||ye)&&(pe=Ii(Q,1,-_e,1+_e,0,-1,2,ae)||[],ce&&(pe=_a(ce,1).concat(pe)),ye&&(pe=pe.concat(_a(ye,-1)))),pe}(W,L)).length&&this.splitTile(W,0,0,0),B&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hs(X,L,B){return 32*((1<<X)*B+L)+X}function Tl(X,L){const B=X.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const W=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!W)return L(null,null);const Q=new ge(W.features);let ae=st(Q);ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),L(null,{vectorTile:Q,rawData:ae.buffer})}Nn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Nn.prototype.splitTile=function(X,L,B,W,Q,ae,_e){for(var pe=[X,L,B,W],ce=this.options,ye=ce.debug;pe.length;){W=pe.pop(),B=pe.pop(),L=pe.pop(),X=pe.pop();var Le=1<<L,Qe=hs(L,B,W),Be=this.tiles[Qe];if(!Be&&(ye>1&&console.time("creation"),Be=this.tiles[Qe]=bl(X,L,B,W,ce),this.tileCoords.push({z:L,x:B,y:W}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,B,W,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var dt="z"+L;this.stats[dt]=(this.stats[dt]||0)+1,this.total++}if(Be.source=X,Q){if(L===ce.maxZoom||L===Q)continue;var mt=1<<Q-L;if(B!==Math.floor(ae/mt)||W!==Math.floor(_e/mt))continue}else if(L===ce.indexMaxZoom||Be.numPoints<=ce.indexMaxPoints)continue;if(Be.source=null,X.length!==0){ye>1&&console.time("clipping");var pt,gt,It,jt,or,Xt,fe=.5*ce.buffer/ce.extent,Mi=.5-fe,dr=.5+fe,Vi=1+fe;pt=gt=It=jt=null,or=Ii(X,Le,B-fe,B+dr,0,Be.minX,Be.maxX,ce),Xt=Ii(X,Le,B+Mi,B+Vi,0,Be.minX,Be.maxX,ce),X=null,or&&(pt=Ii(or,Le,W-fe,W+dr,1,Be.minY,Be.maxY,ce),gt=Ii(or,Le,W+Mi,W+Vi,1,Be.minY,Be.maxY,ce),or=null),Xt&&(It=Ii(Xt,Le,W-fe,W+dr,1,Be.minY,Be.maxY,ce),jt=Ii(Xt,Le,W+Mi,W+Vi,1,Be.minY,Be.maxY,ce),Xt=null),ye>1&&console.timeEnd("clipping"),pe.push(pt||[],L+1,2*B,2*W),pe.push(gt||[],L+1,2*B,2*W+1),pe.push(It||[],L+1,2*B+1,2*W),pe.push(jt||[],L+1,2*B+1,2*W+1)}}},Nn.prototype.getTile=function(X,L,B){var W=this.options,Q=W.extent,ae=W.debug;if(X<0||X>24)return null;var _e=1<<X,pe=hs(X,L=(L%_e+_e)%_e,B);if(this.tiles[pe])return ya(this.tiles[pe],Q);ae>1&&console.log("drilling down to z%d-%d-%d",X,L,B);for(var ce,ye=X,Le=L,Qe=B;!ce&&ye>0;)ye--,Le=Math.floor(Le/2),Qe=Math.floor(Qe/2),ce=this.tiles[hs(ye,Le,Qe)];return ce&&ce.source?(ae>1&&console.log("found parent tile z%d-%d-%d",ye,Le,Qe),ae>1&&console.time("drilling down"),this.splitTile(ce.source,ye,Le,Qe,X,L,B),ae>1&&console.timeEnd("drilling down"),this.tiles[pe]?ya(this.tiles[pe],Q):null):null};class mi extends a.VectorTileWorkerSource{constructor(L,B,W,Q,ae){super(L,B,W,Q,Tl),ae&&(this.loadGeoJSON=ae)}loadData(L,B){const W=L&&L.request,Q=W&&W.collectResourceTiming;this.loadGeoJSON(L,(ae,_e)=>{if(ae||!_e)return B(ae);if(typeof _e!="object")return B(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{me(_e,!0);try{if(L.filter){const ce=a.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));const ye=_e.features.filter(Le=>ce.value.evaluate({zoom:0},Le));_e={type:"FeatureCollection",features:ye}}this._geoJSONIndex=L.cluster?new fi(function({superclusterOptions:ce,clusterProperties:ye}){if(!ye||!ce)return ce;const Le={},Qe={},Be={accumulated:null,zoom:0},dt={properties:null},mt=Object.keys(ye);for(const pt of mt){const[gt,It]=ye[pt],jt=a.createExpression(It),or=a.createExpression(typeof gt=="string"?[gt,["accumulated"],["get",pt]]:gt);Le[pt]=jt.value,Qe[pt]=or.value}return ce.map=pt=>{dt.properties=pt;const gt={};for(const It of mt)gt[It]=Le[It].evaluate(Be,dt);return gt},ce.reduce=(pt,gt)=>{dt.properties=gt;for(const It of mt)Be.accumulated=pt[It],pt[It]=Qe[It].evaluate(Be,dt)},ce}(L)).load(_e.features):function(ce,ye){return new Nn(ce,ye)}(_e,L.geojsonVtOptions)}catch(ce){return B(ce)}this.loaded={};const pe={};if(Q){const ce=a.getPerformanceMeasurement(W);ce&&(pe.resourceTiming={},pe.resourceTiming[L.source]=JSON.parse(JSON.stringify(ce)))}B(null,pe)}})}reloadTile(L,B){const W=this.loaded;return W&&W[L.uid]?super.reloadTile(L,B):this.loadTile(L,B)}loadGeoJSON(L,B){if(L.request)a.getJSON(L.request,B);else{if(typeof L.data!="string")return B(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return B(null,JSON.parse(L.data))}catch{return B(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(W){B(W)}}getClusterChildren(L,B){try{B(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(W){B(W)}}getClusterLeaves(L,B){try{B(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(W){B(W)}}}class xa{constructor(L){this.self=L,this.actor=new a.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:mi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,W)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=W},this.self.registerRTLTextPlugin=B=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=B.applyArabicShaping,a.plugin.processBidirectionalText=B.processBidirectionalText,a.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}clearCaches(L,B,W){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],W()}checkIfReady(L,B,W){W()}setReferrer(L,B){this.referrer=B}spriteLoaded(L,B){this.isSpriteLoaded[L]=B;for(const W in this.workerSources[L]){const Q=this.workerSources[L][W];for(const ae in Q)Q[ae]instanceof a.VectorTileWorkerSource&&(Q[ae].isSpriteLoaded=B,Q[ae].fire(new a.Event("isSpriteLoaded")))}}setImages(L,B,W){this.availableImages[L]=B;for(const Q in this.workerSources[L]){const ae=this.workerSources[L][Q];for(const _e in ae)ae[_e].availableImages=B}W()}enableTerrain(L,B,W){this.terrain=B,W()}setProjection(L,B){this.projections[L]=a.getProjection(B)}setLayers(L,B,W){this.getLayerIndex(L).replace(B),W()}updateLayers(L,B,W){this.getLayerIndex(L).update(B.layers,B.removedIds),W()}loadTile(L,B,W){const Q=this.enableTerrain?a.extend({enableTerrain:this.terrain},B):B;Q.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,B.type,B.source).loadTile(Q,W)}loadDEMTile(L,B,W){const Q=this.enableTerrain?a.extend({buildQuadTree:this.terrain},B):B;this.getDEMWorkerSource(L,B.source).loadTile(Q,W)}reloadTile(L,B,W){const Q=this.enableTerrain?a.extend({enableTerrain:this.terrain},B):B;Q.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,B.type,B.source).reloadTile(Q,W)}abortTile(L,B,W){this.getWorkerSource(L,B.type,B.source).abortTile(B,W)}removeTile(L,B,W){this.getWorkerSource(L,B.type,B.source).removeTile(B,W)}removeSource(L,B,W){if(!this.workerSources[L]||!this.workerSources[L][B.type]||!this.workerSources[L][B.type][B.source])return;const Q=this.workerSources[L][B.type][B.source];delete this.workerSources[L][B.type][B.source],Q.removeSource!==void 0?Q.removeSource(B,W):W()}loadWorkerSource(L,B,W){try{this.self.importScripts(B.url),W()}catch(Q){W(Q.toString())}}syncRTLPluginState(L,B,W){try{a.plugin.setState(B);const Q=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&Q!=null){this.self.importScripts(Q);const ae=a.plugin.isParsed();W(ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),ae)}}catch(Q){W(Q.toString())}}getAvailableImages(L){let B=this.availableImages[L];return B||(B=[]),B}getLayerIndex(L){let B=this.layerIndexes[L];return B||(B=this.layerIndexes[L]=new Me),B}getWorkerSource(L,B,W){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][B]||(this.workerSources[L][B]={}),this.workerSources[L][B][W]||(this.workerSources[L][B][W]=new this.workerSourceTypes[B]({send:(Q,ae,_e,pe,ce,ye)=>{this.actor.send(Q,ae,_e,L,ce,ye)},scheduler:this.actor.scheduler},this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])),this.workerSources[L][B][W]}getDEMWorkerSource(L,B){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][B]||(this.demWorkerSources[L][B]=new ne),this.demWorkerSources[L][B]}enforceCacheSizeLimit(L,B){a.enforceCacheSizeLimit(B)}getWorkerPerformanceMetrics(L,B,W){W(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new xa(self)),xa}),S(["./shared"],function(a){function U(h,t){if(Array.isArray(h)){if(!Array.isArray(t)||h.length!==t.length)return!1;for(let l=0;l<h.length;l++)if(!U(h[l],t[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&t!==null){if(typeof t!="object"||Object.keys(h).length!==Object.keys(t).length)return!1;for(const l in h)if(!U(h[l],t[l]))return!1;return!0}return h===t}var de=Me;function Me(h){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,y=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(y);try{_=new Worker(b),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(b),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var y=_.getImageData(0,0,1,1);return y&&y.width===p.width}()?(ne[l=t&&t.failIfMajorPerformanceCaveat]===void 0&&(ne[l]=function(p){var _,y=function(b){var T=document.createElement("canvas"),C=Object.create(Me.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=b,T.getContext("webgl",C)||T.getContext("experimental-webgl",C)}(p);if(!y)return!1;try{_=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!_||y.isContextLost())&&(y.shaderSource(_,"void main() {}"),y.compileShader(_),y.getShaderParameter(_,y.COMPILE_STATUS)===!0)}(l)),ne[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(h)}var ne={};function me(h,t,l){const p=a.window.document.createElement(h);return t!==void 0&&(p.className=t),l&&l.appendChild(p),p}function Ge(h,t,l){const p=a.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(t))p.setAttributeNS(null,_,t[_]);return l&&l.appendChild(p),p}Me.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ye=a.window.document&&a.window.document.documentElement.style,ze=Ye&&Ye.userSelect!==void 0?"userSelect":"WebkitUserSelect";let kt;function ge(){Ye&&ze&&(kt=Ye[ze],Ye[ze]="none")}function he(){Ye&&ze&&(Ye[ze]=kt)}function we(h){h.preventDefault(),h.stopPropagation(),a.window.removeEventListener("click",we,!0)}function je(){a.window.addEventListener("click",we,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",we,!0)},0)}function Fe(h,t){const l=h.getBoundingClientRect();return ft(h,l,t)}function st(h,t){const l=h.getBoundingClientRect(),p=[];for(let _=0;_<t.length;_++)p.push(ft(h,l,t[_]));return p}function lt(h){return a.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function ft(h,t,l){const p=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new a.pointGeometry((l.clientX-t.left)*p,(l.clientY-t.top)*p)}function nr(h,t){var l=t[0],p=t[1],_=t[2],y=t[3],b=l*y-_*p;return b?(h[0]=y*(b=1/b),h[1]=-p*b,h[2]=-_*b,h[3]=l*b,h):null}function xt(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class ai extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,l){this._validate(t,l)&&(this.images[t]=l)}_validate(t,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,l){if(!t)return!0;let p=0;for(const _ of t){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(t,l){return!(t&&(t.length!==4||t[0]<0||l.data.width<t[0]||t[1]<0||l.data.height<t[1]||t[2]<0||l.data.width<t[2]||t[3]<0||l.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,l){l.version=this.images[t].version+1,this.images[t]=l,this.updatedImages[t]=!0}removeImage(t){const l=this.images[t];delete this.images[t],delete this.patterns[t],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,l){let p=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(t,l):this.requestors.push({ids:t,callback:l})}_notify(t,l){const p={};for(const _ of t){this.images[_]||this.fire(new a.Event("styleimagemissing",{id:_}));const y=this.images[_];y?p[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:a.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:t,height:l}=this.atlasImage;return{width:t,height:l}}getPattern(t){const l=this.patterns[t],p=this.getImage(t);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new a.ImagePosition(_,p);this.patterns[t]={bin:_,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const l=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(t,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:l,h:p}=a.potpack(t),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const y in this.patterns){const{bin:b}=this.patterns[y],T=b.x+1,C=b.y+1,M=this.images[y].data,z=M.width,R=M.height;a.RGBAImage.copy(M,_,{x:0,y:0},{x:T,y:C},{width:z,height:R}),a.RGBAImage.copy(M,_,{x:0,y:R-1},{x:T,y:C-1},{width:z,height:1}),a.RGBAImage.copy(M,_,{x:0,y:0},{x:T,y:C+R},{width:z,height:1}),a.RGBAImage.copy(M,_,{x:z-1,y:0},{x:T-1,y:C},{width:1,height:R}),a.RGBAImage.copy(M,_,{x:0,y:0},{x:T+z,y:C},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const l of t){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];xt(p)&&this.updateImage(l,p)}}}const Oi=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(h,t){return function([l,p,_]){const y=a.degToRad(p+90),b=a.degToRad(_);return{x:l*Math.cos(y)*Math.sin(b),y:l*Math.sin(y)*Math.sin(b),z:l*Math.cos(b),azimuthal:p,polar:_}}(h.expression.evaluate(t))}interpolate(h,t,l){return{x:a.number(h.x,t.x,l),y:a.number(h.y,t.y,l),z:a.number(h.z,t.z,l),azimuthal:a.number(h.azimuthal,t.azimuthal,l),polar:a.number(h.polar,t.polar,l)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),Fi="-transition";class Co extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(Oi),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,l={}){if(!this._validate(a.validateLight,t,l))for(const p in t){const _=t[p];a.endsWith(p,Fi)?this._transitionable.setTransition(p.slice(0,-Fi.length),_):this._transitionable.setValue(p,_)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,p){return(!p||p.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const as=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),Ui="-transition";class yn extends a.Evented{constructor(t,l){super(),this._transitionable=new a.Transitionable(as),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(t){for(const l in t){const p=t[l];a.endsWith(l,Ui)?this._transitionable.setTransition(l.slice(0,-Ui.length),p):this._transitionable.setValue(l,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function it(h,t,l,p){const _=a.smoothstep(45,65,l),[y,b]=wt(h,p),T=a.length(t);let C=1-Math.min(1,Math.exp((T-y)/(b-y)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*h.alpha}function wt(h,t){const l=.5/Math.tan(.5*t);return[h.range[0]+l,h.range[1]+l]}const vt=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])}),sr="-transition";class zt extends a.Evented{constructor(t,l){super(),this._transitionable=new a.Transitionable(vt),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const t=this._transform,l=t.projection.name==="globe",p=a.globeToMercatorTransition(t.zoom),_=this.properties.get("range"),y=[.5,3];return{range:l?[a.number(y[0],_[0],p),a.number(y[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,l={}){if(!this._validate(a.validateFog,t,l)){for(const p of Object.keys(a.spec.fog))t&&t[p]===void 0&&(t[p]=a.spec.fog[p].default);for(const p in t){const _=t[p];a.endsWith(p,sr)?this._transitionable.setTransition(p.slice(0,-sr.length),_):this._transitionable.setValue(p,_)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,t))*l.a}getOpacityAtLatLng(t,l){return this._transform.projection.supportsFog?function(p,_,y){const b=a.MercatorCoordinate.fromLngLat(_),T=y.elevation?y.elevation.getAtPointOrZero(b):0,C=[b.x,b.y,T];return a.transformMat4(C,C,y.mercatorFogMatrix),it(p,C,y.pitch,y._fov)}(this.state,t,l):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?wt(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,p){return(!p||p.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Mr{constructor(t,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const y=new Mr.Actor(p[_],l,this.id);y.name=`Worker ${_}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,l,p){a.asyncAll(this.actors,(_,y)=>{_.send(t,l,y)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Zr(h,t,l){return t*(a.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}Mr.Actor=a.Actor;class qr{constructor(t,l,p,_){this.screenBounds=t,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(t,l){let p,_;if(t instanceof a.pointGeometry||typeof t[0]=="number"){const y=a.pointGeometry.convert(t);p=[a.pointGeometry.convert(t)],_=l.isPointAboveHorizon(y)}else{const y=a.pointGeometry.convert(t[0]),b=a.pointGeometry.convert(t[1]);p=[y,b],_=a.polygonizeBounds(y,b).every(T=>l.isPointAboveHorizon(T))}return new qr(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],_=a.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),a.bufferConvexPolygon(_,t)}bufferedCameraGeometryGlobe(t){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],_=a.polygonizeBounds(l,p,t),y=this.cameraPoint.clone();switch(3*((y.y>l.y)+(y.y>p.y))+((y.x>l.x)+(y.x>p.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(t,l,p,_=0){const y=t.queryPadding/l._projectionScaler+1,b=p?this._bufferedCameraMercator(y,l):this._bufferedScreenMercator(y,l);let T=t.tileID.wrap+(b.unwrapped?_:0);const C=b.polygon.map(K=>a.getTilePoint(t.tileTransform,K,T));if(!a.polygonIntersectsBox(C,0,0,a.EXTENT,a.EXTENT))return;T=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const M=this.screenGeometryMercator.polygon.map(K=>a.getTileVec3(t.tileTransform,K,T)),z=M.map(K=>new a.pointGeometry(K[0],K[1])),R=l.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),F=a.getTileVec3(t.tileTransform,R,T),j=M.map(K=>{const V=a.sub(K,K,F);return a.normalize(V,V),new a.Ray(F,V)}),G=Zr(t,1,l.zoom)*l._projectionScaler;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:j,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(N=a.getBounds(C),N.min.x=a.clamp(N.min.x,0,a.EXTENT),N.min.y=a.clamp(N.min.y,0,a.EXTENT),N.max.x=a.clamp(N.max.x,0,a.EXTENT),N.max.y=a.clamp(N.max.y,0,a.EXTENT),N),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:G};var N}_bufferedScreenMercator(t,l){const p=ls(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),l):{polygon:this.bufferedScreenGeometry(t).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(t,l){const p=ls(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),l):{polygon:this.bufferedCameraGeometry(t).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(t,l){const p=function(y,b){const T=a.multiply([],b.pixelMatrix,b.globeMatrix),C=[0,-a.GLOBE_RADIUS,0,1],M=[0,a.GLOBE_RADIUS,0,1],z=[0,0,0,1];a.transformMat4$1(C,C,T),a.transformMat4$1(M,M,T),a.transformMat4$1(z,z,T);const R=new a.pointGeometry(C[0]/C[3],C[1]/C[3]),F=new a.pointGeometry(M[0]/M[3],M[1]/M[3]),j=a.polygonContainsPoint(y,R)&&C[3]<z[3],G=a.polygonContainsPoint(y,F)&&M[3]<z[3];if(!j&&!G)return null;const N=function(se,be,Se){for(let Te=1;Te<se.length;Te++){const ve=fi(be.pointCoordinate3D(se[Te-1]).x),ee=fi(be.pointCoordinate3D(se[Te]).x);if(Se<0){if(ve<ee)return{idx:Te,t:-ve/(ee-1-ve)}}else if(ee<ve)return{idx:Te,t:(1-ve)/(ee+1-ve)}}return null}(y,b,j?-1:1);if(!N)return null;const{idx:K,t:V}=N;let Z=K>1?Wr(y.slice(0,K),b):[],q=K<y.length?Wr(y.slice(K),b):[];Z=Z.map(se=>new a.pointGeometry(fi(se.x),se.y)),q=q.map(se=>new a.pointGeometry(fi(se.x),se.y));const te=[...Z];te.length===0&&te.push(q[q.length-1]);const Y=a.number(te[te.length-1].y,(q.length===0?Z[0]:q[0]).y,V);let J;return J=j?[new a.pointGeometry(0,Y),new a.pointGeometry(0,0),new a.pointGeometry(1,0),new a.pointGeometry(1,Y)]:[new a.pointGeometry(1,Y),new a.pointGeometry(1,1),new a.pointGeometry(0,1),new a.pointGeometry(0,Y)],te.push(...J),q.length===0?te.push(Z[0]):te.push(...q),{polygon:te.map(se=>new a.MercatorCoordinate(se.x,se.y)),unwrapped:!1}}(t,l);if(p)return p;const _=function(y,b){let T=!1,C=-1/0,M=0;for(let R=0;R<y.length-1;R++)y[R].x>C&&(C=y[R].x,M=R);for(let R=0;R<y.length-1;R++){const F=(M+R)%(y.length-1),j=y[F],G=y[F+1];Math.abs(j.x-G.x)>.5&&(j.x<G.x?(j.x+=1,F===0&&(y[y.length-1].x+=1)):(G.x+=1,F+1===y.length-1&&(y[0].x+=1)),T=!0)}const z=a.mercatorXfromLng(b.center.lng);return T&&z<Math.abs(z-1)&&y.forEach(R=>{R.x-=1}),{polygon:y,unwrapped:T}}(Wr(t,l).map(y=>new a.pointGeometry(fi(y.x),y.y)),l);return{polygon:_.polygon.map(y=>new a.MercatorCoordinate(y.x,y.y)),unwrapped:_.unwrapped}}}function Wr(h,t){return a.resample(h,l=>{const p=t.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function fi(h){return h<0?1+h%1:h%1}function ls(h){return 100*h|0}function da(h,t,l,p,_){const y=function(b,T){if(b)return _(b);if(T){const C=a.pick(a.extend(T,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(C.vectorLayers=T.vector_layers,C.vectorLayerIds=C.vectorLayers.map(M=>M.id)),T.language_options&&(C.languageOptions=T.language_options),T.language&&T.language[T.id]&&(C.language=T.language[T.id]),T.worldview_options&&(C.worldviewOptions=T.worldview_options),T.worldview?C.worldview=T.worldview[T.id]:T.worldview_default&&(C.worldview=T.worldview_default),C.tiles=t.canonicalizeTileset(C,h.url),_(null,C)}};return h.url?a.getJSON(t.transformRequest(t.normalizeSourceURL(h.url,null,l,p),a.ResourceType.Source),y):a.exported.frame(()=>y(null,h))}class Rn{constructor(t,l,p){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const l=Math.pow(2,t.z),p=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*l),y=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*l),b=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*l);return t.x>=p&&t.x<y&&t.y>=_&&t.y<b}}class yl{constructor(t,l,p){this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Io={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ao{constructor(t,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,l,p){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],b=l.attributes[y.name];b!==void 0&&t.vertexAttribPointer(b,y.components,t[Io[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ft{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bn extends Ft{getDefault(){return a.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Mo extends Ft{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class xn extends Ft{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ni extends Ft{getDefault(){return[!0,!0,!0,!0]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cs extends Ft{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Bt extends Ft{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class no extends Ft{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const l=this.current;(t.func!==l.func||t.ref!==l.ref||t.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class On extends Ft{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Fn extends Ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=t,this.dirty=!1}}class ko extends Ft{getDefault(){return[0,1]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class us extends Ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=t,this.dirty=!1}}class pa extends Ft{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class fa extends Ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.BLEND):l.disable(l.BLEND),this.current=t,this.dirty=!1}}class Ii extends Ft{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class vn extends Ft{getDefault(){return a.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zo extends Ft{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class xl extends Ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=t,this.dirty=!1}}class Ai extends Ft{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Un extends Ft{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class vl extends Ft{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ma extends Ft{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _a extends Ft{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ga extends Ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ya extends Ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wl extends Ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class bl extends Ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class iu extends Ft{getDefault(){return null}set(t){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class oo extends Ft{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Nn extends Ft{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class hs extends Ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Tl extends Ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class mi extends Ft{constructor(t,l){super(t),this.context=t,this.parent=l}getDefault(){return null}}class xa extends mi{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class X extends mi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class L extends X{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class B{constructor(t,l,p,_){this.context=t,this.width=l,this.height=p;const y=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new xa(t,y),_&&(this.depthAttachment=new X(t,y))}destroy(){const t=this.context.gl,l=this.colorAttachment.get();if(l&&t.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class W{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Bn(this),this.clearDepth=new Mo(this),this.clearStencil=new xn(this),this.colorMask=new Ni(this),this.depthMask=new cs(this),this.stencilMask=new Bt(this),this.stencilFunc=new no(this),this.stencilOp=new On(this),this.stencilTest=new Fn(this),this.depthRange=new ko(this),this.depthTest=new us(this),this.depthFunc=new pa(this),this.blend=new fa(this),this.blendFunc=new Ii(this),this.blendColor=new vn(this),this.blendEquation=new zo(this),this.cullFace=new xl(this),this.cullFaceSide=new Ai(this),this.frontFace=new Un(this),this.program=new vl(this),this.activeTexture=new ma(this),this.viewport=new _a(this),this.bindFramebuffer=new ga(this),this.bindRenderbuffer=new ya(this),this.bindTexture=new wl(this),this.bindVertexBuffer=new bl(this),this.bindElementBuffer=new iu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new oo(this),this.pixelStoreUnpack=new Nn(this),this.pixelStoreUnpackPremultiplyAlpha=new hs(this),this.pixelStoreUnpackFlipY=new Tl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,l){return new yl(this,t,l)}createVertexBuffer(t,l,p){return new Ao(this,t,l,p)}createRenderbuffer(t,l,p){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,t,l,p),this.bindRenderbuffer.set(null),y}createFramebuffer(t,l,p){return new B(this,t,l,p)}clear({color:t,depth:l,stencil:p}){const _=this.gl;let y=0;t&&(y|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(y|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(y|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){U(t.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Q extends a.Evented{constructor(t,l,p,_){super(),this.id=t,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},l),a.extend(this,a.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=da(this._options,this.map._requestManager,null,null,(t,l)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):l&&(a.extend(this,l),l.bounds&&(this.tileBounds=new Rn(l.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(l.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,l){const p=a.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=a.getImage(this.map._requestManager.transformRequest(_,a.ResourceType.Tile),(y,b,T,C)=>(delete t.request,t.aborted?(t.state="unloaded",l(null)):y?(t.state="errored",l(y)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:T,expires:C}),t.setTexture(b,this.map.painter),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(t,l,p){t.setTexture(l,p)}static unloadTileData(t,l){t.texture&&l.saveTileTexture(t.texture)}abortTile(t,l){t.request&&(t.request.cancel(),delete t.request),l()}unloadTile(t,l){t.texture&&this.map.painter.saveTileTexture(t.texture),l()}hasTransition(){return!1}}let ae;function _e(h,t,l,p,_,y,b,T){const C=[h,l,_,t,p,y,1,1,1],M=[b,T,1],z=a.adjoint([],C),[R,F,j]=a.transformMat3(M,M,a.transpose(z,z));return a.multiply$1(C,[R,0,0,0,F,0,0,0,j],C)}class pe extends a.Evented{constructor(t,l,p,_){super(),this.id=t,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(t,l){this._loaded=l||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(p,_)=>{if(this._loaded=!0,p)this.fire(new a.ErrorEvent(p));else if(_){const{HTMLImageElement:y}=a.window;this.image=_ instanceof y?a.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const l=t.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,y=1/0,b=-1/0,T=-1/0;for(const R of p)_=Math.min(_,R.x),y=Math.min(y,R.y),b=Math.max(b,R.x),T=Math.max(T,R.y);const C=Math.max(b-_,T-y),M=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),z=Math.pow(2,M);return new a.CanonicalTileID(M,Math.floor((_+b)/2*z),Math.floor((y+T)/2*z))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const C in this.tiles){const M=this.tiles[C];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}if(this._boundsArray)return;const l=a.tileTransform(this.tileID,this.map.transform.projection),[p,_,y,b]=this.coordinates.map(C=>{const M=l.projection.project(C[0],C[1]);return a.getTilePoint(l,M)._round()});this.perspectiveTransform=function(C,M,z,R,F,j,G,N,K,V){const Z=_e(0,0,C,0,0,M,C,M),q=_e(z,R,F,j,G,N,K,V);return a.multiply$1(q,a.adjoint(Z,Z),q),[q[6]/q[8]*C/a.EXTENT,q[7]/q[8]*M/a.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,b.x,b.y,y.x,y.y);const T=this._boundsArray=new a.StructArrayLayout4i8;T.emplaceBack(p.x,p.y,0,0),T.emplaceBack(_.x,_.y,a.EXTENT,0),T.emplaceBack(b.x,b.y,0,a.EXTENT),T.emplaceBack(y.x,y.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(T,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,l=t.gl;this.texture?this.texture.update(this.image):(this.texture=new a.Texture(t,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,l){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},l(null)):(t.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ce={vector:class extends a.Evented{constructor(h,t,l,p){if(super(),this.id=h,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(t,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(h){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const t=this.language||this.map._language,l=this.worldview||this.map._worldview;this._tileJSONRequest=da(this._options,this.map._requestManager,t,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${t}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new a.ErrorEvent(p))):_&&(a.extend(this,_),_.bounds&&(this.tileBounds=new Rn(_.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(p)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.load(()=>{const t=this.map.style._getSourceCaches(this.id);for(const l of t)l.clearTiles()})}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}_setLanguage(h){return h===this.language||this.setSourceProperty(()=>{this.language=h}),this}_setWorldview(h){return h===this.worldview?this:this.worldviewOptions&&h&&!this.worldviewOptions[h]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${h}".`),this):(this.setSourceProperty(()=>{this.worldview=h}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(h,t){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,a.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired")h.state==="loading"?h.reloadCallback=t:h.request=h.actor.send("reloadTile",p,_.bind(this));else if(h.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const y=a.loadVectorTile.call({deduped:this._deduped},p,(b,T)=>{b||!T?_.call(this,b):(p.data={cacheControl:T.cacheControl,expires:T.expires,rawData:T.rawData.slice(0)},h.actor&&h.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);h.request={cancel:y}}function _(y,b){return delete h.request,h.aborted?t(null):y&&y.status!==404?t(y):(b&&b.resourceTiming&&(h.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&h.setExpiryData(b),h.loadVectorData(b,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Q,"raster-dem":class extends Q{constructor(h,t,l,p){super(h,t,l,p),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,y){_&&(h.state="errored",t(_)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=a.getImage(this.map._requestManager.transformRequest(l,a.ResourceType.Tile),function(_,y,b,T){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(_)h.state="errored",t(_);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:T});const C=a.window.ImageBitmap&&y instanceof a.window.ImageBitmap&&(ae==null&&(ae=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),ae),M=1-(y.width-a.prevPowerOfTwo(y.width))/2;M<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const z=C?y:a.exported.getImageData(y,M),R={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:M};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",R,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const t=h.canonical,l=Math.pow(2,t.z),p=(t.x-1+l)%l,_=t.x===0?h.wrap-1:h.wrap,y=(t.x+1+l)%l,b=t.x+1===l?h.wrap+1:h.wrap,T={};return T[new a.OverscaledTileID(h.overscaledZ,_,t.z,p,t.y).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,b,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(T[new a.OverscaledTileID(h.overscaledZ,_,t.z,p,t.y-1).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,b,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<l&&(T[new a.OverscaledTileID(h.overscaledZ,_,t.z,p,t.y+1).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,b,t.z,y,t.y+1).key]={backfilled:!1}),T}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends a.Evented{constructor(h,t,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=t.data,this._options=a.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*_,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*_,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:a.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},t),this}getClusterLeaves(h,t,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:t,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=a.extend({},this.workerOptions),t=this._data;typeof t=="string"?(h.request=this.map._requestManager.transformRequest(a.exported.resolveURL(t),a.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new a.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new a.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,t){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete h.request,h.unloadVectorData(),h.aborted?t(null):p?t(p):(h.loadVectorData(_,this.map.painter,l==="reloadTile"),t(null))),void 0,l==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pe{constructor(h,t,l,p){super(h,t,l,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,a.ResourceType.Source).url);a.getVideo(this.urls,(t,l)=>{this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(h,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pe,canvas:class extends pe{constructor(h,t,l,p){super(h,t,l,p),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends a.Evented{constructor(h,t,l,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=t,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Rn(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:l,z:p}=h.canonical;return this._implementation.hasTile({x:t,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:l,y:p,z:_}=h.tileID.canonical,y=new a.window.AbortController,b=this._implementation.loadTile({x:l,y:p,z:_},{signal:y.signal});if(!b)return this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null);b.cancel=()=>y.abort(),h.request=b.then(function(T){return delete h.request,h.aborted?(h.state="unloaded",t(null)):T?function(C){return C instanceof a.window.ImageData||C instanceof a.window.ImageBitmap||C instanceof a.window.HTMLCanvasElement}(T)?(this.loadTileData(h,T),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null))}.bind(this)).catch(T=>{T.code!==20&&(h.state="errored",t(T))})}loadTileData(h,t){Q.loadTileData(h,t,this._map.painter)}unloadTileData(h){Q.unloadTileData(h,this._map.painter)}prepareTile(h){if(!this._implementation.prepareTile)return null;const{x:t,y:l,z:p}=h.tileID.canonical,_=this._implementation.prepareTile({x:t,y:l,z:p});return _?(this.loadTileData(h,_),h.state="loaded",_):null}unloadTile(h,t){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:p,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ye=function(h,t,l,p){const _=new ce[t.type](h,t,l,p);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Le(h,t){const l=a.identity([]);return a.scale(l,l,[.5*h.width,.5*-h.height,1]),a.translate(l,l,[1,-1,0]),a.multiply(l,l,h.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(l)}function Qe(h,t,l,p,_,y,b,T=!1){const C=h.tilesIn(p,b,T);C.sort(dt);const M=[];for(const R of C)M.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(t,l,h._state,R,_,y,Le(h.transform,R.tile.tileID),T)});const z=function(R){const F={},j={};for(const G of R){const N=G.queryResults,K=G.wrappedTileID,V=j[K]=j[K]||{};for(const Z in N){const q=N[Z],te=V[Z]=V[Z]||{},Y=F[Z]=F[Z]||[];for(const J of q)te[J.featureIndex]||(te[J.featureIndex]=!0,Y.push(J))}}return F}(M);for(const R in z)z[R].forEach(F=>{const j=F.feature,G=j.layer;G&&G.type!=="background"&&G.type!=="sky"&&(j.source=G.source,G["source-layer"]&&(j.sourceLayer=G["source-layer"]),j.state=j.id!==void 0?h.getFeatureState(G["source-layer"],j.id):{})});return z}function Be(h,t){const l=h.getRenderableIds().map(y=>h.getTileByID(y)),p=[],_={};for(let y=0;y<l.length;y++){const b=l[y],T=b.tileID.canonical.key;_[T]||(_[T]=!0,b.querySourceFeatures(p,t))}return p}function dt(h,t){const l=h.tileID,p=t.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function mt(){return uc.workerClass!=null?new uc.workerClass:new a.window.Worker(uc.workerUrl)}const pt="mapboxgl_preloaded_worker_pool";class gt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<gt.workerCount;)this.workers.push(new mt);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pt]}numActive(){return Object.keys(this.active).length}}let It;function jt(){return It||(It=new gt),It}function or(h,t){const l={};for(const p in h)p!=="ref"&&(l[p]=h[p]);return a.refProperties.forEach(p=>{p in t&&(l[p]=t[p])}),l}function Xt(h){h=h.slice();const t=Object.create(null);for(let l=0;l<h.length;l++)t[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=or(h[l],t[h[l].ref]));return h}gt.workerCount=2;const fe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Mi(h,t,l){l.push({command:fe.addSource,args:[h,t[h]]})}function dr(h,t,l){t.push({command:fe.removeSource,args:[h]}),l[h]=!0}function Vi(h,t,l,p){dr(h,l,p),Mi(h,t,l)}function vm(h,t,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&p!=="data"&&!U(h[l][p],t[l][p]))return!1;for(p in t[l])if(t[l].hasOwnProperty(p)&&p!=="data"&&!U(h[l][p],t[l][p]))return!1;return!0}function ki(h,t,l,p,_,y){let b;for(b in t=t||{},h=h||{})h.hasOwnProperty(b)&&(U(h[b],t[b])||l.push({command:y,args:[p,b,t[b],_]}));for(b in t)t.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(U(h[b],t[b])||l.push({command:y,args:[p,b,t[b],_]}))}function El(h){return h.id}function ud(h,t){return h[t.id]=t,h}class va{constructor(t,l){this.reset(t,l)}reset(t,l){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let l=1,p=this._distances[l];const _=t*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const y=l-1,b=this._distances[y],T=p-b,C=T>0?(_-b)/T:0;return this.points[y].mult(1-C).add(this.points[l].mult(C))}}class Ke{constructor(t,l,p){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(l/p);for(let b=0;b<this.xCellCount*this.yCellCount;b++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=l,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,l,p,_,y){this._forEachCell(l,p,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(t,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(t,l,p,_,y,b){this.boxCells[y].push(b)}_insertCircleCell(t,l,p,_,y,b){this.circleCells[y].push(b)}_query(t,l,p,_,y,b){if(p<0||t>this.width||_<0||l>this.height)return!y&&[];const T=[];if(t<=0&&l<=0&&this.width<=p&&this.height<=_){if(y)return!0;for(let C=0;C<this.boxKeys.length;C++)T.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const M=this.circles[3*C],z=this.circles[3*C+1],R=this.circles[3*C+2];T.push({key:this.circleKeys[C],x1:M-R,y1:z-R,x2:M+R,y2:z+R})}return b?T.filter(b):T}return this._forEachCell(t,l,p,_,this._queryCell,T,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?T.length>0:T}_queryCircle(t,l,p,_,y){const b=t-p,T=t+p,C=l-p,M=l+p;if(T<0||b>this.width||M<0||C>this.height)return!_&&[];const z=[];return this._forEachCell(b,C,T,M,this._queryCellCircle,z,{hitTest:_,circle:{x:t,y:l,radius:p},seenUids:{box:{},circle:{}}},y),_?z.length>0:z}query(t,l,p,_,y){return this._query(t,l,p,_,!1,y)}hitTest(t,l,p,_,y){return this._query(t,l,p,_,!0,y)}hitTestCircle(t,l,p,_){return this._queryCircle(t,l,p,!0,_)}_queryCell(t,l,p,_,y,b,T,C){const M=T.seenUids,z=this.boxCells[y];if(z!==null){const F=this.bboxes;for(const j of z)if(!M.box[j]){M.box[j]=!0;const G=4*j;if(t<=F[G+2]&&l<=F[G+3]&&p>=F[G+0]&&_>=F[G+1]&&(!C||C(this.boxKeys[j]))){if(T.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[j],x1:F[G],y1:F[G+1],x2:F[G+2],y2:F[G+3]})}}}const R=this.circleCells[y];if(R!==null){const F=this.circles;for(const j of R)if(!M.circle[j]){M.circle[j]=!0;const G=3*j;if(this._circleAndRectCollide(F[G],F[G+1],F[G+2],t,l,p,_)&&(!C||C(this.circleKeys[j]))){if(T.hitTest)return b.push(!0),!0;{const N=F[G],K=F[G+1],V=F[G+2];b.push({key:this.circleKeys[j],x1:N-V,y1:K-V,x2:N+V,y2:K+V})}}}}}_queryCellCircle(t,l,p,_,y,b,T,C){const M=T.circle,z=T.seenUids,R=this.boxCells[y];if(R!==null){const j=this.bboxes;for(const G of R)if(!z.box[G]){z.box[G]=!0;const N=4*G;if(this._circleAndRectCollide(M.x,M.y,M.radius,j[N+0],j[N+1],j[N+2],j[N+3])&&(!C||C(this.boxKeys[G])))return b.push(!0),!0}}const F=this.circleCells[y];if(F!==null){const j=this.circles;for(const G of F)if(!z.circle[G]){z.circle[G]=!0;const N=3*G;if(this._circlesCollide(j[N],j[N+1],j[N+2],M.x,M.y,M.radius)&&(!C||C(this.circleKeys[G])))return b.push(!0),!0}}}_forEachCell(t,l,p,_,y,b,T,C){const M=this._convertToXCellCoord(t),z=this._convertToYCellCoord(l),R=this._convertToXCellCoord(p),F=this._convertToYCellCoord(_);for(let j=M;j<=R;j++)for(let G=z;G<=F;G++)if(y.call(this,t,l,p,_,this.xCellCount*G+j,b,T,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,l,p,_,y,b){const T=_-t,C=y-l,M=p+b;return M*M>T*T+C*C}_circleAndRectCollide(t,l,p,_,y,b,T){const C=(b-_)/2,M=Math.abs(t-(_+C));if(M>C+p)return!1;const z=(T-y)/2,R=Math.abs(l-(y+z));if(R>z+p)return!1;if(M<=C||R<=z)return!0;const F=M-C,j=R-z;return F*F+j*j<=p*p}}const Lt=Math.tan(85*Math.PI/180);function At(h,t,l,p,_,y,b){const T=a.create();if(l)if(y.name==="globe"){const C=a.calculateGlobeLabelMatrix(_,t);a.multiply(T,T,C)}else{const C=nr([],b);T[0]=C[0],T[1]=C[1],T[4]=C[2],T[5]=C[3],p||a.rotateZ(T,T,_.angle)}else a.multiply(T,_.labelPlaneMatrix,h);return T}function sn(h,t,l,p,_,y,b){const T=At(h,t,l,p,_,y,b);return y.name==="globe"&&l||(T[2]=T[6]=T[10]=T[14]=0),T}function Po(h,t,l,p,_,y,b){if(l){if(y.name==="globe"){const T=At(h,t,l,p,_,y,b);return a.invert(T,T),a.multiply(T,h,T),T}{const T=a.clone(h),C=a.identity([]);return C[0]=b[0],C[1]=b[1],C[4]=b[2],C[5]=b[3],a.multiply(T,T,C),p||a.rotateZ(T,T,-_.angle),T}}return _.glCoordMatrix}function Et(h,t,l=0){const p=[h.x,h.y,l,1];l?a.transformMat4$1(p,p,t):xr(p,p,t);const _=p[3];return{point:[p[0]/_,p[1]/_,p[2]/_],signedDistanceFromCamera:_}}function Vn(h,t){const l=[h[0],h[1],h[2],1];a.transformMat4$1(l,l,t);const p=l[3];return{point:[l[0]/p,l[1]/p,l[2]/p],signedDistanceFromCamera:p}}function ds(h,t){return Math.min(.5+h/t*.5,1.5)}function wa(h,t){const l=h[0]/h[3],p=h[1]/h[3];return l>=-t[0]&&l<=t[0]&&p>=-t[1]&&p<=t[1]}function ji(h,t,l,p,_,y,b,T,C,M){const z=l.transform,R=p?h.textSizeData:h.iconSizeData,F=a.evaluateSizeForZoom(R,l.transform.zoom),j=z.projection.name==="globe",G=[256/l.width*2+1,256/l.height*2+1],N=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;N.clear();let K=null;j&&(K=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const V=h.lineVertexArray,Z=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,q=l.transform.width/l.transform.height;let te=!1;for(let Y=0;Y<Z.length;Y++){const J=Z.get(Y);if(J.writingMode!==a.WritingMode.vertical||te||Y!==0&&Z.get(Y-1).writingMode===a.WritingMode.horizontal||(te=!0),(J.hidden||J.writingMode===a.WritingMode.vertical)&&!te){Br(J.numGlyphs,N);continue}te=!1;const se=new a.pointGeometry(J.tileAnchorX,J.tileAnchorY),be=C?C(se):[0,0,0],Se=z.projection.projectTilePoint(se.x,se.y,M.canonical),Te=[Se.x+be[0],Se.y+be[1],Se.z+be[2]],ve=[...Te,1];if(a.transformMat4$1(ve,ve,t),!wa(ve,G)){Br(J.numGlyphs,N);continue}const ee=ds(l.transform.cameraToCenterDistance,ve[3]),De=a.evaluateSizeForFeature(R,F,J),Pe=b?De/ee:De*ee,We=Et(new a.pointGeometry(Te[0],Te[1]),_,Te[2]);if(We.signedDistanceFromCamera<=0){Br(J.numGlyphs,N);continue}let Ie={};const at=b?null:C,qe=ps(J,Pe,!1,T,t,_,y,h.glyphOffsetArray,V,N,K,We.point,se,Ie,q,at,z.projection,M,b);te=qe.useVertical,at&&qe.needsFlipping&&(Ie={}),(qe.notEnoughRoom||te||qe.needsFlipping&&ps(J,Pe,!0,T,t,_,y,h.glyphOffsetArray,V,N,K,We.point,se,Ie,q,at,z.projection,M,b).notEnoughRoom)&&Br(J.numGlyphs,N)}p?(h.text.dynamicLayoutVertexBuffer.updateData(N),K&&h.text.globeExtVertexBuffer.updateData(K)):(h.icon.dynamicLayoutVertexBuffer.updateData(N),K&&h.icon.globeExtVertexBuffer.updateData(K))}function pr(h,t,l,p,_,y,b,T,C,M,z,R,F,j,G,N){const K=T.glyphStartIndex+T.numGlyphs,V=T.lineStartIndex,Z=T.lineStartIndex+T.lineLength,q=t.getoffsetX(T.glyphStartIndex),te=t.getoffsetX(K-1),Y=ms(h*q,l,p,_,y,b,T.segment,V,Z,C,M,z,R,F,!0,j,G,N);if(!Y)return null;const J=ms(h*te,l,p,_,y,b,T.segment,V,Z,C,M,z,R,F,!0,j,G,N);return J?{first:Y,last:J}:null}function hd(h,t,l,p){return h.writingMode===a.WritingMode.horizontal&&Math.abs(l.y-t.y)>Math.abs(l.x-t.x)*p?{useVertical:!0}:h.writingMode===a.WritingMode.vertical?t.y<l.y?{needsFlipping:!0}:null:h.flipState!==0&&function(_,y,b){const T=(y.x-_.x)*b;return T===0||Math.abs((y.y-_.y)/T)>Lt}(t,l,p)?h.flipState===1?{needsFlipping:!0}:null:t.x>l.x?{needsFlipping:!0}:null}function ps(h,t,l,p,_,y,b,T,C,M,z,R,F,j,G,N,K,V,Z){const q=t/24,te=h.lineOffsetX*q,Y=h.lineOffsetY*q;let J;if(h.numGlyphs>1){const se=h.glyphStartIndex+h.numGlyphs,be=h.lineStartIndex,Se=h.lineStartIndex+h.lineLength,Te=pr(q,T,te,Y,l,R,F,h,C,y,j,N,!1,K,V,Z);if(!Te)return{notEnoughRoom:!0};const ve=Vn(Te.first.point,b).point,ee=Vn(Te.last.point,b).point,De=new a.pointGeometry(ve[0],ve[1]),Pe=new a.pointGeometry(ee[0],ee[1]);if(p&&!l){const We=hd(h,De,Pe,G);if(h.flipState=We&&We.needsFlipping?1:2,We)return We}J=[Te.first];for(let We=h.glyphStartIndex+1;We<se-1;We++)J.push(ms(q*T.getoffsetX(We),te,Y,l,R,F,h.segment,be,Se,C,y,j,N,!1,!1,K,V,Z));J.push(Te.last)}else{if(p&&!l){const be=Et(F,_).point,Se=h.lineStartIndex+h.segment+1,Te=new a.pointGeometry(C.getx(Se),C.gety(Se)),ve=Et(Te,_),ee=ve.signedDistanceFromCamera>0?ve.point:fs(F,Te,be,1,_,void 0,K,V.canonical),De=hd(h,new a.pointGeometry(be[0],be[1]),new a.pointGeometry(ee[0],ee[1]),G);if(h.flipState=De&&De.needsFlipping?1:2,De)return De}const se=ms(q*T.getoffsetX(h.glyphStartIndex),te,Y,l,R,F,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,C,y,j,N,!1,!1,K,V,Z);if(!se)return{notEnoughRoom:!0};J=[se]}if(z)for(const se of J)a.updateGlobeVertexNormal(z,M.length+0,se.up[0],se.up[1],se.up[2]),a.updateGlobeVertexNormal(z,M.length+1,se.up[0],se.up[1],se.up[2]),a.updateGlobeVertexNormal(z,M.length+2,se.up[0],se.up[1],se.up[2]),a.updateGlobeVertexNormal(z,M.length+3,se.up[0],se.up[1],se.up[2]),a.addDynamicAttributes(M,se.point[0],se.point[1],se.point[2],se.angle);else for(const se of J)a.addDynamicAttributes(M,se.point[0],se.point[1],se.point[2],se.angle);return{}}function Sl(h,t,l,p,_){const y=p.projectTilePoint(h.x,h.y,t);if(!_)return Et(y,l,y.z);const b=_(h);return Et(new a.pointGeometry(y.x+b[0],y.y+b[1]),l,y.z+b[2])}function fs(h,t,l,p,_,y,b,T){const C=Sl(h.add(h.sub(t)._unit()),T,_,b,y).point,M=a.sub([],l,C);return a.scaleAndAdd([],l,M,p/a.length(M))}function ms(h,t,l,p,_,y,b,T,C,M,z,R,F,j,G,N,K,V){const Z=p?h-t:h+t;let q=Z>0?1:-1,te=0;p&&(q*=-1,te=Math.PI),q<0&&(te+=Math.PI);let Y=q>0?T+b:T+b+1,J=_,se=_,be=0,Se=0;const Te=Math.abs(Z),ve=[],ee=[];let De=y;const Pe=()=>{const ot=Y-q;return be===0?y:new a.pointGeometry(M.getx(ot),M.gety(ot))},We=()=>fs(Pe(),De,se,Te-be+1,z,F,N,K.canonical);for(;be+Se<=Te;){if(Y+=q,Y<T||Y>=C)return null;if(se=J,ve.push(J),j&&ee.push(De||Pe()),J=R[Y],J===void 0){De=new a.pointGeometry(M.getx(Y),M.gety(Y));const ot=Sl(De,K.canonical,z,N,F);J=ot.signedDistanceFromCamera>0?R[Y]=ot.point:We()}else De=null;be+=Se,Se=a.distance(se,J)}De=De||new a.pointGeometry(M.getx(Y),M.gety(Y));const Ie=Pe();G&&F&&(R[Y]=J=R[Y]===void 0?J:We(),Se=a.distance(se,J));const at=(Te-be)/Se,qe=De.sub(Ie).mult(at)._add(Ie),Ze=a.sub([],J,se),Ve=a.scaleAndAdd([],se,Ze,at);let $e=[0,0,1],yt=Ze[0],ut=Ze[1];if(V&&($e=N.upVector(K.canonical,qe.x,qe.y),$e[0]!==0||$e[1]!==0||$e[2]!==1)){const ot=[1,0,0],bt=[0,1,0];ot[0]=$e[2],ot[1]=0,ot[2]=-$e[0],a.cross(bt,$e,ot),a.normalize(ot,ot),a.normalize(bt,bt),yt=a.dot(Ze,ot),ut=a.dot(Ze,bt)}if(l){const ot=a.cross([],$e,Ze);a.normalize(ot,ot),a.scaleAndAdd(Ve,Ve,ot,l*q)}const St=te+Math.atan2(ut,yt);return ve.push(Ve),j&&ee.push(qe),{point:Ve,angle:St,path:ve,tilePath:ee,up:$e}}const dd=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Br(h,t){for(let l=0;l<h;l++){const p=t.length;t.resize(p+4),t.float32.set(dd,4*p)}}function xr(h,t,l){const p=t[0],_=t[1];return h[0]=l[0]*p+l[4]*_+l[12],h[1]=l[1]*p+l[5]*_+l[13],h[3]=l[3]*p+l[7]*_+l[15],h}const Gi=100;class nu{constructor(t,l,p=new Ke(t.width+200,t.height+200,25),_=new Ke(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Gi,this.screenBottomBoundary=t.height+Gi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=l}placeCollisionBox(t,l,p,_,y,b,T,C){let M=p.projectedAnchorX,z=p.projectedAnchorY,R=p.projectedAnchorZ;const F=p.elevation,j=p.tileID;if(F&&j){const Y=t.getProjection().upVector(j.canonical,p.tileAnchorX,p.tileAnchorY),J=t.getProjection().upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;M+=Y[0]*F*J,z+=Y[1]*F*J,R+=Y[2]*F*J}const G=this.projectAndGetPerspectiveRatio(T,[M,z,R],p.tileID,t.projection.name==="globe"||!!F||this.transform.pitch>0,t.getProjection()),N=b*G.perspectiveRatio,K=(p.x1*l+_.x-p.padding)*N+G.point.x,V=(p.y1*l+_.y-p.padding)*N+G.point.y,Z=(p.x2*l+_.x+p.padding)*N+G.point.x,q=(p.y2*l+_.y+p.padding)*N+G.point.y,te=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(K,V,Z,q)||!y&&this.grid.hitTest(K,V,Z,q,C)||te?{box:[],offscreen:!1,occluded:G.occluded}:{box:[K,V,Z,q],offscreen:this.isOffscreen(K,V,Z,q),occluded:!1}}placeCollisionCircles(t,l,p,_,y,b,T,C,M,z,R,F,j,G,N){const K=[],V=this.transform.elevation,Z=V?V.getAtTileOffsetFunc(N,this.transform.center.lat,this.transform.worldSize,t.getProjection()):Ie=>[0,0,0],q=new a.pointGeometry(p.tileAnchorX,p.tileAnchorY),te=t.getProjection().projectTilePoint(p.tileAnchorX,p.tileAnchorY,N.canonical),Y=Z(q),J=[te.x+Y[0],te.y+Y[1],te.z+Y[2]],se=t.projection.name==="globe",be=this.projectAndGetPerspectiveRatio(T,[J[0],J[1],J[2]],N,se||!!V||this.transform.pitch>0,t.getProjection()),{perspectiveRatio:Se}=be,Te=(R?b/Se:b*Se)/a.ONE_EM,ve=Et(new a.pointGeometry(J[0],J[1]),C,J[2]).point,ee=be.signedDistanceFromCamera>0?pr(Te,y,p.lineOffsetX*Te,p.lineOffsetY*Te,!1,ve,q,p,_,C,{},V&&!R?Z:null,R&&!!V,t.getProjection(),N,R):null;let De=!1,Pe=!1,We=!0;if(ee&&!be.occluded){const Ie=.5*j*Se+G,at=new a.pointGeometry(-100,-100),qe=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ze=new va,Ve=ee.first,$e=ee.last;let yt=[];for(let ot=Ve.path.length-1;ot>=1;ot--)yt.push(Ve.path[ot]);for(let ot=1;ot<$e.path.length;ot++)yt.push($e.path[ot]);const ut=2.5*Ie;if(M){const ot=yt.map(V&&!se?(bt,$t)=>{const Ht=Z($t<Ve.path.length-1?Ve.tilePath[Ve.path.length-1-$t]:$e.tilePath[$t-Ve.path.length+2]);return bt[2]=Ht[2],Vn(bt,M)}:bt=>Vn(bt,M));yt=ot.some(bt=>bt.signedDistanceFromCamera<=0)?[]:ot.map(bt=>bt.point)}let St=[];if(yt.length>0){const ot=yt.map(er=>new a.pointGeometry(er[0],er[1]));let bt=1/0,$t=-1/0,Ht=1/0,Er=-1/0;for(let er=0;er<ot.length;er++)bt=Math.min(bt,ot[er].x),Ht=Math.min(Ht,ot[er].y),$t=Math.max($t,ot[er].x),Er=Math.max(Er,ot[er].y);St=bt>=at.x&&$t<=qe.x&&Ht>=at.y&&Er<=qe.y?[ot]:$t<at.x||bt>qe.x||Er<at.y||Ht>qe.y?[]:a.clipLine([ot],at.x,at.y,qe.x,qe.y)}for(const ot of St){Ze.reset(ot,.25*Ie);let bt=0;bt=Ze.length<=.5*Ie?1:Math.ceil(Ze.paddedLength/ut)+1;for(let $t=0;$t<bt;$t++){const Ht=$t/Math.max(bt-1,1),Er=Ze.lerp(Ht),er=Er.x+Gi,zi=Er.y+Gi;K.push(er,zi,Ie,0);const Tn=er-Ie,Zn=zi-Ie,ar=er+Ie,ur=zi+Ie;if(We=We&&this.isOffscreen(Tn,Zn,ar,ur),Pe=Pe||this.isInsideGrid(Tn,Zn,ar,ur),!l&&this.grid.hitTestCircle(er,zi,Ie,F)&&(De=!0,!z))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!z&&De||!Pe?[]:K,offscreen:We,collisionDetected:De,occluded:be.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,_=1/0,y=-1/0,b=-1/0;for(const z of t){const R=new a.pointGeometry(z.x+Gi,z.y+Gi);p=Math.min(p,R.x),_=Math.min(_,R.y),y=Math.max(y,R.x),b=Math.max(b,R.y),l.push(R)}const T=this.grid.query(p,_,y,b).concat(this.ignoredGrid.query(p,_,y,b)),C={},M={};for(const z of T){const R=z.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const F=[new a.pointGeometry(z.x1,z.y1),new a.pointGeometry(z.x2,z.y1),new a.pointGeometry(z.x2,z.y2),new a.pointGeometry(z.x1,z.y2)];a.polygonIntersectsPolygon(l,F)&&(C[R.bucketInstanceId][R.featureIndex]=!0,M[R.bucketInstanceId]===void 0&&(M[R.bucketInstanceId]=[]),M[R.bucketInstanceId].push(R.featureIndex))}return M}insertCollisionBox(t,l,p,_,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,l,p,_,y){const b=l?this.ignoredGrid:this.grid,T={bucketInstanceId:p,featureIndex:_,collisionGroupID:y};for(let C=0;C<t.length;C+=4)b.insertCircle(T,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,l,p,_,y){const b=[l[0],l[1],l[2],1];let T=!1;if(l[2]||this.transform.pitch>0){a.transformMat4$1(b,b,t);const C=y.name==="globe";this.fogState&&p&&!C&&(T=function(M,z,R,F,j,G){const N=G.calculateFogTileMatrix(j),K=[z,R,F];return a.transformMat4(K,K,N),it(M,K,G.pitch,G._fov)}(this.fogState,l[0],l[1],l[2],p.toUnwrapped(),this.transform)>.9)}else xr(b,b,t);return{point:new a.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+Gi,(-b[1]/b[3]+1)/2*this.transform.height+Gi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(y)/b[3]*.5,1.5),signedDistanceFromCamera:b[3],occluded:_&&b[2]>b[3]||T}}isOffscreen(t,l,p,_){return p<Gi||t>=this.screenRightBoundary||_<Gi||l>this.screenBottomBoundary}isInsideGrid(t,l,p,_){return p>=0&&t<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}function ti(h,t,l){const p=t.createTileMatrix(h,h.worldSize,l.toUnwrapped());return a.multiply(new Float32Array(16),h.projMatrix,p)}function $i(h,t,l){if(t.projection.name===l.projection.name)return h.projMatrix;const p=l.clone();return p.setProjection(t.projection),ti(p,t.getProjection(),h)}function Cl(h,t,l){return t.name===l.projection.name?h.projMatrix:ti(l,t,h)}class ba{constructor(t,l,p,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class _r{constructor(t,l,p,_,y,b=!1){this.text=new ba(t?t.text:null,l,p,y),this.icon=new ba(t?t.icon:null,l,_,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Do{constructor(t,l,p,_=!1){this.text=t,this.icon=l,this.skipFade=p,this.clipped=_}}class ou{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Ta{constructor(t,l,p,_,y){this.bucketInstanceId=t,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=y}}class Xr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const l=++this.maxGroupID;this.collisionGroups[t]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[t]}}function Il(h,t,l,p,_){const{horizontalAlign:y,verticalAlign:b}=a.getAnchorAlignment(h),T=-(y-.5)*t,C=-(b-.5)*l,M=a.evaluateVariableOffset(h,p);return new a.pointGeometry(T+M[0]*_,C+M[1]*_)}function Ea(h,t,l,p,_){const y=new a.pointGeometry(h,t);return l&&y._rotate(p?_:-_),y}class jn{constructor(t,l,p,_,y){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new nu(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Xr(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,l,p,_){const y=p.getBucket(l),b=p.latestFeatureIndex;if(!y||!b||l.id!==y.layerIds[0])return;const T=y.layers[0].layout,C=p.collisionBoxArray,M=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),z=p.tileSize/a.EXTENT,R=p.tileID.toUnwrapped();this.transform.setProjection(y.projection);const F=(j=p.tileID,G=y.getProjection(),N=this.transform,G.name===this.projection?N.calculateProjMatrix(j.toUnwrapped()):ti(N,G,j));var j,G,N;const K=T.get("text-pitch-alignment")==="map",V=T.get("text-rotation-alignment")==="map";l.compileFilter();const Z=l.dynamicFilter(),q=l.dynamicFilterNeedsFeature(),te=this.transform.calculatePixelsToTileUnitsMatrix(p),Y=sn(F,p.tileID.canonical,K,V,this.transform,y.getProjection(),te);let J=null;if(K){const Se=Po(F,p.tileID.canonical,K,V,this.transform,y.getProjection(),te);J=a.multiply([],this.transform.labelPlaneMatrix,Se)}let se=null;Z&&p.latestFeatureIndex&&(se={unwrappedTileID:R,dynamicFilter:Z,dynamicFilterNeedsFeature:q,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Ta(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,p.tileID);const be={bucket:y,layout:T,posMatrix:F,textLabelPlaneMatrix:Y,labelToScreenMatrix:J,clippingData:se,scale:M,textPixelRatio:z,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(_)for(const Se of y.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:ve,symbolInstanceEnd:ee}=Se;t.push({sortKey:Te,symbolInstanceStart:ve,symbolInstanceEnd:ee,parameters:be})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:be})}attemptAnchorPlacement(t,l,p,_,y,b,T,C,M,z,R,F,j,G,N,K,V,Z){const q=[F.textOffset0,F.textOffset1],te=Il(t,p,_,q,y),Y=this.collisionIndex.placeCollisionBox(G,y,l,Ea(te.x,te.y,b,T,this.transform.angle),R,C,M,z.predicate);if((!K||this.collisionIndex.placeCollisionBox(G,G.getSymbolInstanceIconSize(Z,this.transform.zoom,j),K,Ea(te.x,te.y,b,T,this.transform.angle),R,C,M,z.predicate).box.length!==0)&&Y.box.length>0){let J;return this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(J=this.prevPlacement.variableOffsets[F.crossTileID].anchor),this.variableOffsets[F.crossTileID]={textOffset:q,width:p,height:_,anchor:t,textScale:y,prevAnchor:J},this.markUsedJustification(G,t,F,N),G.allowVerticalPlacement&&(this.markUsedOrientation(G,N,F),this.placedOrientations[F.crossTileID]=N),{shift:te,placedGlyphBoxes:Y}}}placeLayerBucketPart(t,l,p,_){const{bucket:y,layout:b,posMatrix:T,textLabelPlaneMatrix:C,labelToScreenMatrix:M,clippingData:z,textPixelRatio:R,holdingForFade:F,collisionBoxArray:j,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:N,collisionGroup:K}=t.parameters,V=b.get("text-optional"),Z=b.get("icon-optional"),q=b.get("text-allow-overlap"),te=b.get("icon-allow-overlap"),Y=b.get("text-rotation-alignment")==="map",J=b.get("text-pitch-alignment")==="map",se=b.get("icon-text-fit")!=="none",be=b.get("symbol-z-order")==="viewport-y";this.transform.setProjection(y.projection);let Se=q&&(te||!y.hasIconData()||Z),Te=te&&(q||!y.hasTextData()||V);!y.collisionArrays&&j&&y.deserializeCollisionBoxes(j),p&&_&&y.updateCollisionDebugBuffers(this.transform.zoom,j);const ve=(ee,De,Pe)=>{if(z){const ar={zoom:this.transform.zoom,pitch:this.transform.pitch};let ur=null;if(z.dynamicFilterNeedsFeature){const Zt=this.retainedQueryData[y.bucketInstanceId];ur=z.featureIndex.loadFeature({featureIndex:ee.featureIndex,bucketIndex:Zt.bucketIndex,sourceLayerIndex:Zt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(ar,ur,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new a.pointGeometry(ee.tileAnchorX,ee.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[ee.crossTileID]=new Do(!1,!1,!1,!0),void(l[ee.crossTileID]=!0)}if(l[ee.crossTileID])return;if(F)return void(this.placements[ee.crossTileID]=new Do(!1,!1,!1));let We=!1,Ie=!1,at=!0,qe=!1,Ze=!1,Ve=null,$e={box:null,offscreen:null,occluded:null},yt={box:null,offscreen:null,occluded:null},ut=null,St=null,ot=null,bt=0,$t=0,Ht=0;Pe.textFeatureIndex?bt=Pe.textFeatureIndex:ee.useRuntimeCollisionCircles&&(bt=ee.featureIndex),Pe.verticalTextFeatureIndex&&($t=Pe.verticalTextFeatureIndex);const Er=ar=>{ar.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||ar.elevation)&&(ar.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,ar.tileAnchorX,ar.tileAnchorY):0)},er=Pe.textBox;if(er){Er(er);const ar=Zt=>{let kr=a.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Zt&&this.prevPlacement){const Hr=this.prevPlacement.placedOrientations[ee.crossTileID];Hr&&(this.placedOrientations[ee.crossTileID]=Hr,kr=Hr,this.markUsedOrientation(y,kr,ee))}return kr},ur=(Zt,kr)=>{if(y.allowVerticalPlacement&&ee.numVerticalGlyphVertices>0&&Pe.verticalTextBox){for(const Hr of y.writingModes)if(Hr===a.WritingMode.vertical?($e=kr(),yt=$e):$e=Zt(),$e&&$e.box&&$e.box.length)break}else $e=Zt()};if(b.get("text-variable-anchor")){let Zt=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]){const Ot=this.prevPlacement.variableOffsets[ee.crossTileID];Zt.indexOf(Ot.anchor)>0&&(Zt=Zt.filter(_i=>_i!==Ot.anchor),Zt.unshift(Ot.anchor))}const kr=(Ot,_i,jo)=>{const cn=y.getSymbolInstanceTextSize(G,ee,this.transform.zoom,De),Ms=(Ot.x2-Ot.x1)*cn+2*Ot.padding,ks=(Ot.y2-Ot.y1)*cn+2*Ot.padding,lo=se&&!te?_i:null;lo&&Er(lo);let zr={box:[],offscreen:!1,occluded:!1};const En=q?2*Zt.length:Zt.length;for(let qn=0;qn<En;++qn){const $a=this.attemptAnchorPlacement(Zt[qn%Zt.length],Ot,Ms,ks,cn,Y,J,R,T,K,qn>=Zt.length,ee,De,y,jo,lo,G,N);if($a&&(zr=$a.placedGlyphBoxes,zr&&zr.box&&zr.box.length)){We=!0,Ve=$a.shift;break}}return zr};ur(()=>kr(er,Pe.iconBox,a.WritingMode.horizontal),()=>{const Ot=Pe.verticalTextBox;return Ot&&Er(Ot),y.allowVerticalPlacement&&!($e&&$e.box&&$e.box.length)&&ee.numVerticalGlyphVertices>0&&Ot?kr(Ot,Pe.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),$e&&(We=$e.box,at=$e.offscreen,qe=$e.occluded);const Hr=ar($e&&$e.box);if(!We&&this.prevPlacement){const Ot=this.prevPlacement.variableOffsets[ee.crossTileID];Ot&&(this.variableOffsets[ee.crossTileID]=Ot,this.markUsedJustification(y,Ot.anchor,ee,Hr))}}else{const Zt=(kr,Hr)=>{const Ot=y.getSymbolInstanceTextSize(G,ee,this.transform.zoom,De),_i=this.collisionIndex.placeCollisionBox(y,Ot,kr,new a.pointGeometry(0,0),q,R,T,K.predicate);return _i&&_i.box&&_i.box.length&&(this.markUsedOrientation(y,Hr,ee),this.placedOrientations[ee.crossTileID]=Hr),_i};ur(()=>Zt(er,a.WritingMode.horizontal),()=>{const kr=Pe.verticalTextBox;return y.allowVerticalPlacement&&ee.numVerticalGlyphVertices>0&&kr?(Er(kr),Zt(kr,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ar($e&&$e.box&&$e.box.length)}}if(ut=$e,We=ut&&ut.box&&ut.box.length>0,at=ut&&ut.offscreen,qe=ut&&ut.occluded,ee.useRuntimeCollisionCircles){const ar=y.text.placedSymbolArray.get(ee.centerJustifiedTextSymbolIndex>=0?ee.centerJustifiedTextSymbolIndex:ee.verticalPlacedTextSymbolIndex),ur=a.evaluateSizeForFeature(y.textSizeData,G,ar),Zt=b.get("text-padding");St=this.collisionIndex.placeCollisionCircles(y,q,ar,y.lineVertexArray,y.glyphOffsetArray,ur,T,C,M,p,J,K.predicate,ee.collisionCircleDiameter*ur/a.ONE_EM,Zt,this.retainedQueryData[y.bucketInstanceId].tileID),We=q||St.circles.length>0&&!St.collisionDetected,at=at&&St.offscreen,qe=St.occluded}if(Pe.iconFeatureIndex&&(Ht=Pe.iconFeatureIndex),Pe.iconBox){const ar=ur=>{Er(ur);const Zt=se&&Ve?Ea(Ve.x,Ve.y,Y,J,this.transform.angle):new a.pointGeometry(0,0),kr=y.getSymbolInstanceIconSize(N,this.transform.zoom,De);return this.collisionIndex.placeCollisionBox(y,kr,ur,Zt,te,R,T,K.predicate)};yt&&yt.box&&yt.box.length&&Pe.verticalIconBox?(ot=ar(Pe.verticalIconBox),Ie=ot.box.length>0):(ot=ar(Pe.iconBox),Ie=ot.box.length>0),at=at&&ot.offscreen,Ze=ot.occluded}const zi=V||ee.numHorizontalGlyphVertices===0&&ee.numVerticalGlyphVertices===0,Tn=Z||ee.numIconVertices===0;if(zi||Tn?Tn?zi||(Ie=Ie&&We):We=Ie&&We:Ie=We=Ie&&We,We&&ut&&ut.box&&this.collisionIndex.insertCollisionBox(ut.box,b.get("text-ignore-placement"),y.bucketInstanceId,yt&&yt.box&&$t?$t:bt,K.ID),Ie&&ot&&this.collisionIndex.insertCollisionBox(ot.box,b.get("icon-ignore-placement"),y.bucketInstanceId,Ht,K.ID),St&&(We&&this.collisionIndex.insertCollisionCircles(St.circles,b.get("text-ignore-placement"),y.bucketInstanceId,bt,K.ID),p)){const ar=y.bucketInstanceId;let ur=this.collisionCircleArrays[ar];ur===void 0&&(ur=this.collisionCircleArrays[ar]=new ou);for(let Zt=0;Zt<St.circles.length;Zt+=4)ur.circles.push(St.circles[Zt+0]),ur.circles.push(St.circles[Zt+1]),ur.circles.push(St.circles[Zt+2]),ur.circles.push(St.collisionDetected?1:0)}const Zn=y.projection.name!=="globe";Se=Se&&(Zn||!qe),Te=Te&&(Zn||!Ze),this.placements[ee.crossTileID]=new Do(We||Se,Ie||Te,at||y.justReloaded),l[ee.crossTileID]=!0};if(be){const ee=y.getSortedSymbolIndexes(this.transform.angle);for(let De=ee.length-1;De>=0;--De){const Pe=ee[De];ve(y.symbolInstances.get(Pe),Pe,y.collisionArrays[Pe])}}else for(let ee=t.symbolInstanceStart;ee<t.symbolInstanceEnd;ee++)ve(y.symbolInstances.get(ee),ee,y.collisionArrays[ee]);if(p&&y.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[y.bucketInstanceId];a.invert(ee.invProjMatrix,T),ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(t,l,p,_){let y;y=_===a.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(l)];const b=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const T of b)T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=y>=0&&T!==y?0:p.crossTileID)}markUsedOrientation(t,l,p){const _=l===a.WritingMode.horizontal||l===a.WritingMode.horizontalOnly?l:0,y=l===a.WritingMode.vertical?l:0,b=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const T of b)t.text.placedSymbolArray.get(T).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(t):1,y=l?l.opacities:{},b=l?l.variableOffsets:{},T=l?l.placedOrientations:{};for(const C in this.placements){const M=this.placements[C],z=y[C];z?(this.opacities[C]=new _r(z,_,M.text,M.icon,null,M.clipped),p=p||M.text!==z.text.placed||M.icon!==z.icon.placed):(this.opacities[C]=new _r(null,_,M.text,M.icon,M.skipFade,M.clipped),p=p||M.text||M.icon)}for(const C in y){const M=y[C];if(!this.opacities[C]){const z=new _r(M,_,!1,!1);z.isHidden()||(this.opacities[C]=z,p=p||M.text.placed||M.icon.placed)}}for(const C in b)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=b[C]);for(const C in T)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=T[C]);p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:t)}updateLayerOpacities(t,l){const p={};for(const _ of l){const y=_.getBucket(t);y&&_.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,p,_.collisionBoxArray)}}updateBucketOpacities(t,l,p){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0].layout,y=!!t.layers[0].dynamicFilter(),b=new _r(null,0,!1,!1,!0),T=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),M=_.get("text-variable-anchor"),z=_.get("text-rotation-alignment")==="map",R=_.get("text-pitch-alignment")==="map",F=_.get("icon-text-fit")!=="none",j=new _r(null,0,T&&(C||!t.hasIconData()||_.get("icon-optional")),C&&(T||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const G=(K,V,Z)=>{for(let q=0;q<V/4;q++)K.opacityVertexArray.emplaceBack(Z)};let N=0;for(let K=0;K<t.symbolInstances.length;K++){const V=t.symbolInstances.get(K),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:q,crossTileID:te}=V;let Y=this.opacities[te];l[te]?Y=b:Y||(Y=j,this.opacities[te]=Y),l[te]=!0;const J=Z>0||q>0,se=V.numIconVertices>0,be=this.placedOrientations[V.crossTileID],Se=be===a.WritingMode.vertical,Te=be===a.WritingMode.horizontal||be===a.WritingMode.horizontalOnly;if(!J&&!se||Y.isHidden()||N++,J){const ve=Gn(Y.text);G(t.text,Z,Se?Lo:ve),G(t.text,q,Te?Lo:ve);const ee=Y.text.isHidden();[V.rightJustifiedTextSymbolIndex,V.centerJustifiedTextSymbolIndex,V.leftJustifiedTextSymbolIndex].forEach(We=>{We>=0&&(t.text.placedSymbolArray.get(We).hidden=ee||Se?1:0)}),V.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(V.verticalPlacedTextSymbolIndex).hidden=ee||Te?1:0);const De=this.variableOffsets[V.crossTileID];De&&this.markUsedJustification(t,De.anchor,V,be);const Pe=this.placedOrientations[V.crossTileID];Pe&&(this.markUsedJustification(t,"left",V,Pe),this.markUsedOrientation(t,Pe,V))}if(se){const ve=Gn(Y.icon);V.placedIconSymbolIndex>=0&&(G(t.icon,V.numIconVertices,Se?Lo:ve),t.icon.placedSymbolArray.get(V.placedIconSymbolIndex).hidden=Y.icon.isHidden()),V.verticalPlacedIconSymbolIndex>=0&&(G(t.icon,V.numVerticalIconVertices,Te?Lo:ve),t.icon.placedSymbolArray.get(V.verticalPlacedIconSymbolIndex).hidden=Y.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ve=t.collisionArrays[K];if(ve){let ee=new a.pointGeometry(0,0),De=!0;if(ve.textBox||ve.verticalTextBox){if(M){const We=this.variableOffsets[te];We?(ee=Il(We.anchor,We.width,We.height,We.textOffset,We.textScale),z&&ee._rotate(R?this.transform.angle:-this.transform.angle)):De=!1}y&&(De=!Y.clipped),ve.textBox&&so(t.textCollisionBox.collisionVertexArray,Y.text.placed,!De||Se,ee.x,ee.y),ve.verticalTextBox&&so(t.textCollisionBox.collisionVertexArray,Y.text.placed,!De||Te,ee.x,ee.y)}const Pe=De&&Boolean(!Te&&ve.verticalIconBox);ve.iconBox&&so(t.iconCollisionBox.collisionVertexArray,Y.icon.placed,Pe,F?ee.x:0,F?ee.y:0),ve.verticalIconBox&&so(t.iconCollisionBox.collisionVertexArray,Y.icon.placed,!Pe,F?ee.x:0,F?ee.y:0)}}}if(t.fullyClipped=N===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=K.invProjMatrix,t.placementViewportMatrix=K.viewportMatrix,t.collisionCircleArray=K.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function so(h,t,l,p,_){h.emplaceBack(t?1:0,l?1:0,p||0,_||0),h.emplaceBack(t?1:0,l?1:0,p||0,_||0),h.emplaceBack(t?1:0,l?1:0,p||0,_||0),h.emplaceBack(t?1:0,l?1:0,p||0,_||0)}const Al=Math.pow(2,25),wm=Math.pow(2,24),su=Math.pow(2,17),_s=Math.pow(2,16),bm=Math.pow(2,9),pd=Math.pow(2,8),gs=Math.pow(2,1);function Gn(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Al+t*wm+l*su+t*_s+l*bm+t*pd+l*gs+t}const Lo=0;class ao{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,l,p,_,y){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(l.getBucketParts(b,_,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((T,C)=>T.sortKey-C.sortKey));this._currentPartIndex<b.length;){const T=b[this._currentPartIndex];if(l.placeLayerBucketPart(T,this._seenCrossTileIDs,p,T.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class au{constructor(t,l,p,_,y,b,T,C){this.placement=new jn(t,y,b,T,C),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,l,p){const _=a.exported.now(),y=()=>{const b=a.exported.now()-_;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=l[t[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=T)&&(!b.maxzoom||b.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new ao(b)),this._inProgressLayer.continuePlacement(p[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ml=512/a.EXTENT/2;class Tm{constructor(t,l,p){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const y=l.get(_),b=y.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,t)})}}getScaledCoordinates(t,l){const p=Ml/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*a.EXTENT+t.tileAnchorX)*p),y:Math.floor((l.canonical.y*a.EXTENT+t.tileAnchorY)*p)}}findMatches(t,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let y=0;y<t.length;y++){const b=t.get(y);if(b.crossTileID)continue;const T=this.indexedSymbolInstances[b.key];if(!T)continue;const C=this.getScaledCoordinates(b,l);for(const M of T)if(Math.abs(M.coord.x-C.x)<=_&&Math.abs(M.coord.y-C.y)<=_&&!p[M.crossTileID]){p[M.crossTileID]=!0,b.crossTileID=M.crossTileID;break}}}}class Em{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class lu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const l=Math.round((t-this.lng)/360);if(l!==0)for(const p in this.indexes){const _=this.indexes[p],y={};for(const b in _){const T=_[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+l),y[T.tileID.key]=T}this.indexes[p]=y}this.lng=t}addBucket(t,l,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const _=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>t.overscaledZ)for(const T in b){const C=b[T];C.tileID.isChildOf(t)&&C.findMatches(l.symbolInstances,t,_)}else{const T=b[t.scaledTo(Number(y)).key];T&&T.findMatches(l.symbolInstances,t,_)}}for(let y=0;y<l.symbolInstances.length;y++){const b=l.symbolInstances.get(y);b.crossTileID||(b.crossTileID=p.generate(),_[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Tm(t,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(t,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[t][_.crossTileID]}removeStaleBuckets(t){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const y in _)t[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[y]),delete _[y],l=!0)}return l}}class fd{constructor(){this.layerIndexes={},this.crossTileIDs=new Em,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,l,p,_){let y=this.layerIndexes[t.id];y===void 0&&(y=this.layerIndexes[t.id]=new lu);let b=!1;const T={};_.name!=="globe"&&y.handleWrapJump(p);for(const C of l){const M=C.getBucket(t);M&&t.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(C.tileID,M,this.crossTileIDs)&&(b=!0),T[M.bucketInstanceId]=!0)}return y.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(t){const l={};t.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const Sa=(h,t)=>a.emitValidationErrors(h,t&&t.filter(l=>l.identifier!=="source.canvas")),Sm=a.pick(fe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),md=a.pick(fe,["setCenter","setZoom","setBearing","setPitch"]),Cm={version:8,layers:[],sources:{}},cu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class an extends a.Evented{constructor(t,l={}){super(),this.map=t,this.dispatcher=new Mr(jt(),this),this.imageManager=new ai,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(t._requestManager,l.localFontFamily?a.LocalGlyphMode.all:l.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new a.LineAtlas(256,512),this.crossTileSymbolIndex=new fd,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const p=this;this._rtlTextPluginCallback=an.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,b)=>{if(a.triggerPluginCompletionEvent(y),b&&b.every(T=>T))for(const T in p._sourceCaches){const C=p._sourceCaches[T],M=C.getSource().type;M!=="vector"&&M!=="geojson"||C.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getSource(_.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const T=this._layers[b];T.source===y.id&&this._validateLayer(T)}})}loadURL(t,l={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!a.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,l.accessToken);const _=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(_,(y,b)=>{this._request=null,y?this.fire(new a.ErrorEvent(y)):b&&this._load(b,p)})}loadJSON(t,l={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,l.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Cm,!1)}_updateLayerCount(t,l){const p=l?1:-1;t.is3D()&&(this._num3DLayers+=p),t.type==="circle"&&(this._numCircleLayers+=p),t.type==="symbol"&&(this._numSymbolLayers+=p)}_load(t,l){if(l&&Sa(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=a.clone$1(t),this._updateMapProjection();for(const _ in t.sources)this.addSource(_,t.sources[_],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const p=Xt(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=a.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Co(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(l,p,_){let y,b,T;const C=a.exported.devicePixelRatio>1?"@2x":"";let M=a.getJSON(p.transformRequest(p.normalizeSpriteURL(l,C,".json"),a.ResourceType.SpriteJSON),(F,j)=>{M=null,T||(T=F,y=j,R())}),z=a.getImage(p.transformRequest(p.normalizeSpriteURL(l,C,".png"),a.ResourceType.SpriteImage),(F,j)=>{z=null,T||(T=F,b=j,R())});function R(){if(T)_(T);else if(y&&b){const F=a.exported.getImageData(b),j={};for(const G in y){const{width:N,height:K,x:V,y:Z,sdf:q,pixelRatio:te,stretchX:Y,stretchY:J,content:se}=y[G],be=new a.RGBAImage({width:N,height:K});a.RGBAImage.copy(F,be,{x:V,y:Z},{x:0,y:0},{width:N,height:K}),j[G]={data:be,pixelRatio:te,sdf:q,stretchX:Y,stretchY:J,content:se}}_(null,j)}}return{cancel(){M&&(M.cancel(),M=null),z&&(z.cancel(),z=null)}}}(t,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new a.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const l=this.getSource(t.source);if(!l)return;const p=t.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const l=[];for(const p of t){const _=this._layers[p];_.type!=="custom"&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&cu[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(_.length||y.length)&&this._updateWorkerLayers(_,y);for(const b in this._updatedSources){const T=this._updatedSources[b];T==="reload"?this._reloadSource(b):T==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const y=this._sourceCaches[_];p[_]=y.used,y.used=!1}for(const _ of this._order){const y=this._layers[_];if(y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)){const T=this._getLayerSourceCache(y);T&&(T.used=!0)}const b=this.map.painter;if(b){const T=y.getProgramIds();if(!T)continue;const C=y.getProgramConfiguration(t.zoom);for(const M of T)b.useProgram(M,C)}}for(const _ in p){const y=this._sourceCaches[_];p[_]!==y.used&&y.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Sa(this,a.validateStyle(t)))return!1;(t=a.clone$1(t)).layers=Xt(t.layers);const l=function(_,y){if(!_)return[{command:fe.setStyle,args:[y]}];let b=[];try{if(!U(_.version,y.version))return[{command:fe.setStyle,args:[y]}];U(_.center,y.center)||b.push({command:fe.setCenter,args:[y.center]}),U(_.zoom,y.zoom)||b.push({command:fe.setZoom,args:[y.zoom]}),U(_.bearing,y.bearing)||b.push({command:fe.setBearing,args:[y.bearing]}),U(_.pitch,y.pitch)||b.push({command:fe.setPitch,args:[y.pitch]}),U(_.sprite,y.sprite)||b.push({command:fe.setSprite,args:[y.sprite]}),U(_.glyphs,y.glyphs)||b.push({command:fe.setGlyphs,args:[y.glyphs]}),U(_.transition,y.transition)||b.push({command:fe.setTransition,args:[y.transition]}),U(_.light,y.light)||b.push({command:fe.setLight,args:[y.light]}),U(_.fog,y.fog)||b.push({command:fe.setFog,args:[y.fog]}),U(_.projection,y.projection)||b.push({command:fe.setProjection,args:[y.projection]});const T={},C=[];(function(R,F,j,G){let N;for(N in F=F||{},R=R||{})R.hasOwnProperty(N)&&(F.hasOwnProperty(N)||dr(N,j,G));for(N in F)F.hasOwnProperty(N)&&(R.hasOwnProperty(N)?U(R[N],F[N])||(R[N].type==="geojson"&&F[N].type==="geojson"&&vm(R,F,N)?j.push({command:fe.setGeoJSONSourceData,args:[N,F[N].data]}):Vi(N,F,j,G)):Mi(N,F,j))})(_.sources,y.sources,C,T);const M=[];_.layers&&_.layers.forEach(R=>{R.source&&T[R.source]?b.push({command:fe.removeLayer,args:[R.id]}):M.push(R)});let z=_.terrain;z&&T[z.source]&&(b.push({command:fe.setTerrain,args:[void 0]}),z=void 0),b=b.concat(C),U(z,y.terrain)||b.push({command:fe.setTerrain,args:[y.terrain]}),function(R,F,j){F=F||[];const G=(R=R||[]).map(El),N=F.map(El),K=R.reduce(ud,{}),V=F.reduce(ud,{}),Z=G.slice(),q=Object.create(null);let te,Y,J,se,be,Se,Te;for(te=0,Y=0;te<G.length;te++)J=G[te],V.hasOwnProperty(J)?Y++:(j.push({command:fe.removeLayer,args:[J]}),Z.splice(Z.indexOf(J,Y),1));for(te=0,Y=0;te<N.length;te++)J=N[N.length-1-te],Z[Z.length-1-te]!==J&&(K.hasOwnProperty(J)?(j.push({command:fe.removeLayer,args:[J]}),Z.splice(Z.lastIndexOf(J,Z.length-Y),1)):Y++,Se=Z[Z.length-te],j.push({command:fe.addLayer,args:[V[J],Se]}),Z.splice(Z.length-te,0,J),q[J]=!0);for(te=0;te<N.length;te++)if(J=N[te],se=K[J],be=V[J],!q[J]&&!U(se,be))if(U(se.source,be.source)&&U(se["source-layer"],be["source-layer"])&&U(se.type,be.type)){for(Te in ki(se.layout,be.layout,j,J,null,fe.setLayoutProperty),ki(se.paint,be.paint,j,J,null,fe.setPaintProperty),U(se.filter,be.filter)||j.push({command:fe.setFilter,args:[J,be.filter]}),U(se.minzoom,be.minzoom)&&U(se.maxzoom,be.maxzoom)||j.push({command:fe.setLayerZoomRange,args:[J,be.minzoom,be.maxzoom]}),se)se.hasOwnProperty(Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?ki(se[Te],be[Te],j,J,Te.slice(6),fe.setPaintProperty):U(se[Te],be[Te])||j.push({command:fe.setLayerProperty,args:[J,Te,be[Te]]}));for(Te in be)be.hasOwnProperty(Te)&&!se.hasOwnProperty(Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?ki(se[Te],be[Te],j,J,Te.slice(6),fe.setPaintProperty):U(se[Te],be[Te])||j.push({command:fe.setLayerProperty,args:[J,Te,be[Te]]}))}else j.push({command:fe.removeLayer,args:[J]}),Se=Z[Z.lastIndexOf(J)+1],j.push({command:fe.addLayer,args:[be,Se]})}(M,y.layers,b)}catch(T){console.warn("Unable to compute style diff:",T),b=[{command:fe.setStyle,args:[y]}]}return b}(this.serialize(),t).filter(_=>!(_.command in md));if(l.length===0)return!1;const p=l.filter(_=>!(_.command in Sm));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,l){return this.getImage(t)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,l),this._afterImageUpdated(t),this)}updateImage(t,l){this.imageManager.updateImage(t,l)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,l,p={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(a.validateSource,`sources.${t}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=ye(t,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:_.serialize(),sourceId:t}));const y=b=>{const T=(b?"symbol:":"other:")+t,C=this._sourceCaches[T]=new a.SourceCache(T,_,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[t]=C,C.style=this,C.onAdd(this.map)};y(!1),l.type!=="vector"&&l.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const l=this.getSource(t);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(t);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,l){this._checkLoaded(),this.getSource(t).setData(l),this._changed=!0}getSource(t){const l=this._getSourceCache(t);return l&&l.getSource()}addLayer(t,l,p={}){this._checkLoaded();const _=t.id;if(this.getLayer(_))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(t.type==="custom"){if(Sa(this,a.validateCustomStyleLayer(t)))return;y=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(_,t.source),t=a.clone$1(t),t=a.extend(t,{source:_})),this._validate(a.validateLayer,`layers.${_}`,t,{arrayIndex:-1},p))return;y=a.createStyleLayer(t),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const b=l?this._order.indexOf(l):this._order.length;if(l&&b===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(b,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const T=this._getLayerSourceCache(y);if(this._removedLayers[_]&&y.source&&T&&y.type!=="custom"){const C=this._removedLayers[_];delete this._removedLayers[_],C.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",T.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,l){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===l)return;const p=this._order.indexOf(t);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&_===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const l=this._layers[t];if(!l)return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=l,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const l in this._layers)if(this._layers[l].type===t)return!0;return!1}setLayerZoomRange(t,l,p){this._checkLoaded();const _=this.getLayer(t);_?_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,l,p={}){this._checkLoaded();const _=this.getLayer(t);if(_){if(!U(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(a.validateFilter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=a.clone$1(l),this._updateLayer(_)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const l=this.getLayer(t);return l&&a.clone$1(l.filter)}setLayoutProperty(t,l,p,_={}){this._checkLoaded();const y=this.getLayer(t);y?U(y.getLayoutProperty(l),p)||(y.setLayoutProperty(l,p,_),this._updateLayer(y)):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,l){const p=this.getLayer(t);if(p)return p.getLayoutProperty(l);this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,l,p,_={}){this._checkLoaded();const y=this.getLayer(t);y?U(y.getPaintProperty(l),p)||(y.setPaintProperty(l,p,_)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,l){const p=this.getLayer(t);return p&&p.getPaintProperty(l)}setFeatureState(t,l){this._checkLoaded();const p=t.source,_=t.sourceLayer,y=this.getSource(p);if(!y)return void this.fire(new a.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const b=y.type;if(b==="geojson"&&_)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!_)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(p);for(const C of T)C.setFeatureState(_,t.id,l)}removeFeatureState(t,l){this._checkLoaded();const p=t.source,_=this.getSource(p);if(!_)return void this.fire(new a.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const y=_.type,b=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(p);for(const C of T)C.removeFeatureState(b,t.id,l)}getFeatureState(t){this._checkLoaded();const l=t.source,p=t.sourceLayer,_=this.getSource(l);if(_){if(_.type!=="vector"||p)return t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,t.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();t[p.id]||(t[p.id]=p.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const l=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",l.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const l=b=>this._layers[b].type==="fill-extrusion",p={},_=[];for(let b=this._order.length-1;b>=0;b--){const T=this._order[b];if(l(T)){p[T]=b;for(const C of t){const M=C[T];if(M)for(const z of M)_.push(z)}}}_.sort((b,T)=>T.intersectionZ-b.intersectionZ);const y=[];for(let b=this._order.length-1;b>=0;b--){const T=this._order[b];if(l(T))for(let C=_.length-1;C>=0;C--){const M=_[C].feature;if(p[M.layer.id]<b)break;y.push(M),_.pop()}else for(const C of t){const M=C[T];if(M)for(const z of M)y.push(z.feature)}}return y}queryRenderedFeatures(t,l,p){l&&l.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of l.layers){const M=this._layers[C];if(!M)return this.fire(new a.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];_[M.source]=!0}}const y=[];l.availableImages=this._availableImages;const b=l&&l.layers?l.layers.some(C=>{const M=this.getLayer(C);return M&&M.is3D()}):this.has3DLayers(),T=qr.createFromScreenPoints(t,p);for(const C in this._sourceCaches){const M=this._sourceCaches[C].getSource().id;l.layers&&!_[M]||y.push(Qe(this._sourceCaches[C],this._layers,this._serializedLayers,T,l,p,b,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(C,M,z,R,F,j,G){const N={},K=j.queryRenderedSymbols(R),V=[];for(const Z of Object.keys(K).map(Number))V.push(G[Z]);V.sort(dt);for(const Z of V){const q=Z.featureIndex.lookupSymbolFeatures(K[Z.bucketInstanceId],M,Z.bucketIndex,Z.sourceLayerIndex,F.filter,F.layers,F.availableImages,C);for(const te in q){const Y=N[te]=N[te]||[],J=q[te];J.sort((se,be)=>{const Se=Z.featureSortOrder;if(Se){const Te=Se.indexOf(se.featureIndex);return Se.indexOf(be.featureIndex)-Te}return be.featureIndex-se.featureIndex});for(const se of J)Y.push(se)}}for(const Z in N)N[Z].forEach(q=>{const te=q.feature,Y=z(C[Z]).getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=Y});return N}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,l){l&&l.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(t);let _=[];for(const y of p)_=_.concat(Be(y,l));return _}addSourceType(t,l,p){return an.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(an.setSourceType(t,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const b in t)if(!U(t[b],p[b])){_=!0;break}if(!_)return;const y=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,l),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,l=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(l===1){if(typeof t.source=="object"){const p="terrain-dem-src";this.addSource(p,t.source),t=a.clone$1(t),t=a.extend(t,{source:p})}if(this._validate(a.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(t,l);else{const p=this.terrain,_=p.get();for(const y of Object.keys(a.spec.terrain))!t.hasOwnProperty(y)&&a.spec.terrain[y].default&&(t[y]=a.spec.terrain[y].default);for(const y in t)if(!U(t[y],_[y])){p.set(t),this.stylesheet.terrain=t;const b=this._setTransitionParameters({duration:0});p.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const l=this.fog=new zt(t,this.map.transform);this.stylesheet.fog=t;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();Object.keys(t).length===0&&l.set(t);for(const _ in t)if(!U(t[_],p[_])){l.set(t),this.stylesheet.fog=t;const y=this._setTransitionParameters({duration:0});l.updateTransitions(y);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:a.exported.now(),transition:a.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...l)}_createTerrain(t,l){const p=this.terrain=new yn(t,l);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const t in this._layers){const l=this._layers[t];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const l=this._layers[t];l.type==="symbol"&&this._updateLayer(l)}}_validate(t,l,p,_,y={}){return(!y||y.validate!==!1)&&Sa(this,t.call(a.validateStyle,a.extend({key:l,style:this.serialize(),value:p,styleSpec:a.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const l=this._getSourceCaches(t);for(const p of l)p.clearTiles()}_reloadSource(t){const l=this._getSourceCaches(t);for(const p of l)p.resume(),p.reload()}_updateSources(t){for(const l in this._sourceCaches)this._sourceCaches[l].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const l=this._sourceCaches[t];l.resume(),l.reload()}}_updatePlacement(t,l,p,_,y=!1){let b=!1,T=!1;const C={};for(const M of this._order){const z=this._layers[M];if(z.type!=="symbol")continue;if(!C[z.source]){const F=this._getLayerSourceCache(z);if(!F)continue;C[z.source]=F.getRenderableIds(!0).map(j=>F.getTileByID(j)).sort((j,G)=>G.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(G.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(z,C[z.source],t.center.lng,t.projection);b=b||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new au(t,this._order,y,l,p,_,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),T=!0),b&&this.pauseablePlacement.placement.setStale()),T||b)for(const M of this._order){const z=this._layers[M];z.type==="symbol"&&this.placement.updateLayerOpacities(z,C[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=y=>{y&&y.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(t,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(t,l,p){return a.makeRequest(l,p)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const l=[];return this._otherSourceCaches[t]&&l.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&l.push(this._symbolSourceCaches[t]),l}_isSourceCacheLoaded(t){const l=this._getSourceCaches(t);return l.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}an.getSourceType=function(h){return ce[h]},an.setSourceType=function(h,t){ce[h]=t},an.registerForPluginStateChange=a.registerForPluginStateChange;var uu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,hu="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ca={},$n={};Ca=Gt("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),$n=Gt(`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const kl=Gt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ys=uu,xs=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var zl={background:Gt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Gt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Gt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Gt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Gt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Gt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Gt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Gt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Gt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Gt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Gt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Gt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Gt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Gt(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Gt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Gt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Gt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Gt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Gt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Gt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Gt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Gt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Gt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Gt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,hu),skyboxGradient:Gt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,hu),skyboxCapture:Gt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Gt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Gt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Gt(h,t,l){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,y=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b=h.match(_),T=t.match(_),C=uu.match(_);let M=T?T.concat(b):b;l||(Ca.staticUniforms&&(M=Ca.staticUniforms.concat(M)),$n.staticUniforms&&(M=$n.staticUniforms.concat(M))),M&&(M=M.concat(C));const z={};return{fragmentSource:h=h.replace(p,(R,F,j,G,N)=>(z[N]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${j} ${G} ${N};
#else
uniform ${j} ${G} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${j} ${G} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(p,(R,F,j,G,N)=>{const K=G==="float"?"vec2":"vec4",V=N.match(/color/)?"color":K;return z[N]?F==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${j} ${K} a_${N};
varying ${j} ${G} ${N};
#else
uniform ${j} ${G} u_${N};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${j} ${G} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${V}(a_${N}, u_${N}_t);
#else
    ${j} ${G} ${N} = u_${N};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${j} ${K} a_${N};
#else
uniform ${j} ${G} u_${N};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${j} ${G} ${N} = a_${N};
#else
    ${j} ${G} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${j} ${G} ${N} = unpack_mix_${V}(a_${N}, u_${N}_t);
#else
    ${j} ${G} ${N} = u_${N};
#endif
`}),staticAttributes:y,staticUniforms:M}}class _d{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,l,p,_,y,b,T,C,M){this.context=t;let z=this.boundPaintVertexBuffers.length!==_.length;for(let R=0;!z&&R<_.length;R++)this.boundPaintVertexBuffers[R]!==_[R]&&(z=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===p&&!z&&this.boundIndexBuffer===y&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===C&&this.boundDynamicVertexBuffer3===M?(t.bindVertexArrayOES.set(this.vao),T&&T.bind(),y&&y.dynamicDraw&&y.bind(),C&&C.bind(),M&&M.bind()):this.freshBind(l,p,_,y,b,T,C,M)}freshBind(t,l,p,_,y,b,T,C){let M;const z=t.numAttributes,R=this.context,F=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=t,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=C;else{M=R.currentNumAttributes||0;for(let j=z;j<M;j++)F.disableVertexAttribArray(j)}l.enableAttributes(F,t);for(const j of p)j.enableAttributes(F,t);b&&b.enableAttributes(F,t),T&&T.enableAttributes(F,t),C&&C.enableAttributes(F,t),l.bind(),l.setVertexAttribPointers(F,t,y);for(const j of p)j.bind(),j.setVertexAttribPointers(F,t,y);b&&(b.bind(),b.setVertexAttribPointers(F,t,y)),_&&_.bind(),T&&(T.bind(),T.setVertexAttribPointers(F,t,y)),C&&(C.bind(),C.setVertexAttribPointers(F,t,y)),R.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function du(h,t){const l=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new a.MercatorCoordinate(0,p/l).toLngLat().lat,new a.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function gd(h,t,l,p,_,y,b){const T=h.context,C=T.gl,M=l.fbo;if(!M)return;h.prepareDrawTile();const z=h.useProgram("hillshade");T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get());const R=((N,K,V,Z)=>{const q=V.paint.get("hillshade-shadow-color"),te=V.paint.get("hillshade-highlight-color"),Y=V.paint.get("hillshade-accent-color");let J=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(J-=N.transform.angle);const se=!N.options.moving;return{u_matrix:Z||N.transform.calculateProjMatrix(K.tileID.toUnwrapped(),se),u_image:0,u_latrange:du(0,K.tileID),u_light:[V.paint.get("hillshade-exaggeration"),J],u_shadow:q,u_highlight:te,u_accent:Y}})(h,l,p,h.terrain?t.projMatrix:null);h.prepareDrawProgram(T,z,t.toUnwrapped());const{tileBoundsBuffer:F,tileBoundsIndexBuffer:j,tileBoundsSegments:G}=h.getTileBoundsBuffers(l);z.draw(T,C.TRIANGLES,_,y,b,a.CullFaceMode.disabled,R,p.id,F,j,G)}function Pl(h,t,l){if(!t.needsDEMTextureUpload)return;const p=h.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(l.stride);const y=l.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new a.Texture(p,y,_.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Dl(h,t,l,p,_,y){const b=h.context,T=b.gl;if(!t.dem)return;const C=t.dem;if(b.activeTexture.set(T.TEXTURE1),Pl(h,t,C),!t.demTexture)return;t.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const M=C.dim;b.activeTexture.set(T.TEXTURE0);let z=t.fbo;if(!z){const G=new a.Texture(b,{width:M,height:M,data:null},T.RGBA);G.bind(T.LINEAR,T.CLAMP_TO_EDGE),z=t.fbo=b.createFramebuffer(M,M,!0),z.colorAttachment.set(G.texture)}b.bindFramebuffer.set(z.framebuffer),b.viewport.set([0,0,M,M]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:F,tileBoundsSegments:j}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(b,T.TRIANGLES,p,_,y,a.CullFaceMode.disabled,((G,N)=>{const K=N.stride,V=a.create();return a.ortho(V,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(V,V,[0,-a.EXTENT,0]),{u_matrix:V,u_image:1,u_dimension:[K,K],u_zoom:G.overscaledZ,u_unpack:N.unpackVector}})(t.tileID,C),l.id,R,F,j),t.needsHillshadePrepare=!1}const Ll=(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_image0:new a.Uniform1i(h,t.u_image0),u_skirt_height:new a.Uniform1f(h,t.u_skirt_height)}),Rl=(h,t)=>({u_matrix:h,u_image0:0,u_skirt_height:t}),Ut=(h,t,l,p,_,y,b,T,C,M,z,R,F,j)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:T,u_frustum_br:C,u_frustum_bl:M,u_globe_pos:z,u_globe_radius:R,u_viewport:F,u_grid_matrix:j?Float32Array.from(j):new Float32Array(9)});function Ia(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const Ro=new class{constructor(){this.operations={}}newMorphing(h,t,l,p,_){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==l.tileID.key&&(y.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:_,from:t,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const l=this.operations[t];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Aa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function yd(h,t){const l=1<<h.z;return!t&&(h.x===0||h.x===l-1)||h.y===0||h.y===l-1}const Ma=h=>({u_matrix:h});function pu(h,t,l,p,_){if(_>0){const y=a.exported.now(),b=(y-h.timeAdded)/_,T=t?(y-t.timeAdded)/_:-1,C=l.getSource(),M=p.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(h.tileID.overscaledZ-M),R=z&&h.refreshedUponExpiration?1:a.clamp(z?b:1-T,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Im extends a.SourceCache{constructor(t){const l={type:"raster-dem",maxzoom:t.transform.maxZoom},p=new Mr(jt(),null),_=ye("mock-dem",l,p,t.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,l){t.state="loaded",l(null)}}class Am extends a.SourceCache{constructor(t){const l=ye("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Mr(jt(),null),t.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,l,p){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const T=new a.Tile(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom);T.state="loaded",this._tiles[b.key]=T}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const l=this.proxyCachedFBO[t];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Bl extends a.OverscaledTileID{constructor(t,l,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class fu extends a.Elevation{constructor(t,l){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,y]=function(C){const M=new a.StructArrayLayout4i8,z=new a.StructArrayLayout3ui6,R=131;M.reserve(17161),z.reserve(33800);const F=a.EXTENT/128,j=a.EXTENT+F/2,G=j+F;for(let K=-F;K<G;K+=F)for(let V=-F;V<G;V+=F){const Z=V<0||V>j||K<0||K>j?24575:0,q=a.clamp(Math.round(V),0,a.EXTENT),te=a.clamp(Math.round(K),0,a.EXTENT);M.emplaceBack(q+Z,te,q,te)}const N=(K,V)=>{const Z=V*R+K;z.emplaceBack(Z+1,Z,Z+R),z.emplaceBack(Z+R,Z+R+1,Z+1)};for(let K=1;K<129;K++)for(let V=1;V<129;V++)N(V,K);return[0,129].forEach(K=>{for(let V=0;V<130;V++)N(V,K),N(K,V)}),[M,z,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(p,a.boundsAttributes.members),this.gridIndexBuffer=b.createIndexBuffer(_),this.gridSegments=a.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,p.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Am(l.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,0,a.EXTENT,0,a.EXTENT,0,1);const T=b.gl;this._overlapStencilMode=new a.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Im(l.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,l,p){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const _=t.terrain.properties;this.sourceCache=t.terrain.drapeRenderMode===0?this._mockSourceCache:t._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const y=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const b=this.getScaledDemTileSize();this.sourceCache.update(l,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),l.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(C=>{const M=l.getTileByID(C).tileID;return M.projMatrix=p.calculateProjMatrix(M.toUnwrapped()),M});(function(C,M){const z=M.transform.pointCoordinate(M.transform.getCameraPoint()),R=new a.pointGeometry(z.x,z.y);C.sort((F,j)=>{if(j.overscaledZ-F.overscaledZ)return j.overscaledZ-F.overscaledZ;const G=new a.pointGeometry(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),N=new a.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),K=R.mult(1<<F.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(G)-K.distSqr(N)})})(_,this.painter),this._previousZoom=p.zoom;const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const b=this._style._sourceCaches;for(const C in b){const M=b[C];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,t[C],y),M.usedForTerrain))continue;const z=t[C];M.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[l.id]=_.map(C=>new Bl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const T={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const M=this.terrainTileForTile[C.key];if(!M)continue;const z=M.tileID.key;z in T||(this._visibleDemTiles.push(M),T[z]=z)}}_assignTerrainTiles(t){this._initializing||t.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,l=t.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(l.TEXTURE1),Pl(this.painter,_,y))}}_prepareDemTileUniforms(t,l,p,_){if(!l||l.demTexture==null)return!1;const y=t.tileID.canonical,b=Math.pow(2,l.tileID.canonical.z-y.z),T=_||"";return p[`u_dem_tl${T}`]=[y.x*b%1,y.y*b%1],p[`u_dem_scale${T}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,l=t.gl;if(!this._emptyDepthBufferTexture){const p=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(t,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const y=_.dem.tree.minimums[0];return y>0&&t++,p+y},0);return t?l/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,l=t.gl;t.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new a.Texture(t,_,l.RGBA,{premultiply:!1}),y}setupElevationDraw(t,l,p){const _=this.painter.context,y=_.gl,b=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var T;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();const C=this.painter.transform,M=C.projection,z=t.tileID.canonical;b.u_tile_tl_up=M.upVector(z,0,0),b.u_tile_tr_up=M.upVector(z,a.EXTENT,0),b.u_tile_br_up=M.upVector(z,a.EXTENT,a.EXTENT),b.u_tile_bl_up=M.upVector(z,0,a.EXTENT),b.u_tile_up_scale=p&&p.useDenormalizedUpVectorScale?a.GLOBE_METERS_TO_ECEF:M.upVectorScale(z,C.center.lat,C.worldSize).metersToTile;let R=null,F=null,j=1;if(p&&p.morphing&&this._useVertexMorphing){const G=p.morphing.srcDemTile,N=p.morphing.dstDemTile;j=p.morphing.phase,G&&N&&(this._prepareDemTileUniforms(t,G,b,"_prev")&&(F=G),this._prepareDemTileUniforms(t,N,b)&&(R=N))}if(F&&R?(_.activeTexture.set(y.TEXTURE2),R.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),_.activeTexture.set(y.TEXTURE4),F.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),b.u_dem_lerp=j):(R=this.terrainTileForTile[t.tileID.key],_.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(t,R,b)?R.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),_.activeTexture.set(y.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&R){const G=(1<<R.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=G}p&&p.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,b)}renderToBackBuffer(t){const l=this.painter,p=this.painter.context;t.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,y,b,T,C){if(_.transform.projection.name==="globe")(function(M,z,R,F,j){const G=M.context,N=G.gl;let K,V;const Z=M.options.showTerrainWireframe?2:0,q=M.transform,te=a.globeUseCustomAntiAliasing(M,G,q),Y=(ee,De)=>{if(V===ee)return;const Pe=[Aa[ee],"PROJECTION_GLOBE_VIEW"];te&&Pe.push("CUSTOM_ANTIALIASING"),De&&Pe.push(Aa[Z]),K=M.useProgram("globeRaster",null,Pe),V=ee},J=M.colorModeForRenderPass(),se=new a.DepthMode(N.LEQUAL,a.DepthMode.ReadWrite,M.depthRangeFor3D);Ro.update(j);const be=a.calculateGlobeMercatorMatrix(q),Se=[a.mercatorXfromLng(q.center.lng),a.mercatorYfromLat(q.center.lat)],Te=M.globeSharedBuffers,ve=[q.width*a.exported.devicePixelRatio,q.height*a.exported.devicePixelRatio];if((Z?[!1,!0]:[!1]).forEach(ee=>{V=-1;const De=ee?N.LINES:N.TRIANGLES;for(const Pe of F){const We=R.getTile(Pe),Ie=a.StencilMode.disabled,at=z.prevTerrainTileForTile[Pe.key],qe=z.terrainTileForTile[Pe.key];Ia(at,qe)&&Ro.newMorphing(Pe.key,at,qe,j,250),G.activeTexture.set(N.TEXTURE0),We.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Ze=Ro.getMorphValuesForProxy(Pe.key),Ve=Ze?1:0,$e={useDenormalizedUpVectorScale:!0};Ze&&a.extend$1($e,{morphing:{srcDemTile:Ze.from,dstDemTile:Ze.to,phase:a.easeCubicInOut(Ze.phase)}});const yt=Float32Array.from(q.globeMatrix),ut=a.globeTileLatLngCorners(Pe.canonical),St=a.getLatitudinalLod((ut[0][0]+ut[1][0])/2),ot=a.getGridMatrix(Pe.canonical,ut,St),bt=a.globeNormalizeECEF(a.globeTileBounds(Pe.canonical)),$t=Ut(q.projMatrix,yt,be,bt,a.globeToMercatorTransition(q.zoom),Se,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,ve,ot);if(Y(Ve,ee),z.setupElevationDraw(We,K,$e),M.prepareDrawProgram(G,K,Pe.toUnwrapped()),Te){const[Ht,Er,er]=ee?Te.getWirefameBuffers(M.context,St):Te.getGridBuffers(St);K.draw(G,De,se,Ie,J,a.CullFaceMode.backCCW,$t,"globe_raster",Ht,Er,er)}}}),Te){const ee=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&ee.push("CUSTOM_ANTIALIASING"),K=M.useProgram("globeRaster",null,ee);for(const De of F){const{x:Pe,y:We,z:Ie}=De.canonical,at=We===0,qe=We===(1<<Ie)-1,[Ze,Ve,$e,yt]=Te.getPoleBuffers(Ie);if(yt&&(at||qe)){const ut=R.getTile(De);G.activeTexture.set(N.TEXTURE0),ut.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let St=a.globePoleMatrixForTile(Ie,Pe,q);const ot=a.globeNormalizeECEF(a.globeTileBounds(De.canonical)),bt=($t,Ht)=>$t.draw(G,N.TRIANGLES,se,a.StencilMode.disabled,J,a.CullFaceMode.disabled,Ut(q.projMatrix,St,St,ot,0,Se,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,ve),"globe_pole_raster",Ht,$e,yt);z.setupElevationDraw(ut,K,{}),M.prepareDrawProgram(G,K,De.toUnwrapped()),at&&bt(K,Ze),qe&&(St=a.scale(a.create(),St,[1,-1,1]),bt(K,Ve))}}}})(_,y,b,T,C);else{const M=_.context,z=M.gl;let R,F;const j=_.options.showTerrainWireframe?2:0,G=(q,te)=>{if(F===q)return;const Y=[Aa[q]];te&&Y.push(Aa[j]),R=_.useProgram("terrainRaster",null,Y),F=q},N=_.colorModeForRenderPass(),K=new a.DepthMode(z.LEQUAL,a.DepthMode.ReadWrite,_.depthRangeFor3D);Ro.update(C);const V=_.transform,Z=6*Math.pow(1.5,22-V.zoom)*y.exaggeration();(j?[!1,!0]:[!1]).forEach(q=>{F=-1;const te=q?z.LINES:z.TRIANGLES,[Y,J]=q?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const se of T){const be=b.getTile(se),Se=a.StencilMode.disabled,Te=y.prevTerrainTileForTile[se.key],ve=y.terrainTileForTile[se.key];Ia(Te,ve)&&Ro.newMorphing(se.key,Te,ve,C,250),M.activeTexture.set(z.TEXTURE0),be.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const ee=Ro.getMorphValuesForProxy(se.key),De=ee?1:0;let Pe;ee&&(Pe={morphing:{srcDemTile:ee.from,dstDemTile:ee.to,phase:a.easeCubicInOut(ee.phase)}});const We=Rl(se.projMatrix,yd(se.canonical,V.renderWorldCopies)?Z/10:Z);G(De,q),y.setupElevationDraw(be,R,Pe),_.prepareDrawProgram(M,R,se.toUnwrapped()),R.draw(M,te,K,Se,N,a.CullFaceMode.backCCW,We,"terrain_raster",y.gridBuffer,Y,J)}})}}(l,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],b=this._drapedRenderBatches.shift(),T=[],C=l.style.order;let M=0;for(const z of y){const R=_.getTileByID(z.proxyTileKey),F=_.proxyCachedFBO[z.key]?_.proxyCachedFBO[z.key][t]:void 0,j=F!==void 0?_.renderCache[F]:this.pool[M++],G=F!==void 0;if(R.texture=j.tex,G&&!j.dirty){T.push(R.tileID);continue}let N;p.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(p.clear({color:a.Color.transparent,stencil:0}),j.dirty=!1);for(let K=b.start;K<=b.end;++K){const V=l.style._layers[C[K]];if(V.isHidden(l.transform.zoom))continue;const Z=l.style._getLayerSourceCache(V),q=Z?this.proxyToSource[z.key][Z.id]:[z];if(!q)continue;const te=q;p.viewport.set([0,0,j.fb.width,j.fb.height]),N!==(Z?Z.id:null)&&(this._setupStencil(j,q,V,Z),N=Z?Z.id:null),l.renderLayer(l,Z,V,te)}this.renderedToTile?(j.dirty=!0,T.push(R.tileID)):G||--M,M===5&&(M=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),b.end+1}postRender(){}renderCacheEfficiency(t){const l=t.order.length;if(l===0)return{efficiency:100};let p,_=0,y=0,b=!1;for(let T=0;T<l;++T){const C=t._layers[t.order[T]];this._style.isLayerDraped(C)?(b&&++_,++y):b||(b=!0,p=C.id)}return y===0?{efficiency:100}:{efficiency:100*(1-_/y),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{t=Math.min(t,l.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,T=Math.pow(2,b.overscaledZ),{x:C,y:M}=b.canonical,z=C/T,R=(C+1)/T,F=M/T,j=(M+1)/T;return{minx:z,miny:F,maxx:R,maxy:j,t:y.dem.tree.raycastRoot(z,F,R,j,t,l,p),tile:y}});_.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,l,p);if(b!=null)return b}return null}_createFBO(){const t=this.painter.context,l=t.gl,p=this.drapeBufferSize;t.activeTexture.set(l.TEXTURE0);const _=new a.Texture(t,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const y=t.createFramebuffer(p[0],p[1],!1);return y.colorAttachment.set(_.texture),y.depthAttachment=new L(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const l=this._style._layers[t],p=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),y=!!_&&_.t!==1,b=l.hasTransition();return l.type!=="custom"&&!p&&(y||b)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof Q){t=!0;break}if(t)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(p);if(p.type!=="raster"||_||!y)continue;const b=p.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const C=this.proxyToSource[T.key][y.id];if(C)for(const M of C){const z=pu(y.getTile(M),y.findLoadedParent(M,0),y,this.painter.transform,b);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(y.id,M)}}}}_setupDrapedRenderBatches(){const t=this._style.order,l=t.length;if(l===0)return;const p=[];let _,y=0,b=this._style._layers[t[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<l;)b=this._style._layers[t[y]];for(;y<l;++y){const T=this._style._layers[t[y]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?_===void 0&&(_=y):_!==void 0&&(p.push({start:_,end:y-1}),_=void 0))}_!==void 0&&p.push({start:_,end:y-1}),this._drapedRenderBatches=p}_setupRenderCache(t){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const b=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let T=0;T<b.length;++T){const C=Object.values(b[T]);l.renderCachePool.push(...C)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let b=p.length-1;b>=0;b--){const T=p[b];if(l.getTileByID(T.key),l.proxyCachedFBO[T.key]!==void 0){const C=t[T.key],M=this.proxyToSource[T.key];let z=0;for(const R in M){const F=M[R],j=C[R];if(!j||j.length!==F.length||F.some((G,N)=>G!==j[N]||_[R]&&_[R].hasOwnProperty(G.key))){z=-1;break}++z}for(const R in l.proxyCachedFBO[T.key])l.renderCache[l.proxyCachedFBO[T.key][R]].dirty=z<0||z!==Object.values(C).length}}const y=[...this._drapedRenderBatches];y.sort((b,T)=>T.end-T.start-(b.end-b.start));for(const b of y)for(const T of p){if(l.proxyCachedFBO[T.key])continue;let C=l.renderCachePool.pop();C===void 0&&l.renderCache.length<50&&(C=l.renderCache.length,l.renderCache.push(this._createFBO())),C!==void 0&&(l.proxyCachedFBO[T.key]={},l.proxyCachedFBO[T.key][b.start]=C,l.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let T;if(p.isTileClipped())T=l.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(t,l){const p=this.painter,_=this.painter.context,y=_.gl;p._tileClippingMaskIDs={},_.setColorMode(a.ColorMode.disabled),_.setDepthMode(a.DepthMode.disabled);const b=p.useProgram("clippingMask");for(const T of t){const C=p._tileClippingMaskIDs[T.key]=--l;b.draw(_,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.ALWAYS,mask:0},C,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Ma(T.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const l=this.painter.transform;if(t.x<0||t.x>l.width||t.y<0||t.y>l.height)return null;const p=[t.x,t.y,1,1];a.transformMat4$1(p,p,l.pixelMatrixInverse),a.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,y=a.mercatorZfromAltitude(1,l.center.lat),b=[_[0],_[1],_[2]/y,0],T=a.subtract([],p.slice(0,3),b);a.normalize(T,T);const C=this.raycast(b,T,this._exaggeration);return C!==null&&C?(a.scaleAndAdd(b,b,T,C),b[3]=b[2],b[2]*=y,b):null}drawDepth(){const t=this.painter,l=t.context,p=this.proxySourceCache,_=Math.ceil(t.width),y=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const b=l.gl,T=l.createFramebuffer(_,y,!0);l.activeTexture.set(b.TEXTURE0);const C=new a.Texture(l,{width:_,height:y,data:null},b.RGBA);C.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.colorAttachment.set(C.texture);const M=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,y);T.depthAttachment.set(M),this._depthFBO=T,this._depthTexture=C}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,y]),function(b,T,C,M){if(b.transform.projection.name==="globe")return;const z=b.context,R=z.gl;z.clear({depth:1});const F=b.useProgram("terrainDepth"),j=new a.DepthMode(R.LESS,a.DepthMode.ReadWrite,b.depthRangeFor3D);for(const G of M){const N=C.getTile(G),K=Rl(G.projMatrix,0);T.setupElevationDraw(N,F),F.draw(z,R.TRIANGLES,j,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,K,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(t,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,l,p){if(t.getSource()instanceof pe)return this._setupProxiedCoordsForImageSource(t,l,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let T=0;T<y.length;T++){const C=y[T],M=this._findTileCoveringTileID(C,t);if(M){const z=this._createProxiedId(C,M,p[C.key]&&p[C.key][t.id]);_.push(z),this.proxyToSource[C.key][t.id]=[z]}}let b=!1;for(let T=0;T<l.length;T++){const C=t.getTile(l[T]);if(!C||!C.hasData())continue;const M=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(M&&M.tileID.canonical.z!==C.tileID.canonical.z){const z=this.proxyToSource[M.tileID.key][t.id],R=this._createProxiedId(M.tileID,C,p[M.tileID.key]&&p[M.tileID.key][t.id]);z?z.splice(z.length-1,0,R):this.proxyToSource[M.tileID.key][t.id]=[R],_.push(R),b=!0}}this._sourceTilesOverlap[t.id]=b}_setupProxiedCoordsForImageSource(t,l,p){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],y=this.proxyCoords,b=t.getSource(),T=new a.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),C=b.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((z,R)=>(z.min.x=Math.min(z.min.x,R.x-T.x),z.min.y=Math.min(z.min.y,R.y-T.y),z.max.x=Math.max(z.max.x,R.x-T.x),z.max.y=Math.max(z.max.y,R.y-T.y),z),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),M=(z,R)=>{const F=z.wrap+z.canonical.x/(1<<z.canonical.z),j=z.canonical.y/(1<<z.canonical.z),G=a.EXTENT/(1<<z.canonical.z),N=R.wrap+R.canonical.x/(1<<R.canonical.z),K=R.canonical.y/(1<<R.canonical.z);return F+G<N+C.min.x||F>N+C.max.x||j+G<K+C.min.y||j>K+C.max.y};for(let z=0;z<y.length;z++){const R=y[z];for(let F=0;F<l.length;F++){const j=t.getTile(l[F]);if(!j||!j.hasData()||M(R,j.tileID))continue;const G=this._createProxiedId(R,j,p[R.key]&&p[R.key][t.id]),N=this.proxyToSource[R.key][t.id];N?N.push(G):this.proxyToSource[R.key][t.id]=[G],_.push(G)}}}_createProxiedId(t,l,p){let _=this.orthoMatrix;if(p){const y=p.find(b=>b.key===l.tileID.key);if(y)return y}if(l.tileID.key!==t.key){const y=t.canonical.z-l.tileID.canonical.z;let b,T,C;_=a.create();const M=l.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(b=a.EXTENT>>y,T=b*((l.tileID.canonical.x<<y)-t.canonical.x+M),C=b*((l.tileID.canonical.y<<y)-t.canonical.y)):(b=a.EXTENT<<-y,T=a.EXTENT*(l.tileID.canonical.x-(t.canonical.x+M<<-y)),C=a.EXTENT*(l.tileID.canonical.y-(t.canonical.y<<-y))),a.ortho(_,0,b,0,b,0,1),a.translate(_,_,[T,C,0])}return new Bl(l.tileID,t.key,_)}_findTileCoveringTileID(t,l){let p=l.getTile(t);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],y=_[t.key];if(p=y?l.getTileByID(y):null,p&&p.hasData()||y===null)return p;let b=p?p.tileID:t,T=b.overscaledZ;const C=l.getSource().minzoom,M=[];if(!y){const R=l.getSource().maxzoom;if(t.canonical.z>=R){const F=t.canonical.z-R;l.getSource().reparseOverscaled?(T=Math.max(t.canonical.z+2,l.transform.tileZoom),b=new a.OverscaledTileID(T,t.wrap,R,t.canonical.x>>F,t.canonical.y>>F)):F!==0&&(T=R,b=new a.OverscaledTileID(T,t.wrap,R,t.canonical.x>>F,t.canonical.y>>F))}b.key!==t.key&&(M.push(b.key),p=l.getTile(b))}const z=R=>{M.forEach(F=>{_[F]=R}),M.length=0};for(T-=1;T>=C&&(!p||!p.hasData());T--){p&&z(p.tileID.key);const R=b.calculateScaledKey(T);if(p=l.getTileByID(R),p&&p.hasData())break;const F=_[R];if(F===null)break;F===void 0?M.push(R):p=l.getTileByID(F)}return z(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,l){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(l){let p=0;const _=new a.StructArrayLayout2ui4,y=131;for(let b=1;b<129;b++){for(let T=1;T<129;T++)p=b*y+T,_.emplaceBack(p,p+1),_.emplaceBack(p,p+y),_.emplaceBack(p+1,p+y),b===128&&_.emplaceBack(p+y,p+y+1);_.emplaceBack(p+1,p+1+y)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ol(h){const t=[];for(let l=0;l<h.length;l++){if(h[l]===null)continue;const p=h[l].split(" ");t.push(p.pop())}return t}class Fl{static cacheKey(t,l,p){let _=`${t}${p?p.cacheKey:""}`;for(const y of l)_+=`/${y}`;return _}constructor(t,l,p,_,y,b){const T=t.gl;this.program=T.createProgram();const C=Ol(p.staticAttributes),M=_?_.getBinderAttributes():[],z=C.concat(M),R=p.staticUniforms?Ol(p.staticUniforms):[],F=_?_.getBinderUniforms():[],j=R.concat(F),G=[];for(const Y of j)G.indexOf(Y)<0&&G.push(Y);let N=_?_.defines():[];N=N.concat(b.map(Y=>`#define ${Y}`));const K=N.concat(t.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(xs):xs,xs,ys,kl.fragmentSource,$n.fragmentSource,p.fragmentSource).join(`
`),V=N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ys,kl.vertexSource,$n.vertexSource,Ca.vertexSource,p.vertexSource).join(`
`),Z=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(Z,K),T.compileShader(Z),T.attachShader(this.program,Z);const q=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(q,V),T.compileShader(q),T.attachShader(this.program,q),this.attributes={};const te={};this.numAttributes=z.length;for(let Y=0;Y<this.numAttributes;Y++)z[Y]&&(T.bindAttribLocation(this.program,Y,z[Y]),this.attributes[z[Y]]=Y);T.linkProgram(this.program),T.deleteShader(q),T.deleteShader(Z);for(let Y=0;Y<G.length;Y++){const J=G[Y];if(J&&!te[J]){const se=T.getUniformLocation(this.program,J);se&&(te[J]=se)}}this.fixedUniforms=y(t,te),this.binderUniforms=_?_.getUniforms(t,te):[],b.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Y,J)=>({u_dem:new a.Uniform1i(Y,J.u_dem),u_dem_prev:new a.Uniform1i(Y,J.u_dem_prev),u_dem_unpack:new a.Uniform4f(Y,J.u_dem_unpack),u_dem_tl:new a.Uniform2f(Y,J.u_dem_tl),u_dem_scale:new a.Uniform1f(Y,J.u_dem_scale),u_dem_tl_prev:new a.Uniform2f(Y,J.u_dem_tl_prev),u_dem_scale_prev:new a.Uniform1f(Y,J.u_dem_scale_prev),u_dem_size:new a.Uniform1f(Y,J.u_dem_size),u_dem_lerp:new a.Uniform1f(Y,J.u_dem_lerp),u_exaggeration:new a.Uniform1f(Y,J.u_exaggeration),u_depth:new a.Uniform1i(Y,J.u_depth),u_depth_size_inv:new a.Uniform2f(Y,J.u_depth_size_inv),u_meter_to_dem:new a.Uniform1f(Y,J.u_meter_to_dem),u_label_plane_matrix_inv:new a.UniformMatrix4f(Y,J.u_label_plane_matrix_inv),u_tile_tl_up:new a.Uniform3f(Y,J.u_tile_tl_up),u_tile_tr_up:new a.Uniform3f(Y,J.u_tile_tr_up),u_tile_br_up:new a.Uniform3f(Y,J.u_tile_br_up),u_tile_bl_up:new a.Uniform3f(Y,J.u_tile_bl_up),u_tile_up_scale:new a.Uniform1f(Y,J.u_tile_up_scale)}))(t,te)),b.indexOf("FOG")!==-1&&(this.fogUniforms=((Y,J)=>({u_fog_matrix:new a.UniformMatrix4f(Y,J.u_fog_matrix),u_fog_range:new a.Uniform2f(Y,J.u_fog_range),u_fog_color:new a.Uniform4f(Y,J.u_fog_color),u_fog_horizon_blend:new a.Uniform1f(Y,J.u_fog_horizon_blend),u_fog_temporal_offset:new a.Uniform1f(Y,J.u_fog_temporal_offset),u_frustum_tl:new a.Uniform3f(Y,J.u_frustum_tl),u_frustum_tr:new a.Uniform3f(Y,J.u_frustum_tr),u_frustum_br:new a.Uniform3f(Y,J.u_frustum_br),u_frustum_bl:new a.Uniform3f(Y,J.u_frustum_bl),u_globe_pos:new a.Uniform3f(Y,J.u_globe_pos),u_globe_radius:new a.Uniform1f(Y,J.u_globe_radius),u_globe_transition:new a.Uniform1f(Y,J.u_globe_transition),u_is_globe:new a.Uniform1i(Y,J.u_is_globe),u_viewport:new a.Uniform2f(Y,J.u_viewport)}))(t,te))}setTerrainUniformValues(t,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in l)p[_].set(l[_])}}setFogUniformValues(t,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in l)p[_].location&&p[_].set(l[_])}}draw(t,l,p,_,y,b,T,C,M,z,R,F,j,G,N,K,V){const Z=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(_),t.setColorMode(y),t.setCullFace(b);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(T[te]);G&&G.setUniforms(t,this.binderUniforms,F,{zoom:j});const q={[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[l];for(const te of R.get()){const Y=te.vaos||(te.vaos={});(Y[C]||(Y[C]=new _d)).bind(t,this,M,G?G.getPaintVertexBuffers():[],z,te.vertexOffset,N,K,V),Z.drawElements(l,te.primitiveLength*q,Z.UNSIGNED_SHORT,te.primitiveOffset*q*2)}}}function mu(h,t,l){const p=1/Zr(l,1,t.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,t.transform.tileZoom)/_,b=y*(l.tileID.canonical.x+l.tileID.wrap*_),T=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const xd=a.create(),vd=(h,t,l,p,_,y,b,T,C)=>{const M=t.style.light,z=M.properties.get("position"),R=[z.x,z.y,z.z],F=a.create$1();M.properties.get("anchor")==="viewport"&&(a.fromRotation(F,-t.transform.angle),a.transformMat3(R,R,F));const j=M.properties.get("color"),G=t.transform,N={u_matrix:h,u_lightpos:R,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return G.projection.name==="globe"&&(N.u_tile_id=[_.canonical.x,_.canonical.y,1<<_.canonical.z],N.u_zoom_transition=b,N.u_inv_rot_matrix=C,N.u_merc_center=T,N.u_up_dir=G.projection.upVector(new a.CanonicalTileID(0,0,0),T[0]*a.EXTENT,T[1]*a.EXTENT),N.u_height_lift=y),N},ka=(h,t,l,p,_,y,b,T,C,M,z)=>{const R=vd(h,t,l,p,_,T,C,M,z),F={u_height_factor:-Math.pow(2,_.overscaledZ)/b.tileSize/8};return a.extend(R,mu(y,t,b),F)},vs=h=>({u_matrix:h}),_u=(h,t,l,p)=>a.extend(vs(h),mu(l,t,p)),Ul=(h,t)=>({u_matrix:h,u_world:t}),gu=(h,t,l,p,_)=>a.extend(_u(h,t,l,p),{u_world:_}),wn=a.create(),yu=(h,t,l,p,_,y)=>{const b=h.transform,T=b.projection.name==="globe";let C;if(y.paint.get("circle-pitch-alignment")==="map")if(T){const z=a.globePixelsToTileUnits(b.zoom,t.canonical)*b._projectionScaler;C=Float32Array.from([z,0,0,z])}else C=b.calculatePixelsToTileUnitsMatrix(l);else C=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:b.cameraToCenterDistance,u_matrix:h.translatePosMatrix(t.projMatrix,l,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:wn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){M.u_inv_rot_matrix=p,M.u_merc_center=_,M.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],M.u_zoom_transition=a.globeToMercatorTransition(b.zoom);const z=_[0]*a.EXTENT,R=_[1]*a.EXTENT;M.u_up_dir=b.projection.upVector(new a.CanonicalTileID(0,0,0),z,R)}return M},wd=h=>{const t=[];return h.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},xu=(h,t,l,p)=>{const _=a.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(p),u_extrude_scale:[t.pixelsToGLUnits[0]/_,t.pixelsToGLUnits[1]/_]}},vu=(h,t,l=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:l}),wu=a.create(),Mm=(h,t,l,p,_,y,b)=>{const T=h.transform,C=T.projection.name==="globe",M=C?a.globePixelsToTileUnits(T.zoom,t.canonical)*T._projectionScaler:Zr(l,1,y),z={u_matrix:t.projMatrix,u_extrude_scale:M,u_intensity:b,u_inv_rot_matrix:wu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){z.u_inv_rot_matrix=p,z.u_merc_center=_,z.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],z.u_zoom_transition=a.globeToMercatorTransition(T.zoom);const R=_[0]*a.EXTENT,F=_[1]*a.EXTENT;z.u_up_dir=T.projection.upVector(new a.CanonicalTileID(0,0,0),R,F)}return z},bu=(h,t,l,p,_,y,b,T)=>{const C=h.transform,M=C.calculatePixelsToTileUnitsMatrix(t),z={u_matrix:bd(h,t,l,_),u_pixels_to_tile_units:M,u_device_pixel_ratio:b,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:T};if(Nl(l)){const R=za(t,h.transform);z.u_texsize=t.lineAtlasTexture.size,z.u_scale=[R,p.fromScale,p.toScale],z.u_mix=p.t}return z},km=(h,t,l,p,_,y)=>{const b=h.transform,T=za(t,b);return{u_matrix:bd(h,t,l,_),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:y,u_image:0,u_scale:[T,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function za(h,t){return 1/Zr(h,1,t.tileZoom)}function bd(h,t,l,p){return h.translatePosMatrix(p||t.tileID.projMatrix,t,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Nl(h){const t=h.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const zm=(h,t,l,p,_,y)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(T=_.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=_.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Tu(_.paint.get("raster-hue-rotate")),u_perspective_transform:y};var b,T};function Tu(h){h*=Math.PI/180;const t=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*t-l+1)/3,(Math.sqrt(3)*t-l+1)/3]}const Td=a.create(),Pa=(h,t,l,p,_,y,b,T,C,M,z,R,F,j,G,N)=>{const K=_.transform,V={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:K.width/K.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:T,u_is_text:+C,u_pitch_with_map:+p,u_texsize:M,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Td,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Td,u_up_vector:[0,-1,0]};return N.name==="globe"&&(V.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],V.u_zoom_transition=R,V.u_inv_rot_matrix=j,V.u_merc_center=F,V.u_camera_forward=K._camera.forward(),V.u_ecef_origin=a.globeECEFOrigin(K.globeMatrix,z.toUnwrapped()),V.u_tile_matrix=Float32Array.from(K.globeMatrix),V.u_up_vector=G),V},Ed=(h,t,l,p,_,y,b,T,C,M,z,R,F,j,G,N,K)=>a.extend(Pa(h,t,l,p,_,y,b,T,C,M,R,F,j,G,N,K),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+z}),Sd=(h,t,l,p,_,y,b,T,C,M,z,R,F,j,G,N)=>a.extend(Ed(h,t,l,p,_,y,b,T,!0,C,!0,z,R,F,j,G,N),{u_texsize_icon:M,u_texture_icon:1}),Cd=(h,t,l)=>({u_matrix:h,u_opacity:t,u_color:l}),ws=(h,t,l,p,_,y)=>a.extend(function(b,T,C,M){const z=C.imageManager.getPattern(b.from.toString()),R=C.imageManager.getPattern(b.to.toString()),{width:F,height:j}=C.imageManager.getPixelSize(),G=Math.pow(2,M.tileID.overscaledZ),N=M.tileSize*Math.pow(2,C.transform.tileZoom)/G,K=N*(M.tileID.canonical.x+M.tileID.wrap*G),V=N*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[F,j],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/Zr(M,1,C.transform.tileZoom),u_pixel_coord_upper:[K>>16,V>>16],u_pixel_coord_lower:[65535&K,65535&V]}}(p,y,l,_),{u_matrix:h,u_opacity:t}),Pm={fillExtrusion:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_lightpos:new a.Uniform3f(h,t.u_lightpos),u_lightintensity:new a.Uniform1f(h,t.u_lightintensity),u_lightcolor:new a.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(h,t.u_vertical_gradient),u_opacity:new a.Uniform1f(h,t.u_opacity),u_tile_id:new a.Uniform3f(h,t.u_tile_id),u_zoom_transition:new a.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(h,t.u_merc_center),u_up_dir:new a.Uniform3f(h,t.u_up_dir),u_height_lift:new a.Uniform1f(h,t.u_height_lift)}),fillExtrusionPattern:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_lightpos:new a.Uniform3f(h,t.u_lightpos),u_lightintensity:new a.Uniform1f(h,t.u_lightintensity),u_lightcolor:new a.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(h,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(h,t.u_height_factor),u_tile_id:new a.Uniform3f(h,t.u_tile_id),u_zoom_transition:new a.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(h,t.u_merc_center),u_up_dir:new a.Uniform3f(h,t.u_up_dir),u_height_lift:new a.Uniform1f(h,t.u_height_lift),u_image:new a.Uniform1i(h,t.u_image),u_texsize:new a.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(h,t.u_scale),u_fade:new a.Uniform1f(h,t.u_fade),u_opacity:new a.Uniform1f(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_image:new a.Uniform1i(h,t.u_image),u_texsize:new a.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(h,t.u_scale),u_fade:new a.Uniform1f(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_world:new a.Uniform2f(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_world:new a.Uniform2f(h,t.u_world),u_image:new a.Uniform1i(h,t.u_image),u_texsize:new a.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(h,t.u_scale),u_fade:new a.Uniform1f(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new a.Uniform1f(h,t.u_camera_to_center_distance),u_extrude_scale:new a.UniformMatrix2f(h,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(h,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_inv_rot_matrix:new a.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(h,t.u_merc_center),u_tile_id:new a.Uniform3f(h,t.u_tile_id),u_zoom_transition:new a.Uniform1f(h,t.u_zoom_transition),u_up_dir:new a.Uniform3f(h,t.u_up_dir)}),collisionBox:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(h,t.u_camera_to_center_distance),u_extrude_scale:new a.Uniform2f(h,t.u_extrude_scale)}),collisionCircle:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(h,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(h,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new a.UniformColor(h,t.u_color),u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_overlay:new a.Uniform1i(h,t.u_overlay),u_overlay_scale:new a.Uniform1f(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new a.Uniform1f(h,t.u_extrude_scale),u_intensity:new a.Uniform1f(h,t.u_intensity),u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_inv_rot_matrix:new a.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(h,t.u_merc_center),u_tile_id:new a.Uniform3f(h,t.u_tile_id),u_zoom_transition:new a.Uniform1f(h,t.u_zoom_transition),u_up_dir:new a.Uniform3f(h,t.u_up_dir)}),heatmapTexture:(h,t)=>({u_image:new a.Uniform1i(h,t.u_image),u_color_ramp:new a.Uniform1i(h,t.u_color_ramp),u_opacity:new a.Uniform1f(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_image:new a.Uniform1i(h,t.u_image),u_latrange:new a.Uniform2f(h,t.u_latrange),u_light:new a.Uniform2f(h,t.u_light),u_shadow:new a.UniformColor(h,t.u_shadow),u_highlight:new a.UniformColor(h,t.u_highlight),u_accent:new a.UniformColor(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_image:new a.Uniform1i(h,t.u_image),u_dimension:new a.Uniform2f(h,t.u_dimension),u_zoom:new a.Uniform1f(h,t.u_zoom),u_unpack:new a.Uniform4f(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_pixels_to_tile_units:new a.UniformMatrix2f(h,t.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(h,t.u_units_to_pixels),u_dash_image:new a.Uniform1i(h,t.u_dash_image),u_gradient_image:new a.Uniform1i(h,t.u_gradient_image),u_image_height:new a.Uniform1f(h,t.u_image_height),u_texsize:new a.Uniform2f(h,t.u_texsize),u_scale:new a.Uniform3f(h,t.u_scale),u_mix:new a.Uniform1f(h,t.u_mix),u_alpha_discard_threshold:new a.Uniform1f(h,t.u_alpha_discard_threshold),u_trim_offset:new a.Uniform2f(h,t.u_trim_offset)}),linePattern:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_texsize:new a.Uniform2f(h,t.u_texsize),u_pixels_to_tile_units:new a.UniformMatrix2f(h,t.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(h,t.u_device_pixel_ratio),u_image:new a.Uniform1i(h,t.u_image),u_units_to_pixels:new a.Uniform2f(h,t.u_units_to_pixels),u_scale:new a.Uniform3f(h,t.u_scale),u_fade:new a.Uniform1f(h,t.u_fade),u_alpha_discard_threshold:new a.Uniform1f(h,t.u_alpha_discard_threshold)}),raster:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_tl_parent:new a.Uniform2f(h,t.u_tl_parent),u_scale_parent:new a.Uniform1f(h,t.u_scale_parent),u_fade_t:new a.Uniform1f(h,t.u_fade_t),u_opacity:new a.Uniform1f(h,t.u_opacity),u_image0:new a.Uniform1i(h,t.u_image0),u_image1:new a.Uniform1i(h,t.u_image1),u_brightness_low:new a.Uniform1f(h,t.u_brightness_low),u_brightness_high:new a.Uniform1f(h,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(h,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(h,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(h,t.u_spin_weights),u_perspective_transform:new a.Uniform2f(h,t.u_perspective_transform)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new a.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(h,t.u_size_t),u_size:new a.Uniform1f(h,t.u_size),u_camera_to_center_distance:new a.Uniform1f(h,t.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(h,t.u_fade_change),u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new a.Uniform1i(h,t.u_is_text),u_pitch_with_map:new a.Uniform1i(h,t.u_pitch_with_map),u_texsize:new a.Uniform2f(h,t.u_texsize),u_tile_id:new a.Uniform3f(h,t.u_tile_id),u_zoom_transition:new a.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(h,t.u_merc_center),u_camera_forward:new a.Uniform3f(h,t.u_camera_forward),u_tile_matrix:new a.UniformMatrix4f(h,t.u_tile_matrix),u_up_vector:new a.Uniform3f(h,t.u_up_vector),u_ecef_origin:new a.Uniform3f(h,t.u_ecef_origin),u_texture:new a.Uniform1i(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new a.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(h,t.u_size_t),u_size:new a.Uniform1f(h,t.u_size),u_camera_to_center_distance:new a.Uniform1f(h,t.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(h,t.u_fade_change),u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new a.Uniform1i(h,t.u_is_text),u_pitch_with_map:new a.Uniform1i(h,t.u_pitch_with_map),u_texsize:new a.Uniform2f(h,t.u_texsize),u_texture:new a.Uniform1i(h,t.u_texture),u_gamma_scale:new a.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(h,t.u_device_pixel_ratio),u_tile_id:new a.Uniform3f(h,t.u_tile_id),u_zoom_transition:new a.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(h,t.u_merc_center),u_camera_forward:new a.Uniform3f(h,t.u_camera_forward),u_tile_matrix:new a.UniformMatrix4f(h,t.u_tile_matrix),u_up_vector:new a.Uniform3f(h,t.u_up_vector),u_ecef_origin:new a.Uniform3f(h,t.u_ecef_origin),u_is_halo:new a.Uniform1i(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new a.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(h,t.u_size_t),u_size:new a.Uniform1f(h,t.u_size),u_camera_to_center_distance:new a.Uniform1f(h,t.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(h,t.u_fade_change),u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new a.Uniform1i(h,t.u_is_text),u_pitch_with_map:new a.Uniform1i(h,t.u_pitch_with_map),u_texsize:new a.Uniform2f(h,t.u_texsize),u_texsize_icon:new a.Uniform2f(h,t.u_texsize_icon),u_texture:new a.Uniform1i(h,t.u_texture),u_texture_icon:new a.Uniform1i(h,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_opacity:new a.Uniform1f(h,t.u_opacity),u_color:new a.UniformColor(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_opacity:new a.Uniform1f(h,t.u_opacity),u_image:new a.Uniform1i(h,t.u_image),u_pattern_tl_a:new a.Uniform2f(h,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(h,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(h,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(h,t.u_pattern_br_b),u_texsize:new a.Uniform2f(h,t.u_texsize),u_mix:new a.Uniform1f(h,t.u_mix),u_pattern_size_a:new a.Uniform2f(h,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(h,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(h,t.u_scale_a),u_scale_b:new a.Uniform1f(h,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(h,t.u_tile_units_to_pixels)}),terrainRaster:Ll,terrainDepth:Ll,skybox:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_sun_direction:new a.Uniform3f(h,t.u_sun_direction),u_cubemap:new a.Uniform1i(h,t.u_cubemap),u_opacity:new a.Uniform1f(h,t.u_opacity),u_temporal_offset:new a.Uniform1f(h,t.u_temporal_offset)}),skyboxGradient:(h,t)=>({u_matrix:new a.UniformMatrix4f(h,t.u_matrix),u_color_ramp:new a.Uniform1i(h,t.u_color_ramp),u_center_direction:new a.Uniform3f(h,t.u_center_direction),u_radius:new a.Uniform1f(h,t.u_radius),u_opacity:new a.Uniform1f(h,t.u_opacity),u_temporal_offset:new a.Uniform1f(h,t.u_temporal_offset)}),skyboxCapture:(h,t)=>({u_matrix_3f:new a.UniformMatrix3f(h,t.u_matrix_3f),u_sun_direction:new a.Uniform3f(h,t.u_sun_direction),u_sun_intensity:new a.Uniform1f(h,t.u_sun_intensity),u_color_tint_r:new a.Uniform4f(h,t.u_color_tint_r),u_color_tint_m:new a.Uniform4f(h,t.u_color_tint_m),u_luminance:new a.Uniform1f(h,t.u_luminance)}),globeRaster:(h,t)=>({u_proj_matrix:new a.UniformMatrix4f(h,t.u_proj_matrix),u_globe_matrix:new a.UniformMatrix4f(h,t.u_globe_matrix),u_normalize_matrix:new a.UniformMatrix4f(h,t.u_normalize_matrix),u_merc_matrix:new a.UniformMatrix4f(h,t.u_merc_matrix),u_zoom_transition:new a.Uniform1f(h,t.u_zoom_transition),u_merc_center:new a.Uniform2f(h,t.u_merc_center),u_image0:new a.Uniform1i(h,t.u_image0),u_grid_matrix:new a.UniformMatrix3f(h,t.u_grid_matrix),u_frustum_tl:new a.Uniform3f(h,t.u_frustum_tl),u_frustum_tr:new a.Uniform3f(h,t.u_frustum_tr),u_frustum_br:new a.Uniform3f(h,t.u_frustum_br),u_frustum_bl:new a.Uniform3f(h,t.u_frustum_bl),u_globe_pos:new a.Uniform3f(h,t.u_globe_pos),u_globe_radius:new a.Uniform1f(h,t.u_globe_radius),u_viewport:new a.Uniform2f(h,t.u_viewport)}),globeAtmosphere:(h,t)=>({u_frustum_tl:new a.Uniform3f(h,t.u_frustum_tl),u_frustum_tr:new a.Uniform3f(h,t.u_frustum_tr),u_frustum_br:new a.Uniform3f(h,t.u_frustum_br),u_frustum_bl:new a.Uniform3f(h,t.u_frustum_bl),u_horizon:new a.Uniform1f(h,t.u_horizon),u_transition:new a.Uniform1f(h,t.u_transition),u_fadeout_range:new a.Uniform1f(h,t.u_fadeout_range),u_color:new a.Uniform4f(h,t.u_color),u_high_color:new a.Uniform4f(h,t.u_high_color),u_space_color:new a.Uniform4f(h,t.u_space_color),u_star_intensity:new a.Uniform1f(h,t.u_star_intensity),u_star_density:new a.Uniform1f(h,t.u_star_density),u_star_size:new a.Uniform1f(h,t.u_star_size),u_temporal_offset:new a.Uniform1f(h,t.u_temporal_offset),u_horizon_angle:new a.Uniform1f(h,t.u_horizon_angle),u_rotation_matrix:new a.UniformMatrix4f(h,t.u_rotation_matrix)})};let Vl;function Id(h,t,l,p,_,y,b){const T=h.context,C=T.gl,M=h.transform,z=h.useProgram("collisionBox"),R=[];let F=0,j=0;for(let te=0;te<p.length;te++){const Y=p[te],J=t.getTile(Y),se=J.getBucket(l);if(!se)continue;const be=$i(Y,se,M);let Se=be;_[0]===0&&_[1]===0||(Se=h.translatePosMatrix(be,J,_,y));const Te=b?se.textCollisionBox:se.iconCollisionBox,ve=se.collisionCircleArray;if(ve.length>0){const ee=a.create(),De=Se;a.mul(ee,se.placementInvProjMatrix,M.glCoordMatrix),a.mul(ee,ee,se.placementViewportMatrix),R.push({circleArray:ve,circleOffset:j,transform:De,invTransform:ee,projection:se.getProjection()}),F+=ve.length/4,j=F}Te&&(h.terrain&&h.terrain.setupElevationDraw(J,z),z.draw(T,C.LINES,a.DepthMode.disabled,a.StencilMode.disabled,h.colorModeForRenderPass(),a.CullFaceMode.disabled,xu(Se,M,J,se.getProjection()),l.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,M.zoom,null,Te.collisionVertexBuffer,Te.collisionVertexBufferExt))}if(!b||!R.length)return;const G=h.useProgram("collisionCircle"),N=new a.StructArrayLayout2f1f2i16;N.resize(4*F),N._trim();let K=0;for(const te of R)for(let Y=0;Y<te.circleArray.length/4;Y++){const J=4*Y,se=te.circleArray[J+0],be=te.circleArray[J+1],Se=te.circleArray[J+2],Te=te.circleArray[J+3];N.emplace(K++,se,be,Se,Te,0),N.emplace(K++,se,be,Se,Te,1),N.emplace(K++,se,be,Se,Te,2),N.emplace(K++,se,be,Se,Te,3)}(!Vl||Vl.length<2*F)&&(Vl=function(te){const Y=2*te,J=new a.StructArrayLayout3ui6;J.resize(Y),J._trim();for(let se=0;se<Y;se++){const be=6*se;J.uint16[be+0]=4*se+0,J.uint16[be+1]=4*se+1,J.uint16[be+2]=4*se+2,J.uint16[be+3]=4*se+2,J.uint16[be+4]=4*se+3,J.uint16[be+5]=4*se+0}return J}(F));const V=T.createIndexBuffer(Vl,!0),Z=T.createVertexBuffer(N,a.collisionCircleLayout.members,!0);for(const te of R){const Y={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(q=M).getCameraToCenterDistance(te.projection),u_viewport_size:[q.width,q.height]};G.draw(T,C.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,h.colorModeForRenderPass(),a.CullFaceMode.disabled,Y,l.id,Z,V,a.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,M.zoom)}var q;Z.destroy(),V.destroy()}const Ad=a.create();function Dm(h,t,l,p,_,y){const{horizontalAlign:b,verticalAlign:T}=a.getAnchorAlignment(h),C=-(b-.5)*t,M=-(T-.5)*l,z=a.evaluateVariableOffset(h,p);return new a.pointGeometry((C/_+z[0])*y,(M/_+z[1])*y)}function Lm(h,t,l,p,_,y,b,T,C,M,z){const R=h.text.placedSymbolArray,F=h.text.dynamicLayoutVertexArray,j=h.icon.dynamicLayoutVertexArray,G={},N=Cl(T,h.getProjection(),y),K=y.elevation,V=h.getProjection().upVectorScale(T.canonical,y.center.lat,y.worldSize);F.clear();for(let Z=0;Z<R.length;Z++){const q=R.get(Z),te=h.allowVerticalPlacement&&!q.placedOrientation,Y=q.hidden||!q.crossTileID||te?null:p[q.crossTileID];if(Y){const J=new a.pointGeometry(q.tileAnchorX,q.tileAnchorY),se=h.getProjection().upVector(T.canonical,J.x,J.y),be=K?K.getAtTileOffset(T,J.x,J.y):0,Se=Vn([q.projectedAnchorX+be*se[0]*V.metersToTile,q.projectedAnchorY+be*se[1]*V.metersToTile,q.projectedAnchorZ+be*se[2]*V.metersToTile],l?N:b),Te=ds(y.getCameraToCenterDistance(h.getProjection()),Se.signedDistanceFromCamera);let ve=_.evaluateSizeForFeature(h.textSizeData,M,q)*Te/a.ONE_EM;l&&(ve*=h.tilePixelRatio/C);const{width:ee,height:De,anchor:Pe,textOffset:We,textScale:Ie}=Y,at=Dm(Pe,ee,De,We,Ie,ve);let qe;if(l){const Ve=J.add(at),{x:$e,y:yt,z:ut}=h.getProjection().projectTilePoint(Ve.x,Ve.y,T.canonical);qe=Vn([$e+be*se[0]*V.metersToTile,yt+be*se[1]*V.metersToTile,ut+be*se[2]*V.metersToTile],b).point}else{const Ve=t?at.rotate(-y.angle):at;qe=[Se.point[0]+Ve.x,Se.point[1]+Ve.y,0]}const Ze=h.allowVerticalPlacement&&q.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Ve=0;Ve<q.numGlyphs;Ve++)a.addDynamicAttributes(F,qe[0],qe[1],qe[2],Ze);z&&q.associatedIconIndex>=0&&(G[q.associatedIconIndex]={shiftedAnchor:qe,angle:Ze})}else Br(q.numGlyphs,F)}if(z){j.clear();const Z=h.icon.placedSymbolArray;for(let q=0;q<Z.length;q++){const te=Z.get(q);if(te.hidden)Br(te.numGlyphs,j);else{const Y=G[q];if(Y)for(let J=0;J<te.numGlyphs;J++)a.addDynamicAttributes(j,Y.shiftedAnchor[0],Y.shiftedAnchor[1],Y.shiftedAnchor[2],Y.angle);else Br(te.numGlyphs,j)}}h.icon.dynamicLayoutVertexBuffer.updateData(j)}h.text.dynamicLayoutVertexBuffer.updateData(F)}function Eu(h,t,l){return l.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function jl(h,t,l,p,_,y,b,T,C,M,z,R){const F=h.context,j=F.gl,G=h.transform,N=T==="map",K=C==="map",V=N&&l.layout.get("symbol-placement")!=="point",Z=N&&!K&&!V,q=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let te=!1;const Y=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),J=[a.mercatorXfromLng(G.center.lng),a.mercatorYfromLat(G.center.lat)],se=l.layout.get("text-variable-anchor"),be=G.projection.name==="globe",Se=[],Te=[0,-1,0];let ve=Te;!be&&!G.mercatorFromTransition||N||(ve=function(ee){const De=ee._camera.getWorldToCamera(ee.worldSize,1),Pe=a.multiply([],De,ee.globeMatrix);a.invert(Pe,Pe);const We=[0,0,0],Ie=[0,1,0,0];return a.transformMat4$1(Ie,Ie,Pe),We[0]=Ie[0],We[1]=Ie[1],We[2]=Ie[2],a.normalize(We,We),We}(G));for(const ee of p){const De=t.getTile(ee),Pe=De.getBucket(l);if(!Pe||Pe.projection.name==="mercator"&&be)continue;const We=_?Pe.text:Pe.icon;if(!We||Pe.fullyClipped||!We.segments.get().length)continue;const Ie=We.programConfigurations.get(l.id),at=_||Pe.sdfIcons,qe=_?Pe.textSizeData:Pe.iconSizeData,Ze=K||G.pitch!==0,Ve=a.evaluateSizeForZoom(qe,G.zoom);let $e,yt,ut,St,ot=[0,0],bt=null;if(_){if(yt=De.glyphAtlasTexture,ut=j.LINEAR,$e=De.glyphAtlasTexture.size,Pe.iconsInText){ot=De.imageAtlasTexture.size,bt=De.imageAtlasTexture;const zr=qe.kind==="composite"||qe.kind==="camera";St=Ze||h.options.rotating||h.options.zooming||zr?j.LINEAR:j.NEAREST}}else{const zr=l.layout.get("icon-size").constantOr(0)!==1||Pe.iconsNeedLinear;yt=De.imageAtlasTexture,ut=at||h.options.rotating||h.options.zooming||zr||Ze?j.LINEAR:j.NEAREST,$e=De.imageAtlasTexture.size}const $t=Pe.projection.name==="globe",Ht=$t?ve:Te,Er=$t?a.globeToMercatorTransition(G.zoom):0,er=Cl(ee,Pe.getProjection(),G),zi=G.calculatePixelsToTileUnitsMatrix(De),Tn=At(er,De.tileID.canonical,K,N,G,Pe.getProjection(),zi),Zn=h.terrain&&K&&V?a.invert(a.create(),Tn):Ad,ar=Po(er,De.tileID.canonical,K,N,G,Pe.getProjection(),zi),ur=se&&Pe.hasTextData(),Zt=l.layout.get("icon-text-fit")!=="none"&&ur&&Pe.hasIconData();if(V){const zr=G.elevation,En=zr?zr.getAtTileOffsetFunc(ee,G.center.lat,G.worldSize,Pe.getProjection()):$a=>[0,0,0],qn=sn(er,De.tileID.canonical,K,N,G,Pe.getProjection(),zi);ji(Pe,er,h,_,qn,ar,K,M,En,ee)}const kr=V||_&&se||Zt,Hr=h.translatePosMatrix(er,De,y,b),Ot=kr?Ad:Tn,_i=h.translatePosMatrix(ar,De,y,b,!0),jo=Pe.getProjection().createInversionMatrix(G,ee.canonical),cn=[];h.terrain&&K&&cn.push("PITCH_WITH_MAP_TERRAIN"),$t&&cn.push("PROJECTION_GLOBE_VIEW"),kr&&cn.push("PROJECTED_POS_ON_VIEWPORT");const Ms=at&&l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ks;ks=at?Pe.iconsInText?Sd(qe.kind,Ve,Z,K,h,Hr,Ot,_i,$e,ot,ee,Er,J,jo,Ht,Pe.getProjection()):Ed(qe.kind,Ve,Z,K,h,Hr,Ot,_i,_,$e,!0,ee,Er,J,jo,Ht,Pe.getProjection()):Pa(qe.kind,Ve,Z,K,h,Hr,Ot,_i,_,$e,ee,Er,J,jo,Ht,Pe.getProjection());const lo={program:h.useProgram(Eu(at,_,Pe),Ie,cn),buffers:We,uniformValues:ks,atlasTexture:yt,atlasTextureIcon:bt,atlasInterpolation:ut,atlasInterpolationIcon:St,isSDF:at,hasHalo:Ms,tile:De,labelPlaneMatrixInv:Zn};if(q&&Pe.canOverlap){te=!0;const zr=We.segments.get();for(const En of zr)Se.push({segments:new a.SegmentVector([En]),sortKey:En.sortKey,state:lo})}else Se.push({segments:We.segments,sortKey:0,state:lo})}te&&Se.sort((ee,De)=>ee.sortKey-De.sortKey);for(const ee of Se){const De=ee.state;if(h.terrain&&h.terrain.setupElevationDraw(De.tile,De.program,{useDepthForOcclusion:!be,labelPlaneMatrixInv:De.labelPlaneMatrixInv}),F.activeTexture.set(j.TEXTURE0),De.atlasTexture.bind(De.atlasInterpolation,j.CLAMP_TO_EDGE),De.atlasTextureIcon&&(F.activeTexture.set(j.TEXTURE1),De.atlasTextureIcon&&De.atlasTextureIcon.bind(De.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),De.isSDF){const Pe=De.uniformValues;De.hasHalo&&(Pe.u_is_halo=1,Su(De.buffers,ee.segments,l,h,De.program,Y,z,R,Pe)),Pe.u_is_halo=0}Su(De.buffers,ee.segments,l,h,De.program,Y,z,R,De.uniformValues)}}function Su(h,t,l,p,_,y,b,T,C){const M=p.context;_.draw(M,M.gl.TRIANGLES,y,b,T,a.CullFaceMode.disabled,C,l.id,h.layoutVertexBuffer,h.indexBuffer,t,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer)}function Cu(h,t,l,p,_,y,b){const T=h.context.gl,C=l.paint.get("fill-pattern"),M=C&&C.constantOr(1),z=l.getCrossfadeParameters();let R,F,j,G,N;b?(F=M&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=T.LINES):(F=M?"fillPattern":"fill",R=T.TRIANGLES);for(const K of p){const V=t.getTile(K);if(M&&!V.patternsLoaded())continue;const Z=V.getBucket(l);if(!Z)continue;h.prepareDrawTile();const q=Z.programConfigurations.get(l.id),te=h.useProgram(F,q);M&&(h.context.activeTexture.set(T.TEXTURE0),V.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),q.updatePaintBuffers(z));const Y=C.constantOr(null);if(Y&&V.imageAtlas){const se=V.imageAtlas,be=se.patternPositions[Y.to.toString()],Se=se.patternPositions[Y.from.toString()];be&&Se&&q.setConstantPatternPositions(be,Se)}const J=h.translatePosMatrix(K.projMatrix,V,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(b){G=Z.indexBuffer2,N=Z.segments2;const se=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];j=F==="fillOutlinePattern"&&M?gu(J,h,z,V,se):Ul(J,se)}else G=Z.indexBuffer,N=Z.segments,j=M?_u(J,h,z,V):vs(J);h.prepareDrawProgram(h.context,te,K.toUnwrapped()),te.draw(h.context,R,_,h.stencilModeForClipping(K),y,a.CullFaceMode.disabled,j,l.id,Z.layoutVertexBuffer,G,N,l.paint,h.transform.zoom,q)}}function Gl(h,t,l,p,_,y,b){const T=h.context,C=T.gl,M=h.transform,z=l.paint.get("fill-extrusion-pattern"),R=z.constantOr(1),F=l.getCrossfadeParameters(),j=l.paint.get("fill-extrusion-opacity"),G=M.projection.name==="globe"?a.fillExtrusionHeightLift():0,N=M.projection.name==="globe",K=N?a.globeToMercatorTransition(M.zoom):0,V=[a.mercatorXfromLng(M.center.lng),a.mercatorYfromLat(M.center.lat)],Z=[];N&&Z.push("PROJECTION_GLOBE_VIEW");for(const q of p){const te=t.getTile(q),Y=te.getBucket(l);if(!Y||Y.projection.name!==M.projection.name)continue;const J=Y.programConfigurations.get(l.id),se=h.useProgram(R?"fillExtrusionPattern":"fillExtrusion",J,Z);if(h.terrain){const De=h.terrain;if(h.style.terrainSetForDrapingOnly())De.setupElevationDraw(te,se,{useMeterToDem:!0});else{if(!Y.enableTerrain)continue;if(De.setupElevationDraw(te,se,{useMeterToDem:!0}),Iu(T,t,q,Y,l,De),!Y.centroidVertexBuffer){const Pe=se.attributes.a_centroid_pos;Pe!==void 0&&C.vertexAttrib2f(Pe,0,0)}}}R&&(h.context.activeTexture.set(C.TEXTURE0),te.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),J.updatePaintBuffers(F));const be=z.constantOr(null);if(be&&te.imageAtlas){const De=te.imageAtlas,Pe=De.patternPositions[be.to.toString()],We=De.patternPositions[be.from.toString()];Pe&&We&&J.setConstantPatternPositions(Pe,We)}const Se=h.translatePosMatrix(q.projMatrix,te,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Te=M.projection.createInversionMatrix(M,q.canonical),ve=l.paint.get("fill-extrusion-vertical-gradient"),ee=R?ka(Se,h,ve,j,q,F,te,G,K,V,Te):vd(Se,h,ve,j,q,G,K,V,Te);h.prepareDrawProgram(T,se,q.toUnwrapped()),se.draw(T,T.gl.TRIANGLES,_,y,b,a.CullFaceMode.backCCW,ee,l.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,l.paint,h.transform.zoom,J,h.terrain?Y.centroidVertexBuffer:null,N?Y.layoutVertexExtBuffer:null)}}function Iu(h,t,l,p,_,y){const b=[V=>{let Z=V.canonical.x-1,q=V.wrap;return Z<0&&(Z=(1<<V.canonical.z)-1,q--),new a.OverscaledTileID(V.overscaledZ,q,V.canonical.z,Z,V.canonical.y)},V=>{let Z=V.canonical.x+1,q=V.wrap;return Z===1<<V.canonical.z&&(Z=0,q++),new a.OverscaledTileID(V.overscaledZ,q,V.canonical.z,Z,V.canonical.y)},V=>new a.OverscaledTileID(V.overscaledZ,V.wrap,V.canonical.z,V.canonical.x,(V.canonical.y===0?1<<V.canonical.z:V.canonical.y)-1),V=>new a.OverscaledTileID(V.overscaledZ,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y===(1<<V.canonical.z)-1?0:V.canonical.y+1)],T=V=>{const Z=t.getSource().minzoom,q=Y=>{const J=t.getTileByID(Y);if(J&&J.hasData())return J.getBucket(_)},te=[0,-1,1];for(const Y of te){if(V.overscaledZ+Y<Z)continue;const J=q(V.calculateScaledKey(V.overscaledZ+Y));if(J)return J}},C=[0,0,0],M=(V,Z)=>(C[0]=Math.min(V.min.y,Z.min.y),C[1]=Math.max(V.max.y,Z.max.y),C[2]=a.EXTENT-Z.min.x>V.max.x?Z.min.x-a.EXTENT:V.max.x,C),z=(V,Z)=>(C[0]=Math.min(V.min.x,Z.min.x),C[1]=Math.max(V.max.x,Z.max.x),C[2]=a.EXTENT-Z.min.y>V.max.y?Z.min.y-a.EXTENT:V.max.y,C),R=[(V,Z)=>M(V,Z),(V,Z)=>M(Z,V),(V,Z)=>z(V,Z),(V,Z)=>z(Z,V)],F=new a.pointGeometry(0,0);let j,G,N;const K=(V,Z,q,te,Y)=>{const J=[[te?q:V,te?V:q,0],[te?q:Z,te?Z:q,0]],se=Y<0?a.EXTENT+Y:Y,be=[te?se:(V+Z)/2,te?(V+Z)/2:se,0];return q===0&&Y<0||q!==0&&Y>0?y.getForTilePoints(N,[be],!0,G):J.push(be),y.getForTilePoints(l,J,!0,j),Math.max(J[0][2],J[1][2],be[2])/y.exaggeration()};for(let V=0;V<4;V++){const Z=(V<2?1:5)-V,q=p.borders[V];if(q.length===0)continue;const te=N=b[V](l),Y=T(te);if(!(Y&&Y instanceof a.FillExtrusionBucket&&Y.enableTerrain)||p.borderDoneWithNeighborZ[V]===Y.canonical.z&&Y.borderDoneWithNeighborZ[Z]===p.canonical.z||(G=y.findDEMTileFor(te),!G||!G.dem))continue;if(!j){const Se=y.findDEMTileFor(l);if(!Se||!Se.dem)return;j=Se}const J=Y.borders[Z];let se=0;const be=Y.borderDoneWithNeighborZ[Z]!==p.canonical.z;if(p.canonical.z===Y.canonical.z){for(let Se=0;Se<q.length;Se++){const Te=p.featuresOnBorder[q[Se]],ve=Te.borders[V];let ee;for(;se<J.length&&(ee=Y.featuresOnBorder[J[se]],!(ee.borders[Z][1]>ve[0]+3));)be&&Y.encodeCentroid(void 0,ee,!1),se++;if(ee&&se<J.length){const De=se;let Pe=0;for(;!(ee.borders[Z][0]>ve[1]-3)&&(Pe++,++se!==J.length);)ee=Y.featuresOnBorder[J[se]];if(ee=Y.featuresOnBorder[J[De]],Te.intersectsCount()>1||ee.intersectsCount()>1||Pe!==1){Pe!==1&&(se=De),p.encodeCentroid(void 0,Te,!1),be&&Y.encodeCentroid(void 0,ee,!1);continue}const We=R[V](Te,ee),Ie=V%2?a.EXTENT-1:0;F.x=K(We[0],Math.min(a.EXTENT-1,We[1]),Ie,V<2,We[2]),F.y=0,p.encodeCentroid(F,Te,!1),be&&Y.encodeCentroid(F,ee,!1)}else p.encodeCentroid(void 0,Te,!1)}p.borderDoneWithNeighborZ[V]=Y.canonical.z,p.needsCentroidUpdate=!0,be&&(Y.borderDoneWithNeighborZ[Z]=p.canonical.z,Y.needsCentroidUpdate=!0)}else{for(const Se of q)p.encodeCentroid(void 0,p.featuresOnBorder[Se],!1);if(be){for(const Se of J)Y.encodeCentroid(void 0,Y.featuresOnBorder[Se],!1);Y.borderDoneWithNeighborZ[Z]=p.canonical.z,Y.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[V]=Y.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(h)}const Bo=new a.Color(1,0,0,1),Da=new a.Color(0,1,0,1),Md=new a.Color(0,0,1,1),bs=new a.Color(1,0,1,1),Ts=new a.Color(0,1,1,1);function Au(h,t,l,p){Nt(h,0,t+l/2,h.transform.width,l,p)}function $l(h,t,l,p){Nt(h,t-l/2,0,l,h.transform.height,p)}function Nt(h,t,l,p,_,y){const b=h.context,T=b.gl;T.enable(T.SCISSOR_TEST),T.scissor(t*a.exported.devicePixelRatio,l*a.exported.devicePixelRatio,p*a.exported.devicePixelRatio,_*a.exported.devicePixelRatio),b.clear({color:y}),T.disable(T.SCISSOR_TEST)}function Zl(h,t,l){const p=h.context,_=p.gl,y=h.transform.projection.name==="globe",b=l.projMatrix,T=h.useProgram("debug",null,y?["PROJECTION_GLOBE_VIEW"]:null),C=t.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(C,T);const M=a.DepthMode.disabled,z=a.StencilMode.disabled,R=h.colorModeForRenderPass(),F="$debug";p.activeTexture.set(_.TEXTURE0),h.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),y?C._makeGlobeTileDebugBuffers(h.context,h.transform.projection):C._makeDebugTileBoundsBuffers(h.context,h.transform.projection);const j=C._tileDebugBuffer||h.debugBuffer,G=C._tileDebugIndexBuffer||h.debugIndexBuffer,N=C._tileDebugSegments||h.debugSegments;T.draw(p,_.LINE_STRIP,M,z,R,a.CullFaceMode.disabled,vu(b,a.Color.red),F,j,G,N,null,null,null,C._globeTileDebugBorderBuffer);const K=C.latestRawTileData,V=Math.floor((K&&K.byteLength||0)/1024),Z=t.getTile(l).tileSize,q=512/Math.min(Z,512)*(l.overscaledZ/h.transform.zoom)*.5;let te=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(te+=` => ${l.overscaledZ}`),function(be,Se){be.initDebugOverlayCanvas();const Te=be.debugOverlayCanvas,ve=be.context.gl,ee=be.debugOverlayCanvas.getContext("2d");ee.clearRect(0,0,Te.width,Te.height),ee.shadowColor="white",ee.shadowBlur=2,ee.lineWidth=1.5,ee.strokeStyle="white",ee.textBaseline="top",ee.font="bold 36px Open Sans, sans-serif",ee.fillText(Se,5,5),ee.strokeText(Se,5,5),be.debugOverlayTexture.update(Te),be.debugOverlayTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}(h,`${te} ${V}kb`);const Y=C._tileDebugTextBuffer||h.debugBuffer,J=C._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,se=C._tileDebugTextSegments||h.debugSegments;T.draw(p,_.TRIANGLES,M,z,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,vu(b,a.Color.transparent,q),F,Y,J,se,null,null,null,C._globeTileDebugTextBuffer)}const Rm=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:kd}=Rm;function Zi(h,t,l,p){h.emplaceBack(t,l,p)}class zd{constructor(t){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Zi(this.vertexArray,-1,-1,1),Zi(this.vertexArray,1,-1,1),Zi(this.vertexArray,-1,1,1),Zi(this.vertexArray,1,1,1),Zi(this.vertexArray,-1,-1,-1),Zi(this.vertexArray,1,-1,-1),Zi(this.vertexArray,-1,1,-1),Zi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,kd),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Es(h,t,l,p,_,y){const b=h.gl,T=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),M=t.paint.get("sky-atmosphere-sun-intensity"),z=((R,F,j,G,N)=>({u_matrix_3f:R,u_sun_direction:F,u_sun_intensity:j,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[N.r,N.g,N.b,N.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),p),_,M,T,C);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),l.draw(h,b.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,z,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Pd=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Bm{constructor(t){const l=new a.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new a.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(l,Pd.members),this.indexBuffer=t.createIndexBuffer(p),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ql={symbol:function(h,t,l,p,_){if(h.renderPass!=="translucent")return;const y=a.StencilMode.disabled,b=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(T,C,M,z,R,F,j){const G=C.transform,N=R==="map",K=F==="map";for(const V of T){const Z=z.getTile(V),q=Z.getBucket(M);if(!q||!q.text||!q.text.segments.get().length)continue;const te=a.evaluateSizeForZoom(q.textSizeData,G.zoom),Y=Cl(V,q.getProjection(),G),J=G.calculatePixelsToTileUnitsMatrix(Z),se=At(Y,Z.tileID.canonical,K,N,G,q.getProjection(),J),be=M.layout.get("icon-text-fit")!=="none"&&q.hasIconData();if(te){const Se=Math.pow(2,G.zoom-Z.tileID.overscaledZ);Lm(q,N,K,j,a.symbolSize,G,se,V,Se,te,be)}}}(p,h,l,t,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),l.paint.get("icon-opacity").constantOr(1)!==0&&jl(h,t,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),y,b),l.paint.get("text-opacity").constantOr(1)!==0&&jl(h,t,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),y,b),t.map.showCollisionBoxes&&(Id(h,t,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Id(h,t,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,l,p){if(h.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),y=l.paint.get("circle-stroke-width"),b=l.paint.get("circle-stroke-opacity"),T=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const C=h.context,M=C.gl,z=h.transform,R=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),F=a.StencilMode.disabled,j=h.colorModeForRenderPass(),G=z.projection.name==="globe",N=[a.mercatorXfromLng(z.center.lng),a.mercatorYfromLat(z.center.lat)],K=[];for(let Z=0;Z<p.length;Z++){const q=p[Z],te=t.getTile(q),Y=te.getBucket(l);if(!Y||Y.projection.name!==z.projection.name)continue;const J=Y.programConfigurations.get(l.id),se=wd(l);G&&se.push("PROJECTION_GLOBE_VIEW");const be=h.useProgram("circle",J,se),Se=Y.layoutVertexBuffer,Te=Y.globeExtVertexBuffer,ve=Y.indexBuffer,ee=z.projection.createInversionMatrix(z,q.canonical),De={programConfiguration:J,program:be,layoutVertexBuffer:Se,globeExtVertexBuffer:Te,indexBuffer:ve,uniformValues:yu(h,q,te,ee,N,l),tile:te};if(T){const Pe=Y.segments.get();for(const We of Pe)K.push({segments:new a.SegmentVector([We]),sortKey:We.sortKey,state:De})}else K.push({segments:Y.segments,sortKey:0,state:De})}T&&K.sort((Z,q)=>Z.sortKey-q.sortKey);const V={useDepthForOcclusion:!G};for(const Z of K){const{programConfiguration:q,program:te,layoutVertexBuffer:Y,globeExtVertexBuffer:J,indexBuffer:se,uniformValues:be,tile:Se}=Z.state,Te=Z.segments;h.terrain&&h.terrain.setupElevationDraw(Se,te,V),h.prepareDrawProgram(C,te,Se.tileID.toUnwrapped()),te.draw(C,M.TRIANGLES,R,F,j,a.CullFaceMode.disabled,be,l.id,Y,se,Te,l.paint,z.zoom,q,G?J:null)}},heatmap:function(h,t,l,p){if(l.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,y=_.gl,b=a.StencilMode.disabled,T=new a.ColorMode([y.ONE,y.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(j,G,N,K){const V=j.gl,Z=G.width*K,q=G.height*K;j.activeTexture.set(V.TEXTURE1),j.viewport.set([0,0,Z,q]);let te=N.heatmapFbo;if(!te||te&&(te.width!==Z||te.height!==q)){te&&te.destroy();const Y=V.createTexture();V.bindTexture(V.TEXTURE_2D,Y),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),te=N.heatmapFbo=j.createFramebuffer(Z,q,!1),function(J,se,be,Se,Te,ve){const ee=J.gl;ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,Te,ve,0,ee.RGBA,J.extRenderToTextureHalfFloat?J.extTextureHalfFloat.HALF_FLOAT_OES:ee.UNSIGNED_BYTE,null),Se.colorAttachment.set(be)}(j,0,Y,te,Z,q)}else V.bindTexture(V.TEXTURE_2D,te.colorAttachment.get()),j.bindFramebuffer.set(te.framebuffer)})(_,h,l,h.transform.projection.name==="globe"?.5:.25),_.clear({color:a.Color.transparent});const C=h.transform,M=C.projection.name==="globe",z=M?["PROJECTION_GLOBE_VIEW"]:null,R=M?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,F=[a.mercatorXfromLng(C.center.lng),a.mercatorYfromLat(C.center.lat)];for(let j=0;j<p.length;j++){const G=p[j];if(t.hasRenderableParent(G))continue;const N=t.getTile(G),K=N.getBucket(l);if(!K||K.projection.name!==C.projection.name)continue;const V=K.programConfigurations.get(l.id),Z=h.useProgram("heatmap",V,z),{zoom:q}=h.transform;h.terrain&&h.terrain.setupElevationDraw(N,Z),h.prepareDrawProgram(_,Z,G.toUnwrapped());const te=C.projection.createInversionMatrix(C,G.canonical);Z.draw(_,y.TRIANGLES,a.DepthMode.disabled,b,T,R,Mm(h,G,N,te,F,q,l.paint.get("heatmap-intensity")),l.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,l.paint,h.transform.zoom,V,M?K.globeExtVertexBuffer:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,y){const b=_.context,T=b.gl,C=y.heatmapFbo;if(!C)return;b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,C.colorAttachment.get()),b.activeTexture.set(T.TEXTURE1);let M=y.colorRampTexture;M||(M=y.colorRampTexture=new a.Texture(b,y.colorRamp,T.RGBA)),M.bind(T.LINEAR,T.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(b,T.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,_.colorModeForRenderPass(),a.CullFaceMode.disabled,((z,R,F,j)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(h,l))},line:function(h,t,l,p){if(h.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),y=l.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const b=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),C=h.terrain&&h.terrain.renderingToTexture?1:a.exported.devicePixelRatio,M=l.paint.get("line-dasharray"),z=M.constantOr(1),R=l.layout.get("line-cap"),F=l.paint.get("line-pattern"),j=F.constantOr(1),G=l.paint.get("line-gradient"),N=l.getCrossfadeParameters(),K=j?"linePattern":"line",V=h.context,Z=V.gl,q=(Y=>{const J=[];Nl(Y)&&J.push("RENDER_LINE_DASH"),Y.paint.get("line-gradient")&&J.push("RENDER_LINE_GRADIENT");const se=Y.paint.get("line-trim-offset");se[0]===0&&se[1]===0||J.push("RENDER_LINE_TRIM_OFFSET");const be=Y.paint.get("line-pattern").constantOr(1),Se=Y.paint.get("line-opacity").constantOr(1)!==1;return!be&&Se&&J.push("RENDER_LINE_ALPHA_DISCARD"),J})(l);let te=q.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(te=!1);for(const Y of p){const J=t.getTile(Y);if(j&&!J.patternsLoaded())continue;const se=J.getBucket(l);if(!se)continue;h.prepareDrawTile();const be=se.programConfigurations.get(l.id),Se=h.useProgram(K,be,q),Te=F.constantOr(null);if(Te&&J.imageAtlas){const qe=J.imageAtlas,Ze=qe.patternPositions[Te.to.toString()],Ve=qe.patternPositions[Te.from.toString()];Ze&&Ve&&be.setConstantPatternPositions(Ze,Ve)}const ve=M.constantOr(null),ee=R.constantOr(null);if(!j&&ve&&ee&&J.lineAtlas){const qe=J.lineAtlas,Ze=qe.getDash(ve.to,ee),Ve=qe.getDash(ve.from,ee);Ze&&Ve&&be.setConstantPatternPositions(Ze,Ve)}let[De,Pe]=l.paint.get("line-trim-offset");(ee==="round"||ee==="square")&&De!==Pe&&(De===0&&(De-=1),Pe===1&&(Pe+=1));const We=h.terrain?Y.projMatrix:null,Ie=j?km(h,J,l,N,We,C):bu(h,J,l,N,We,se.lineClipsArray.length,C,[De,Pe]);if(G){const qe=se.gradients[l.id];let Ze=qe.texture;if(l.gradientVersion!==qe.version){let Ve=256;if(l.stepInterpolant){const $e=t.getSource().maxzoom,yt=Y.canonical.z===$e?Math.ceil(1<<h.transform.maxZoom-Y.canonical.z):1;Ve=a.clamp(a.nextPowerOfTwo(se.maxLineLength/a.EXTENT*1024*yt),256,V.maxTextureSize)}qe.gradient=a.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ve,image:qe.gradient||void 0,clips:se.lineClipsArray}),qe.texture?qe.texture.update(qe.gradient):qe.texture=new a.Texture(V,qe.gradient,Z.RGBA),qe.version=l.gradientVersion,Ze=qe.texture}V.activeTexture.set(Z.TEXTURE1),Ze.bind(l.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}z&&(V.activeTexture.set(Z.TEXTURE0),J.lineAtlasTexture.bind(Z.LINEAR,Z.REPEAT),be.updatePaintBuffers(N)),j&&(V.activeTexture.set(Z.TEXTURE0),J.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),be.updatePaintBuffers(N)),h.prepareDrawProgram(V,Se,Y.toUnwrapped());const at=qe=>{Se.draw(V,Z.TRIANGLES,b,qe,T,a.CullFaceMode.disabled,Ie,l.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,l.paint,h.transform.zoom,be,se.layoutVertexBuffer2)};if(te){const qe=h.stencilModeForClipping(Y).ref;qe===0&&h.terrain&&V.clear({stencil:0});const Ze={func:Z.EQUAL,mask:255};Ie.u_alpha_discard_threshold=.8,at(new a.StencilMode(Ze,qe,255,Z.KEEP,Z.KEEP,Z.INVERT)),Ie.u_alpha_discard_threshold=0,at(new a.StencilMode(Ze,qe,255,Z.KEEP,Z.KEEP,Z.KEEP))}else at(h.stencilModeForClipping(Y))}te&&(h.resetStencilClippingMasks(),h.terrain&&V.clear({stencil:0}))},fill:function(h,t,l,p){const _=l.paint.get("fill-color"),y=l.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=h.colorModeForRenderPass(),T=l.paint.get("fill-pattern"),C=h.opaquePassEnabledForLayer()&&!T.constantOr(1)&&_.constantOr(a.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===C){const M=h.depthModeForSublayer(1,h.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Cu(h,t,l,p,M,b,!1)}if(h.renderPass==="translucent"&&l.paint.get("fill-antialias")){const M=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Cu(h,t,l,p,M,b,!0)}},"fill-extrusion":function(h,t,l,p){const _=l.paint.get("fill-extrusion-opacity");if(_!==0&&h.renderPass==="translucent"){const y=new a.DepthMode(h.context.gl.LEQUAL,a.DepthMode.ReadWrite,h.depthRangeFor3D);if(_!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Gl(h,t,l,p,y,a.StencilMode.disabled,a.ColorMode.disabled),Gl(h,t,l,p,y,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const b=h.colorModeForRenderPass();Gl(h,t,l,p,y,a.StencilMode.disabled,b)}}},hillshade:function(h,t,l,p){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const _=h.context,y=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),b=h.colorModeForRenderPass(),T=h.terrain&&h.terrain.renderingToTexture,[C,M]=h.renderPass!=="translucent"||T?[{},p]:h.stencilConfigForOverlap(p);for(const z of M){const R=t.getTile(z);if(R.needsHillshadePrepare&&h.renderPass==="offscreen")Dl(h,R,l,y,a.StencilMode.disabled,b);else if(h.renderPass==="translucent"){const F=T&&h.terrain?h.terrain.stencilModeForRTTOverlap(z):C[z.overscaledZ];gd(h,z,R,l,y,F,b)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,l,p,_,y){if(h.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!p.length)return;const b=h.context,T=b.gl,C=t.getSource(),M=h.useProgram("raster"),z=h.colorModeForRenderPass(),R=h.terrain&&h.terrain.renderingToTexture,[F,j]=C instanceof pe||R?[{},p]:h.stencilConfigForOverlap(p),G=j[j.length-1].overscaledZ,N=!h.options.moving;for(const K of j){const V=R?a.DepthMode.disabled:h.depthModeForSublayer(K.overscaledZ-G,l.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,T.LESS),Z=K.toUnwrapped(),q=t.getTile(K);if(R&&(!q||!q.hasData()))continue;const te=R?K.projMatrix:h.transform.calculateProjMatrix(Z,N),Y=h.terrain&&R?h.terrain.stencilModeForRTTOverlap(K):F[K.overscaledZ],J=y?0:l.paint.get("raster-fade-duration");q.registerFadeDuration(J);const se=t.findLoadedParent(K,0),be=pu(q,se,t,h.transform,J);let Se,Te;h.terrain&&h.terrain.prepareDrawTile();const ve=l.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;b.activeTexture.set(T.TEXTURE0),q.texture.bind(ve,T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE1),se?(se.texture.bind(ve,T.CLAMP_TO_EDGE),Se=Math.pow(2,se.tileID.overscaledZ-q.tileID.overscaledZ),Te=[q.tileID.canonical.x*Se%1,q.tileID.canonical.y*Se%1]):q.texture.bind(ve,T.CLAMP_TO_EDGE);const ee=zm(te,Te||[0,0],Se||1,be,l,C instanceof pe?C.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(b,M,Z),C instanceof pe)C.boundsBuffer&&C.boundsSegments&&M.draw(b,T.TRIANGLES,V,a.StencilMode.disabled,z,a.CullFaceMode.disabled,ee,l.id,C.boundsBuffer,h.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:De,tileBoundsIndexBuffer:Pe,tileBoundsSegments:We}=h.getTileBoundsBuffers(q);M.draw(b,T.TRIANGLES,V,Y,z,a.CullFaceMode.disabled,ee,l.id,De,Pe,We)}}h.resetStencilClippingMasks()},background:function(h,t,l,p){const _=l.paint.get("background-color"),y=l.paint.get("background-opacity");if(y===0)return;const b=h.context,T=b.gl,C=h.transform,M=C.tileSize,z=l.paint.get("background-pattern");if(h.isPatternMissing(z))return;const R=!z&&_.a===1&&y===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==R)return;const F=a.StencilMode.disabled,j=h.depthModeForSublayer(0,R==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),G=h.colorModeForRenderPass(),N=h.useProgram(z?"backgroundPattern":"background");let K,V=p;V||(K=h.getBackgroundTiles(),V=Object.values(K).map(q=>q.tileID)),z&&(b.activeTexture.set(T.TEXTURE0),h.imageManager.bind(h.context));const Z=l.getCrossfadeParameters();for(const q of V){const te=q.toUnwrapped(),Y=p?q.projMatrix:h.transform.calculateProjMatrix(te);h.prepareDrawTile();const J=t?t.getTile(q):K?K[q.key]:new a.Tile(q,M,C.zoom,h),se=z?ws(Y,y,h,z,{tileID:q,tileSize:M},Z):Cd(Y,y,_);h.prepareDrawProgram(b,N,te);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:Se,tileBoundsSegments:Te}=h.getTileBoundsBuffers(J);N.draw(b,T.TRIANGLES,j,F,G,a.CullFaceMode.disabled,se,l.id,be,Se,Te)}},sky:function(h,t,l){const p=h.transform,_=p.projection.name==="mercator"||p.projection.name==="globe"?1:a.smoothstep(7,8,p.zoom),y=l.paint.get("sky-opacity")*_;if(y===0)return;const b=h.context,T=l.paint.get("sky-type"),C=new a.DepthMode(b.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),M=h.frameCounter/1e3%1;T==="atmosphere"?h.renderPass==="offscreen"?l.needsSkyboxCapture(h)&&(function(z,R,F,j){const G=z.context,N=G.gl;let K=R.skyboxFbo;if(!K){K=R.skyboxFbo=G.createFramebuffer(32,32,!1),R.skyboxGeometry=new zd(G),R.skyboxTexture=G.gl.createTexture(),N.bindTexture(N.TEXTURE_CUBE_MAP,R.skyboxTexture),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAG_FILTER,N.LINEAR);for(let te=0;te<6;++te)N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,N.RGBA,32,32,0,N.RGBA,N.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(K.framebuffer),G.viewport.set([0,0,32,32]);const V=R.getCenter(z,!0),Z=z.useProgram("skyboxCapture"),q=new Float64Array(16);a.identity(q),a.rotateY(q,q,.5*-Math.PI),Es(G,R,Z,q,V,0),a.identity(q),a.rotateY(q,q,.5*Math.PI),Es(G,R,Z,q,V,1),a.identity(q),a.rotateX(q,q,.5*-Math.PI),Es(G,R,Z,q,V,2),a.identity(q),a.rotateX(q,q,.5*Math.PI),Es(G,R,Z,q,V,3),a.identity(q),Es(G,R,Z,q,V,4),a.identity(q),a.rotateY(q,q,Math.PI),Es(G,R,Z,q,V,5),G.viewport.set([0,0,z.width,z.height])}(h,l),l.markSkyboxValid(h)):h.renderPass==="sky"&&function(z,R,F,j,G){const N=z.context,K=N.gl,V=z.transform,Z=z.useProgram("skybox");N.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,R.skyboxTexture);const q=((te,Y,J,se,be)=>({u_matrix:te,u_sun_direction:Y,u_cubemap:0,u_opacity:se,u_temporal_offset:be}))(V.skyboxMatrix,R.getCenter(z,!1),0,j,G);z.prepareDrawProgram(N,Z),Z.draw(N,K.TRIANGLES,F,a.StencilMode.disabled,z.colorModeForRenderPass(),a.CullFaceMode.backCW,q,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,l,C,y,M):T==="gradient"&&h.renderPass==="sky"&&function(z,R,F,j,G){const N=z.context,K=N.gl,V=z.transform,Z=z.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new zd(N)),N.activeTexture.set(K.TEXTURE0);let q=R.colorRampTexture;q||(q=R.colorRampTexture=new a.Texture(N,R.colorRamp,K.RGBA)),q.bind(K.LINEAR,K.CLAMP_TO_EDGE);const te=((Y,J,se,be,Se)=>({u_matrix:Y,u_color_ramp:0,u_center_direction:J,u_radius:a.degToRad(se),u_opacity:be,u_temporal_offset:Se}))(V.skyboxMatrix,R.getCenter(z,!1),R.paint.get("sky-gradient-radius"),j,G);z.prepareDrawProgram(N,Z),Z.draw(N,K.TRIANGLES,F,a.StencilMode.disabled,z.colorModeForRenderPass(),a.CullFaceMode.backCW,te,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,l,C,y,M)},debug:function(h,t,l){for(let p=0;p<l.length;p++)Zl(h,t,l[p])},custom:function(h,t,l){const p=h.context,_=l.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(h.renderPass==="offscreen"){const y=_.prerender;y&&(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),y.call(_,p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(a.StencilMode.disabled);const y=_.renderingMode==="3d"?new a.DepthMode(h.context.gl.LEQUAL,a.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,a.DepthMode.ReadOnly);p.setDepthMode(y),_.render(p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}};class Wl{constructor(t,l){this.context=new W(t),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fd,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,l){const p=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fu(this,t));const _=this._terrain;this.transform.elevation=p?_:null,_.update(t,this.transform,l)}_updateFog(t){const l=t.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const y=p+.78*(_-p);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,l){if(this.width=t*a.exported.devicePixelRatio,this.height=l*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const t=this.context,l=new a.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(a.EXTENT,0),l.emplaceBack(0,a.EXTENT),l.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(l,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const p=new a.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(a.EXTENT,0),p.emplaceBack(0,a.EXTENT),p.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(p,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const _=new a.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const y=new a.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(a.EXTENT,0,a.EXTENT,0),y.emplaceBack(0,a.EXTENT,0,a.EXTENT),y.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(y,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const b=new a.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const T=new a.StructArrayLayout1ui2;for(const M of[0,1,3,2,0])T.emplaceBack(M);this.debugIndexBuffer=t.createIndexBuffer(T),this.emptyTexture=new a.Texture(t,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=a.create();const C=this.context.gl;this.stencilClearMode=new a.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new Bm(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,l=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,l.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,Ma(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,l,p){if(!l||this.currentStencilSource===l.id||!t.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const C of p)if(this._tileClippingMaskIDs[C.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=l.id;const _=this.context,y=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(a.ColorMode.disabled),_.setDepthMode(a.DepthMode.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of p){const C=l.getTile(T),M=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:R,tileBoundsSegments:F}=this.getTileBoundsBuffers(C);b.draw(_,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Ma(T.projMatrix),"$clipping",z,R,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,l=this.context.gl;return new a.StencilMode({func:l.NOTEQUAL,mask:255},t,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const l=this.context.gl;return new a.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(t){const l=this.context.gl,p=t.sort((b,T)=>T.overscaledZ-b.overscaledZ),_=p[p.length-1].overscaledZ,y=p[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let T=0;T<y;T++)b[T+_]=new a.StencilMode({func:l.GEQUAL,mask:255},T+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[b,p]}return[{[_]:a.StencilMode.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(t,l,p){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new a.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,l){this.style=t,this.options=l,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const C in _){const M=_[C];M.used&&M.prepare(this.context)}const y={},b={},T={};for(const C in _){const M=_[C];y[C]=M.getVisibleCoordinates(),b[C]=y[C].slice().reverse(),T[C]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<p.length;C++)if(this.style._layers[p[C]].is3D()){this.opaquePassCutoff=C;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),a.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const C of p){const M=this.style._layers[C],z=t._getLayerSourceCache(M);if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const R=z?b[z.id]:void 0;(M.type==="custom"||M.isSky()||R&&R.length)&&this.renderLayer(this,z,M,R)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[p[this.currentLayer]],M=t._getLayerSourceCache(C);if(C.isSky())continue;const z=M?b[M.id]:void 0;this._renderTileClippingMasks(C,M,z),this.renderLayer(this,M,C,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(C,M){const z=C.context,R=z.gl,F=C.transform,j=new a.DepthMode(R.LEQUAL,a.DepthMode.ReadOnly,[0,1]),G=C.useProgram("globeAtmosphere",null,F.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),N=a.globeToMercatorTransition(F.zoom),K=M.properties.get("color").toArray01(),V=M.properties.get("high-color").toArray01(),Z=M.properties.get("space-color").toArray01PremultipliedAlpha(),q=a.identity$1([]);a.rotateY$1(q,q,-a.degToRad(F._center.lng)),a.rotateX$1(q,q,a.degToRad(F._center.lat)),a.rotateZ$1(q,q,F.angle),a.rotateX$1(q,q,-F._pitch);const te=a.fromQuat(new Float32Array(16),q),Y=a.mapValue(M.properties.get("star-intensity"),0,1,0,.25),J=5e-4,se=a.mapValue(M.properties.get("horizon-blend"),0,1,J,.25),be=a.globeUseCustomAntiAliasing(C,z,F)&&se===J?F.worldSize/(2*Math.PI*1.025)-1:F.globeRadius,Se=C.frameCounter/1e3%1,Te=a.length(F.globeCenterInViewSpace),ve=Math.sqrt(Math.pow(Te,2)-Math.pow(be,2)),ee=Math.acos(ve/Te),De=((We,Ie,at,qe,Ze,Ve,$e,yt,ut,St,ot,bt,$t,Ht)=>({u_frustum_tl:We,u_frustum_tr:Ie,u_frustum_br:at,u_frustum_bl:qe,u_horizon:Ze,u_transition:Ve,u_fadeout_range:$e,u_color:yt,u_high_color:ut,u_space_color:St,u_star_intensity:ot,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:bt,u_horizon_angle:$t,u_rotation_matrix:Ht}))(F.frustumCorners.TL,F.frustumCorners.TR,F.frustumCorners.BR,F.frustumCorners.BL,F.frustumCorners.horizon,N,se,K,V,Z,Y,Se,ee,te);C.prepareDrawProgram(z,G);const Pe=C.atmosphereBuffer;Pe&&G.draw(z,R.TRIANGLES,j,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,De,"skybox",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const C=this.style._layers[p[this.currentLayer]],M=t._getLayerSourceCache(C);C.isSky()&&this.renderLayer(this,M,C,M?b[M.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const C=this.style._layers[p[this.currentLayer]],M=t._getLayerSourceCache(C);if(C.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(C)){if(C.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=M?(C.type==="symbol"?T:b)[M.id]:void 0;this._renderTileClippingMasks(C,M,M?y[M.id]:void 0),this.renderLayer(this,M,C,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let C=null;a.values(this.style._layers).forEach(M=>{const z=t._getLayerSourceCache(M);z&&!M.isHidden(this.transform.zoom)&&(!C||C.getSource().maxzoom<z.getSource().maxzoom)&&(C=z)}),C&&this.options.showTileBoundaries&&ql.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const M=C.transform.padding;Au(C,C.transform.height-(M.top||0),3,Bo),Au(C,M.bottom||0,3,Da),$l(C,M.left||0,3,Md),$l(C,C.transform.width-(M.right||0),3,bs);const z=C.transform.centerPoint;(function(R,F,j,G){Nt(R,F-1,j-10,2,20,G),Nt(R,F-10,j-1,20,2,G)})(C,z.x,C.transform.height-z.y,Ts)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}}renderLayer(t,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(p.type)||ql[p.type](t,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,l=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),t.beginQueryEXT(t.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const l={};for(const p in t){const _=t[p],y=this.context.extTimerQuery,b=y.getQueryObjectEXT(_.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(_.query),l[p]=b}return l}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const _ of t)p+=l.getQueryObjectEXT(_,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(_);return p}translatePosMatrix(t,l,p,_,y){if(!p[0]&&!p[1])return t;const b=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(b){const M=Math.sin(b),z=Math.cos(b);p=[p[0]*z-p[1]*M,p[0]*M+p[1]*z]}const T=[y?p[0]:Zr(l,p[0],this.transform.zoom),y?p[1]:Zr(l,p[1],this.transform.zoom),0],C=new Float32Array(16);return a.translate(C,t,T),C}saveTileTexture(t){const l=this._tileTextures[t.size[0]];l?l.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const l=this._tileTextures[t];return l&&l.length>0?l.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const l=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!l||!p}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),l&&!t&&l.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),t&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(t,l,p){this.cache=this.cache||{};const _=p||[],y=this.currentGlobalDefines().concat(_),b=Fl.cacheKey(t,y,l);return this.cache[b]||(this.cache[b]=new Fl(this.context,t,zl[t],l,Pm[t],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const y=_.getOpacity(this.transform.pitch),b=((T,C,M,z,R,F,j,G,N,K,V)=>{const Z=T.transform,q=C.properties.get("color").toArray01();q[3]=z;const te=T.frameCounter/1e3%1;return{u_fog_matrix:M?Z.calculateFogTileMatrix(M):T.identityMat,u_fog_range:C.getFovAdjustedRange(Z._fov),u_fog_color:q,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:te,u_frustum_tl:R,u_frustum_tr:F,u_frustum_br:j,u_frustum_bl:G,u_globe_pos:N,u_globe_radius:K,u_viewport:V,u_globe_transition:a.globeToMercatorTransition(Z.zoom),u_is_globe:+(Z.projection.name==="globe")}})(this,_,p,y,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);l.setFogUniformValues(t,b)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,l=t.createTexture();return t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=t[_.key]||new a.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Oo{constructor(t=0,l=0,p=0,_=0){if(isNaN(t)||t<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=l,this.left=p,this.right=_}interpolate(t,l,p){return l.top!=null&&t.top!=null&&(this.top=a.number(t.top,l.top,p)),l.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,l.bottom,p)),l.left!=null&&t.left!=null&&(this.left=a.number(t.left,l.left,p)),l.right!=null&&t.right!=null&&(this.right=a.number(t.right,l.right,p)),this}getCenter(t,l){const p=a.clamp((this.left+t-this.right)/2,0,t),_=a.clamp((this.top+l-this.bottom)/2,0,l);return new a.pointGeometry(p,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Oo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Xl(h,t){const l=a.getColumn(h,3);a.fromQuat(h,t),a.setColumn(h,3,l)}function La(h,t){const l=a.identity$1([]);return a.rotateZ$1(l,l,-t),a.rotateX$1(l,l,-h),l}function Hl(h,t){const l=[h[0],h[1],0],p=[t[0],t[1],0];if(a.length(l)>=1e-15){const b=a.normalize([],l);a.scale$2(p,b,a.dot(p,b)),t[0]=p[0],t[1]=p[1]}const _=a.cross([],t,h);if(a.len(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return La(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}class Ra{constructor(t,l){this.position=t,this.orientation=l}get position(){return this._position}set position(t){if(t){const l=t instanceof a.MercatorCoordinate?t:new a.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(l.x=a.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(t,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(t)):0,_=this.position,y=a.MercatorCoordinate.fromLngLat(t,p),b=[y.x-_.x,y.y-_.y,y.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Hl(b,l)}setPitchBearing(t,l){this.orientation=La(a.degToRad(t),a.degToRad(-l))}}class Ss{constructor(t,l){this._transform=a.identity([]),this.orientation=l,this.position=t}get mercatorPosition(){const t=this.position;return new a.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=a.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var l;t&&a.setColumn(this._transform,3,[(l=t)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||a.identity$1([]),t&&Xl(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,l){this._orientation=La(t,l),Xl(this._transform,this._orientation)}forward(){const t=a.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=a.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=a.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,l){const p=new Float64Array(16);return a.invert(p,this.getWorldToCamera(t,l)),p}getWorldToCameraPosition(t,l,p){const _=this.position;a.scale$2(_,_,-t);const y=new Float64Array(16);return a.fromScaling(y,[p,p,p]),a.translate(y,y,_),y[10]*=l,y}getWorldToCamera(t,l){const p=new Float64Array(16),_=new Float64Array(4),y=this.position;return a.conjugate(_,this._orientation),a.scale$2(y,y,-t),a.fromQuat(p,_),a.translate(p,p,y),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(t,l,p,_){const y=new Float64Array(16);return a.perspective(y,t,l,p,_),y}getDistanceToElevation(t){const l=t===0?0:a.mercatorZfromAltitude(t,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new Ss([...this.position],[...this.orientation])}}function et(h,t){const l=Ba(h.projection,h.zoom,h.width,h.height),p=function(y,b,T,C,M){const z=new a.LngLat(T.lng-180*Fo,T.lat),R=new a.LngLat(T.lng+180*Fo,T.lat),F=y.project(z.lng,z.lat),j=y.project(R.lng,R.lat),G=-Math.atan2(j.y-F.y,j.x-F.x),N=a.MercatorCoordinate.fromLngLat(T);N.y=a.clamp(N.y,-.999975,.999975);const K=N.toLngLat(),V=y.project(K.lng,K.lat),Z=a.MercatorCoordinate.fromLngLat(K);Z.x+=Fo;const q=Z.toLngLat(),te=y.project(q.lng,q.lat),Y=Uo(te.x-V.x,te.y-V.y,G),J=a.MercatorCoordinate.fromLngLat(K);J.y+=Fo;const se=J.toLngLat(),be=y.project(se.lng,se.lat),Se=Uo(be.x-V.x,be.y-V.y,G),Te=Math.abs(Y.x)/Math.abs(Se.y),ve=a.identity([]);a.rotateZ(ve,ve,-G*(1-(M?0:C)));const ee=a.identity([]);return a.scale(ee,ee,[1,1-(1-Te)*C,1]),ee[4]=-Se.x/Se.y*C,a.rotateZ(ee,ee,G),a.multiply(ee,ve,ee),ee}(h.projection,0,h.center,l,t),_=qi(h);return a.scale(p,p,[_,_,1]),p}function qi(h){const t=h.projection,l=Ba(h.projection,h.zoom,h.width,h.height),p=Mu(t,h.center),_=Mu(t,a.LngLat.convert(t.center));return Math.pow(2,p*l+(1-l)*_)}function Ba(h,t,l,p,_=1/0){const y=h.range;if(!y)return 0;const b=Math.min(_,Math.max(l,p)),T=Math.log(b/1024)/Math.LN2;return a.smoothstep(y[0]+T,y[1]+T,t)}const Fo=1/4e4;function Mu(h,t){const l=a.clamp(t.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),p=new a.LngLat(t.lng-180*Fo,l),_=new a.LngLat(t.lng+180*Fo,l),y=h.project(p.lng,l),b=h.project(_.lng,l),T=a.MercatorCoordinate.fromLngLat(p),C=a.MercatorCoordinate.fromLngLat(_),M=b.x-y.x,z=b.y-y.y,R=C.x-T.x,F=C.y-T.y,j=Math.sqrt((R*R+F*F)/(M*M+z*z));return Math.log(j)/Math.LN2}function Uo(h,t,l){const p=Math.cos(l),_=Math.sin(l);return{x:h*p-t*_,y:h*_+t*p}}class Yl{constructor(t,l,p,_,y,b,T){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=l||22,this._minPitch=p==null?0:p,this._maxPitch=_==null?60:_,this.setProjection(b),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Oo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ss,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const t=new Yl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const l=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||l)&&this._updateCameraOnTerrain(),(t||l)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const p=!U(l,this.getProjection());return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const l=-t*Math.PI/180;var p;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,y,b){var T=y[0],C=y[1],M=y[2],z=y[3],R=Math.sin(b),F=Math.cos(b);_[0]=T*F+M*R,_[1]=C*F+z*R,_[2]=T*-R+M*F,_[3]=C*-R+z*F}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const l=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const l=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,y=0;for(let b=0;b<l.length;b++){const T=new a.pointGeometry(l[b][0]*this.width,p+l[b][1]*(this.height-p)),C=t.pointCoordinate(T);if(!C)continue;const M=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);_+=C[3]*M,y+=M}return y===0?NaN:_/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(_-p,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[l.x,l.y,l.z]:[t.x,t.y,t.z];const _=a.length(a.sub([],this._camera.position,p));return a.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let l=!1;if(t.orientation&&!a.exactEquals(t.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];a.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,l=new Ra;return l.position=new a.MercatorCoordinate(t[0],t[1],t[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(t){if(!a.length$1(t))return!1;a.normalize$1(t,t);const l=a.transformQuat([],[0,0,-1],t),p=a.transformQuat([],[0,-1,0],t);if(p[2]<0)return!1;const _=Hl(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=a.clamp(t[2],_/p,_/l),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,l,p){this._unmodified=!1,this._edgeInsets.interpolate(t,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const l=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(t){const l=[new a.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new a.pointGeometry(0,0)),_=this.pointCoordinate(new a.pointGeometry(this.width,0)),y=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new a.pointGeometry(0,this.height)),T=Math.floor(Math.min(p.x,_.x,y.x,b.x)),C=Math.floor(Math.max(p.x,_.x,y.x,b.x)),M=1;for(let z=T-M;z<=C+M;z++)z!==0&&l.push(new a.UnwrappedTileID(z,t))}return l}coveringTiles(t){let l=this.coveringZoomLevel(t);const p=l,_=this.elevation&&!t.isTerrainDEM,y=this.projection.name==="mercator";if(t.minzoom!==void 0&&l<t.minzoom)return[];t.maxzoom!==void 0&&l>t.maxzoom&&(l=t.maxzoom);const b=this.locationCoordinate(this.center),T=this.center.lat,C=1<<l,M=[C*b.x,C*b.y,0],z=this.projection.name==="globe",R=!z,F=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,R),j=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=C*a.mercatorZfromAltitude(1,this.center.lat),N=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),K=[C*j.x,C*j.y,N*(R?1:G)],V=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),Z=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,q=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,te=t.isTerrainDEM?-q:this._elevation?this._elevation.getMinElevationBelowMSL():0,Y=this.projection.isReprojectedInTileSpace?qi(this):1,J=Ie=>{const qe=new a.MercatorCoordinate(Ie.x+25e-6,Ie.y,Ie.z),Ze=new a.MercatorCoordinate(Ie.x,Ie.y+25e-6,Ie.z),Ve=Ie.toLngLat(),$e=qe.toLngLat(),yt=Ze.toLngLat(),ut=this.locationCoordinate(Ve),St=this.locationCoordinate($e),ot=this.locationCoordinate(yt),bt=Math.hypot(St.x-ut.x,St.y-ut.y),$t=Math.hypot(ot.x-ut.x,ot.y-ut.y);return Math.sqrt(bt*$t)*Y/25e-6},se=Ie=>{const at=q,qe=te;return{aabb:a.tileAABB(this,C,0,0,0,Ie,qe,at,this.projection),zoom:0,x:0,y:0,minZ:qe,maxZ:at,wrap:Ie,fullyVisible:!1}},be=[];let Se=[];const Te=l,ve=t.reparseOverscaled?p:l,ee=Ie=>Ie*Ie,De=ee((N-this._centerAltitude)*G),Pe=Ie=>{if(!this._elevation||!Ie.tileID||!y)return;const at=this._elevation.getMinMaxForTile(Ie.tileID),qe=Ie.aabb;at?(qe.min[2]=at.min,qe.max[2]=at.max,qe.center[2]=(qe.min[2]+qe.max[2])/2):(Ie.shouldSplit=We(Ie),Ie.shouldSplit||(qe.min[2]=qe.max[2]=qe.center[2]=this._centerAltitude))},We=Ie=>{if(Ie.zoom<Z)return!0;if(Ie.zoom===Te)return!1;if(Ie.shouldSplit!=null)return Ie.shouldSplit;const at=Ie.aabb.distanceX(K),qe=Ie.aabb.distanceY(K);let Ze=De,Ve=1;if(z){Ze=ee(Ie.aabb.distanceZ(K));const yt=Math.pow(2,Ie.zoom),ut=a.latFromMercatorY((Ie.y+1)/yt),St=a.latFromMercatorY(Ie.y/yt),ot=Math.min(Math.max(T,ut),St),bt=a.circumferenceAtLatitude(ot)/a.circumferenceAtLatitude(T);if(Ve=ot===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,bt/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Ie.zoom===Te-1&&bt>=.9)return!0}else if(_&&(Ze=ee(Ie.aabb.distanceZ(K)*G)),this.projection.isReprojectedInTileSpace&&p<=5){const yt=Math.pow(2,Ie.zoom),ut=J(new a.MercatorCoordinate((Ie.x+.5)/yt,(Ie.y+.5)/yt));Ve=ut>.85?1:ut}const $e=at*at+qe*qe+Ze;return $e<ee((1<<Te-Ie.zoom)*V*Ve*((yt,ut)=>{if(ut*ee(.707)<yt)return 1;const St=Math.sqrt(ut/yt);return St/(1.4144271570014144+(Math.pow(1.1,St-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ze,De),$e))};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)be.push(se(-Ie)),be.push(se(Ie));for(be.push(se(0));be.length>0;){const Ie=be.pop(),at=Ie.x,qe=Ie.y;let Ze=Ie.fullyVisible;if(!Ze){const Ve=Ie.aabb.intersects(F);if(Ve===0)continue;Ze=Ve===2}if(Ie.zoom!==Te&&We(Ie))for(let Ve=0;Ve<4;Ve++){const $e=(at<<1)+Ve%2,yt=(qe<<1)+(Ve>>1),ut={aabb:y?Ie.aabb.quadrant(Ve):a.tileAABB(this,C,Ie.zoom+1,$e,yt,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:$e,y:yt,wrap:Ie.wrap,fullyVisible:Ze,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};_&&!z&&(ut.tileID=new a.OverscaledTileID(Ie.zoom+1===Te?ve:Ie.zoom+1,Ie.wrap,Ie.zoom+1,$e,yt),Pe(ut)),be.push(ut)}else{const Ve=Ie.zoom===Te?ve:Ie.zoom;if(t.minzoom&&t.minzoom>Ve)continue;const $e=M[0]-(.5+at+(Ie.wrap<<Ie.zoom))*(1<<l-Ie.zoom),yt=M[1]-.5-qe,ut=Ie.tileID?Ie.tileID:new a.OverscaledTileID(Ve,Ie.wrap,Ie.zoom,at,qe);Se.push({tileID:ut,distanceSq:$e*$e+yt*yt})}}if(this.fogCullDistSq){const Ie=this.fogCullDistSq,at=this.horizonLineFromTop();Se=Se.filter(qe=>{const Ze=[0,0,0,1],Ve=[a.EXTENT,a.EXTENT,0,1],$e=this.calculateFogTileMatrix(qe.tileID.toUnwrapped());a.transformMat4$1(Ze,Ze,$e),a.transformMat4$1(Ve,Ve,$e);const yt=a.getAABBPointSquareDist(Ze,Ve);if(yt===0)return!0;let ut=!1;const St=this._elevation;if(St&&yt>Ie&&at!==0){const ot=this.calculateProjMatrix(qe.tileID.toUnwrapped());let bt;t.isTerrainDEM||(bt=St.getMinMaxForTile(qe.tileID)),bt||(bt={min:te,max:q});const $t=a.furthestTileCorner(this.rotation),Ht=[$t[0]*a.EXTENT,$t[1]*a.EXTENT,bt.max];a.transformMat4(Ht,Ht,ot),ut=(1-Ht[1])*this.height*.5<at}return yt<Ie||ut})}return Se.sort((Ie,at)=>Ie.distanceSq-at.distanceSq).map(Ie=>Ie.tileID)}resize(t,l){this.width=t,this.height=l,this.pixelsToGLUnits=[2/t,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const l=a.clamp(t.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),p=this.projection.project(t.lng,l);return new a.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,l){let p,_;const y=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;p=(l.x-y.x)/T,_=(l.y-y.y)/T}else{const T=this.pointCoordinate(l),C=this.pointCoordinate(y);p=T.x-C.x,_=T.y-C.y}const b=this.locationCoordinate(t);this.setLocation(new a.MercatorCoordinate(b.x-p,b.y-_))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,l){const p=l?a.mercatorZfromAltitude(l,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new a.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,l){const p=l!=null?l:this._centerAltitude,_=[t.x,t.y,0,1],y=[t.x,t.y,1,1];a.transformMat4$1(_,_,this.pixelMatrixInverse),a.transformMat4$1(y,y,this.pixelMatrixInverse);const b=y[3];a.scale$1(_,_,1/_[3]),a.scale$1(y,y,1/b);const T=_[2],C=y[2];return{p0:_,p1:y,t:T===C?0:(p-T)/(C-T)}}screenPointToMercatorRay(t){const l=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return a.transformMat4$1(l,l,this.pixelMatrixInverse),a.transformMat4$1(p,p,this.pixelMatrixInverse),a.scale$1(l,l,1/l[3]),a.scale$1(p,p,1/p[3]),l[2]=a.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=a.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,a.scale$1(l,l,1/this.worldSize),a.scale$1(p,p,1/this.worldSize),new a.Ray([l[0],l[1],l[2]],a.normalize([],a.sub([],p,l)))}rayIntersectionCoordinate(t){const{p0:l,p1:p,t:_}=t,y=a.mercatorZfromAltitude(l[2],this._center.lat),b=a.mercatorZfromAltitude(p[2],this._center.lat);return new a.MercatorCoordinate(a.number(l[0],p[0],_)/this.worldSize,a.number(l[1],p[1],_)/this.worldSize,a.number(y,b,_))}pointCoordinate(t,l=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,l)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let l=this.projection.pointCoordinate3D(this,t.x,t.y);if(l)return new a.MercatorCoordinate(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t);const y=.02*_,b=t.clone();for(let T=0;T<10&&_-p>y;T++){b.y=a.number(p,_,.66);const C=this.projection.pointCoordinate3D(this,b.x,b.y);C?(_=b.y,l=C):p=b.y}return l?new a.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}_coordinatePoint(t,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return a.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new a.pointGeometry(_[0]/_[3],_[1]/_[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,l){const p=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),b=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let T=this.pointCoordinate(p,t),C=this.pointCoordinate(_,t);const M=this.pointCoordinate(y,l),z=this.pointCoordinate(b,l),R=(F,j)=>(j.y-F.y)/(j.x-F.x);return T.y>1&&C.y>=0?T=new a.MercatorCoordinate((1-z.y)/R(z,T)+z.x,1):T.y<0&&C.y<=1&&(T=new a.MercatorCoordinate(-z.y/R(z,T)+z.x,0)),C.y>1&&T.y>=0?C=new a.MercatorCoordinate((1-M.y)/R(M,C)+M.x,1):C.y<0&&T.y<=1&&(C=new a.MercatorCoordinate(-M.y/R(M,C)+M.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(T)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(M))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const l=t.visibleDemTiles.reduce((p,_)=>{if(_.dem){const y=_.dem.tree;p.min=Math.min(p.min,y.minimums[0]),p.max=Math.max(p.max,y.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*t.exaggeration(),l.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,l){return this.projection.createTileMatrix(this,l,t)}calculateDistanceTileData(t){const l=t.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=t.canonical,y=1/this.height,b=this.cameraWorldSize/this.zoomScale(_.z),T=(_.x+Math.pow(2,_.z)*t.wrap)*b,C=_.y*b,M=this.point,z=this.angle,R=Math.sin(-z),F=-Math.cos(-z);return p[l]={bearing:[R,F],center:[(M.x-T)*y,(M.y-C)*y],scale:b/a.EXTENT*y},p[l]}calculateFogTileMatrix(t){const l=t.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return a.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(t,l=!1){const p=t.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const y=this.calculatePosMatrix(t,this.worldSize);return a.multiply(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,y),_[p]=new Float32Array(y),_[p]}calculatePixelsToTileUnitsMatrix(t){const l=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(y,b){const{scale:T}=y.tileTransform,C=T*a.EXTENT/(y.tileSize*Math.pow(2,b.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return M=new Float32Array(4),F=(z=b.inverseAdjustmentMatrix)[1],j=z[2],G=z[3],K=(R=[C,C])[1],M[0]=z[0]*(N=R[0]),M[1]=F*N,M[2]=j*K,M[3]=G*K,M;var M,z,R,F,j,G,N,K}(t,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),y=a.mercatorZfromAltitude(1,this._center.lat);p[2]/=y,_[2]/=y,a.normalize(_,_);const b=t.raycast(p,_,t.exaggeration());if(b){const T=a.scaleAndAdd([],p,_,b),C=new a.MercatorCoordinate(T[0],T[1],a.mercatorZfromAltitude(T[2],a.latFromMercatorY(T[1]))),M=(C.z+a.length([C.x-p[0],C.y-p[1],C.z-p[2]*y]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=t.getAtPointOrZero(new a.MercatorCoordinate(...p)),y=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),b=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(b<y){const T=this.locationCoordinate(this._center,this._centerAltitude),C=[T.x-p[0],T.y-p[1],T.z-p[2]],M=a.length(C);C[2]-=(y-b)/this._projectionScaler;const z=a.length(C);if(z===0)return;a.scale$2(C,C,M/z*this._projectionScaler),this._camera.position=[T.x-C[0],T.y-C[1],T.z*this._projectionScaler-C[2]],this._camera.orientation=Hl(C,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const R=this.center;return R.lat=a.clamp(R.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(R.lng=a.clamp(R.lng,this.minLng,this.maxLng)),this.center=R,void(this._constraining=!1)}const t=this._unmodified,{x:l,y:p}=this.point;let _=0,y=l,b=p;const T=this.width/2,C=this.height/2,M=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(p-C<M&&(b=M+C),p+C>z&&(b=z-C),z-M<this.height&&(_=Math.max(_,this.height/(z-M)),b=(z+M)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const R=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,j=this.worldSize/2-(R+F)/2;y=(l+j+this.worldSize)%this.worldSize-j,y-T<R&&(y=R+T),y+T>F&&(y=F-T),F-R<this.width&&(_=Math.max(_,this.width/(F-R)),y=(F+R)/2)}y===l&&b===p||(this.center=this.unproject(new a.pointGeometry(y,b))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,l=this.pixelsPerMeter;if(this.projection.name==="globe"){const Y=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,J=a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=Y/J}const p=Ba(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?l:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-t.x/this.width,y[9]=2*t.y/this.height;let b=a.mul([],y,_);if(this.projection.isReprojectedInTileSpace){const Y=this.locationCoordinate(this.center),J=a.identity([]);a.translate(J,J,[Y.x*this.worldSize,Y.y*this.worldSize,0]),a.multiply(J,J,et(this)),a.translate(J,J,[-Y.x*this.worldSize,-Y.y*this.worldSize,0]),a.multiply(b,b,J),this.inverseAdjustmentMatrix=function(se){const be=et(se,!0);return nr([],[be[0],be[1],be[4],be[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],b,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=b,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const T=a.invert([],y);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(T,this.horizonLineFromTop(),this.height);const C=new Float32Array(16);a.identity(C),a.scale(C,C,[1,-1,1]),a.rotateX(C,C,this._pitch),a.rotateZ(C,C,this.angle);const M=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;M[8]=2*-t.x/this.width,M[9]=2*(t.y+z)/this.height,this.skyboxMatrix=a.multiply(C,M,C);const R=this.point,F=R.x,j=R.y,G=this.width%2/2,N=this.height%2/2,K=Math.cos(this.angle),V=Math.sin(this.angle),Z=F-Math.round(F)+K*G+V*N,q=j-Math.round(j)+K*N+V*G,te=new Float64Array(b);if(a.translate(te,te,[Z>.5?Z-1:Z,q>.5?q-1:q,0]),this.alignedProjMatrix=te,b=a.create(),a.scale(b,b,[this.width/2,-this.height/2,1]),a.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=a.create(),a.scale(b,b,[1,-1,1]),a.translate(b,b,[-1,-1,0]),a.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},b=a.invert(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=b,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const Y=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(Y,Y,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=b;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._projectionScaler,y=[t,t,l];a.scale$2(y,y,_),a.scale$2(p,p,-1),a.multiply$2(p,p,y);const b=a.create();a.translate(b,b,p),a.scale(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,l,_)}_computeCameraPosition(t){const l=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-t/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*y,_.y/this.worldSize-p[1]*y,t/this.worldSize*this._centerAltitude-p[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=t[2];let _=1;p>0&&(_=Math.min((l-this._camera.position[2])/p,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,t,_),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),y=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),T=Math.max((t[2]-y)/Math.cos(p),b),C=this._zoomFromMercatorZ(T);a.scaleAndAdd(t,t,l,T),this._pitch=a.clamp(p,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(_,-Math.PI,Math.PI),this._setZoom(a.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,l){const p=Math.min(t.x,l.x),_=Math.max(t.x,l.x),y=Math.min(t.y,l.y),b=Math.max(t.y,l.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new a.pointGeometry(p,y),new a.pointGeometry(_,b),new a.pointGeometry(p,b),new a.pointGeometry(_,y)],C=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(const z of T){const R=this.pointRayIntersection(z);if(R.t<0)return!0;const F=this.rayIntersectionCoordinate(R);if(F.x<C||F.y<0||F.x>M||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,l){const p=a.length(a.sub([],this._camera.position,t)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const t=function(l,p){const _=[l[0],l[1],l[2],1];a.transformMat4$1(_,_,p);const y=Math.max(_[3],1e-6);return[_[0]/y,_[1]/y,_[2]/y,y]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}}getCameraToCenterDistance(t){const l=Ba(t,this.zoom,this.width,this.height,1024),p=t.pixelSpaceConversion(this.center.lat,this.worldSize,l);return .5/Math.tan(.5*this._fov)*this.height*p}}function Oa(h,t){let l=!1,p=null;const _=()=>{p=null,l&&(h(),p=setTimeout(_,t),l=!1)};return()=>(l=!0,p||_(),p)}class ku{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Oa(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,a.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const l=this._map;if(!l)return"";const p=l.getCenter(),_=Math.round(100*l.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),T=Math.round(p.lng*b)/b,C=Math.round(p.lat*b)/b,M=l.getBearing(),z=l.getPitch();let R="";if(R+=t?`/${T}/${C}/${_}`:`${_}/${C}/${T}`,(M||z)&&(R+="/"+Math.round(10*M)/10),z&&(R+=`/${Math.round(z)}`),this._hashName){const F=this._hashName;let j=!1;const G=a.window.location.hash.slice(1).split("&").map(N=>{const K=N.split("=")[0];return K===F?(j=!0,`${K}=${R}`):N}).filter(N=>N);return j||G.push(`${F}=${R}`),`#${G.join("&")}`}return`#${R}`}_getCurrentHash(){const t=a.window.location.hash.replace("#","");if(this._hashName){let l;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(l[3]||0):t.getBearing();return t.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,t)}}const No={linearity:.3,easing:a.bezier(0,0,.3,1)},Dd=a.extend({deceleration:2500,maxSpeed:1400},No),Ld=a.extend({deceleration:20,maxSpeed:1400},No),Cs=a.extend({deceleration:1e3,maxSpeed:360},No),Om=a.extend({deceleration:1e3,maxSpeed:90},No);class Fm{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,l=a.exported.now();for(;t.length>0&&l-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const y=Vo(l.pan.mag(),p,a.extend({},Dd,t||{}));_.offset=l.pan.mult(y.amount/l.pan.mag()),_.center=this._map.transform.center,Fa(_,y)}if(l.zoom){const y=Vo(l.zoom,p,Ld);_.zoom=this._map.transform.zoom+y.amount,Fa(_,y)}if(l.bearing){const y=Vo(l.bearing,p,Cs);_.bearing=this._map.transform.bearing+a.clamp(y.amount,-179,179),Fa(_,y)}if(l.pitch){const y=Vo(l.pitch,p,Om);_.pitch=this._map.transform.pitch+y.amount,Fa(_,y)}if(_.zoom||_.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Fa(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Vo(h,t,l){const{maxSpeed:p,linearity:_,deceleration:y}=l,b=a.clamp(h*_/(t/1e3),-p,p),T=Math.abs(b)/(y*_);return{easing:l.easing,duration:1e3*T,amount:b*(T/2)}}class li extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p,_={}){const y=Fe(l.getCanvasContainer(),p),b=l.unproject(y);super(t,a.extend({point:y,lngLat:b,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class Ua extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p){const _=t==="touchend"?p.changedTouches:p.touches,y=st(l.getCanvasContainer(),_),b=y.map(C=>l.unproject(C)),T=y.reduce((C,M,z,R)=>C.add(M.div(R.length)),new a.pointGeometry(0,0));super(t,{points:y,point:T,lngLats:b,lngLat:l.unproject(T),originalEvent:p}),this._defaultPrevented=!1}}class Rd extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class Kl{constructor(t,l){this._map=t,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Rd(t.type,this._map,t))}mousedown(t,l){return this._mousedownPos=l,this._firePreventable(new li(t.type,this._map,t))}mouseup(t){this._map.fire(new li(t.type,this._map,t))}preclick(t){const l=a.extend({},t);l.type="preclick",this._map.fire(new li(l.type,this._map,l))}click(t,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(t),this._map.fire(new li(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new li(t.type,this._map,t))}mouseover(t){this._map.fire(new li(t.type,this._map,t))}mouseout(t){this._map.fire(new li(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ua(t.type,this._map,t))}touchmove(t){this._map.fire(new Ua(t.type,this._map,t))}touchend(t){this._map.fire(new Ua(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ua(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zu{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new li(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new li(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bd{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,l){this.isEnabled()&&t.shiftKey&&t.button===0&&(ge(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(t,l){if(!this._active)return;const p=l;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(_.x,p.x),b=Math.max(_.x,p.x),T=Math.min(_.y,p.y),C=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${T}px)`,this._box.style.width=b-y+"px",this._box.style.height=C-T+"px")})}mouseupWindow(t,l){if(!this._active||t.button!==0)return;const p=this._startPos,_=l;if(this.reset(),je(),p.x!==_.x||p.y!==_.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),he(),delete this._startPos,delete this._lastPos}_fireEvent(t,l){return this._map.fire(new a.Event(t,{originalEvent:l}))}}function Jl(h,t){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=t[p];return l}class Od{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const y=new a.pointGeometry(0,0);for(const b of _)y._add(b);return y.div(_.length)}(l),this.touches=Jl(p,l)))}touchmove(t,l,p){if(this.aborted||!this.centroid)return;const _=Jl(p,l);for(const y in this.touches){const b=this.touches[y],T=_[y];(!T||T.dist(b)>30)&&(this.aborted=!0)}}touchend(t,l,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Ql{constructor(t){this.singleTap=new Od(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,l,p){this.singleTap.touchstart(t,l,p)}touchmove(t,l,p){this.singleTap.touchmove(t,l,p)}touchend(t,l,p){const _=this.singleTap.touchend(t,l,p);if(_){const y=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(_)<30;if(y&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Fd{constructor(){this._zoomIn=new Ql({numTouches:1,numTaps:2}),this._zoomOut=new Ql({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,l,p){this._zoomIn.touchstart(t,l,p),this._zoomOut.touchstart(t,l,p)}touchmove(t,l,p){this._zoomIn.touchmove(t,l,p),this._zoomOut.touchmove(t,l,p)}touchend(t,l,p){const _=this._zoomIn.touchend(t,l,p),y=this._zoomOut.touchend(t,l,p);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Is={0:1,2:2};class ec{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,l){return!1}_move(t,l){return{}}mousedown(t,l){if(this._lastPoint)return;const p=lt(t);this._correctButton(t,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(t,l){const p=this._lastPoint;if(p){if(t.preventDefault(),this._eventButton!=null&&function(_,y){const b=Is[y];return _.buttons===void 0||(_.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(t){this._lastPoint&&lt(t)===this._eventButton&&(this._moved&&je(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ud extends ec{mousedown(t,l){super.mousedown(t,l),this._lastPoint&&(this._active=!0)}_correctButton(t,l){return l===0&&!t.ctrlKey}_move(t,l){return{around:l,panDelta:l.sub(t)}}}class Pu extends ec{_correctButton(t,l){return l===0&&t.ctrlKey||l===2}_move(t,l){const p=.8*(l.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){t.preventDefault()}}class Du extends ec{_correctButton(t,l){return l===0&&t.ctrlKey||l===2}_move(t,l){const p=-.5*(l.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){t.preventDefault()}}class Nd{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(t,l,p){return this._calculateTransform(t,l,p)}touchmove(t,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,l,p)}}touchend(t,l,p){this._calculateTransform(t,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,l,p){p.length>0&&(this._active=!0);const _=Jl(p,l),y=new a.pointGeometry(0,0),b=new a.pointGeometry(0,0);let T=0;for(const M in _){const z=_[M],R=this._touches[M];R&&(y._add(z),b._add(z.sub(R)),T++,_[M]=z)}if(this._touches=_,T<this._minTouches||!b.mag())return;const C=b.div(T);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(T),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class tc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,l,p){return{}}touchstart(t,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(t,l,p){const _=this._firstTwoTouches;if(!_)return;t.preventDefault();const[y,b]=_,T=Nr(p,l,y),C=Nr(p,l,b);if(!T||!C)return;const M=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],M,t)}touchend(t,l,p){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,b=Nr(p,l,_),T=Nr(p,l,y);b&&T||(this._active&&je(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Nr(h,t,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return t[p]}function Vd(h,t){return Math.log(h/t)/Math.LN2}class jd extends tc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,l){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Vd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vd(this._distance,p),pinchAround:l}}}function Gd(h,t){return 180*h.angleWith(t)/Math.PI}class Um extends tc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,l){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gd(this._vector,p),pinchAround:l}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const l=25/(Math.PI*this._minDiameter)*360,p=Gd(t,this._startVector);return Math.abs(p)<l}}function ln(h){return Math.abs(h.y)>Math.abs(h.x)}class $d extends tc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ln(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,l,p){const _=this._lastPoints;if(!_)return;const y=t[0].sub(_[0]),b=t[1].sub(_[1]);return this._map._cooperativeGestures&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,p.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(t,l,p){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,y=l.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const b=t.y>0==l.y>0;return ln(t)&&ln(l)&&b}}const As={panStep:100,bearingStep:15,pitchStep:10};class bn{constructor(){const t=As;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let l=0,p=0,_=0,y=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:T=>{const C=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:rc,zoom:l?Math.round(C)+l*(t.shiftKey?2:1):C,bearing:T.getBearing()+p*this._bearingStep,pitch:T.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:T.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rc(h){return h*(2-h)}const tt=4.000244140625;class Zd{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=t.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=a.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%tt==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),t.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=t,this._delta-=l,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Fe(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,l=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>tt?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&M!==0&&(M=1/M);const z=l(),R=Math.pow(2,z),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*M))),this._type==="wheel"&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,y=this._easing;let b,T=!1;if(this._type==="wheel"&&_&&y){const C=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),M=y(C);b=a.number(_,p,M),C<1?this._frameId||(this._frameId=!0):T=!0}else b=p,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:b-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let l=a.ease;if(this._prevEase){const p=this._prevEase,_=(a.exported.now()-p.start)/p.duration,y=p.easing(_+.01)-p.easing(_),b=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-b*b);l=a.bezier(b,T,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!a.window.document.fullscreenElement||!!a.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class qd{constructor(t,l){this._clickZoom=t,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Na{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,l){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Va{constructor(){this._tap=new Ql({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,l,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,l,p))}touchmove(t,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,l,p)}touchend(t,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,l,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wd{constructor(t,l,p){this._el=t,this._mousePan=l,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xd{constructor(t,l,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Hd{constructor(t,l,p,_){this._el=t,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ja=h=>h.zoom||h.drag||h.pitch||h.rotate;class Yd extends a.Event{}class Kd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,l){const p=a.sub([],l,t);this.radius=a.length(p[2]<0?a.div([],p,this.constants):[p[0],p[1],0])}projectRay(t){a.div(t,t,this.constants),a.normalize(t,t),a.mul$1(t,t,this.constants);const l=a.scale$2([],t,this.radius);if(l[2]>0){const p=a.scale$2([],[0,0,1],a.dot(l,[0,0,1])),_=a.scale$2([],a.normalize([],[l[0],l[1],0]),this.radius),y=a.add([],l,a.scale$2([],a.sub([],a.add([],_,p),l),2));l[0]=y[0],l[1]=y[1]}return l}}function Ga(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class ic{constructor(t,l){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fm(t),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Kd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),a.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[_,y,b]of this._listeners)_.addEventListener(y,_===a.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,l,p]of this._listeners)t.removeEventListener(l,t===a.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new Kl(l,t));const _=l.boxZoom=new Bd(l,t);this._add("boxZoom",_);const y=new Fd,b=new Na;l.doubleClickZoom=new qd(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const T=new Va;this._add("tapDragZoom",T);const C=l.touchPitch=new $d(l);this._add("touchPitch",C);const M=new Pu(t),z=new Du(t);l.dragRotate=new Xd(t,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const R=new Ud(t),F=new Nd(l,t);l.dragPan=new Wd(p,R,F),this._add("mousePan",R),this._add("touchPan",F,["touchZoom","touchRotate"]);const j=new Um,G=new jd;l.touchZoomRotate=new Hd(p,G,j,T),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new zu(l));const N=l.scrollZoom=new Zd(l,this);this._add("scrollZoom",N,["mousePan"]);const K=l.keyboard=new bn;this._add("keyboard",K);for(const V of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[V]&&l[V].enable(t[V])}_add(t,l,p){this._handlers.push({handlerName:t,handler:l,allowed:p}),this._handlersById[t]=l}stop(t){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ja(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,l,p){for(const _ in t)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const l=[];for(const p of t)this._el.contains(p.target)&&l.push(p);return l}handleEvent(t,l){this._updatingCamera=!0;const p=t.type==="renderFrame",_=p?void 0:t,y={needsRenderFrame:!1},b={},T={},C=t.touches?this._getMapTouches(t.touches):void 0,M=C?st(this._el,C):p?void 0:Fe(this._el,t);for(const{handlerName:F,handler:j,allowed:G}of this._handlers){if(!j.isEnabled())continue;let N;this._blockedByActive(T,G,F)?j.reset():j[l||t.type]&&(N=j[l||t.type](t,M,C),this.mergeHandlerResult(y,b,N,F,_),N&&N.needsRenderFrame&&this._triggerRenderFrame()),(N||j.isActive())&&(T[F]=j)}const z={};for(const F in this._previousActiveHandlers)T[F]||(z[F]=_);this._previousActiveHandlers=T,(Object.keys(z).length||Ga(y))&&(this._changes.push([y,b,z]),this._triggerRenderFrame()),(Object.keys(T).length||Ga(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=y;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(t,l,p,_,y){if(!p)return;a.extend(t,p);const b={handlerName:_,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(l.zoom=b),p.panDelta!==void 0&&(l.drag=b),p.pitchDelta!==void 0&&(l.pitch=b),p.bearingDelta!==void 0&&(l.rotate=b)}_applyChanges(){const t={},l={},p={};for(const[_,y,b]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.aroundCoord!==void 0&&(t.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),a.extend(l,y),a.extend(p,b);this._updateMapTransform(t,l,p),this._changes=[]}_updateMapTransform(t,l,p){const _=this._map,y=_.transform,b=Z=>[Z.x,Z.y,Z.z];if((Z=>{const q=this._eventsInProgress.drag;return q&&!this._handlersById[q.handlerName].isActive()})()&&!Ga(t)){const Z=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",Z!==y.zoom&&this._map._update(!0)}if(!Ga(t))return void this._fireEvents(l,p,!0);let{panDelta:T,zoomDelta:C,bearingDelta:M,pitchDelta:z,around:R,aroundCoord:F,pinchAround:j}=t;j!==void 0&&(R=j),(Z=>l.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=b(y.pointCoordinate3D(R)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),R=R||_.transform.centerPoint,M&&(y.bearing+=M),z&&(y.pitch+=z),y._updateCameraState();const G=[0,0,0];if(T){const Z=y.pointCoordinate(R);if(y.projection.name==="globe"){const q=a.latFromMercatorY(Z.y),te=y.center.lat,Y=Math.min(a.mercatorZfromAltitude(1,q)/a.mercatorZfromAltitude(1,te),2);T=T.rotate(-y.angle),G[0]=-T.x/y.worldSize*Y,G[1]=-T.y/y.worldSize*Y}else{const q=y.pointCoordinate(R.sub(T));Z&&q&&(G[0]=q.x-Z.x,G[1]=q.y-Z.y)}}const N=y.zoom,K=[0,0,0];if(C){const Z=b(F||y.pointCoordinate3D(R)),q={dir:a.normalize([],a.sub([],Z,y._camera.position))};if(q.dir[2]<0){const te=y.zoomDeltaToMovement(Z,C);a.scale$2(K,q.dir,te)}}const V=a.add(G,G,K);y._translateCameraConstrained(V),C&&Math.abs(y.zoom-N)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(l,p,!0)}_fireEvents(t,l,p){const _=ja(this._eventsInProgress),y=ja(t),b={};for(const z in t){const{originalEvent:R}=t[z];this._eventsInProgress[z]||(b[`${z}start`]=R),this._eventsInProgress[z]=t[z]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const z in b)this._fireEvent(z,b[z]);y&&this._fireEvent("move",y.originalEvent);for(const z in t){const{originalEvent:R}=t[z];this._fireEvent(z,R)}const T={};let C;for(const z in this._eventsInProgress){const{handlerName:R,originalEvent:F}=this._eventsInProgress[z];this._handlersById[R].isActive()||(delete this._eventsInProgress[z],C=l[R]||F,T[`${z}end`]=C)}for(const z in T)this._fireEvent(z,T[z]);const M=ja(this._eventsInProgress);if(p&&(_||y)&&!M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;z?(R(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:C})):(this._map.fire(new a.Event("moveend",{originalEvent:C})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,l){this._map.fire(new a.Event(t,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Yd("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const nc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class oc extends a.Evented{constructor(t,l){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,l){return this.jumpTo({center:t},l)}panBy(t,l,p){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},l),p)}panTo(t,l,p){return this.easeTo(a.extend({center:t},l),p)}getZoom(){return this.transform.zoom}setZoom(t,l){return this.jumpTo({zoom:t},l),this}zoomTo(t,l,p){return this.easeTo(a.extend({zoom:t},l),p)}zoomIn(t,l){return this.zoomTo(this.getZoom()+1,t,l),this}zoomOut(t,l){return this.zoomTo(this.getZoom()-1,t,l),this}getBearing(){return this.transform.bearing}setBearing(t,l){return this.jumpTo({bearing:t},l),this}getPadding(){return this.transform.padding}setPadding(t,l){return this.jumpTo({padding:t},l),this}rotateTo(t,l,p){return this.easeTo(a.extend({bearing:t},l),p)}resetNorth(t,l){return this.rotateTo(0,a.extend({duration:1e3},t),l),this}resetNorthPitch(t,l){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),l),this}snapToNorth(t,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,l):this}getPitch(){return this.transform.pitch}setPitch(t,l){return this.jumpTo({pitch:t},l),this}cameraForBounds(t,l){this.transform.projection.name==="globe"&&a.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),t=a.LngLatBounds.convert(t);const p=l&&l.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,l)}_extendCameraOptions(t){const l={top:0,bottom:0,right:0,left:0};if(typeof(t=a.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const p=t.padding;t.padding={top:p,bottom:p,right:p,left:p}}return t.padding=a.extend(l,t.padding),t}_cameraForBoxAndBearing(t,l,p,_){const y=this._extendCameraOptions(_),b=this.transform,T=b.padding,C=b.project(a.LngLat.convert(t)),M=b.project(a.LngLat.convert(l)),z=new a.pointGeometry(C.x,M.y),R=new a.pointGeometry(M.x,C.y),F=-a.degToRad(p),j=C.rotate(F),G=M.rotate(F),N=z.rotate(F),K=R.rotate(F),V=new a.pointGeometry(Math.max(j.x,G.x,N.x,K.x),Math.max(j.y,G.y,N.y,K.y)),Z=new a.pointGeometry(Math.min(j.x,G.x,N.x,K.x),Math.min(j.y,G.y,N.y,K.y)),q=V.sub(Z),te=(b.width-((T.left||0)+(T.right||0)+y.padding.left+y.padding.right))/q.x,Y=(b.height-((T.top||0)+(T.bottom||0)+y.padding.top+y.padding.bottom))/q.y;if(Y<0||te<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const J=Math.min(b.scaleZoom(b.scale*Math.min(te,Y)),y.maxZoom),se=typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new a.pointGeometry(y.offset.x,y.offset.y):a.pointGeometry.convert(y.offset),be=new a.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(p*Math.PI/180),Se=se.add(be).mult(b.scale/b.zoomScale(J));return{center:b.unproject(C.add(M).div(2).sub(Se)),zoom:J,bearing:p}}_cameraForBox(t,l,p,_,y){const b=this._extendCameraOptions(y);p=p||0,_=_||0,t=a.LngLat.convert(t),l=a.LngLat.convert(l);const T=this.transform.clone();T.padding=b.padding;const C=this.getFreeCameraOptions(),M=new a.LngLat(.5*(t.lng+l.lng),.5*(t.lat+l.lat)),z=.5*(p+_);if(T._camera.position[2]<a.mercatorZfromAltitude(z,M.lat))return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");C.lookAtPoint(M),T.setFreeCameraOptions(C);const R=a.MercatorCoordinate.fromLngLat(t),F=a.MercatorCoordinate.fromLngLat(l),j=T.pointRayIntersection(T.centerPoint,z),G=[(N=T.rayIntersectionCoordinate(j)).x,N.y,N.z];var N;const K=T.screenPointToMercatorRay(T.centerPoint),V=T.projection.name!=="globe";let Z,q=0;do{const te=Math.floor(T.zoom),Y=1<<te,J=Math.min(Y*R.x,Y*F.x),se=Math.min(Y*R.y,Y*F.y),be=Math.max(Y*R.x,Y*F.x),Se=Math.max(Y*R.y,Y*F.y),Te=new a.Aabb([J,se,p],[be,Se,_]),ve=a.Frustum.fromInvProjectionMatrix(T.invProjMatrix,T.worldSize,te,V);if(Te.intersects(ve)!==2){Z&&(T._camera.position=a.scaleAndAdd([],T._camera.position,K.dir,-Z),T._updateStateFromCamera());break}const ee=a.sub([],T._camera.position,G);Z=.5*a.length(ee),T._camera.position=a.scaleAndAdd([],T._camera.position,K.dir,Z);try{T._updateStateFromCamera()}catch{return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++q<10);return{center:T.center,zoom:T.zoom,bearing:T.bearing,pitch:T.pitch}}fitBounds(t,l,p){return this.transform.projection.name==="globe"&&a.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(t,l),l,p)}_raycastElevationBox(t,l){const p=this.transform.elevation;if(!p)return;const _=new a.pointGeometry(t.x,l.y),y=new a.pointGeometry(l.x,t.y),b=p.pointCoordinate(t);if(!b)return;const T=p.pointCoordinate(l);if(!T)return;const C=p.pointCoordinate(_);if(!C)return;const M=p.pointCoordinate(y);if(!M)return;const z=new a.MercatorCoordinate(b[0],b[1]).toLngLat(),R=new a.MercatorCoordinate(T[0],T[1]).toLngLat(),F=new a.MercatorCoordinate(C[0],C[1]).toLngLat(),j=new a.MercatorCoordinate(M[0],M[1]).toLngLat(),G=Math.min(z.lng,Math.min(R.lng,Math.min(F.lng,j.lng))),N=Math.min(z.lat,Math.min(R.lat,Math.min(F.lat,j.lat))),K=Math.max(z.lng,Math.max(R.lng,Math.max(F.lng,j.lng))),V=Math.max(z.lat,Math.max(R.lat,Math.max(F.lat,j.lat))),Z=Math.min(b[3],Math.min(T[3],Math.min(C[3],M[3]))),q=Math.max(b[3],Math.max(T[3],Math.max(C[3],M[3])));return{minLngLat:new a.LngLat(G,N),maxLngLat:new a.LngLat(K,V),minAltitude:Z,maxAltitude:q}}fitScreenCoordinates(t,l,p,_,y){let b,T,C,M;this.transform.projection.name==="globe"&&a.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const z=a.pointGeometry.convert(t),R=a.pointGeometry.convert(l),F=this._raycastElevationBox(z,R);if(F)b=F.minLngLat,T=F.maxLngLat,C=F.minAltitude,M=F.maxAltitude;else{if(this.transform.anyCornerOffEdge(z,R))return this;b=this.transform.pointLocation(z),T=this.transform.pointLocation(R)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(l)),p,_):this._cameraForBox(b,T,C,M,_),_,y)}_fitInternal(t,l,p){return t?(delete(l=a.extend(t,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(t,l){this.stop();const p=t.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,b=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(_=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=a.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(y=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(b=!0,p.pitch=+t.pitch),t.padding==null||p.isPaddingEqual(t.padding)||(p.padding=t.padding),t.preloadOnly?(this._preloadTiles(p),this):(this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),_&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),y&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),b&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(nc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return a.warnOnce(nc),this;this.stop();const _=p.zoom,y=p.pitch,b=p.bearing;p.setFreeCameraOptions(t);const T=_!==p.zoom,C=y!==p.pitch,M=b!==p.bearing;return this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),T&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),M&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),C&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)),this}easeTo(t,l){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const p=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),T=this.getPadding(),C="zoom"in t?+t.zoom:_,M="bearing"in t?this._normalizeBearing(t.bearing,y):y,z="pitch"in t?+t.pitch:b,R="padding"in t?t.padding:p.padding,F=a.pointGeometry.convert(t.offset);let j,G,N;if(p.projection.name==="globe"){const Se=a.MercatorCoordinate.fromLngLat(p.center),Te=F.rotate(-p.angle);Se.x+=Te.x/p.worldSize,Se.y+=Te.y/p.worldSize;const ve=Se.toLngLat(),ee=a.LngLat.convert(t.center||ve);this._normalizeCenter(ee),j=p.centerPoint.add(Te),G=new a.pointGeometry(Se.x,Se.y).mult(p.worldSize),N=new a.pointGeometry(a.mercatorXfromLng(ee.lng),a.mercatorYfromLat(ee.lat)).mult(p.worldSize).sub(G)}else{j=p.centerPoint.add(F);const Se=p.pointLocation(j),Te=a.LngLat.convert(t.center||Se);this._normalizeCenter(Te),G=p.project(Se),N=p.project(Te).sub(G)}const K=p.zoomScale(C-_);let V,Z;t.around&&(V=a.LngLat.convert(t.around),Z=p.locationPoint(V));const q=this._zooming||C!==_,te=this._rotating||y!==M,Y=this._pitching||z!==b,J=!p.isPaddingEqual(R),se=Se=>Te=>{if(q&&(Se.zoom=a.number(_,C,Te)),te&&(Se.bearing=a.number(y,M,Te)),Y&&(Se.pitch=a.number(b,z,Te)),J&&(Se.interpolatePadding(T,R,Te),j=Se.centerPoint.add(F)),V)Se.setLocationAtPoint(V,Z);else{const ve=Se.zoomScale(Se.zoom-_),ee=C>_?Math.min(2,K):Math.max(.5,K),De=Math.pow(ee,1-Te),Pe=Se.unproject(G.add(N.mult(Te*De)).mult(ve));Se.setLocationAtPoint(Se.renderWorldCopies?Pe.wrap():Pe,j)}return t.preloadOnly||this._fireMoveEvents(l),Se};if(t.preloadOnly){const Se=this._emulate(se,t.duration,p);return this._preloadTiles(Se),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=q,this._rotating=te,this._pitching=Y,this._padding=J,this._easeId=t.easeId,this._prepareEase(l,t.noMoveStart,be),this._ease(se(p),Se=>{p.recenterOnTerrain(),this._afterEase(l,Se)},t),this}_prepareEase(t,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.Event("zoomend",t)),_&&this.fire(new a.Event("rotateend",t)),y&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,l){if(!t.essential&&a.exported.prefersReducedMotion){const Ze=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ze,l)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const p=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),T=this.getPadding(),C="zoom"in t?a.clamp(+t.zoom,p.minZoom,p.maxZoom):_,M="bearing"in t?this._normalizeBearing(t.bearing,y):y,z="pitch"in t?+t.pitch:b,R="padding"in t?t.padding:p.padding,F=p.zoomScale(C-_),j=a.pointGeometry.convert(t.offset);let G=p.centerPoint.add(j);const N=p.pointLocation(G),K=a.LngLat.convert(t.center||N);this._normalizeCenter(K);const V=p.project(N),Z=p.project(K).sub(V);let q=t.curve;const te=Math.max(p.width,p.height),Y=te/F,J=Z.mag();if("minZoom"in t){const Ze=a.clamp(Math.min(t.minZoom,_,C),p.minZoom,p.maxZoom),Ve=te/p.zoomScale(Ze-_);q=Math.sqrt(Ve/J*2)}const se=q*q;function be(Ze){const Ve=(Y*Y-te*te+(Ze?-1:1)*se*se*J*J)/(2*(Ze?Y:te)*se*J);return Math.log(Math.sqrt(Ve*Ve+1)-Ve)}function Se(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Te(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const ve=be(0);let ee=function(Ze){return Te(ve)/Te(ve+q*Ze)},De=function(Ze){return te*((Te(ve)*(Se(Ve=ve+q*Ze)/Te(Ve))-Se(ve))/se)/J;var Ve},Pe=(be(1)-ve)/q;if(Math.abs(J)<1e-6||!isFinite(Pe)){if(Math.abs(te-Y)<1e-6)return this.easeTo(t,l);const Ze=Y<te?-1:1;Pe=Math.abs(Math.log(Y/te))/q,De=function(){return 0},ee=function(Ve){return Math.exp(Ze*q*Ve)}}t.duration="duration"in t?+t.duration:1e3*Pe/("screenSpeed"in t?+t.screenSpeed/q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const We=y!==M,Ie=z!==b,at=!p.isPaddingEqual(R),qe=Ze=>Ve=>{const $e=Ve*Pe,yt=1/ee($e);Ze.zoom=Ve===1?C:_+Ze.scaleZoom(yt),We&&(Ze.bearing=a.number(y,M,Ve)),Ie&&(Ze.pitch=a.number(b,z,Ve)),at&&(Ze.interpolatePadding(T,R,Ve),G=Ze.centerPoint.add(j));const ut=Ve===1?K:Ze.unproject(V.add(Z.mult(De($e))).mult(yt));return Ze.setLocationAtPoint(Ze.renderWorldCopies?ut.wrap():ut,G),Ze._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(l),Ze};if(t.preloadOnly){const Ze=this._emulate(qe,t.duration,p);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=We,this._pitching=Ie,this._padding=at,this._prepareEase(l,!1),this._ease(qe(p),()=>this._afterEase(l),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,l,p){p.animate===!1||p.duration===0?(t(1),l()):(this._easeStart=a.exported.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,l){t=a.wrap(t,-180,180);const p=Math.abs(t-l);return Math.abs(t-360-l)<p&&(t-=360),Math.abs(t+360-l)<p&&(t+=360),t}_normalizeCenter(t){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=t.lng-l.center.lng;t.lng+=p>180?-360:p<-180?360:0}_emulate(t,l,p){const _=Math.ceil(15*l/1e3),y=[],b=t(p.clone());for(let T=0;T<=_;T++){const C=b(T/_);y.push(C.clone())}return y}}class Lu{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const l=this.options&&this.options.compact;return this._map=t,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=me("button","mapboxgl-ctrl-attrib-button",this._container),me("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,l){const p=this._map._getUIString(`AttributionControl.${l}`);t.setAttribute("aria-label",p),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(t){const p=l.reduce((_,y,b)=>(y.value&&(_+=`${y.key}=${y.value}${b<l.length-1?"&":""}`),_),"?");t.href=`${a.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const y=l[_];if(y.used){const b=y.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((_,y)=>_.length-y.length),t=t.filter((_,y)=>{for(let b=y+1;b<t.length;b++)if(t[b].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ru{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=me("div","mapboxgl-ctrl");const l=me("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const l in t){const p=t[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const l=t[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Bu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const l=++this._id;return this._queue.push({callback:t,id:l,cancelled:!1}),l}remove(t){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ou(h,t,l){if(h=new a.LngLat(h.lng,h.lat),t){const p=new a.LngLat(h.lng-360,h.lat),_=new a.LngLat(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),b=l.locationPoint(h).distSqr(t),T=t.x<0||t.y<0||t.x>l.width||t.y>l.height;l.locationPoint(p).distSqr(t)<b&&(T||Math.abs(p.lng-l.center.lng)<y)?h=p:l.locationPoint(_).distSqr(t)<b&&(T||Math.abs(_.lng-l.center.lng)<y)&&(h=_)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const sc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ac extends a.Evented{constructor(t,l){if(super(),(t instanceof a.window.HTMLElement||l)&&(t=a.extend({element:t},l)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=me("div");const _=41,y=27,b=Ge("svg",{display:"block",height:_*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${_}`},this._element),T=Ge("radialGradient",{id:"shadowGradient"},Ge("defs",{},b));Ge("stop",{offset:"10%","stop-opacity":.4},T),Ge("stop",{offset:"100%","stop-opacity":.05},T),Ge("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),Ge("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),Ge("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),Ge("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in sc)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const l=t.code,p=t.charCode||t.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){const l=t.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map;if(!t)return!1;const l=t.unproject(this._pos),p=t.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(l)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const l=this._pos;if(!l||l.x<0||l.x>t.transform.width||l.y<0||l.y>t.transform.height)return void this._clearFadeTimer();const p=t.unproject(l);let _;t._usingGlobe()&&a.isLngLatBehindGlobe(t.transform,this._lngLat)?_=0:(_=1-t._queryFogOpacity(p),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(_*=.2)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const l=this._calculateXYTransform()+this._calculateZTransform(),p=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px) ${sc[this._anchor]}
            ${l}
            translate(${p.x}px,${p.y}px)
        `}_calculateXYTransform(){const t=this._pos,l=this._map;if(this.getPitchAlignment()!=="map"||!l||!t)return"";if(!l._usingGlobe()){const C=l.getPitch();return C?`rotateX(${C}deg)`:""}const p=a.radToDeg(a.globeTiltAtLngLat(l.transform,this._lngLat)),_=t.sub(a.globeCenterToScreenPoint(l.transform)),y=p/(Math.abs(_.x)+Math.abs(_.y)),b=_.x*y,T=-_.y*y;return T||b?`rotateX(${T}deg) rotateY(${b}deg)`:""}_calculateZTransform(){const t=this._calculateRotation();return t?`rotateZ(${t}deg)`:""}_calculateRotation(){if(this._rotationAlignment==="viewport"||this._rotationAlignment==="auto")return this._rotation;if(this._map&&this._rotationAlignment==="map"){const t=this._map;if(this._pos&&t&&t._usingGlobe()){const l=t.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),p=t.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(l);return this._rotation+a.radToDeg(Math.atan2(p.y,p.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(t){a.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Ou(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),t===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._usingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){const l=this._map;if(l){if(!this._isDragging){const p=this._clickTolerance||l._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){const l=this._map;l&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const l=this._map;return l&&(t?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class Jd{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const l=a.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,l,p){this._start=this.getValue(l),this._end=t,this._startTime=l,this._endTime=l+p}}const Fu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Qd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function lc(h){h.parentNode&&h.parentNode.removeChild(h)}const ep={showCompass:!0,showZoom:!0,visualizePitch:!1};class tp{constructor(t,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Pu({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new Du({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(t,l){this.mouseRotate.mousedown(t,l),this.mousePitch&&this.mousePitch.mousedown(t,l),ge()}move(t,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(t,l),y=_&&_.bearingDelta;if(y&&p.setBearing(p.getBearing()+y),this.mousePitch){const b=this.mousePitch.mousemoveWindow(t,l),T=b&&b.pitchDelta;T&&p.setPitch(p.getPitch()+T)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){he(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Fe(this.element,t)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Fe(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=st(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=st(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Uu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},rp={maxWidth:100,unit:"metric"};function Nu(h,t,l){const p=Vu(t),_=p/t,y={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=`${p}&nbsp;${y}`})}function Vu(h){const t=Math.pow(10,`${Math.floor(h)}`.length-1);let l=h/t;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(l),t*l}const ju={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cc(h=new a.pointGeometry(0,0),t="bottom"){if(typeof h=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new a.pointGeometry(0,h);case"top-left":return new a.pointGeometry(l,l);case"top-right":return new a.pointGeometry(-l,l);case"bottom":return new a.pointGeometry(0,-h);case"bottom-left":return new a.pointGeometry(l,-l);case"bottom-right":return new a.pointGeometry(-l,-l);case"left":return new a.pointGeometry(h,0);case"right":return new a.pointGeometry(-h,0)}return new a.pointGeometry(0,0)}return h instanceof a.pointGeometry||Array.isArray(h)?a.pointGeometry.convert(h):a.pointGeometry.convert(h[t]||[0,0])}const uc={version:a.version,supported:de,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends oc{constructor(h){if((h=a.extend({},Qd,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(h.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yl(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=h.language==="auto"?a.window.navigator.language:h.language,this._worldview=h.worldview,this._renderTaskQueue=new Bu,this._domRenderTaskQueue=new Bu,this._controls=[],this._markers=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Fu,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Jd(0),this._explicitProjection=null,this._requestManager=new a.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=a.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ic(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new ku(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,a.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new Lu({customAttribution:h.customAttribution})),this._logoControl=new Ru,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new a.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new a.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),this.fire(new a.Event("resize",h)),t&&this.fire(new a.Event("moveend",h)),this}getBounds(){return this.transform.projection.name==="globe"&&a.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(a.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h==null?85:h)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getLanguage(){return this._language}setLanguage(h){if(this._language=h==="auto"?a.window.navigator.language:h,this.style)for(const t in this.style._sourceCaches){const l=this.style._sourceCaches[t]._source;l._setLanguage&&l._setLanguage(this._language)}for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){if(this._worldview=h,this.style)for(const t in this.style._sourceCaches){const l=this.style._sourceCaches[t]._source;l._setWorldview&&l._setWorldview(h)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._updateProjection(h)}_updateProjection(h){const t=this.getProjection();h===null&&(this._explicitProjection=null);const l=h||this.getProjection();let p;if(l&&l.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(p=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(p=this.transform.setProjection(l),this.transform.mercatorFromTransition=!1),h&&(this._explicitProjection=h.name==="globe"?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),p){if(t.name==="globe"&&this.getProjection().name==="globe")this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const _ in this.style._sourceCaches)this.style._sourceCaches[_].clearTiles()}this._update(!0)}return this}project(h){return this.transform.locationPoint3D(a.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(a.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(h,t,l){if(h==="mouseenter"||h==="mouseover"){let p=!1;const _=b=>{const T=t.filter(M=>this.getLayer(M)),C=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];C.length?p||(p=!0,l.call(this,new li(h,this,b.originalEvent,{features:C}))):p=!1},y=()=>{p=!1};return{layers:new Set(t),listener:l,delegates:{mousemove:_,mouseout:y}}}if(h==="mouseleave"||h==="mouseout"){let p=!1;const _=b=>{const T=t.filter(C=>this.getLayer(C));(T.length?this.queryRenderedFeatures(b.point,{layers:T}):[]).length?p=!0:p&&(p=!1,l.call(this,new li(h,this,b.originalEvent)))},y=b=>{p&&(p=!1,l.call(this,new li(h,this,b.originalEvent)))};return{layers:new Set(t),listener:l,delegates:{mousemove:_,mouseout:y}}}{const p=_=>{const y=t.filter(T=>this.getLayer(T)),b=y.length?this.queryRenderedFeatures(_.point,{layers:y}):[];b.length&&(_.features=b,l.call(this,_),delete _.features)};return{layers:new Set(t),listener:l,delegates:{[h]:p}}}}on(h,t,l){if(l===void 0)return super.on(h,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(h,t,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(h,t,l){if(l===void 0)return super.once(h,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(h,t,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(h,t,l){if(l===void 0)return super.off(h,t);t=new Set(Array.isArray(t)?t:[t]);const p=(y,b)=>{if(y.size!==b.size)return!1;for(const T of y)if(!b.has(T))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(y=>{for(let b=0;b<y.length;b++){const T=y[b];if(T.listener===l&&p(T.layers,t)){for(const C in T.delegates)this.off(C,T.delegates[C]);return y.splice(b,1),this}}})(_),this}queryRenderedFeatures(h,t){return this.style?(t!==void 0||h===void 0||h instanceof a.pointGeometry||Array.isArray(h)||(t=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}queryTerrainElevation(h,t){const l=this.transform.elevation;return l?(t=a.extend({},{exaggerated:!0},t),l.getAtPoint(a.MercatorCoordinate.fromLngLat(h),null,t.exaggerated)):null}setStyle(h,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new an(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new an(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,a.ResourceType.Style);a.getJSON(p,(_,y)=>{_?this.fire(new a.ErrorEvent(_)):y&&this._updateDiff(y,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h)&&this._update(!0)}catch(l){a.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const t in h){const l=h[t]._tiles;for(const p in l){const _=l[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(h,t,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:y,content:b}={}){if(this._lazyInitEmptyStyle(),t instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&t instanceof a.window.ImageBitmap){const{width:T,height:C,data:M}=a.exported.getImageData(t);this.style.addImage(h,{data:new a.RGBAImage({width:T,height:C},M),pixelRatio:l,stretchX:_,stretchY:y,content:b,sdf:p,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:C}=t,M=t;this.style.addImage(h,{data:new a.RGBAImage({width:T,height:C},new Uint8Array(M.data)),pixelRatio:l,stretchX:_,stretchY:y,content:b,sdf:p,version:0,userImage:M}),M.onAdd&&M.onAdd(this,h)}}updateImage(h,t){const l=this.style.getImage(h);if(!l)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&t instanceof a.window.ImageBitmap?a.exported.getImageData(t):t,{width:_,height:y}=p;_!==void 0&&y!==void 0?_===l.data.width&&y===l.data.height?(l.data.replace(p.data,!(t instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&t instanceof a.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${y})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){a.getImage(this._requestManager.transformRequest(h,a.ResourceType.Image),(l,p)=>{t(l,p instanceof a.window.HTMLImageElement?a.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,t,l){return this.style.setLayerZoomRange(h,t,l),this._update(!0)}setFilter(h,t,l={}){return this.style.setFilter(h,t,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,l,p={}){return this.style.setPaintProperty(h,t,l,p),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,l,p={}){return this.style.setLayoutProperty(h,t,l,p),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(h),this.transform):0}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let l,p,_,y=this._container;for(;y&&(!p||!_);){const b=a.window.getComputedStyle(y).transform;b&&b!=="none"&&(l=b.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),y=y.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=_?Math.abs(t/_):t}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=me("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=me("div","mapboxgl-canvas-container",h);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=me("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=me("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=me("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const l=a.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const h=a.extend({},de.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);t?(a.storeAuthState(t,!0),this.painter=new Wl(t,this.transform),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;const l=this.painter.context.extTimerQuery,p=a.exported.now();if(this.listens("gpu-timing-frame")&&(t=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this.getProjection().name==="globe"&&(this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.projection.name==="globe"&&this._updateProjection():this.transform.projection.name==="mercator"&&this._updateProjection());let _=!1;const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,M=this.transform.pitch,z=a.exported.now();this.style.zoomHistory.update(C,z);const R=new a.EvaluationParameters(C,{now:z,fadeDuration:y,pitch:M,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),F=R.crossFadingFactor();F===1&&F===this._crossFadingFactor||(_=!0,this._crossFadingFactor=F),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerUpdate()):b=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const C=a.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,t),setTimeout(()=>{const M=l.getQueryObjectEXT(t,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:C,gpuTime:M})),a.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:M}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(C);this.fire(new a.Event("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(C);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:M}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(T||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(b=this._updateAverageElevation(p,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const h of this._markers)h._update()}_updateAverageElevation(h,t=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),y=!1;this.transform.elevation&&(y=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const b=Math.abs(p-_);if(b>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===a.AUTH_ERR_MSG||h.status===401)){const t=this.painter.context.gl;a.storeAuthState(t,!1),this._logoControl instanceof Ru&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(y){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,y,0);const b=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,b),b}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(h),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(h,t,l){let p=l[1]-l[0];const _=h.length/4;for(let y=0;y<t.length;y++){const b=t[y];let T=0;for(let C=0;C<b.length;C+=4)b[C]===h[C]&&b[C+1]===h[C+1]&&b[C+2]===h[C+2]&&b[C+3]===h[C+3]&&(T+=1);p+=(l[y+2]-l[y+1])*(1-T/_)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),lc(this._canvasContainer),lc(this._controlContainer),lc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=a.exported.frame(t=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(t)}))}_preloadTiles(h){const t=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(t,(l,p)=>l._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,t){a.setCacheLimits(h,t)}get version(){return a.version}},NavigationControl:class{constructor(h){this.options=a.extend({},ep,h),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:t}):l.resetNorth({},{originalEvent:t}))}),this._compassIcon=me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),l=t===h.getMaxZoom(),p=t===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new tp(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const l=me("button",h,this._container);return l.type="button",l.addEventListener("click",t),l}_setButtonTitle(h,t){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends a.Evented{constructor(h){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},Uu,h),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Oa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){this._supportsGeolocation!==void 0?h(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(t=>{this._supportsGeolocation=t.state!=="denied",h(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,h(this._supportsGeolocation))}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),l=h.coords;return!!t&&(l.longitude<t.getWest()||l.longitude>t.getEast()||l.latitude<t.getSouth()||l.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",h)),this._finish()}}_updateCamera(h){const t=new a.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),_=a.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(l),_,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new a.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=a.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=me("button","mapboxgl-ctrl-geolocate",this._container),me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me("div","mapboxgl-user-location"),this._dotElement.appendChild(me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ac({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ac({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lu,ScaleControl:class{constructor(h){this.options=a.extend({},rp,h),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Nu.bind(this)),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,l=t._containerHeight/2,p=t._containerWidth/2-h/2,_=t.unproject([p,l]),y=t.unproject([p+h,l]),b=_.distanceTo(y);if(this.options.unit==="imperial"){const T=3.2808*b;T>5280?this._setScale(h,T/5280,"mile"):this._setScale(h,T,"foot")}else this.options.unit==="nautical"?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,t,l){const p=Vu(t),_=p/t;this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(p):`${p}&nbsp;nm`})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof a.window.HTMLElement?this._container=h.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);me("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(h){super(),this.options=a.extend(Object.create(ju),h),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=a.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(a.window.document.createTextNode(h))}setHTML(h){const t=a.window.document.createDocumentFragment(),l=a.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=me("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const l=this._closeButton=me("button","mapboxgl-popup-close-button",t);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,l=this._container,p=this._pos;if(!t||!l||!p)return"bottom";const _=l.offsetWidth,y=l.offsetHeight,b=p.x<_/2,T=p.x>t.transform.width-_/2;if(p.y+h<y)return b?"top-left":T?"top-right":"top";if(p.y>t.transform.height-y){if(b)return"bottom-left";if(T)return"bottom-right"}return b?"left":T?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,l=this._content;if(!t||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=me("div","mapboxgl-popup",t.getContainer()),this._tip=me("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ou(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:t.project(this._lngLat),y=cc(this.options.offset),b=this._anchor=this._getAnchor(y.y),T=cc(this.options.offset,b),C=_.add(T).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${sc[b]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&t._usingGlobe()){const _=a.isLngLatBehindGlobe(t.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Gu);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:ac,Style:an,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Ra,Evented:a.Evented,config:a.config,prewarm:function(){jt().acquire(pt)},clearPrewarmedResources:function(){const h=It;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(pt),It=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(h){a.config.ACCESS_TOKEN=h},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(h){a.config.API_URL=h},get workerCount(){return gt.workerCount},set workerCount(h){gt.workerCount=h},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){a.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){a.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return uc});var P=w;return P})})(F2);const _y=F2.exports;var cf,kA=new Uint8Array(16);function zA(){if(!cf&&(cf=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!cf))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return cf(kA)}const PA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function DA(n){return typeof n=="string"&&PA.test(n)}var ui=[];for(var mg=0;mg<256;++mg)ui.push((mg+256).toString(16).substr(1));function LA(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=(ui[n[o+0]]+ui[n[o+1]]+ui[n[o+2]]+ui[n[o+3]]+"-"+ui[n[o+4]]+ui[n[o+5]]+"-"+ui[n[o+6]]+ui[n[o+7]]+"-"+ui[n[o+8]]+ui[n[o+9]]+"-"+ui[n[o+10]]+ui[n[o+11]]+ui[n[o+12]]+ui[n[o+13]]+ui[n[o+14]]+ui[n[o+15]]).toLowerCase();if(!DA(u))throw TypeError("Stringified UUID is invalid");return u}function RA(n,o,u){n=n||{};var m=n.random||(n.rng||zA)();if(m[6]=m[6]&15|64,m[8]=m[8]&63|128,o){u=u||0;for(var w=0;w<16;++w)o[u+w]=m[w];return o}return LA(m)}var gy=function(n,o){return gy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,m){u.__proto__=m}||function(u,m){for(var w in m)Object.prototype.hasOwnProperty.call(m,w)&&(u[w]=m[w])},gy(n,o)};function ym(n,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");gy(n,o);function u(){this.constructor=n}n.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}function yy(n){var o=typeof Symbol=="function"&&Symbol.iterator,u=o&&n[o],m=0;if(u)return u.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&m>=n.length&&(n=void 0),{value:n&&n[m++],done:!n}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function Jf(n,o){var u=typeof Symbol=="function"&&n[Symbol.iterator];if(!u)return n;var m=u.call(n),w,S=[],P;try{for(;(o===void 0||o-- >0)&&!(w=m.next()).done;)S.push(w.value)}catch(a){P={error:a}}finally{try{w&&!w.done&&(u=m.return)&&u.call(m)}finally{if(P)throw P.error}}return S}function Qf(n,o,u){if(u||arguments.length===2)for(var m=0,w=o.length,S;m<w;m++)(S||!(m in o))&&(S||(S=Array.prototype.slice.call(o,0,m)),S[m]=o[m]);return n.concat(S||Array.prototype.slice.call(o))}function ts(n){return typeof n=="function"}function N2(n){var o=function(m){Error.call(m),m.stack=new Error().stack},u=n(o);return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}var _g=N2(function(n){return function(u){n(this),this.message=u?u.length+` errors occurred during unsubscription:
`+u.map(function(m,w){return w+1+") "+m.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=u}});function xy(n,o){if(n){var u=n.indexOf(o);0<=u&&n.splice(u,1)}}var xm=function(){function n(o){this.initialTeardown=o,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var o,u,m,w,S;if(!this.closed){this.closed=!0;var P=this._parentage;if(P)if(this._parentage=null,Array.isArray(P))try{for(var a=yy(P),U=a.next();!U.done;U=a.next()){var de=U.value;de.remove(this)}}catch(ze){o={error:ze}}finally{try{U&&!U.done&&(u=a.return)&&u.call(a)}finally{if(o)throw o.error}}else P.remove(this);var Me=this.initialTeardown;if(ts(Me))try{Me()}catch(ze){S=ze instanceof _g?ze.errors:[ze]}var ne=this._finalizers;if(ne){this._finalizers=null;try{for(var me=yy(ne),Ge=me.next();!Ge.done;Ge=me.next()){var Ye=Ge.value;try{aw(Ye)}catch(ze){S=S!=null?S:[],ze instanceof _g?S=Qf(Qf([],Jf(S)),Jf(ze.errors)):S.push(ze)}}}catch(ze){m={error:ze}}finally{try{Ge&&!Ge.done&&(w=me.return)&&w.call(me)}finally{if(m)throw m.error}}}if(S)throw new _g(S)}},n.prototype.add=function(o){var u;if(o&&o!==this)if(this.closed)aw(o);else{if(o instanceof n){if(o.closed||o._hasParent(this))return;o._addParent(this)}(this._finalizers=(u=this._finalizers)!==null&&u!==void 0?u:[]).push(o)}},n.prototype._hasParent=function(o){var u=this._parentage;return u===o||Array.isArray(u)&&u.includes(o)},n.prototype._addParent=function(o){var u=this._parentage;this._parentage=Array.isArray(u)?(u.push(o),u):u?[u,o]:o},n.prototype._removeParent=function(o){var u=this._parentage;u===o?this._parentage=null:Array.isArray(u)&&xy(u,o)},n.prototype.remove=function(o){var u=this._finalizers;u&&xy(u,o),o instanceof n&&o._removeParent(this)},n.EMPTY=function(){var o=new n;return o.closed=!0,o}(),n}(),V2=xm.EMPTY;function j2(n){return n instanceof xm||n&&"closed"in n&&ts(n.remove)&&ts(n.add)&&ts(n.unsubscribe)}function aw(n){ts(n)?n():n.unsubscribe()}var x0={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},vy={setTimeout:function(n,o){for(var u=[],m=2;m<arguments.length;m++)u[m-2]=arguments[m];var w=vy.delegate;return w!=null&&w.setTimeout?w.setTimeout.apply(w,Qf([n,o],Jf(u))):setTimeout.apply(void 0,Qf([n,o],Jf(u)))},clearTimeout:function(n){var o=vy.delegate;return((o==null?void 0:o.clearTimeout)||clearTimeout)(n)},delegate:void 0};function BA(n){vy.setTimeout(function(){throw n})}function lw(){}var uf=null;function If(n){if(x0.useDeprecatedSynchronousErrorHandling){var o=!uf;if(o&&(uf={errorThrown:!1,error:null}),n(),o){var u=uf,m=u.errorThrown,w=u.error;if(uf=null,m)throw w}}else n()}var G2=function(n){ym(o,n);function o(u){var m=n.call(this)||this;return m.isStopped=!1,u?(m.destination=u,j2(u)&&u.add(m)):m.destination=NA,m}return o.create=function(u,m,w){return new wy(u,m,w)},o.prototype.next=function(u){this.isStopped||this._next(u)},o.prototype.error=function(u){this.isStopped||(this.isStopped=!0,this._error(u))},o.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},o.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},o.prototype._next=function(u){this.destination.next(u)},o.prototype._error=function(u){try{this.destination.error(u)}finally{this.unsubscribe()}},o.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},o}(xm),OA=Function.prototype.bind;function gg(n,o){return OA.call(n,o)}var FA=function(){function n(o){this.partialObserver=o}return n.prototype.next=function(o){var u=this.partialObserver;if(u.next)try{u.next(o)}catch(m){hf(m)}},n.prototype.error=function(o){var u=this.partialObserver;if(u.error)try{u.error(o)}catch(m){hf(m)}else hf(o)},n.prototype.complete=function(){var o=this.partialObserver;if(o.complete)try{o.complete()}catch(u){hf(u)}},n}(),wy=function(n){ym(o,n);function o(u,m,w){var S=n.call(this)||this,P;if(ts(u)||!u)P={next:u!=null?u:void 0,error:m!=null?m:void 0,complete:w!=null?w:void 0};else{var a;S&&x0.useDeprecatedNextContext?(a=Object.create(u),a.unsubscribe=function(){return S.unsubscribe()},P={next:u.next&&gg(u.next,a),error:u.error&&gg(u.error,a),complete:u.complete&&gg(u.complete,a)}):P=u}return S.destination=new FA(P),S}return o}(G2);function hf(n){BA(n)}function UA(n){throw n}var NA={closed:!0,next:lw,error:UA,complete:lw},VA=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function jA(n){return n}function GA(n){return n.length===0?jA:n.length===1?n[0]:function(u){return n.reduce(function(m,w){return w(m)},u)}}var cw=function(){function n(o){o&&(this._subscribe=o)}return n.prototype.lift=function(o){var u=new n;return u.source=this,u.operator=o,u},n.prototype.subscribe=function(o,u,m){var w=this,S=ZA(o)?o:new wy(o,u,m);return If(function(){var P=w,a=P.operator,U=P.source;S.add(a?a.call(S,U):U?w._subscribe(S):w._trySubscribe(S))}),S},n.prototype._trySubscribe=function(o){try{return this._subscribe(o)}catch(u){o.error(u)}},n.prototype.forEach=function(o,u){var m=this;return u=uw(u),new u(function(w,S){var P=new wy({next:function(a){try{o(a)}catch(U){S(U),P.unsubscribe()}},error:S,complete:w});m.subscribe(P)})},n.prototype._subscribe=function(o){var u;return(u=this.source)===null||u===void 0?void 0:u.subscribe(o)},n.prototype[VA]=function(){return this},n.prototype.pipe=function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];return GA(o)(this)},n.prototype.toPromise=function(o){var u=this;return o=uw(o),new o(function(m,w){var S;u.subscribe(function(P){return S=P},function(P){return w(P)},function(){return m(S)})})},n.create=function(o){return new n(o)},n}();function uw(n){var o;return(o=n!=null?n:x0.Promise)!==null&&o!==void 0?o:Promise}function $A(n){return n&&ts(n.next)&&ts(n.error)&&ts(n.complete)}function ZA(n){return n&&n instanceof G2||$A(n)&&j2(n)}var qA=N2(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),by=function(n){ym(o,n);function o(){var u=n.call(this)||this;return u.closed=!1,u.currentObservers=null,u.observers=[],u.isStopped=!1,u.hasError=!1,u.thrownError=null,u}return o.prototype.lift=function(u){var m=new hw(this,this);return m.operator=u,m},o.prototype._throwIfClosed=function(){if(this.closed)throw new qA},o.prototype.next=function(u){var m=this;If(function(){var w,S;if(m._throwIfClosed(),!m.isStopped){m.currentObservers||(m.currentObservers=Array.from(m.observers));try{for(var P=yy(m.currentObservers),a=P.next();!a.done;a=P.next()){var U=a.value;U.next(u)}}catch(de){w={error:de}}finally{try{a&&!a.done&&(S=P.return)&&S.call(P)}finally{if(w)throw w.error}}}})},o.prototype.error=function(u){var m=this;If(function(){if(m._throwIfClosed(),!m.isStopped){m.hasError=m.isStopped=!0,m.thrownError=u;for(var w=m.observers;w.length;)w.shift().error(u)}})},o.prototype.complete=function(){var u=this;If(function(){if(u._throwIfClosed(),!u.isStopped){u.isStopped=!0;for(var m=u.observers;m.length;)m.shift().complete()}})},o.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(o.prototype,"observed",{get:function(){var u;return((u=this.observers)===null||u===void 0?void 0:u.length)>0},enumerable:!1,configurable:!0}),o.prototype._trySubscribe=function(u){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,u)},o.prototype._subscribe=function(u){return this._throwIfClosed(),this._checkFinalizedStatuses(u),this._innerSubscribe(u)},o.prototype._innerSubscribe=function(u){var m=this,w=this,S=w.hasError,P=w.isStopped,a=w.observers;return S||P?V2:(this.currentObservers=null,a.push(u),new xm(function(){m.currentObservers=null,xy(a,u)}))},o.prototype._checkFinalizedStatuses=function(u){var m=this,w=m.hasError,S=m.thrownError,P=m.isStopped;w?u.error(S):P&&u.complete()},o.prototype.asObservable=function(){var u=new cw;return u.source=this,u},o.create=function(u,m){return new hw(u,m)},o}(cw),hw=function(n){ym(o,n);function o(u,m){var w=n.call(this)||this;return w.destination=u,w.source=m,w}return o.prototype.next=function(u){var m,w;(w=(m=this.destination)===null||m===void 0?void 0:m.next)===null||w===void 0||w.call(m,u)},o.prototype.error=function(u){var m,w;(w=(m=this.destination)===null||m===void 0?void 0:m.error)===null||w===void 0||w.call(m,u)},o.prototype.complete=function(){var u,m;(m=(u=this.destination)===null||u===void 0?void 0:u.complete)===null||m===void 0||m.call(u)},o.prototype._subscribe=function(u){var m,w;return(w=(m=this.source)===null||m===void 0?void 0:m.subscribe(u))!==null&&w!==void 0?w:V2},o}(by);const{VITE_MAPS_TOKEN:WA}=w2();_y.accessToken=WA;const XA=n=>{const o=gr.exports.useRef(),u=gr.exports.useCallback(ne=>{o.current=ne},[]),m=gr.exports.useRef({}),w=gr.exports.useRef(new by),S=gr.exports.useRef(new by),P=gr.exports.useRef(),[a,U]=gr.exports.useState(n),de=gr.exports.useCallback((ne,me)=>{var kt;const{lng:Ge,lat:Ye}=(kt=ne.lngLat)!=null?kt:ne,ze=new _y.Marker;ze.id=me!=null?me:RA(),ze.setLngLat([Ge,Ye]).addTo(P.current).setDraggable(!0),m.current[ze.id]=ze,me||S.current.next({id:ze.id,lng:Ge,lat:Ye}),ze.on("drag",ge=>{const{id:he}=ge.target,{lng:we,lat:je}=ge.target.getLngLat();w.current.next({id:he,lng:we,lat:je})})},[]),Me=gr.exports.useCallback(({id:ne,lng:me,lat:Ge})=>{m.current[ne].setLngLat([me,Ge])},[]);return gr.exports.useEffect(()=>{const ne=new _y.Map({container:o.current,style:"mapbox://styles/mapbox/streets-v11",center:[n.lng,n.lat],zoom:n.zoom});ne.on("style.load",()=>{ne.setFog({})}),P.current=ne},[n]),gr.exports.useEffect(()=>{var ne;return(ne=P.current)==null||ne.on("move",()=>{const{lng:me,lat:Ge}=P.current.getCenter();U({lng:me.toFixed(4),lat:Ge.toFixed(4),zoom:P.current.getZoom().toFixed(2)})}),()=>{var me;(me=P.current)==null||me.off("move")}},[]),gr.exports.useEffect(()=>{var ne;return(ne=P.current)==null||ne.on("click",me=>{de(me)}),()=>{var me;(me=P.current)==null||me.off("click")}},[de]),{coords:a,setRef:u,marcadores:m,nuevoMarcador$:S.current,movimientoMarcador$:w.current,agregarMarcador:de,actualizarMarcador:Me}},HA={lng:-84.431,lat:10.3231,zoom:13.5},YA=()=>{const{socket:n,newMarker:o,updateMarker:u}=gr.exports.useContext(B2),{coords:m,setRef:w,nuevoMarcador$:S,movimientoMarcador$:P,agregarMarcador:a,actualizarMarcador:U}=XA(HA);return gr.exports.useEffect(()=>(n.on("marcadores-activos",de=>{for(const Me of Object.keys(de))a(de[Me],Me)}),n.on("marcador-nuevo",de=>{a(de,de.id)}),n.on("marcador-actualizado",de=>{U(de)}),()=>{n.off("marcadores-activos"),n.off("marcador-nuevo"),n.off("marcador-actualizado")}),[n]),gr.exports.useEffect(()=>(S.subscribe(de=>{o(de)}),()=>{S.unsubscribe()}),[S]),gr.exports.useEffect(()=>(P.subscribe(de=>{u(de)}),()=>{P.unsubscribe()}),[P]),sw(IA,{children:[sw("div",{className:"info",children:["Lng: ",m.lng," | Lat: ",m.lat," | Zoom: ",m.zoom]}),nd("div",{ref:w,className:"mapContainer"})]})};function KA(){return nd(MA,{children:nd(YA,{})})}yg.createRoot(document.getElementById("root")).render(nd(KA,{}));
